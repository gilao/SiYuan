{"ID":"20240301094838-qab8xmh","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f528","id":"20240301094838-qab8xmh","tags":"Go 1.22,Go-math 库","title":"Go 随机数太烂了，1.22 终于优化了","updated":"20240301095841"},"Children":[{"ID":"20240301094838-bejottn","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240301094838-bejottn","updated":"20240301095048"},"Children":[{"Type":"NodeText","Data":"深度解析 rand/v2"}]},{"ID":"20240301095049-msyk47f","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240301095049-msyk47f","updated":"20240301095100"},"Children":[{"Type":"NodeText","Data":"源码解析"}]},{"ID":"20240301095106-ng177hm","Type":"NodeParagraph","Properties":{"id":"20240301095106-ng177hm","updated":"20240301095106"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"c5340b19181ea8a7e06fb1701e68c2d4"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/c5340b19181ea8a7e06fb1701e68c2d4-20240301095106-kv3on0b.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240301095112-aawqmyb","Type":"NodeParagraph","Properties":{"id":"20240301095112-aawqmyb","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"它们由一个叫做State的结构体构成，state结构体包含如下："}]},{"ID":"20240301095112-dl1p8yy","Type":"NodeList","ListData":{},"Properties":{"id":"20240301095112-dl1p8yy","updated":"20240301095112"},"Children":[{"ID":"20240301095112-krib4aw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240301095112-krib4aw","updated":"20240301095112"},"Children":[{"ID":"20240301095112-bdb92e4","Type":"NodeParagraph","Properties":{"id":"20240301095112-bdb92e4","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"32字节的buf"}]}]},{"ID":"20240301095112-acqeanl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240301095112-acqeanl","updated":"20240301095112"},"Children":[{"ID":"20240301095112-tkdt8l7","Type":"NodeParagraph","Properties":{"id":"20240301095112-tkdt8l7","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"4字节的seed"}]}]},{"ID":"20240301095112-d2h3oqn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240301095112-d2h3oqn","updated":"20240301095112"},"Children":[{"ID":"20240301095112-hhh7358","Type":"NodeParagraph","Properties":{"id":"20240301095112-hhh7358","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"i则是当前块的下标"}]}]},{"ID":"20240301095112-21oi2hj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240301095112-21oi2hj","updated":"20240301095112"},"Children":[{"ID":"20240301095112-wj66nlr","Type":"NodeParagraph","Properties":{"id":"20240301095112-wj66nlr","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"n是有多少块"}]}]},{"ID":"20240301095112-8fqjfrb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240301095112-8fqjfrb","updated":"20240301095112"},"Children":[{"ID":"20240301095112-8eq03wz","Type":"NodeParagraph","Properties":{"id":"20240301095112-8eq03wz","updated":"20240301095112"},"Children":[{"Type":"NodeText","Data":"c则是块计数器"}]}]}]},{"ID":"20240301095113-t1m62m0","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240301095113-t1m62m0","updated":"20240301095131"},"Children":[{"Type":"NodeText","Data":"伪随机数初始化"}]},{"ID":"20240301095138-r3h7jr5","Type":"NodeParagraph","Properties":{"id":"20240301095138-r3h7jr5","updated":"20240301095202"},"Children":[{"Type":"NodeText","Data":"初始化 seed"}]},{"ID":"20240301095202-ppi4a0g","Type":"NodeParagraph","Properties":{"id":"20240301095202-ppi4a0g","updated":"20240301095237"},"Children":[{"Type":"NodeText","Data":"seed 在 randinit 中开始初始化，randinit 则是在调度器 scheinit 期间一并调用的。"}]},{"ID":"20240301095237-eu35808","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240301095237-eu35808","updated":"20240301095841"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"// randinit initializes the global random state\n// It must be called before any use of grand\nfunc randinit() {\n  lock(\u0026globalRand.lock)\n  if glboalRand.init {\n    fatal(\"randinit twice\")\n  }\n\n  seed := \u0026globalRand.seed\n  if startupRand != nil {\n    for i, c := range startupRand {\n      seed[i%len(seed)] ^= c\n    }\n    clear(startupRand)\n    startupRand = nil\n  } else {\n    if readRandom(seed[:]) != len(seed) {\n      // readRandom should never fail, but if it does we'd rather\n      // not make Go binaries completely unusable, so make up \n      // some random data based on the current time\n      readRandomFailed = true\n      readTimeRandom(seed[:])\n    }\n  }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}