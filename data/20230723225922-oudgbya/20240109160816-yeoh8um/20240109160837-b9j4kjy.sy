{"ID":"20240109160837-b9j4kjy","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f3d4","id":"20240109160837-b9j4kjy","tags":"Go-zap 库","title":"在Go语言项目中使用Zap 日志库","updated":"20240109230913"},"Children":[{"ID":"20240109160837-4jm5lnf","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240109160837-4jm5lnf","updated":"20240109160945"},"Children":[{"Type":"NodeText","Data":"介绍"}]},{"ID":"20240109160945-5ucynjr","Type":"NodeParagraph","Properties":{"id":"20240109160945-5ucynjr","updated":"20240109161610"},"Children":[{"Type":"NodeText","Data":"在许多Go语言项目中，我们需要一个好的日志记录器能够提供下面的功能："}]},{"ID":"20240109161610-qe4hw2x","Type":"NodeList","ListData":{},"Properties":{"id":"20240109161610-qe4hw2x","updated":"20240109161612"},"Children":[{"ID":"20240109161612-gj2qibf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109161612-gj2qibf","updated":"20240109161612"},"Children":[{"ID":"20240109161612-hqzxxji","Type":"NodeParagraph","Properties":{"id":"20240109161612-hqzxxji","updated":"20240109161642"},"Children":[{"Type":"NodeText","Data":"能够将事件记录到文件中，而不是应用程序控制台。"}]}]},{"ID":"20240109161642-gurvppw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109161642-gurvppw"},"Children":[{"ID":"20240109161642-bqrg2l9","Type":"NodeParagraph","Properties":{"id":"20240109161642-bqrg2l9","updated":"20240109161704"},"Children":[{"Type":"NodeText","Data":"日志切割-能够根据文件大小、时间或间隔等来切割日志文件"}]}]},{"ID":"20240109161704-am4c83v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109161704-am4c83v"},"Children":[{"ID":"20240109161704-pt4mx8c","Type":"NodeParagraph","Properties":{"id":"20240109161704-pt4mx8c","updated":"20240109161730"},"Children":[{"Type":"NodeText","Data":"支持不同的日志级别。例如INFO、DEBUG、ERROR等。"}]}]},{"ID":"20240109161730-6aq8l4z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109161730-6aq8l4z"},"Children":[{"ID":"20240109161730-pwme9a0","Type":"NodeParagraph","Properties":{"id":"20240109161730-pwme9a0","updated":"20240109161754"},"Children":[{"Type":"NodeText","Data":"能够打印基本信息，如调用文件/函数名和行号，日志时间等"}]}]}]},{"ID":"20240109161755-djlpz9t","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240109161755-djlpz9t","updated":"20240109161805"},"Children":[{"Type":"NodeText","Data":"默认的Go Logger"}]},{"ID":"20240109161805-t9vu1ay","Type":"NodeParagraph","Properties":{"id":"20240109161805-t9vu1ay","updated":"20240109161812"},"Children":[{"Type":"NodeText","Data":"在介绍Uber-go的zap包之前，让我们先看看Go语言提供的基本日志功能。Go语言提供的默认日志包是"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://golang.org/pkg/log/","TextMarkTextContent":"https://golang.org/pkg/log/"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240109160930-vhwzajj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240109160930-vhwzajj","updated":"20240109162115"},"Children":[{"Type":"NodeText","Data":"实现Go Logger"}]},{"ID":"20240109162116-a6nuy63","Type":"NodeParagraph","Properties":{"id":"20240109162116-a6nuy63","updated":"20240109162120"},"Children":[{"Type":"NodeText","Data":"实现一个Go语言中的日志记录器非常简单——创建一个新的日志文件，然后设置它为日志的输出位置。"}]},{"ID":"20240109162122-ow8mzjo","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162122-ow8mzjo","updated":"20240109162127"},"Children":[{"Type":"NodeText","Data":"设置 Logger"}]},{"ID":"20240109162128-sjp7x4i","Type":"NodeParagraph","Properties":{"id":"20240109162128-sjp7x4i","updated":"20240109162145"},"Children":[{"Type":"NodeText","Data":"我们可以像下面的代码一样设置日志记录器"}]},{"ID":"20240109162146-nfa3b6i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162146-nfa3b6i","updated":"20240109162354"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func SetupLogger() {\n  logFileLocation, _ := os.OpenFile(\"/Users/q1mi/test.log\", os.O_CREATE|os.O_APPEND|os.O_RDWR, 0744)\n  log.SetOutput(logFileLocation)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162358-5gf0wnw","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162358-5gf0wnw","updated":"20240109162405"},"Children":[{"Type":"NodeText","Data":"使用Logger"}]},{"ID":"20240109162410-cvbduzm","Type":"NodeParagraph","Properties":{"id":"20240109162410-cvbduzm","updated":"20240109162410"},"Children":[{"Type":"NodeText","Data":"让我们来写一些虚拟的代码来使用这个日志记录器。"}]},{"ID":"20240109162410-uimub88","Type":"NodeParagraph","Properties":{"id":"20240109162410-uimub88","updated":"20240109162410"},"Children":[{"Type":"NodeText","Data":"在当前的示例中，我们将建立一个到URL的HTTP连接，并将状态代码/错误记录到日志文件中。"}]},{"ID":"20240109162411-wsxoj6u","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162411-wsxoj6u","updated":"20240109162458"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func simpleHttpGet(url string) {\n\tresp, err := http.Get(url)\n\tif err != nil {\n\t\tlog.Printf(\"Error fetching url %s : %s\", url, err.Error())\n\t} else {\n\t\tlog.Printf(\"Status Code for %s : %s\", url, resp.Status)\n\t\tresp.Body.Close()\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162459-h41dpm2","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162459-h41dpm2","updated":"20240109162512"},"Children":[{"Type":"NodeText","Data":"Logger 的运行"}]},{"ID":"20240109162512-0hcxrwq","Type":"NodeParagraph","Properties":{"id":"20240109162512-0hcxrwq","updated":"20240109162517"},"Children":[{"Type":"NodeText","Data":"现在让我们执行上面的代码并查看日志记录器的运行情况。"}]},{"ID":"20240109162517-3vrlr82","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162517-3vrlr82","updated":"20240109162523"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n\tSetupLogger()\n\tsimpleHttpGet(\"www.google.com\")\n\tsimpleHttpGet(\"http://www.google.com\")\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162528-2gp3rb1","Type":"NodeParagraph","Properties":{"id":"20240109162528-2gp3rb1","updated":"20240109162528"},"Children":[{"Type":"NodeText","Data":"当我们执行上面的代码，我们能看到一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"test.log"},{"Type":"NodeText","Data":"​文件被创建，下面的内容会被添加到这个日志文件中。"}]},{"ID":"20240109162529-6bmwy38","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162529-6bmwy38","updated":"20240109162535"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"2019/05/24 01:14:13 Error fetching url www.google.com : Get www.google.com: unsupported protocol scheme \"\"\n2019/05/24 01:14:14 Status Code for http://www.google.com : 200 OK\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162539-z4oscj2","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240109162539-z4oscj2","updated":"20240109162553"},"Children":[{"Type":"NodeText","Data":"Go Logger的优势和劣势"}]},{"ID":"20240109162553-kwrun0d","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162553-kwrun0d","updated":"20240109162555"},"Children":[{"Type":"NodeText","Data":"优势"}]},{"ID":"20240109162557-94pq5bo","Type":"NodeParagraph","Properties":{"id":"20240109162557-94pq5bo","updated":"20240109162645"},"Children":[{"Type":"NodeText","Data":"它最大的优点是使用非常简单。我们可以设置任何 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"io.Writer"},{"Type":"NodeText","Data":"​作为日志记录输出并向其发送要写入的日志"}]},{"ID":"20240109162646-h3u3x2r","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162646-h3u3x2r","updated":"20240109162652"},"Children":[{"Type":"NodeText","Data":"劣势"}]},{"ID":"20240109162658-ig6haki","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162658-ig6haki","updated":"20240109162658"},"Children":[{"ID":"20240109162658-uikztl9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-uikztl9","updated":"20240109162658"},"Children":[{"ID":"20240109162658-29gmfj3","Type":"NodeParagraph","Properties":{"id":"20240109162658-29gmfj3","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"仅限基本的日志级别"}]},{"ID":"20240109162658-7ewqd0u","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162658-7ewqd0u","updated":"20240109162658"},"Children":[{"ID":"20240109162658-6kkk5d9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-6kkk5d9","updated":"20240109162658"},"Children":[{"ID":"20240109162658-1jafd03","Type":"NodeParagraph","Properties":{"id":"20240109162658-1jafd03","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"只有一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Print"},{"Type":"NodeText","Data":"​选项。不支持"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"INFO"},{"Type":"NodeText","Data":"​/"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DEBUG"},{"Type":"NodeText","Data":"​等多个级别。"}]}]}]}]},{"ID":"20240109162658-q7t9ixk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-q7t9ixk","updated":"20240109162658"},"Children":[{"ID":"20240109162658-k4fa6fb","Type":"NodeParagraph","Properties":{"id":"20240109162658-k4fa6fb","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"对于错误日志，它有"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Fatal"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Panic"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240109162658-7ucjca0","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162658-7ucjca0","updated":"20240109162658"},"Children":[{"ID":"20240109162658-04bz2ke","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-04bz2ke","updated":"20240109162658"},"Children":[{"ID":"20240109162658-1igkmtu","Type":"NodeParagraph","Properties":{"id":"20240109162658-1igkmtu","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"Fatal日志通过调用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"os.Exit(1)"},{"Type":"NodeText","Data":"​来结束程序"}]}]},{"ID":"20240109162658-90jli3k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-90jli3k","updated":"20240109162658"},"Children":[{"ID":"20240109162658-6ykr0wz","Type":"NodeParagraph","Properties":{"id":"20240109162658-6ykr0wz","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"Panic日志在写入日志消息之后抛出一个panic"}]}]},{"ID":"20240109162658-ift7g5k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-ift7g5k","updated":"20240109162658"},"Children":[{"ID":"20240109162658-amnzbnf","Type":"NodeParagraph","Properties":{"id":"20240109162658-amnzbnf","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"但是它缺少一个ERROR日志级别，这个级别可以在不抛出panic或退出程序的情况下记录错误"}]}]}]}]},{"ID":"20240109162658-v1boj4e","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-v1boj4e","updated":"20240109162658"},"Children":[{"ID":"20240109162658-1zl4pv3","Type":"NodeParagraph","Properties":{"id":"20240109162658-1zl4pv3","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"缺乏日志格式化的能力——例如记录调用者的函数名和行号，格式化日期和时间格式。等等。"}]}]},{"ID":"20240109162658-81yamju","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162658-81yamju","updated":"20240109162658"},"Children":[{"ID":"20240109162658-c0xyjmq","Type":"NodeParagraph","Properties":{"id":"20240109162658-c0xyjmq","updated":"20240109162658"},"Children":[{"Type":"NodeText","Data":"不提供日志切割的能力。"}]}]}]},{"ID":"20240109162707-vq3gqtz","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240109162707-vq3gqtz","updated":"20240109162731"},"Children":[{"Type":"NodeText","Data":"Uber-go Zap"}]},{"ID":"20240109162732-df7swg4","Type":"NodeParagraph","Properties":{"id":"20240109162732-df7swg4","updated":"20240109162749"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/uber-go/zap","TextMarkTextContent":"Zap"},{"Type":"NodeText","Data":"是非常快的、结构化的，分日志级别的Go日志库。"}]},{"ID":"20240109162750-j2zj085","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240109162750-j2zj085","updated":"20240109162802"},"Children":[{"Type":"NodeText","Data":"为什么选择Uber-go zap"}]},{"ID":"20240109162821-lbqzhkz","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162821-lbqzhkz","updated":"20240109162821"},"Children":[{"ID":"20240109162821-ael7kac","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-ael7kac","updated":"20240109162821"},"Children":[{"ID":"20240109162821-4crrzvy","Type":"NodeParagraph","Properties":{"id":"20240109162821-4crrzvy","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"它同时提供了结构化日志记录和printf风格的日志记录"}]}]},{"ID":"20240109162821-av5fxwj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-av5fxwj","updated":"20240109162821"},"Children":[{"ID":"20240109162821-gob3jmo","Type":"NodeParagraph","Properties":{"id":"20240109162821-gob3jmo","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"它非常的快"}]}]}]},{"ID":"20240109162821-cl2vkka","Type":"NodeParagraph","Properties":{"id":"20240109162821-cl2vkka","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"根据Uber-go Zap的文档，它的性能比类似的结构化日志包更好——也比标准库更快。 以下是Zap发布的基准测试信息"}]},{"ID":"20240109162821-7vwnc2n","Type":"NodeParagraph","Properties":{"id":"20240109162821-7vwnc2n","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"记录一条消息和10个字段:"}]},{"ID":"20240109162821-y6cbq6w","Type":"NodeTable","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20240109162821-y6cbq6w","updated":"20240109162821"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Package"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Time"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Time % to zap"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Objects Allocated"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"⚡️ zap"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"862 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+0%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"5 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"⚡️ zap (sugared)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"1250 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+45%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"11 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"zerolog"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"4021 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+366%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"76 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"go-kit"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"4542 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+427%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"105 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"apex/log"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"26785 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+3007%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"115 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"logrus"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"29501 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+3322%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"125 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"log15"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"29906 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+3369%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"122 allocs/op"}]}]}]},{"ID":"20240109162821-xbpr6m1","Type":"NodeParagraph","Properties":{"id":"20240109162821-xbpr6m1","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"记录一个静态字符串，没有任何上下文或printf风格的模板："}]},{"ID":"20240109162821-witx1pc","Type":"NodeTable","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20240109162821-witx1pc","updated":"20240109162821"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Package"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Time"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Time % to zap"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Objects Allocated"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"⚡️ zap"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"118 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+0%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"0 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"⚡️ zap (sugared)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"191 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+62%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"2 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"zerolog"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"93 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-21%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"0 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"go-kit"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"280 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+137%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"11 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"standard library"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"499 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+323%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"2 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"apex/log"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"1990 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+1586%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"10 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"logrus"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"3129 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+2552%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"24 allocs/op"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"log15"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"3887 ns/op"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"+3194%"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"23 allocs/op"}]}]}]},{"ID":"20240109162821-phy92ey","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162821-phy92ey","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"安装"}]},{"ID":"20240109162821-b3anjz8","Type":"NodeParagraph","Properties":{"id":"20240109162821-b3anjz8","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"运行下面的命令安装zap"}]},{"ID":"20240109162821-gohc7s1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-gohc7s1","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"go get -u go.uber.org/zap\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-a5pvddr","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109162821-a5pvddr","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"配置Zap Logger"}]},{"ID":"20240109162821-zd9i1ln","Type":"NodeParagraph","Properties":{"id":"20240109162821-zd9i1ln","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"Zap提供了两种类型的日志记录器—"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Sugared Logger"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Logger"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240109162821-020j77d","Type":"NodeParagraph","Properties":{"id":"20240109162821-020j77d","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"在性能很好但不是很关键的上下文中，使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SugaredLogger"},{"Type":"NodeText","Data":"​。它比其他结构化日志记录包快4-10倍，并且支持结构化和printf风格的日志记录。"}]},{"ID":"20240109162821-v0wcl7s","Type":"NodeParagraph","Properties":{"id":"20240109162821-v0wcl7s","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"在每一微秒和每一次内存分配都很重要的上下文中，使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Logger"},{"Type":"NodeText","Data":"​。它甚至比"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SugaredLogger"},{"Type":"NodeText","Data":"​更快，内存分配次数也更少，但它只支持强类型的结构化日志记录。"}]},{"ID":"20240109162821-04imjf0","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109162821-04imjf0","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"Logger"}]},{"ID":"20240109162821-vmzqvqq","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162821-vmzqvqq","updated":"20240109162821"},"Children":[{"ID":"20240109162821-7sfu44q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-7sfu44q","updated":"20240109162821"},"Children":[{"ID":"20240109162821-tw3a4fh","Type":"NodeParagraph","Properties":{"id":"20240109162821-tw3a4fh","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"通过调用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.NewProduction()"},{"Type":"NodeText","Data":"​/"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.NewDevelopment()"},{"Type":"NodeText","Data":"​或者"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.Example()"},{"Type":"NodeText","Data":"​创建一个Logger。"}]}]},{"ID":"20240109162821-b4v96ie","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-b4v96ie","updated":"20240109162821"},"Children":[{"ID":"20240109162821-ppfdm5u","Type":"NodeParagraph","Properties":{"id":"20240109162821-ppfdm5u","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"上面的每一个函数都将创建一个logger。唯一的区别在于它将记录的信息不同。例如production logger默认记录调用函数信息、日期和时间等。"}]}]},{"ID":"20240109162821-fvcnm39","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-fvcnm39","updated":"20240109162821"},"Children":[{"ID":"20240109162821-q6bkmlm","Type":"NodeParagraph","Properties":{"id":"20240109162821-q6bkmlm","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"通过Logger调用Info/Error等。"}]}]},{"ID":"20240109162821-fk5xp11","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-fk5xp11","updated":"20240109162821"},"Children":[{"ID":"20240109162821-85hxcjw","Type":"NodeParagraph","Properties":{"id":"20240109162821-85hxcjw","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"默认情况下日志都会打印到应用程序的console界面。"}]}]}]},{"ID":"20240109162821-g8m5lta","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-g8m5lta","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"var logger *zap.Logger\n\nfunc main() {\n\tInitLogger()\n  defer logger.Sync()\n\tsimpleHttpGet(\"www.google.com\")\n\tsimpleHttpGet(\"http://www.google.com\")\n}\n\nfunc InitLogger() {\n\tlogger, _ = zap.NewProduction()\n}\n\nfunc simpleHttpGet(url string) {\n\tresp, err := http.Get(url)\n\tif err != nil {\n\t\tlogger.Error(\n\t\t\t\"Error fetching url..\",\n\t\t\tzap.String(\"url\", url),\n\t\t\tzap.Error(err))\n\t} else {\n\t\tlogger.Info(\"Success..\",\n\t\t\tzap.String(\"statusCode\", resp.Status),\n\t\t\tzap.String(\"url\", url))\n\t\tresp.Body.Close()\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-l5mqnwk","Type":"NodeParagraph","Properties":{"id":"20240109162821-l5mqnwk","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"在上面的代码中，我们首先创建了一个Logger，然后使用Info/ Error等Logger方法记录消息。"}]},{"ID":"20240109162821-qyeremm","Type":"NodeParagraph","Properties":{"id":"20240109162821-qyeremm","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"日志记录器方法的语法是这样的："}]},{"ID":"20240109162821-0shrzdh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-0shrzdh","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func (log *Logger) MethodXXX(msg string, fields ...Field) \n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-3atqqco","Type":"NodeParagraph","Properties":{"id":"20240109162821-3atqqco","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"其中"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"MethodXXX"},{"Type":"NodeText","Data":"​是一个可变参数函数，可以是Info / Error/ Debug / Panic等。每个方法都接受一个消息字符串和任意数量的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zapcore.Field"},{"Type":"NodeText","Data":"​场参数。"}]},{"ID":"20240109162821-pu0m3dv","Type":"NodeParagraph","Properties":{"id":"20240109162821-pu0m3dv","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"每个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zapcore.Field"},{"Type":"NodeText","Data":"​其实就是一组键值对参数。"}]},{"ID":"20240109162821-wwmb9cv","Type":"NodeParagraph","Properties":{"id":"20240109162821-wwmb9cv","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"我们执行上面的代码会得到如下输出结果："}]},{"ID":"20240109162821-7led9n4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-7led9n4","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"{\"level\":\"error\",\"ts\":1572159218.912792,\"caller\":\"zap_demo/temp.go:25\",\"msg\":\"Error fetching url..\",\"url\":\"www.sogo.com\",\"error\":\"Get www.sogo.com: unsupported protocol scheme \\\"\\\"\",\"stacktrace\":\"main.simpleHttpGet\\n\\t/Users/q1mi/zap_demo/temp.go:25\\nmain.main\\n\\t/Users/q1mi/zap_demo/temp.go:14\\nruntime.main\\n\\t/usr/local/go/src/runtime/proc.go:203\"}\n{\"level\":\"info\",\"ts\":1572159219.1227388,\"caller\":\"zap_demo/temp.go:30\",\"msg\":\"Success..\",\"statusCode\":\"200 OK\",\"url\":\"http://www.sogo.com\"}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-oaq0lmy","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109162821-oaq0lmy","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"Sugared Logger"}]},{"ID":"20240109162821-3rdhe1q","Type":"NodeParagraph","Properties":{"id":"20240109162821-3rdhe1q","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"现在让我们使用Sugared Logger来实现相同的功能。"}]},{"ID":"20240109162821-ab6bggm","Type":"NodeList","ListData":{},"Properties":{"id":"20240109162821-ab6bggm","updated":"20240109162821"},"Children":[{"ID":"20240109162821-9sswsfe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-9sswsfe","updated":"20240109162821"},"Children":[{"ID":"20240109162821-ujy94p2","Type":"NodeParagraph","Properties":{"id":"20240109162821-ujy94p2","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"大部分的实现基本都相同。"}]}]},{"ID":"20240109162821-vxd6q7s","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-vxd6q7s","updated":"20240109162821"},"Children":[{"ID":"20240109162821-vw5vh7w","Type":"NodeParagraph","Properties":{"id":"20240109162821-vw5vh7w","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"惟一的区别是，我们通过调用主logger的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":". Sugar()"},{"Type":"NodeText","Data":"​方法来获取一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SugaredLogger"},{"Type":"NodeText","Data":"​。"}]}]},{"ID":"20240109162821-tije2nz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109162821-tije2nz","updated":"20240109162821"},"Children":[{"ID":"20240109162821-cl86gn0","Type":"NodeParagraph","Properties":{"id":"20240109162821-cl86gn0","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"然后使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SugaredLogger"},{"Type":"NodeText","Data":"​以"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"printf"},{"Type":"NodeText","Data":"​格式记录语句"}]}]}]},{"ID":"20240109162821-2iirp3g","Type":"NodeParagraph","Properties":{"id":"20240109162821-2iirp3g","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"下面是修改过后使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SugaredLogger"},{"Type":"NodeText","Data":"​代替"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Logger"},{"Type":"NodeText","Data":"​的代码："}]},{"ID":"20240109162821-9et0g0o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-9et0g0o","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"var sugarLogger *zap.SugaredLogger\n\nfunc main() {\n\tInitLogger()\n\tdefer sugarLogger.Sync()\n\tsimpleHttpGet(\"www.google.com\")\n\tsimpleHttpGet(\"http://www.google.com\")\n}\n\nfunc InitLogger() {\n  logger, _ := zap.NewProduction()\n\tsugarLogger = logger.Sugar()\n}\n\nfunc simpleHttpGet(url string) {\n\tsugarLogger.Debugf(\"Trying to hit GET request for %s\", url)\n\tresp, err := http.Get(url)\n\tif err != nil {\n\t\tsugarLogger.Errorf(\"Error fetching URL %s : Error = %s\", url, err)\n\t} else {\n\t\tsugarLogger.Infof(\"Success! statusCode = %s for URL %s\", resp.Status, url)\n\t\tresp.Body.Close()\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-gr78aru","Type":"NodeParagraph","Properties":{"id":"20240109162821-gr78aru","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"当你执行上面的代码会得到如下输出："}]},{"ID":"20240109162821-3xecnv5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109162821-3xecnv5","updated":"20240109162821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"{\"level\":\"error\",\"ts\":1572159149.923002,\"caller\":\"logic/temp2.go:27\",\"msg\":\"Error fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \\\"\\\"\",\"stacktrace\":\"main.simpleHttpGet\\n\\t/Users/q1mi/zap_demo/logic/temp2.go:27\\nmain.main\\n\\t/Users/q1mi/zap_demo/logic/temp2.go:14\\nruntime.main\\n\\t/usr/local/go/src/runtime/proc.go:203\"}\n{\"level\":\"info\",\"ts\":1572159150.192585,\"caller\":\"logic/temp2.go:29\",\"msg\":\"Success! statusCode = 200 OK for URL http://www.sogo.com\"}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109162821-el5u88m","Type":"NodeParagraph","Properties":{"id":"20240109162821-el5u88m","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"你应该注意到的了，到目前为止这两个logger都打印输出JSON结构格式。"}]},{"ID":"20240109162821-r5pm4aa","Type":"NodeParagraph","Properties":{"id":"20240109162821-r5pm4aa","updated":"20240109162821"},"Children":[{"Type":"NodeText","Data":"在本博客的后面部分，我们将更详细地讨论SugaredLogger，并了解如何进一步配置它。"}]},{"ID":"20240109212502-h67ftiv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109212502-h67ftiv","updated":"20240109212509"},"Children":[{"Type":"NodeText","Data":"定制logger"}]},{"ID":"20240109212509-amb94f5","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109212509-amb94f5","updated":"20240109212534"},"Children":[{"Type":"NodeText","Data":"将日志写入文件而不是终端"}]},{"ID":"20240109212544-jrbeblw","Type":"NodeParagraph","Properties":{"id":"20240109212544-jrbeblw","updated":"20240109212544"},"Children":[{"Type":"NodeText","Data":"我们要做的第一个更改是把日志写入文件，而不是打印到应用程序控制台。"}]},{"ID":"20240109212544-5h7e3st","Type":"NodeList","ListData":{},"Properties":{"id":"20240109212544-5h7e3st","updated":"20240109212544"},"Children":[{"ID":"20240109212544-j2yfeqy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109212544-j2yfeqy","updated":"20240109212544"},"Children":[{"ID":"20240109212544-j5jfwn8","Type":"NodeParagraph","Properties":{"id":"20240109212544-j5jfwn8","updated":"20240109212544"},"Children":[{"Type":"NodeText","Data":"我们将使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.New(…)"},{"Type":"NodeText","Data":"​方法来手动传递所有配置，而不是使用像"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.NewProduction()"},{"Type":"NodeText","Data":"​这样的预置方法来创建logger。"}]}]}]},{"ID":"20240109212545-65566l4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109212545-65566l4","updated":"20240109212615"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func New(core zapcore.Core, options ...Options) *Logger\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109212630-4fnamax","Type":"NodeParagraph","Properties":{"id":"20240109212630-4fnamax","updated":"20240109212633"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zapcore.Core"},{"Type":"NodeText","Data":"​需要三个配置——"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Encoder"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WriteSyncer"},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LogLevel"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240109212634-cbl9iiq","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240109212634-cbl9iiq","updated":"20240109212919"},"Children":[{"ID":"20240109212839-yhhiqy3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240109212839-yhhiqy3","updated":"20240109212919"},"Children":[{"ID":"20240109212839-kx4cqg1","Type":"NodeParagraph","Properties":{"id":"20240109212839-kx4cqg1","updated":"20240109212901"},"Children":[{"Type":"NodeText","Data":"Encoder: 编码器 如何写入日志，"}]},{"ID":"20240109212909-6xy9y50","Type":"NodeParagraph","Properties":{"id":"20240109212909-6xy9y50","updated":"20240109212909"},"Children":[{"Type":"NodeText","Data":"我们将使用开箱即用的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NewJSONEncoder()"},{"Type":"NodeText","Data":"​，并使用预先设置的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ProductionEncoderConfig()"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240109212909-3kz7k8v","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109212909-3kz7k8v","updated":"20240109212919"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig())\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240109212921-6va54ee","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240109212921-6va54ee","updated":"20240109213201"},"Children":[{"ID":"20240109212950-qqpbrlp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240109212950-qqpbrlp","updated":"20240109213201"},"Children":[{"ID":"20240109212950-q2ch6tx","Type":"NodeParagraph","Properties":{"id":"20240109212950-q2ch6tx","updated":"20240109213201"},"Children":[{"Type":"NodeText","Data":"WriterSyncer：指定日志将写到哪里去。我们使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zapcore.AddSync()"},{"Type":"NodeText","Data":"​函数并且将打开的文件句柄传进去。"}]}]}]},{"ID":"20240109213116-3g8cj1c","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213116-3g8cj1c","updated":"20240109213135"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"file, _ := os.Create(\"./test.log\")\nwriteSyncer := zapcore.AddSync(file)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213136-1robh3x","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240109213136-1robh3x","updated":"20240109213146"},"Children":[{"ID":"20240109213146-xb0tx7v","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240109213146-xb0tx7v","updated":"20240109213146"},"Children":[{"ID":"20240109213146-rm3rfi0","Type":"NodeParagraph","Properties":{"id":"20240109213146-rm3rfi0","updated":"20240109213224"},"Children":[{"Type":"NodeText","Data":"Log Level：哪种级别的日志将被写入。"}]}]}]},{"ID":"20240109213240-yh1ne20","Type":"NodeParagraph","Properties":{"id":"20240109213240-yh1ne20","updated":"20240109213240"},"Children":[{"Type":"NodeText","Data":"我们将修改上述部分中的Logger代码，并重写"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"InitLogger()"},{"Type":"NodeText","Data":"​方法。其余方法—"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main()"},{"Type":"NodeText","Data":"​ /"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SimpleHttpGet()"},{"Type":"NodeText","Data":"​保持不变。"}]},{"ID":"20240109213240-nnj76t6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213240-nnj76t6","updated":"20240109213240"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func InitLogger() {\n\twriteSyncer := getLogWriter()\n\tencoder := getEncoder()\n\tcore := zapcore.NewCore(encoder, writeSyncer, zapcore.DebugLevel)\n\n\tlogger := zap.New(core)\n\tsugarLogger = logger.Sugar()\n}\n\nfunc getEncoder() zapcore.Encoder {\n\treturn zapcore.NewJSONEncoder(zap.NewProductionEncoderConfig())\n}\n\nfunc getLogWriter() zapcore.WriteSyncer {\n\tfile, _ := os.Create(\"./test.log\")\n\treturn zapcore.AddSync(file)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213240-9p3pyqe","Type":"NodeParagraph","Properties":{"id":"20240109213240-9p3pyqe","updated":"20240109213240"},"Children":[{"Type":"NodeText","Data":"当使用这些修改过的logger配置调用上述部分的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main()"},{"Type":"NodeText","Data":"​函数时，以下输出将打印在文件——"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"test.log"},{"Type":"NodeText","Data":"​中。"}]},{"ID":"20240109213240-f9gx3xd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213240-f9gx3xd","updated":"20240109213240"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"{\"level\":\"debug\",\"ts\":1572160754.994731,\"msg\":\"Trying to hit GET request for www.sogo.com\"}\n{\"level\":\"error\",\"ts\":1572160754.994982,\"msg\":\"Error fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \\\"\\\"\"}\n{\"level\":\"debug\",\"ts\":1572160754.994996,\"msg\":\"Trying to hit GET request for http://www.sogo.com\"}\n{\"level\":\"info\",\"ts\":1572160757.3755069,\"msg\":\"Success! statusCode = 200 OK for URL http://www.sogo.com\"}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213247-ohntho3","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109213247-ohntho3","updated":"20240109213327"},"Children":[{"Type":"NodeText","Data":"将JSON Encoder 更改为普通的Log Encoder"}]},{"ID":"20240109213525-tsopjld","Type":"NodeParagraph","Properties":{"id":"20240109213525-tsopjld","updated":"20240109213525"},"Children":[{"Type":"NodeText","Data":"现在，我们希望将编码器从JSON Encoder更改为普通Encoder。为此，我们需要将"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NewJSONEncoder()"},{"Type":"NodeText","Data":"​更改为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NewConsoleEncoder()"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240109213525-n742lcj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213525-n742lcj","updated":"20240109213525"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"return zapcore.NewConsoleEncoder(zap.NewProductionEncoderConfig())\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213525-u42q0e0","Type":"NodeParagraph","Properties":{"id":"20240109213525-u42q0e0","updated":"20240109213525"},"Children":[{"Type":"NodeText","Data":"当使用这些修改过的logger配置调用上述部分的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main()"},{"Type":"NodeText","Data":"​函数时，以下输出将打印在文件——"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"test.log"},{"Type":"NodeText","Data":"​中。"}]},{"ID":"20240109213525-8r0z5k6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213525-8r0z5k6","updated":"20240109213525"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"1.572161051846623e+09\tdebug\tTrying to hit GET request for www.sogo.com\n1.572161051846828e+09\terror\tError fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \"\"\n1.5721610518468401e+09\tdebug\tTrying to hit GET request for http://www.sogo.com\n1.572161052068744e+09\tinfo\tSuccess! statusCode = 200 OK for URL http://www.sogo.com\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213525-2udjcm6","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109213525-2udjcm6","updated":"20240109213525"},"Children":[{"Type":"NodeText","Data":"更改时间编码并添加调用者详细信息"}]},{"ID":"20240109213549-tmp9j0v","Type":"NodeParagraph","Properties":{"id":"20240109213549-tmp9j0v","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"鉴于我们对配置所做的更改，有下面两个问题："}]},{"ID":"20240109213549-lo61xgk","Type":"NodeList","ListData":{},"Properties":{"id":"20240109213549-lo61xgk","updated":"20240109213549"},"Children":[{"ID":"20240109213549-zft6vgt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109213549-zft6vgt","updated":"20240109213549"},"Children":[{"ID":"20240109213549-jrqh4wh","Type":"NodeParagraph","Properties":{"id":"20240109213549-jrqh4wh","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"时间是以非人类可读的方式展示，例如1.572161051846623e+09"}]}]},{"ID":"20240109213549-1y9g6v4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109213549-1y9g6v4","updated":"20240109213549"},"Children":[{"ID":"20240109213549-m7acd2w","Type":"NodeParagraph","Properties":{"id":"20240109213549-m7acd2w","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"调用方函数的详细信息没有显示在日志中"}]}]}]},{"ID":"20240109213549-w8g50t0","Type":"NodeParagraph","Properties":{"id":"20240109213549-w8g50t0","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"我们要做的第一件事是覆盖默认的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ProductionConfig()"},{"Type":"NodeText","Data":"​，并进行以下更改:"}]},{"ID":"20240109213549-mroagfj","Type":"NodeList","ListData":{},"Properties":{"id":"20240109213549-mroagfj","updated":"20240109213549"},"Children":[{"ID":"20240109213549-0q73q87","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109213549-0q73q87","updated":"20240109213549"},"Children":[{"ID":"20240109213549-p2py436","Type":"NodeParagraph","Properties":{"id":"20240109213549-p2py436","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"修改时间编码器"}]}]},{"ID":"20240109213549-1twukmb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109213549-1twukmb","updated":"20240109213549"},"Children":[{"ID":"20240109213549-cu8jhua","Type":"NodeParagraph","Properties":{"id":"20240109213549-cu8jhua","updated":"20240109213549"},"Children":[{"Type":"NodeText","Data":"在日志文件中使用大写字母记录日志级别"}]}]}]},{"ID":"20240109213601-wf52wwz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213601-wf52wwz","updated":"20240109213603"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func getEncoder() zapcore.Encoder {\n\tencoderConfig := zap.NewProductionEncoderConfig()\n\tencoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder\n\tencoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder\n\treturn zapcore.NewConsoleEncoder(encoderConfig)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213619-dckyaoe","Type":"NodeParagraph","Properties":{"id":"20240109213619-dckyaoe","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"接下来，我们将修改zap logger代码，添加将调用函数信息记录到日志中的功能。为此，我们将在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"zap.New(..)"},{"Type":"NodeText","Data":"​函数中添加一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Option"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240109213619-sk3hckf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213619-sk3hckf","updated":"20240109213619"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"logger := zap.New(core, zap.AddCaller())\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213619-t5vzu9t","Type":"NodeParagraph","Properties":{"id":"20240109213619-t5vzu9t","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"当使用这些修改过的logger配置调用上述部分的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main()"},{"Type":"NodeText","Data":"​函数时，以下输出将打印在文件——"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"test.log"},{"Type":"NodeText","Data":"​中。"}]},{"ID":"20240109213619-sx0f7ut","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213619-sx0f7ut","updated":"20240109213619"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"2019-10-27T15:33:29.855+0800\tDEBUG\tlogic/temp2.go:47\tTrying to hit GET request for www.sogo.com\n2019-10-27T15:33:29.855+0800\tERROR\tlogic/temp2.go:50\tError fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \"\"\n2019-10-27T15:33:29.856+0800\tDEBUG\tlogic/temp2.go:47\tTrying to hit GET request for http://www.sogo.com\n2019-10-27T15:33:30.125+0800\tINFO\tlogic/temp2.go:52\tSuccess! statusCode = 200 OK for URL http://www.sogo.com\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213619-ryitwkt","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109213619-ryitwkt","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"AddCallerSkip"}]},{"ID":"20240109213619-8yo7336","Type":"NodeParagraph","Properties":{"id":"20240109213619-8yo7336","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"当我们不是直接使用初始化好的logger实例记录日志，而是将其包装成一个函数等，此时日录日志的函数调用链会增加，想要获得准确的调用信息就需要通过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AddCallerSkip"},{"Type":"NodeText","Data":"​函数来跳过。"}]},{"ID":"20240109213619-a7wujol","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213619-a7wujol","updated":"20240109213619"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"logger := zap.New(core, zap.AddCaller(), zap.AddCallerSkip(1))\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213619-4ndk4iv","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109213619-4ndk4iv","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"将日志输出到多个位置"}]},{"ID":"20240109213619-fj2n8jd","Type":"NodeParagraph","Properties":{"id":"20240109213619-fj2n8jd","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"我们可以将日志同时输出到文件和终端。"}]},{"ID":"20240109213619-6ahxagg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213619-6ahxagg","updated":"20240109213619"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func getLogWriter() zapcore.WriteSyncer {\n\tfile, _ := os.Create(\"./test.log\")\n\t// 利用io.MultiWriter支持文件和终端两个输出目标\n\tws := io.MultiWriter(file, os.Stdout)\n\treturn zapcore.AddSync(ws)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109213619-kohmf7k","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240109213619-kohmf7k","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"将err日志单独输出到文件"}]},{"ID":"20240109213619-9qqh0p7","Type":"NodeParagraph","Properties":{"id":"20240109213619-9qqh0p7","updated":"20240109213619"},"Children":[{"Type":"NodeText","Data":"有时候我们除了将全量日志输出到"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xx.log"},{"Type":"NodeText","Data":"​文件中之外，还希望将"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ERROR"},{"Type":"NodeText","Data":"​级别的日志单独输出到一个名为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xx.err.log"},{"Type":"NodeText","Data":"​的日志文件中。我们可以通过以下方式实现。"}]},{"ID":"20240109213619-2xof0qj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109213619-2xof0qj","updated":"20240109213619"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func InitLogger() {\n\tencoder := getEncoder()\n\t// test.log记录全量日志\n\tlogF, _ := os.Create(\"./test.log\")\n\tc1 := zapcore.NewCore(encoder, zapcore.AddSync(logF), zapcore.DebugLevel)\n\t// test.err.log记录ERROR级别的日志\n\terrF, _ := os.Create(\"./test.err.log\")\n\tc2 := zapcore.NewCore(encoder, zapcore.AddSync(errF), zap.ErrorLevel)\n\t// 使用NewTee将c1和c2合并到core\n\tcore := zapcore.NewTee(c1, c2)\n\tlogger = zap.New(core, zap.AddCaller())\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230544-80qpn4e","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240109230544-80qpn4e","updated":"20240109230604"},"Children":[{"Type":"NodeText","Data":"使用 Lumberjack 进行日志切割归档"}]},{"ID":"20240109230620-z6gzkeq","Type":"NodeParagraph","Properties":{"id":"20240109230620-z6gzkeq","updated":"20240109230620"},"Children":[{"Type":"NodeText","Data":"这个日志程序中唯一缺少的就是日志切割归档功能。"}]},{"ID":"20240109230620-ean4zr8","Type":"NodeBlockquote","Properties":{"id":"20240109230620-ean4zr8","updated":"20240109230620"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240109230620-5ljlhs2","Type":"NodeParagraph","Properties":{"id":"20240109230620-5ljlhs2","updated":"20240109230620"},"Children":[{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"Zap本身不支持切割归档日志文件"}]}]},{"ID":"20240109230620-dp53zkl","Type":"NodeParagraph","Properties":{"id":"20240109230620-dp53zkl","updated":"20240109230620"},"Children":[{"Type":"NodeText","Data":"官方的说法是为了添加日志切割归档功能，我们将使用第三方库"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/natefinch/lumberjack","TextMarkTextContent":"Lumberjack"},{"Type":"NodeText","Data":"来实现。"}]},{"ID":"20240109230620-0th59yj","Type":"NodeParagraph","Properties":{"id":"20240109230620-0th59yj","updated":"20240109230620"},"Children":[{"Type":"NodeText","Data":"目前只支持按文件大小切割，原因是按时间切割效率低且不能保证日志数据不被破坏。详情戳"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/natefinch/lumberjack/issues/54","TextMarkTextContent":"https://github.com/natefinch/lumberjack/issues/54"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240109230620-wwxvbge","Type":"NodeParagraph","Properties":{"id":"20240109230620-wwxvbge","updated":"20240109230620"},"Children":[{"Type":"NodeText","Data":"想按日期切割可以使用"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/lestrrat-go/file-rotatelogs","TextMarkTextContent":"github.com/lestrrat-go/file-rotatelogs"},{"Type":"NodeText","Data":"这个库，虽然目前不维护了，但也够用了。"}]},{"ID":"20240109230625-dfxc12a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109230625-dfxc12a","updated":"20240109230741"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"// 使用file-rotatelogs按天切割日志\n\nimport rotatelogs \"github.com/lestrrat-go/file-rotatelogs\"\n\nl, _ := rotatelogs.New(\n\tfilename+\".%Y%m%d%H%M\",\n\trotatelogs.WithMaxAge(30*24*time.Hour),    // 最长保存30天\n\trotatelogs.WithRotationTime(time.Hour*24), // 24小时切割一次\n)\nzapcore.AddSync(l)"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230742-2ck2o20","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240109230742-2ck2o20","updated":"20240109230803"},"Children":[{"Type":"NodeText","Data":"安装"}]},{"ID":"20240109230913-bcf3qcm","Type":"NodeParagraph","Properties":{"id":"20240109230913-bcf3qcm","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"执行下面的命令安装 Lumberjack v2 版本。"}]},{"ID":"20240109230913-51d7wp2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109230913-51d7wp2","updated":"20240109230913"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"go get gopkg.in/natefinch/lumberjack.v2\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230913-rah1rtx","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109230913-rah1rtx","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"zap logger中加入Lumberjack"}]},{"ID":"20240109230913-iej8lxc","Type":"NodeParagraph","Properties":{"id":"20240109230913-iej8lxc","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"要在zap中加入Lumberjack支持，我们需要修改"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WriteSyncer"},{"Type":"NodeText","Data":"​代码。我们将按照下面的代码修改"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"getLogWriter()"},{"Type":"NodeText","Data":"​函数："}]},{"ID":"20240109230913-2dhv8po","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109230913-2dhv8po","updated":"20240109230913"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func getLogWriter() zapcore.WriteSyncer {\n\tlumberJackLogger := \u0026lumberjack.Logger{\n\t\tFilename:   \"./test.log\",\n\t\tMaxSize:    10,\n\t\tMaxBackups: 5,\n\t\tMaxAge:     30,\n\t\tCompress:   false,\n\t}\n\treturn zapcore.AddSync(lumberJackLogger)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230913-r32x8st","Type":"NodeParagraph","Properties":{"id":"20240109230913-r32x8st","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"Lumberjack Logger采用以下属性作为输入:"}]},{"ID":"20240109230913-fr1syrd","Type":"NodeList","ListData":{},"Properties":{"id":"20240109230913-fr1syrd","updated":"20240109230913"},"Children":[{"ID":"20240109230913-a8dbhf2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109230913-a8dbhf2","updated":"20240109230913"},"Children":[{"ID":"20240109230913-lc70ng1","Type":"NodeParagraph","Properties":{"id":"20240109230913-lc70ng1","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"Filename: 日志文件的位置"}]}]},{"ID":"20240109230913-am96jr1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109230913-am96jr1","updated":"20240109230913"},"Children":[{"ID":"20240109230913-2czow37","Type":"NodeParagraph","Properties":{"id":"20240109230913-2czow37","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"MaxSize：在进行切割之前，日志文件的最大大小（以MB为单位）"}]}]},{"ID":"20240109230913-fw4xrtf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109230913-fw4xrtf","updated":"20240109230913"},"Children":[{"ID":"20240109230913-45xx18y","Type":"NodeParagraph","Properties":{"id":"20240109230913-45xx18y","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"MaxBackups：保留旧文件的最大个数"}]}]},{"ID":"20240109230913-5ofbndc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109230913-5ofbndc","updated":"20240109230913"},"Children":[{"ID":"20240109230913-cm7wo0p","Type":"NodeParagraph","Properties":{"id":"20240109230913-cm7wo0p","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"MaxAges：保留旧文件的最大天数"}]}]},{"ID":"20240109230913-t1y4kfm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240109230913-t1y4kfm","updated":"20240109230913"},"Children":[{"ID":"20240109230913-f7pb2q3","Type":"NodeParagraph","Properties":{"id":"20240109230913-f7pb2q3","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"Compress：是否压缩/归档旧文件"}]}]}]},{"ID":"20240109230913-2amjrmz","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240109230913-2amjrmz","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"测试所有功能"}]},{"ID":"20240109230913-a4fcurs","Type":"NodeParagraph","Properties":{"id":"20240109230913-a4fcurs","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"最终，使用Zap/Lumberjack logger的完整示例代码如下："}]},{"ID":"20240109230913-9yeyd6k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109230913-9yeyd6k","updated":"20240109230913"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"net/http\"\n\n\t\"gopkg.in/natefinch/lumberjack.v2\"\n\t\"go.uber.org/zap\"\n\t\"go.uber.org/zap/zapcore\"\n)\n\nvar sugarLogger *zap.SugaredLogger\n\nfunc main() {\n\tInitLogger()\n\tdefer sugarLogger.Sync()\n\tsimpleHttpGet(\"www.sogo.com\")\n\tsimpleHttpGet(\"http://www.sogo.com\")\n}\n\nfunc InitLogger() {\n\twriteSyncer := getLogWriter()\n\tencoder := getEncoder()\n\tcore := zapcore.NewCore(encoder, writeSyncer, zapcore.DebugLevel)\n\n\tlogger := zap.New(core, zap.AddCaller())\n\tsugarLogger = logger.Sugar()\n}\n\nfunc getEncoder() zapcore.Encoder {\n\tencoderConfig := zap.NewProductionEncoderConfig()\n\tencoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder\n\tencoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder\n\treturn zapcore.NewConsoleEncoder(encoderConfig)\n}\n\nfunc getLogWriter() zapcore.WriteSyncer {\n\tlumberJackLogger := \u0026lumberjack.Logger{\n\t\tFilename:   \"./test.log\",\n\t\tMaxSize:    1,\n\t\tMaxBackups: 5,\n\t\tMaxAge:     30,\n\t\tCompress:   false,\n\t}\n\treturn zapcore.AddSync(lumberJackLogger)\n}\n\nfunc simpleHttpGet(url string) {\n\tsugarLogger.Debugf(\"Trying to hit GET request for %s\", url)\n\tresp, err := http.Get(url)\n\tif err != nil {\n\t\tsugarLogger.Errorf(\"Error fetching URL %s : Error = %s\", url, err)\n\t} else {\n\t\tsugarLogger.Infof(\"Success! statusCode = %s for URL %s\", resp.Status, url)\n\t\tresp.Body.Close()\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230913-vk48s5q","Type":"NodeParagraph","Properties":{"id":"20240109230913-vk48s5q","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"执行上述代码，下面的内容会输出到文件——test.log中。"}]},{"ID":"20240109230913-619116z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240109230913-619116z","updated":"20240109230913"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"2019-10-27T15:50:32.944+0800\tDEBUG\tlogic/temp2.go:48\tTrying to hit GET request for www.sogo.com\n2019-10-27T15:50:32.944+0800\tERROR\tlogic/temp2.go:51\tError fetching URL www.sogo.com : Error = Get www.sogo.com: unsupported protocol scheme \"\"\n2019-10-27T15:50:32.944+0800\tDEBUG\tlogic/temp2.go:48\tTrying to hit GET request for http://www.sogo.com\n2019-10-27T15:50:33.165+0800\tINFO\tlogic/temp2.go:53\tSuccess! statusCode = 200 OK for URL http://www.sogo.com\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240109230913-158l2lx","Type":"NodeParagraph","Properties":{"id":"20240109230913-158l2lx","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"同时，可以在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​函数中循环记录日志，测试日志文件是否会自动切割和归档（日志文件每1MB会切割并且在当前目录下最多保存5个备份）。"}]},{"ID":"20240109230913-ah75362","Type":"NodeParagraph","Properties":{"id":"20240109230913-ah75362","updated":"20240109230913"},"Children":[{"Type":"NodeText","Data":"至此，我们总结了如何将Zap日志程序集成到Go应用程序项目中。"}]}]}