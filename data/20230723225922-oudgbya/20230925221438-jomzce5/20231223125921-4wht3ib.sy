{"ID":"20231223125921-4wht3ib","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f409","id":"20231223125921-4wht3ib","tags":"公众号-Golang语言开发栈,I/O多路复用机制,Go-Select","title":"Go 语言内置 I O多路复用机制","updated":"20231223131806"},"Children":[{"ID":"20231223125921-kw68hks","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231223125921-kw68hks","updated":"20231223131030"},"Children":[{"Type":"NodeText","Data":"介绍"}]},{"ID":"20231223131042-gizvjs4","Type":"NodeParagraph","Properties":{"id":"20231223131042-gizvjs4","updated":"20231223131042"},"Children":[{"Type":"NodeText","Data":"o 协程之间通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 通信，但是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 读写取决于自身特性，即是否有可写入缓冲区、缓冲区中是否有数据、是否已关闭..."}]},{"ID":"20231223131042-aq7nm5i","Type":"NodeParagraph","Properties":{"id":"20231223131042-aq7nm5i","updated":"20231223131042"},"Children":[{"Type":"NodeText","Data":"为了检测 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 的特性，Go 提供了一个关键字 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​，可用于实现 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"I/O"},{"Type":"NodeText","Data":"​ 多路复用机制。"}]},{"ID":"20231223131042-f7urjkw","Type":"NodeParagraph","Properties":{"id":"20231223131042-f7urjkw","updated":"20231223131042"},"Children":[{"Type":"NodeText","Data":"本文我们介绍 Go 关键字 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 的使用方式。"}]},{"ID":"20231223131056-ods3i3n","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231223131056-ods3i3n","updated":"20231223131148"},"Children":[{"Type":"NodeText","Data":"使用方式  "}]},{"ID":"20231223131123-kgr5u75","Type":"NodeParagraph","Properties":{"id":"20231223131123-kgr5u75","updated":"20231223131134"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Go 关键字 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"select"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 中包含 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"case"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 语句和 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"default"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 语句，其中 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"default"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 语句可以认为是一种特殊的 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"case"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 语句。"}]},{"ID":"20231223131123-kemy3wq","Type":"NodeParagraph","Properties":{"id":"20231223131123-kemy3wq","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"因为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句不负责处理 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 的读写，它可以在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的任意位置，且仅能包含一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句。在所有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句都不满足执行条件时，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句将被执行（建议尽量不要省略 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句）。"}]},{"ID":"20231223131123-0cv1cu6","Type":"NodeParagraph","Properties":{"id":"20231223131123-0cv1cu6","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"我们通过代码片段，分别介绍 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 在检测到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 不同特性时，得到的运行结果。"}]},{"ID":"20231223131123-b7yk003","Type":"NodeParagraph","Properties":{"id":"20231223131123-b7yk003","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"空 "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231223131123-btupmvv","Type":"NodeParagraph","Properties":{"id":"20231223131123-btupmvv","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"接下来，我们阅读一段代码。"}]},{"ID":"20231223131123-5v28q72","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-5v28q72","updated":"20231223131210"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"R28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n fmt.Println(\"Golang 语言开发栈\")\n go func() {\n  fmt.Println(\"Golang 公众号\")\n }()\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-zy7d166","Type":"NodeParagraph","Properties":{"id":"20231223131123-zy7d166","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"阅读上面这段代码，读者朋友们认为 Go 协程中的打印语句可以正常输出吗？"}]},{"ID":"20231223131123-a0oa9ov","Type":"NodeParagraph","Properties":{"id":"20231223131123-a0oa9ov","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"读者朋友们如果运行代码，会发现 Go 协程中的打印语句还没有执行，程序就已经退出了，这是因为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 函数中的打印语句已经执行完成，所以会退出程序。"}]},{"ID":"20231223131123-5sn88iv","Type":"NodeParagraph","Properties":{"id":"20231223131123-5sn88iv","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"如果我们希望 Go 协程中的打印语句也执行，可以在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 函数中使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select{}"},{"Type":"NodeText","Data":"​ 将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"​ 阻塞，Go 协程中的打印语句就有机会执行了。但是，这会导致死锁（可以根据实际应用场景选择是否使用）。"}]},{"ID":"20231223131123-37m3c6g","Type":"NodeParagraph","Properties":{"id":"20231223131123-37m3c6g","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无缓冲 "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231223131123-7z0t1zq","Type":"NodeParagraph","Properties":{"id":"20231223131123-7z0t1zq","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"接下来，我们再读一段可以导致死锁的代码："}]},{"ID":"20231223131123-3umztxu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-3umztxu","updated":"20231223131237"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n c := make(chan string)\n DoChannel(c)\n}\n\nfunc DoChannel(c chan string) {\n var receive string\n send := \"golang\"\n select {\n case receive = \u003c-c:\n  fmt.Println(receive)\n case c \u003c- send:\n  fmt.Println(send)\n }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-77z6hiv","Type":"NodeParagraph","Properties":{"id":"20231223131123-77z6hiv","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"阅读上面这段代码，我们定义一个函数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DoChannel()"},{"Type":"NodeText","Data":"​，该函数接收的参数是一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"string"},{"Type":"NodeText","Data":"​ 类型的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，函数体中使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的两个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句，分别对参数进行接收和发送操作。"}]},{"ID":"20231223131123-oefgyb0","Type":"NodeParagraph","Properties":{"id":"20231223131123-oefgyb0","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"运行代码，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 阻塞。"}]},{"ID":"20231223131123-592ixch","Type":"NodeParagraph","Properties":{"id":"20231223131123-592ixch","updated":"20231223131432"},"Children":[{"Type":"NodeText","Data":"因为，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"我们传参的 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"c"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 是无缓冲 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"channel"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，所以它即不能读也不能写，两个 "},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"case"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 语句都不执行，"},{"Type":"NodeTextMark","TextMarkType":"code strong","TextMarkTextContent":"select"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 陷入阻塞，导致死锁"},{"Type":"NodeText","Data":"（此处为了行文，故意没有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句）。"}]},{"ID":"20231223131123-eih2tdy","Type":"NodeParagraph","Properties":{"id":"20231223131123-eih2tdy","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无数据，有缓冲"},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231223131123-igxj84x","Type":"NodeParagraph","Properties":{"id":"20231223131123-igxj84x","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"我们将上面这段代码，稍微修改一下，将入参的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 改为 1 个缓冲区大小的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​（未写入数据）。代码如下："}]},{"ID":"20231223131123-o3qzih7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-o3qzih7","updated":"20231223131746"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n c := make(chan string, 1)\n DoChannel(c)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-t0oe7m5","Type":"NodeParagraph","Properties":{"id":"20231223131123-t0oe7m5","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"运行代码，写执行，读未执行。"}]},{"ID":"20231223131123-r19fuga","Type":"NodeParagraph","Properties":{"id":"20231223131123-r19fuga","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的对入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 进行发送操作的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句被执行，因为入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 是一个有 1 个缓冲区大小的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，并且该 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 中还没有数据，所以读取操作的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句没有读取到数据，不满足执行条件。"}]},{"ID":"20231223131123-d3tsrig","Type":"NodeParagraph","Properties":{"id":"20231223131123-d3tsrig","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有缓冲区，已写满数据 "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231223131123-2v0wz2b","Type":"NodeParagraph","Properties":{"id":"20231223131123-2v0wz2b","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"我们再修改一下入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​，将入参的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 改为 1 个缓冲区大小的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，并且写入字符串 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Go"},{"Type":"NodeText","Data":"​。代码如下："}]},{"ID":"20231223131123-p6ucw28","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-p6ucw28","updated":"20231223131742"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n c := make(chan string, 1)\n c \u003c- \"Go\"\n DoChannel(c)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-lwik8py","Type":"NodeParagraph","Properties":{"id":"20231223131123-lwik8py","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"运行代码，读执行，写未执行。"}]},{"ID":"20231223131123-z8bwg64","Type":"NodeParagraph","Properties":{"id":"20231223131123-z8bwg64","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"即 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的对入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 进行接收操作的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句被执行，因为入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 是一个有 1 个缓冲区大小，并且已写满数据，所以读取操作的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句可以读取到数据，满足执行条件。"}]},{"ID":"20231223131123-1chmet5","Type":"NodeParagraph","Properties":{"id":"20231223131123-1chmet5","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"而写入操作的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 无法写入数据，不满足执行条件。"}]},{"ID":"20231223131123-ygm2i5n","Type":"NodeParagraph","Properties":{"id":"20231223131123-ygm2i5n","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有缓冲区，有数据，可写数据 "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231223131123-sbmwv36","Type":"NodeParagraph","Properties":{"id":"20231223131123-sbmwv36","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"最后一种场景是既能读取也能写入的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，我们修改一下入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​，将入参 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 改为 2 个缓冲区大小的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，其中 1 个缓冲区写入字符串 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Go"},{"Type":"NodeText","Data":"​，另外 1 个缓冲区还可以写入数据。代码如下："}]},{"ID":"20231223131123-z19mkw3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-z19mkw3","updated":"20231223131738"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n c := make(chan string, 2)\n c \u003c- \"Go\"\n DoChannel(c)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-gtm5rr6","Type":"NodeParagraph","Properties":{"id":"20231223131123-gtm5rr6","updated":"20231223131618"},"Children":[{"Type":"NodeText","Data":"通过多次运行代码，会发现读取和写入的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句都有机会执行，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":"因为两个 "},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"code strong text","TextMarkTextContent":"case"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":" 语句都满足执行条件，但是只能有 1 个 "},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"code strong text","TextMarkTextContent":"case"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":" 语句执行，"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"code strong text","TextMarkTextContent":"select"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":" 会随机执行其中 1 个 "},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"code strong text","TextMarkTextContent":"case"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":" 语句。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"}]},{"ID":"20231223131123-3na6rbt","Type":"NodeParagraph","Properties":{"id":"20231223131123-3na6rbt","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"至此，我们已经介绍了 5 种 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的运行结果。"}]},{"ID":"20231223131123-iilk2e7","Type":"NodeParagraph","Properties":{"id":"20231223131123-iilk2e7","updated":"20231223131123"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"case 语句中声明变量"}]},{"ID":"20231223131123-kdcuwky","Type":"NodeParagraph","Properties":{"id":"20231223131123-kdcuwky","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"上面的代码中，我们发现在两个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句中，读操作我们将读取到的数据赋值给变量 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"receive"},{"Type":"NodeText","Data":"​，实际上，我们也可以省略变量赋值操作。"}]},{"ID":"20231223131123-9gupxrb","Type":"NodeParagraph","Properties":{"id":"20231223131123-9gupxrb","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"如果我们需要将读取到的数据，赋值给变量的话，一般建议将读取 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 返回的两个值全部接收，其中一个是读取到的数据，另外一个是布尔值，代表 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 中没有数据，并且已被关闭。代码如下："}]},{"ID":"20231223131123-0vtwys3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231223131123-0vtwys3","updated":"20231223131752"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func main() {\n c := make(chan string)\n close(c)\n DoChannelV2(c)\n}\n\nfunc DoChannelV2(c chan string) {\n var (\n  receive string\n  ok      bool\n )\n select {\n case receive, ok = \u003c-c:\n  if !ok {\n   fmt.Println(\"no data\")\n  } else {\n   fmt.Println(receive)\n  }\n }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231223131123-jyikt6s","Type":"NodeParagraph","Properties":{"id":"20231223131123-jyikt6s","updated":"20231223131123"},"Children":[{"Type":"NodeText","Data":"阅读上面这段代码，我们使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"close"},{"Type":"NodeText","Data":"​ 将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c"},{"Type":"NodeText","Data":"​ 关闭。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的读操作 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句，可以通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ok"},{"Type":"NodeText","Data":"​ 的值，得到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 中没有数据，且已被关闭，不必打印空数据。"}]},{"ID":"20231223131757-i4ivzry","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231223131757-i4ivzry","updated":"20231223131800"},"Children":[{"Type":"NodeText","Data":"总结"}]},{"ID":"20231223131806-u9f57zh","Type":"NodeParagraph","Properties":{"id":"20231223131806-u9f57zh","updated":"20231223131806"},"Children":[{"Type":"NodeText","Data":"本文我们了解到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句可以读取 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​，多个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句仅能其中 1 个被执行。"}]},{"ID":"20231223131806-1cjtqv3","Type":"NodeParagraph","Properties":{"id":"20231223131806-1cjtqv3","updated":"20231223131806"},"Children":[{"Type":"NodeText","Data":"每个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句仅能对 1 个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 进行读写操作，如果读操作未读取到数据将陷入阻塞，如果写操作无法写入数据将陷入阻塞，如果所有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"channel"},{"Type":"NodeText","Data":"​ 都陷入阻塞时，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 也会陷入阻塞。"}]},{"ID":"20231223131806-q9diob7","Type":"NodeParagraph","Properties":{"id":"20231223131806-q9diob7","updated":"20231223131806"},"Children":[{"Type":"NodeText","Data":"为了避免 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 陷入阻塞，我们可以使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句，需要注意的是，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"default"},{"Type":"NodeText","Data":"​ 语句可以在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"select"},{"Type":"NodeText","Data":"​ 的任意位置，但是仅能包含 1 个，而 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"case"},{"Type":"NodeText","Data":"​ 语句可以包含多个。"}]}]}