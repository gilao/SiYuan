{"ID":"20230724012306-nifi534","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4f1","id":"20230724012306-nifi534","title":"Consul 集群","updated":"20230724012335"},"Children":[{"ID":"20230724012311-p765r6p","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724012311-p765r6p","updated":"20230724012311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker run -d -p 8500:8500 -v /data/consul:/consul/data -e CONSUL_BIND_INTERFACE='eth0' --name=consul1 consul agent -server -bootstrap -ui -client='0.0.0.0'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724012311-5euqrr4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724012311-5euqrr4","updated":"20230724012311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker run -d --name=consul2 -e CONSUL_BIND_INTERFACE=eth0 consul agent --server=true --client=0.0.0.0 --join 172.17.0.3;\ndocker run -d --name=consul3 -e CONSUL_BIND_INTERFACE=eth0 consul agent --server=true --client=0.0.0.0 --join 172.17.0.3;\ndocker run -d --name=consul4 -e CONSUL_BIND_INTERFACE=eth0 consul agent --server=false --client=0.0.0.0 --join 172.17.0.3;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724012311-fv76fpw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724012311-fv76fpw","updated":"20230724012311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker run -d --name=consul5 -e CONSUL_BIND_INTERFACE='eth0' consul agent -server -bootstrap-expect 3 -datacenter=dc2\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724012311-laljgbo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724012311-laljgbo","updated":"20230724012311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker run -d --name=consul9 -e CONSUL_BIND_INTERFACE=eth0 consul agent --datacenter=dc2 --server=true --client=0.0.0.0 --join 172.17.0.8;\ndocker run -d --name=consul7 -e CONSUL_BIND_INTERFACE=eth0 consul agent --datacenter=dc2 --server=true --client=0.0.0.0 --join 172.17.0.8;\ndocker run -d --name=consul8 -e CONSUL_BIND_INTERFACE=eth0 consul agent --datacenter=dc2 --server=false --client=0.0.0.0 --join 172.17.0.8;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724012311-etvcpgy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724012311-etvcpgy","updated":"20230724012311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 不启用acl时，可直接执行下面的命令，创建一个只有一个节点的consul集群\nsudo docker run -id -expose=[8300,8301,8302,8500,8600] --restart always -p 18300:8300 -p 18301:8301 -p 18302:8302 -p 18500:8500 -p 18600:8600 --name server1 -e 'CONSUL_LOCAL_CONFIG={\"skip_leave_on_interrupt\": true}' consul agent -server -bootstrap-expect=1 -node=server1 -bind=0.0.0.0 -client=0.0.0.0 -ui -datacenter dc1\n# 启用acl是，只需要修改上面-e参数，如下面的命令，其中token_value可自行设置\nsudo docker run -id -expose=[8300,8301,8302,8500,8600] --restart always -p 18300:8300 -p 18301:8301 -p 18302:8302 -p 18500:8500 -p 18600:8600 --name server1 -e 'CONSUL_LOCAL_CONFIG={\"skip_leave_on_interrupt\": true,\"acl\": {\"enabled\": true,\"default_policy\": \"deny\",\"down_policy\": \"extend-cache\",\"tokens\": {\"master\": \"216032gree\"}}}' consul agent -server -bootstrap-expect=1 -node=server1 -bind=0.0.0.0 -client=0.0.0.0 -ui -datacenter dc1\n\n    各参数说明：\n    -expose：暴露出出来的端口，即consul启动所需的端口：8300,8301,8302,8500,8600\n    --restart：always表示容器挂了就自动重启\n    -p：建立宿主机与容器的端口映射\n    --name：容器名称\n    -e：环境变量，这里用于对consul进行配置\n    consul：这是consul镜像名，不是consul命令\n    agent：容器中执行的命令，各参数含义：\n            -server：表示节点是server类型\n            -bootstrap-expect：表示集群中有几个server节点后开始选举leader，既然是单节点集群，那自然就是1了\n            -node：节点名称\n            -bind：集群内部通信地址，默认是0.0.0.0\n            -client：客户端地址，默认是127.0.0.1\n            -ui：启用consul的web页面管理\n            -datacenter：数据中心\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724012311-k44cybl","Type":"NodeParagraph","Properties":{"id":"20230724012311-k44cybl","updated":"20230724012319"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"wget "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/","TextMarkTextContent":"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/"}]},{"ID":"20230724012311-iy504p9","Type":"NodeParagraph","Properties":{"id":"20230724012311-iy504p9","updated":"20230724012326"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"wget "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x","TextMarkTextContent":"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x"},{"Type":"NodeText","Data":" 86_64.rpm"}]}]}