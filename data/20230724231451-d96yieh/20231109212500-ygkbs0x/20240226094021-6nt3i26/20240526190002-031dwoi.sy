{"ID":"20240526190002-031dwoi","Spec":"1","Type":"NodeDocument","Properties":{"icon":"26fa","id":"20240526190002-031dwoi","title":"配置文件","type":"doc","updated":"20240526190057"},"Children":[{"ID":"20240526190023-z1w3tl2","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-z1w3tl2","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"概述"}]},{"ID":"20240526190023-tu1rj3i","Type":"NodeParagraph","Properties":{"id":"20240526190023-tu1rj3i","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"一般程序启动的时候需要通过静态配置文件加载各种配置，go-zero 目前支持以下四种后缀名的配置文件："}]},{"ID":"20240526190023-39odagl","Type":"NodeList","ListData":{},"Properties":{"id":"20240526190023-39odagl","updated":"20240526190023"},"Children":[{"ID":"20240526190023-ez1x53g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240526190023-ez1x53g","updated":"20240526190023"},"Children":[{"ID":"20240526190023-lbrzjt2","Type":"NodeParagraph","Properties":{"id":"20240526190023-lbrzjt2","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"*.json"}]}]},{"ID":"20240526190023-vxwhqjs","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240526190023-vxwhqjs","updated":"20240526190023"},"Children":[{"ID":"20240526190023-pn2wr3l","Type":"NodeParagraph","Properties":{"id":"20240526190023-pn2wr3l","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"*.toml"}]}]},{"ID":"20240526190023-aqobv1v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240526190023-aqobv1v","updated":"20240526190023"},"Children":[{"ID":"20240526190023-bjw4lny","Type":"NodeParagraph","Properties":{"id":"20240526190023-bjw4lny","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"*.yaml"}]}]},{"ID":"20240526190023-3d2v48g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240526190023-3d2v48g","updated":"20240526190023"},"Children":[{"ID":"20240526190023-wfwh5xu","Type":"NodeParagraph","Properties":{"id":"20240526190023-wfwh5xu","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"*.yml"}]}]}]},{"ID":"20240526190023-6f25vyk","Type":"NodeParagraph","Properties":{"id":"20240526190023-6f25vyk","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"此外，go-zero 还支持从环境变量中加载配置，且环境变量的优先级高于静态配置文件。"}]},{"ID":"20240526190023-987o8e2","Type":"NodeParagraph","Properties":{"id":"20240526190023-987o8e2","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"本章将会演示 go-zero 如何加载静态配置。"}]},{"ID":"20240526190023-xuyzisg","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-xuyzisg","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"任务目标"}]},{"ID":"20240526190023-d9pof1c","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526190023-d9pof1c","updated":"20240526190023"},"Children":[{"ID":"20240526190023-bae720f","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240526190023-bae720f","updated":"20240526190023"},"Children":[{"ID":"20240526190023-xz3aq4p","Type":"NodeParagraph","Properties":{"id":"20240526190023-xz3aq4p","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"学会如何定义一个配置。"}]}]},{"ID":"20240526190023-5h5p9h7","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240526190023-5h5p9h7","updated":"20240526190023"},"Children":[{"ID":"20240526190023-8w5c41d","Type":"NodeParagraph","Properties":{"id":"20240526190023-8w5c41d","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"从静态文件中加载配置。"}]}]}]},{"ID":"20240526190023-0kz82gh","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-0kz82gh","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"准备条件"}]},{"ID":"20240526190023-yi293d3","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526190023-yi293d3","updated":"20240526190023"},"Children":[{"ID":"20240526190023-nmsg0b3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240526190023-nmsg0b3","updated":"20240526190023"},"Children":[{"ID":"20240526190023-1hs9cvy","Type":"NodeParagraph","Properties":{"id":"20240526190023-1hs9cvy","updated":"20240526190023"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://go-zero.dev/docs/tasks","TextMarkTextContent":"完成 golang 安装"}]}]}]},{"ID":"20240526190023-hpppn0f","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-hpppn0f","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"定义 Config"}]},{"ID":"20240526190023-r60k9o7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526190023-r60k9o7","updated":"20240526190023"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type Config struct {\n    Name string\n    Host string `json:\",default=0.0.0.0\"`\n    Port int\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526190023-ujgf9du","Type":"NodeParagraph","Properties":{"id":"20240526190023-ujgf9du","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"如上，我们定义了一个 Config struct ，里面包含几个字段，服务名称，监听地址，端口号。"}]},{"ID":"20240526190023-aptrn67","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-aptrn67","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"定义配置路径"}]},{"ID":"20240526190023-o1ir9v4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526190023-o1ir9v4","updated":"20240526190023"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"var f = flag.String(\"f\", \"config.yaml\", \"config file\")\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526190023-2eqby5b","Type":"NodeParagraph","Properties":{"id":"20240526190023-2eqby5b","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"我们一般希望可以在启动的时候指定配置文件的路径，所以我们定一个 flag 用于接受配置文件的路径。"}]},{"ID":"20240526190023-zsmi6si","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-zsmi6si","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"编写配置文件"}]},{"ID":"20240526190023-eev2n5a","Type":"NodeParagraph","Properties":{"id":"20240526190023-eev2n5a","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"我们使用 yaml 格式当做实例，生成 config.yaml 文件。写入如下内容"}]},{"ID":"20240526190023-9qutsn4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526190023-9qutsn4","updated":"20240526190023"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"Name: demo\nHost: 127.0.0.1\nPort: 6370\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526190023-e37jqyi","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-e37jqyi","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"加载配置"}]},{"ID":"20240526190023-lhs2c69","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526190023-lhs2c69","updated":"20240526190023"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"flag.Parse()\nvar c Config\nconf.MustLoad(*f, \u0026c)\nprintln(c.Name)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526190023-ofcu41g","Type":"NodeParagraph","Properties":{"id":"20240526190023-ofcu41g","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"至此我们将 config.yaml 中的配置文件加载到 Config 中来了。我们后续可以在程序中使用我们的配置变量"}]},{"ID":"20240526190023-qbkvk4y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526190023-qbkvk4y","updated":"20240526190023"},"Children":[{"Type":"NodeText","Data":"完整实例"}]},{"ID":"20240526190023-ltn3t29","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526190023-ltn3t29","updated":"20240526190023"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n    \"flag\"\n    \"github.com/zeromicro/go-zero/core/conf\"\n)\n\ntype Config struct {\n    Name string\n    Host string `json:\",default=0.0.0.0\"`\n    Port int\n}\n\nvar f = flag.String(\"f\", \"config.yaml\", \"config file\")\n\nfunc main() {\n    flag.Parse()\n    var c Config\n    conf.MustLoad(*f, \u0026c)\n    // conf.MustLoad(*f, \u0026c，conf.UseEnv()) // 额外从环境变量中加载配置\n    println(c.Name)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526190023-l35yps9","Type":"NodeParagraph","Properties":{"id":"20240526190023-l35yps9","updated":"20240526190028"}}]}