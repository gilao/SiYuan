{"ID":"20240527001828-9y1iilp","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f50c","id":"20240527001828-9y1iilp","title":"go-zero 配置概述","type":"doc","updated":"20240527001947"},"Children":[{"ID":"20240527001903-v14akew","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001903-v14akew","updated":"20240527001903"},"Children":[{"Type":"NodeText","Data":"概述"}]},{"ID":"20240527001903-hzefqc5","Type":"NodeParagraph","Properties":{"id":"20240527001903-hzefqc5","updated":"20240527001904"},"Children":[{"Type":"NodeText","Data":"go-zero 提供了一个强大的 conf 包用于加载配置。我们目前支持的 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"yaml"},{"Type":"NodeText","Data":", "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"json"},{"Type":"NodeText","Data":", "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"toml"},{"Type":"NodeText","Data":" 3 种格式的配置文件，go-zero 通过文件后缀会自行加载对应的文件格式。"}]},{"ID":"20240527001903-o99fg2n","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001903-o99fg2n","updated":"20240527001903"},"Children":[{"Type":"NodeText","Data":"如何使用"}]},{"ID":"20240527001903-23kod0c","Type":"NodeParagraph","Properties":{"id":"20240527001903-23kod0c","updated":"20240527001904"},"Children":[{"Type":"NodeText","Data":"我们使用 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/zeromicro/go-zero/tree/master/core/conf","TextMarkTextContent":"github.com/zeromicro/go-zero/core/conf"},{"Type":"NodeText","Data":" conf 包进行配置的加载。"}]},{"ID":"20240527001903-djjlllp","Type":"NodeParagraph","Properties":{"id":"20240527001903-djjlllp","updated":"20240527001904"},"Children":[{"Type":"NodeText","Data":"第一步我们会定义我们的配置结构体，其中定义我们所有需要的依赖。"}]},{"ID":"20240527001903-8pkbjui","Type":"NodeParagraph","Properties":{"id":"20240527001903-8pkbjui","updated":"20240527001904"},"Children":[{"Type":"NodeText","Data":"第二步接着根据配置编写我们对应格式的配置文件。"}]},{"ID":"20240527001903-vr531kt","Type":"NodeParagraph","Properties":{"id":"20240527001903-vr531kt","updated":"20240527001904"},"Children":[{"Type":"NodeText","Data":"第三步通过 conf.MustLoad 加载配置。"}]},{"ID":"20240527001903-g2u7gek","Type":"NodeParagraph","Properties":{"id":"20240527001903-g2u7gek","updated":"20240527001903"},"Children":[{"Type":"NodeText","Data":"具体使用例子:"}]},{"ID":"20240527001905-m91rn1q","Type":"NodeList","ListData":{},"Properties":{"id":"20240527001905-m91rn1q","updated":"20240527001914"},"Children":[{"ID":"20240527001906-yys52bx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527001906-yys52bx","updated":"20240527001914"},"Children":[{"ID":"20240527001906-gwe92pv","Type":"NodeParagraph","Properties":{"id":"20240527001906-gwe92pv","updated":"20240527001909"},"Children":[{"Type":"NodeText","Data":"main.go"}]},{"ID":"20240527001909-hhxor0j","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001909-hhxor0j","updated":"20240527001914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n    \"flag\"\n\n    \"github.com/zeromicro/go-zero/core/conf\"\n)\n\ntype Config struct {\n    Host string `json:\",default=0.0.0.0\"`\n    Port int\n}\n\nvar f = flag.String(\"f\", \"config.yaml\", \"config file\")\n\nfunc main() {\n    flag.Parse()\n    var c Config\n    conf.MustLoad(*f, \u0026c)\n    println(c.Host)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240527001828-ecdb6sx","Type":"NodeList","ListData":{},"Properties":{"id":"20240527001828-ecdb6sx","updated":"20240527001927"},"Children":[{"ID":"20240527001918-ij2gyvn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527001918-ij2gyvn","updated":"20240527001927"},"Children":[{"ID":"20240527001918-um3reqg","Type":"NodeParagraph","Properties":{"id":"20240527001918-um3reqg","updated":"20240527001921"},"Children":[{"Type":"NodeText","Data":"config.yaml"}]},{"ID":"20240527001922-c1jmo10","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001922-c1jmo10","updated":"20240527001927"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"Host: 127.0.0.1\nPort: 8888\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240527001947-hqteby5","Type":"NodeParagraph","Properties":{"id":"20240527001947-hqteby5","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"我们一般会在程序启动的时候进行配置的加载，同时我们一般也需要定义我们配置所需要的结构体， 在 go-zero 中，我们推荐将所有服务依赖都定义在 config 中，这样以后配置根据 config 就可以查找出所有的依赖。"}]},{"ID":"20240527001947-zxm4eyn","Type":"NodeParagraph","Properties":{"id":"20240527001947-zxm4eyn","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"我们使用 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"func MustLoad(path string, v interface{}, opts ...Option)"},{"Type":"NodeText","Data":" 进行加载配置，path 为配置的路径，v 为结构体。 这个方法会完成配置的加载，如果配置加载失败，整个程序会 fatal 停止掉。"}]},{"ID":"20240527001947-gpz5crp","Type":"NodeParagraph","Properties":{"id":"20240527001947-gpz5crp","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"当然我们也提供了其他的加载方式，例如："}]},{"ID":"20240527001947-ftmgnhf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-ftmgnhf","updated":"20240527001947"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func Load(file string, v interface{}, opts ...Option) error\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-vx36pk0","Type":"NodeParagraph","Properties":{"id":"20240527001947-vx36pk0","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-3hlunvl","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001947-3hlunvl","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"其他格式的配置文件"}]},{"ID":"20240527001947-cd9yfpd","Type":"NodeParagraph","Properties":{"id":"20240527001947-cd9yfpd","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们目前支持的配置格式如下："}]},{"ID":"20240527001947-ra1mav8","Type":"NodeList","ListData":{},"Properties":{"id":"20240527001947-ra1mav8","updated":"20240527001948"},"Children":[{"ID":"20240527001947-r5tjn91","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527001947-r5tjn91","updated":"20240527001947"},"Children":[{"ID":"20240527001947-r0k2i9a","Type":"NodeParagraph","Properties":{"id":"20240527001947-r0k2i9a","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"json"}]}]},{"ID":"20240527001947-8f7yigw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527001947-8f7yigw","updated":"20240527001947"},"Children":[{"ID":"20240527001947-fdxzozd","Type":"NodeParagraph","Properties":{"id":"20240527001947-fdxzozd","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"yaml | yml"}]}]},{"ID":"20240527001947-aayr3js","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240527001947-aayr3js","updated":"20240527001947"},"Children":[{"ID":"20240527001947-ddk5vw9","Type":"NodeParagraph","Properties":{"id":"20240527001947-ddk5vw9","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"toml"}]}]}]},{"ID":"20240527001947-9ftqpq3","Type":"NodeParagraph","Properties":{"id":"20240527001947-9ftqpq3","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们程序会自动通过文件后缀进行对应格式的加载。"}]},{"ID":"20240527001947-urbmlar","Type":"NodeParagraph","Properties":{"id":"20240527001947-urbmlar","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"当然我们在 conf 包中也提供了对应格式二进制数据加载的方法："}]},{"ID":"20240527001947-ra153op","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-ra153op","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"\nfunc LoadFromJsonBytes(content []byte, v interface{}) error\n\nfunc LoadFromTomlBytes(content []byte, v interface{}) error\n\nfunc LoadFromYamlBytes(content []byte, v interface{}) error\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-6ivebf0","Type":"NodeParagraph","Properties":{"id":"20240527001947-6ivebf0","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-504par4","Type":"NodeParagraph","Properties":{"id":"20240527001947-504par4","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"简单示例："}]},{"ID":"20240527001947-rruv8p4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-rruv8p4","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"text := []byte(`a: foo\nB: bar`)\n\nvar val struct {\n    A string\n    B string\n}\n_ = LoadFromYamlBytes(text, \u0026val)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-x97130v","Type":"NodeParagraph","Properties":{"id":"20240527001947-x97130v","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-b7zdewl","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240527001947-b7zdewl","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"注意"}]},{"ID":"20240527001947-dvmiw3x","Type":"NodeParagraph","Properties":{"id":"20240527001947-dvmiw3x","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"对于有些需要自定义 tag 的，为了方便统一，我们目前所有 tag 均为 json tag。"}]},{"ID":"20240527001947-py08wpo","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001947-py08wpo","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"大小写不敏感"}]},{"ID":"20240527001947-b15t13m","Type":"NodeParagraph","Properties":{"id":"20240527001947-b15t13m","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"conf 目前已经默认自动支持 key 大小写不敏感，例如对应如下的配置我们都可以解析出来："}]},{"ID":"20240527001947-hgwkn09","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-hgwkn09","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"eWFtbA=="},{"Type":"NodeCodeBlockCode","Data":"Host: \"127.0.0.1\"\n\nhost: \"127.0.0.1\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-7o7896l","Type":"NodeParagraph","Properties":{"id":"20240527001947-7o7896l","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-ad6u91q","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001947-ad6u91q","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"环境变量"}]},{"ID":"20240527001947-f2tz2jl","Type":"NodeParagraph","Properties":{"id":"20240527001947-f2tz2jl","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"目前 conf 配置支持环境变量注入，我们有 2 种方式实现"}]},{"ID":"20240527001947-blbzpd3","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240527001947-blbzpd3","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"1. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"conf.UseEnv()"}]},{"ID":"20240527001947-h6joxyy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-h6joxyy","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"\nvar c struct {\n    Name string\n}\n\nconf.MustLoad(\"config.yaml\", \u0026c, conf.UseEnv())\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-qomyiyy","Type":"NodeParagraph","Properties":{"id":"20240527001947-qomyiyy","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-3rofm31","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-3rofm31","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y29uZmlnLnlhbWw="},{"Type":"NodeCodeBlockCode","Data":"Name: ${SERVER_NAME}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-jmyemxa","Type":"NodeParagraph","Properties":{"id":"20240527001947-jmyemxa","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-gyaggt6","Type":"NodeParagraph","Properties":{"id":"20240527001947-gyaggt6","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"如上，我们在 Load 时候传入 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"UseEnv"},{"Type":"NodeText","Data":"， conf 会自动根据值替换字符串中的${var}或$var 当前环境变量。"}]},{"ID":"20240527001947-h4dir0t","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240527001947-h4dir0t","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"2. env Tag"}]},{"ID":"20240527001947-uziyxnc","Type":"NodeParagraph","Properties":{"id":"20240527001947-uziyxnc","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"注意 env 需要 go-zero "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/zeromicro/go-zero/releases/tag/v1.4.3","TextMarkTextContent":"v1.4.3"},{"Type":"NodeText","Data":" 以上版本才支持。"}]},{"ID":"20240527001947-9uctzme","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-9uctzme","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"var c struct {\n    Name string `json:\",env=SERVER_NAME\"`\n}\n\nconf.MustLoad(\"config.yaml\", \u0026c)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-yvx36t4","Type":"NodeParagraph","Properties":{"id":"20240527001947-yvx36t4","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-zi76xdu","Type":"NodeParagraph","Properties":{"id":"20240527001947-zi76xdu","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们可以在 json tag 的后面加上 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"env=SERVER_NAME"},{"Type":"NodeText","Data":" 的标签，conf 将会自动去加载对应的环境变量。"}]},{"ID":"20240527001947-kf8im8h","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240527001947-kf8im8h","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"注意"}]},{"ID":"20240527001947-ewg90b0","Type":"NodeParagraph","Properties":{"id":"20240527001947-ewg90b0","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们配置加载的顺序会优先级 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"env"},{"Type":"NodeText","Data":" \u003e "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"配置中的定义"},{"Type":"NodeText","Data":" \u003e "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"json tag 中的 default 定义"}]},{"ID":"20240527001947-txxdcsz","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001947-txxdcsz","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"tag 校验规则"}]},{"ID":"20240527001947-cg62tu0","Type":"NodeParagraph","Properties":{"id":"20240527001947-cg62tu0","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们可以通过在 tag 中来声明参数接收规则，除此之外，还支持参数的校验，参数校验的规则写在 tag value 中，简单示例如下："}]},{"ID":"20240527001947-tc4f1xw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-tc4f1xw","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type Config struct {\n    Name string // 没有任何 tag，表示配置必填\n    Port int64 `json:\",default=8080\"` // 如果配置中没有配置，将会初始成 8080\n    Path string `json:\",optional\"`\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-3ek2ur6","Type":"NodeParagraph","Properties":{"id":"20240527001947-3ek2ur6","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-30341c7","Type":"NodeParagraph","Properties":{"id":"20240527001947-30341c7","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"如果我们在 conf 加载的时候，验证没有通过，将会报出来对应的错误。"}]},{"ID":"20240527001947-ygkj1rk","Type":"NodeParagraph","Properties":{"id":"20240527001947-ygkj1rk","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"目前 go-zero 支持的校验规则如下:"}]},{"ID":"20240527001947-poqlpug","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20240527001947-poqlpug","updated":"20240527001948"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"接收规则"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"示例"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"optional"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前字段是可选参数，允许为零值(zero value)"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"json:\u0026quot;foo,optional\u0026quot;"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"options"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前参数仅可接收的枚举值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"写法 1"},{"Type":"NodeText","Data":"：竖线"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"|"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"default"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前参数默认值"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"json:\u0026quot;gender,default=male\u0026quot;"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"range"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前参数数值有效范围，仅对数值有效，写法规则详情见下文温馨提示"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"json:\u0026quot;age,range=[0:120]\u0026quot;"},{"Type":"NodeText","Data":"​"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"env"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"当前参数从环境变量获取"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"json:\u0026quot;mode,env=MODE\u0026quot;"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20240527001947-klczab5","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240527001947-klczab5","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Range 表达式值规则"}]},{"ID":"20240527001947-9z0t371","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240527001947-9z0t371","updated":"20240527001948"},"Children":[{"ID":"20240527001947-efwrxzk","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240527001947-efwrxzk","updated":"20240527001947"},"Children":[{"ID":"20240527001947-mdhk2v5","Type":"NodeParagraph","Properties":{"id":"20240527001947-mdhk2v5","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"左开右闭区间：(min:max]，表示大于 min 小于等于 max，当 min 缺省时，min 代表数值 0，当 max 缺省时，max 代表无穷大，min 和 max 不能同时缺省"}]}]},{"ID":"20240527001947-5vtea7l","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240527001947-5vtea7l","updated":"20240527001947"},"Children":[{"ID":"20240527001947-pvjwr4g","Type":"NodeParagraph","Properties":{"id":"20240527001947-pvjwr4g","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"左闭右开区间：[min:max)，表示大于等于 min 小于 max，当 max 缺省时，max 代表数值 0，当 min 缺省时，min 代表无穷大，min 和 max 不能同时缺省"}]}]},{"ID":"20240527001947-4ops84i","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240527001947-4ops84i","updated":"20240527001947"},"Children":[{"ID":"20240527001947-sxkv9ie","Type":"NodeParagraph","Properties":{"id":"20240527001947-sxkv9ie","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"闭区间：[min:max]，表示大于等于 min 小于等于 max，当 min 缺省时，min 代表数值 0，当 max 缺省时，max 代表无穷大，min 和 max 不能同时缺省"}]}]},{"ID":"20240527001947-pjc9kn5","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240527001947-pjc9kn5","updated":"20240527001947"},"Children":[{"ID":"20240527001947-mrr6lsv","Type":"NodeParagraph","Properties":{"id":"20240527001947-mrr6lsv","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"开区间：(min:max)，表示大于 min 小于 max，当 min 缺省时，min 代表数值 0，当 max 缺省时，max 代表无穷大，min 和 max 不能同时缺省"}]}]}]},{"ID":"20240527001947-r7uqdrl","Type":"NodeParagraph","Properties":{"id":"20240527001947-r7uqdrl","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"更多可以参考 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/zeromicro/go-zero/blob/master/core/mapping/unmarshaler_test.go","TextMarkTextContent":"unmarshaler_test.go"}]},{"ID":"20240527001947-lknuh56","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240527001947-lknuh56","updated":"20240527001947"},"Children":[{"Type":"NodeText","Data":"inherit 配置继承"}]},{"ID":"20240527001947-jo0e86d","Type":"NodeParagraph","Properties":{"id":"20240527001947-jo0e86d","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"在我们日常的配置，会出现很多重复的配置，例如 rpcClientConf 中，每个 rpc 都有一个 etcd 的配置，但是我们大部分的情况下 etcd 的配置都是一样的，我们希望可以只用配置一次etcd就可以了。 如下的例子"}]},{"ID":"20240527001947-p8k8mll","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-p8k8mll","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z29j"},{"Type":"NodeCodeBlockCode","Data":"type Config struct {\n    Etcd     discov.EtcdConf\n    UserRpc  zrpc.RpcClientConf\n    PortRpc  zrpc.RpcClientConf\n    OtherRpc zrpc.RpcClientConf\n}\n\nconst str = `\nEtcd:\n  Key: rpcServer\"\n  Hosts:\n    - \"127.0.0.1:6379\"\n    - \"127.0.0.1:6377\"\n    - \"127.0.0.1:6376\"\n\nUserRpc:\n  Etcd:\n    Key: UserRpc\n    Hosts:\n    - \"127.0.0.1:6379\"\n    - \"127.0.0.1:6377\"\n    - \"127.0.0.1:6376\"\n\nPortRpc:\n  Etcd:\n    Key: PortRpc\n    Hosts:\n    - \"127.0.0.1:6379\"\n    - \"127.0.0.1:6377\"\n    - \"127.0.0.1:6376\"\n\nOtherRpc:\n  Etcd:\n    Key: OtherRpc\n    Hosts:\n    - \"127.0.0.1:6379\"\n    - \"127.0.0.1:6377\"\n    - \"127.0.0.1:6376\"\n`\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-qyjgk3j","Type":"NodeParagraph","Properties":{"id":"20240527001947-qyjgk3j","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-10aferh","Type":"NodeParagraph","Properties":{"id":"20240527001947-10aferh","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"我们必须为每个 Etcd 都要加上 Hosts 等基础配置。"}]},{"ID":"20240527001947-10kvtu6","Type":"NodeParagraph","Properties":{"id":"20240527001947-10kvtu6","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"但是如果我们使用了 inherit 的tag 定义，使用的方式在tag 中加上 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"inherit"},{"Type":"NodeText","Data":"。如下："}]},{"ID":"20240527001947-b873a1x","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-b873a1x","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"// A RpcClientConf is a rpc client config.\n    RpcClientConf struct {\n        Etcd          discov.EtcdConf `json:\",optional,inherit\"`\n        ....\n    }\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527001947-rnct0u3","Type":"NodeParagraph","Properties":{"id":"20240527001947-rnct0u3","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"Copy"}]},{"ID":"20240527001947-vumu40g","Type":"NodeParagraph","Properties":{"id":"20240527001947-vumu40g","updated":"20240527001948"},"Children":[{"Type":"NodeText","Data":"这样我们就可以简化 Etcd 的配置，他会自动向上一层寻找配置。"}]},{"ID":"20240527001947-noukhxg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527001947-noukhxg","updated":"20240527001948"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"const str = `\nEtcd:\n  Key: rpcServer\"\n  Hosts:\n    - \"127.0.0.1:6379\"\n    - \"127.0.0.1:6377\"\n    - \"127.0.0.1:6376\"\n\nUserRpc:\n  Etcd:\n    Key: UserRpc\n\nPortRpc:\n  Etcd:\n    Key: PortRpc\n\nOtherRpc:\n  Etcd:\n    Key: OtherRpc\n`\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}