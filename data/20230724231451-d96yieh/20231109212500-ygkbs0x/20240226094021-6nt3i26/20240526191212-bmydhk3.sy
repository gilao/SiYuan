{"ID":"20240526191212-bmydhk3","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f416","id":"20240526191212-bmydhk3","title":"MySQL 数据库操作","type":"doc","updated":"20240526191923"},"Children":[{"ID":"20240526191237-2t1izs8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526191237-2t1izs8","updated":"20240526191237"},"Children":[{"Type":"NodeText","Data":"概述"}]},{"ID":"20240526191237-ih1ls7m","Type":"NodeParagraph","Properties":{"id":"20240526191237-ih1ls7m","updated":"20240526191238"},"Children":[{"Type":"NodeText","Data":"数据库的相关使用, 我们一般推荐使用 goctl 直接生成 model 代码，同时会自动生成 golang 结构体，CURD操作方法，缓存等，可以参考 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://go-zero.dev/docs/tasks/cli/mysql","TextMarkTextContent":"goctl model"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240526191237-bkqywzc","Type":"NodeParagraph","Properties":{"id":"20240526191237-bkqywzc","updated":"20240526191238"},"Children":[{"Type":"NodeText","Data":"但是针对特殊情况需要自行直接链接数据库的，我们也可以直接自己初始化 sql conn。"}]},{"ID":"20240526191249-2om5aeo","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526191249-2om5aeo","updated":"20240526191249"},"Children":[{"Type":"NodeText","Data":"创建数据库"}]},{"ID":"20240526191249-0iw4grl","Type":"NodeParagraph","Properties":{"id":"20240526191249-0iw4grl","updated":"20240526191250"},"Children":[{"Type":"NodeText","Data":"首先在的数据库中创建如下的表。"}]},{"ID":"20240526191249-rfjtyxd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191249-rfjtyxd","updated":"20240526191250"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c3Fs"},{"Type":"NodeCodeBlockCode","Data":"CREATE TABLE user (\n    id bigint AUTO_INCREMENT,\n    name varchar(255) NOT NULL DEFAULT '' COMMENT 'The username',\n    type tinyint(1) NULL DEFAULT 0 COMMENT 'The user type, 0:normal,1:vip, for test golang keyword',\n    create_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    update_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    PRIMARY KEY (id)\n) ENGINE = InnoDB COLLATE utf8mb4_general_ci COMMENT 'user table';\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526191312-ns93t2y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526191312-ns93t2y","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"连接到数据库"}]},{"ID":"20240526191312-kuz2bta","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526191312-kuz2bta","updated":"20240526191342"},"Children":[{"ID":"20240526191312-37eq884","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240526191312-37eq884","updated":"20240526191337"},"Children":[{"ID":"20240526191312-klpwecn","Type":"NodeParagraph","Properties":{"id":"20240526191312-klpwecn","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"Mysql"}]},{"ID":"20240526191312-asg15k8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191312-asg15k8","updated":"20240526191312"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n    \"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n    // 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情\n    // 需要自行将 dsn 中的 host，账号 密码配置正确\n    dsn := \"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n    conn := sqlx.NewMysql(dsn)\n    _ = conn\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526191312-t75fej9","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20240526191312-t75fej9","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"注意"}]},{"ID":"20240526191312-d5guay8","Type":"NodeParagraph","Properties":{"id":"20240526191312-d5guay8","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"想要正确的处理 time.Time ，您需要带上 parseTime 参数， "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/go-sql-driver/mysql#parameters","TextMarkTextContent":"更多参数"},{"Type":"NodeText","Data":" 要支持完整的 UTF-8 编码，您需要将 charset=utf8 更改为 charset=utf8mb4"}]}]},{"ID":"20240526191312-544kxyd","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240526191312-544kxyd","updated":"20240526191342"},"Children":[{"ID":"20240526191312-tu9yl0p","Type":"NodeParagraph","Properties":{"id":"20240526191312-tu9yl0p","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"自定义驱动\ngo-zero 允许通过 DriverName 选项自定义 MySQL 驱动，例如："}]},{"ID":"20240526191312-qwr1umr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191312-qwr1umr","updated":"20240526191312"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n    \"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n    dsn := \"user:pass@tcp(127.0.0.1:3307)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n    conn := sqlx.NewSqlConn(\"mysql\", dsn)\n    _ = conn\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]},{"ID":"20240526191312-5rzi1zo","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240526191312-5rzi1zo","updated":"20240526191312"},"Children":[{"ID":"20240526191312-iuptw4n","Type":"NodeParagraph","Properties":{"id":"20240526191312-iuptw4n","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"现有的数据库连接"}]}]}]},{"ID":"20240526191312-5gwd9qi","Type":"NodeParagraph","Properties":{"id":"20240526191312-5gwd9qi","updated":"20240526191313"},"Children":[{"Type":"NodeText","Data":"go-zero 允许通过 现有的数据库初始化 Sql 链接，例如："}]},{"ID":"20240526191312-wkm5h2o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191312-wkm5h2o","updated":"20240526191313"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n    \"database/sql\"\n    \"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n    sqlDB, err := sql.Open(\"mysql\", \"mydb_dsn\")\n    if err != nil {\n        panic(err)\n    }\n    conn := sqlx.NewSqlConnFromDB(sqlDB)\n    _ = conn\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240526191312-4hot9up","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240526191312-4hot9up","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"开始 CRUD"}]},{"ID":"20240526191312-xxmcxdk","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526191312-xxmcxdk","updated":"20240526191754"},"Children":[{"ID":"20240526191312-1q5n7q9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240526191312-1q5n7q9","updated":"20240526191754"},"Children":[{"ID":"20240526191312-4lfjmms","Type":"NodeParagraph","Properties":{"id":"20240526191312-4lfjmms","updated":"20240526191312"},"Children":[{"Type":"NodeText","Data":"插入一条数据\n我们使用上面的创建链接的方法得到一个链接之后，我们可以开始操作数据库。"}]},{"ID":"20240526191613-mtumns8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191613-mtumns8","updated":"20240526191754"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n\t// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情\n\t// 需要自行确保 dsn 中的 host 账号 密码都配置正确\n\tdsn := \"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n\tconn := sqlx.NewMysql(dsn)\n\n\tr, err := conn.ExecCtx(context.Background(), \"insert into user (type, name) values (?, ?)\", 1, \"test\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tfmt.Println(r.RowsAffected())\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240526191637-p9a80lk","Type":"NodeParagraph","Properties":{"id":"20240526191637-p9a80lk","updated":"20240526191645"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"执行程序，我们会在user 中插入一条记录。"}]},{"ID":"20240526191637-t4rsxd3","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526191637-t4rsxd3","updated":"20240526191745"},"Children":[{"ID":"20240526191637-63niv7p","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240526191637-63niv7p","updated":"20240526191745"},"Children":[{"ID":"20240526191637-uhls1kq","Type":"NodeParagraph","Properties":{"id":"20240526191637-uhls1kq","updated":"20240526191637"},"Children":[{"Type":"NodeText","Data":"查询数据"}]},{"ID":"20240526191637-eg4d3ja","Type":"NodeParagraph","Properties":{"id":"20240526191637-eg4d3ja","updated":"20240526191637"},"Children":[{"Type":"NodeText","Data":"我们需要先定义一个 User 结构体，接着再查询"}]},{"ID":"20240526191655-mgssjfn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191655-mgssjfn","updated":"20240526191745"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"context\"\n\t\"database/sql\"\n\t\"time\"\n\n\t\"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\ntype User struct {\n\tId       int64          `db:\"id\"`\n\tName     sql.NullString `db:\"name\"` // The username\n\tType     int64          `db:\"type\"` // The user type, 0:normal,1:vip, for test golang keyword\n\tCreateAt sql.NullTime   `db:\"create_at\"`\n\tUpdateAt time.Time      `db:\"update_at\"`\n}\n\nfunc main() {\n\t// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情\n\t// 需要自行确保 dsn 中的 host 账号 密码都配置正确\n\tdsn := \"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n\tconn := sqlx.NewMysql(dsn)\n\n\tvar u User\n\tquery := \"select id, name, type, create_at, update_at from user where id=?\"\n\terr := conn.QueryRowCtx(context.Background(), \u0026u, query, 1)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240526191800-5ih3v03","Type":"NodeParagraph","Properties":{"id":"20240526191800-5ih3v03","updated":"20240526191804"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"执行上述程序，我们会看到 我们刚刚插入进去的 user 信息"}]},{"ID":"20240526191800-2lcx01b","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526191800-2lcx01b","updated":"20240526191854"},"Children":[{"ID":"20240526191800-h69squr","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240526191800-h69squr","updated":"20240526191854"},"Children":[{"ID":"20240526191800-kpjdz25","Type":"NodeParagraph","Properties":{"id":"20240526191800-kpjdz25","updated":"20240526191800"},"Children":[{"Type":"NodeText","Data":"修改数据 我们继续修改代码"}]},{"ID":"20240526191810-x4qqq1g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191810-x4qqq1g","updated":"20240526191854"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\n\t\"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n\t// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情\n\t// 需要自行确保 dsn 中的 host 账号 密码都配置正确\n\tdsn := \"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n\tconn := sqlx.NewMysql(dsn)\n\n\t_, err := conn.ExecCtx(context.Background(), \"update user set type = ? where name = ?\", 2, \"test\")\n\tif err != nil {\n\t\tfmt.Println(err)\n\t\treturn\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240526191833-51v8xnf","Type":"NodeParagraph","Properties":{"id":"20240526191833-51v8xnf","updated":"20240526191852"},"Children":[{"Type":"NodeText","Data":"运行上述代码，会发现数据库中的记录 type 变为 2了。"}]},{"ID":"20240526191859-iz8r22y","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240526191859-iz8r22y","updated":"20240526191917"},"Children":[{"ID":"20240526191902-a1bbttq","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240526191902-a1bbttq","updated":"20240526191917"},"Children":[{"ID":"20240526191902-1erwh11","Type":"NodeParagraph","Properties":{"id":"20240526191902-1erwh11","updated":"20240526191904"},"Children":[{"Type":"NodeText","Data":"删除数据"}]},{"ID":"20240526191905-came9m8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240526191905-came9m8","updated":"20240526191917"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\n\t\"github.com/zeromicro/go-zero/core/stores/sqlx\"\n)\n\nfunc main() {\n\t// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情\n\t// 需要自行确保 dsn 中的 host 账号 密码都配置正确\n\tdsn := \"user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\"\n\tconn := sqlx.NewMysql(dsn)\n\n\t_, err := conn.ExecCtx(context.Background(), \"delete from user where `id` = ?\", 1)\n\tif err != nil {\n\t\tfmt.Println(err)\n\t\treturn\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}]},{"ID":"20240526191923-06jttbg","Type":"NodeParagraph","Properties":{"id":"20240526191923-06jttbg","updated":"20240526191923"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行上述代码，会发现数据库中的记录已经被删除了。"}]},{"ID":"20240526191923-3i0zk46","Type":"NodeParagraph","Properties":{"id":"20240526191923-3i0zk46","updated":"20240526191923"},"Children":[{"Type":"NodeText","Data":"至此，你已经完成 mysql 数据库的基本使用。"}]}]}