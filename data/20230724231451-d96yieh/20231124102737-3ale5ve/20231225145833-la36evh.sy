{"ID":"20231225145833-la36evh","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f3d5","id":"20231225145833-la36evh","tags":"单元测试","title":"Golang 单元测试合集整理","updated":"20231227095016"},"Children":[{"ID":"20231225145917-b5kzprk","Type":"NodeParagraph","Properties":{"id":"20231225145917-b5kzprk","updated":"20231225145917"},"Children":[{"Type":"NodeText","Data":"无论写什么样的语言，单元测试都是必不可少的，它可以极大的提高我们的代码质量，减少各种低级错误和 bug"}]},{"ID":"20231225145917-mgdi1qv","Type":"NodeParagraph","Properties":{"id":"20231225145917-mgdi1qv","updated":"20231225145917"},"Children":[{"Type":"NodeText","Data":"无论你是一个靠谱合格的码农，还是一个优秀的程序员，单元测试都是咱们必须落实的一环"}]},{"ID":"20231225145917-cc4u12s","Type":"NodeParagraph","Properties":{"id":"20231225145917-cc4u12s","updated":"20231225145917"},"Children":[{"Type":"NodeText","Data":"单元测试比较容易，此处梳理了了基本的单元测试用到的方式和第三方库的使用方式，用到的时候，可以来这里查询 mock 第三方库的地址和基本用法，欢迎收藏"}]},{"ID":"20231225145917-z1ejz40","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231225145917-z1ejz40","updated":"20231225145930"},"Children":[{"Type":"NodeText","Data":"基本的单元测试"}]},{"ID":"20231225145930-7fmc40i","Type":"NodeList","ListData":{},"Properties":{"id":"20231225145930-7fmc40i","updated":"20231225145934"},"Children":[{"ID":"20231225145934-bkipyiy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225145934-bkipyiy","updated":"20231225145934"},"Children":[{"ID":"20231225145934-8f0qjtb","Type":"NodeParagraph","Properties":{"id":"20231225145934-8f0qjtb","updated":"20231225145952"},"Children":[{"Type":"NodeText","Data":"Golang 单元测试文件名 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xxx_test.go"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231225145959-nzh4pv4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225145959-nzh4pv4"},"Children":[{"ID":"20231225145959-g018y3e","Type":"NodeParagraph","Properties":{"id":"20231225145959-g018y3e","updated":"20231225150026"},"Children":[{"Type":"NodeText","Data":"单元测试函数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"func Testxxx (t *testing.T) {}"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231225150027-57ri4j4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225150027-57ri4j4"},"Children":[{"ID":"20231225150027-ek6pbyt","Type":"NodeParagraph","Properties":{"id":"20231225150027-ek6pbyt","updated":"20231225150109"},"Children":[{"Type":"NodeText","Data":"自测试的写法 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"t.Run(\u0026quot;case1\u0026quot;, func(t *testing.T){})"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231225150112-87t861z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225150112-87t861z"},"Children":[{"ID":"20231225150112-vqlzvcs","Type":"NodeParagraph","Properties":{"id":"20231225150112-vqlzvcs","updated":"20231225150130"},"Children":[{"Type":"NodeText","Data":"使用工具生成单测文件和函数"}]}]}]},{"ID":"20231225150130-47iwxzs","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231225150130-47iwxzs","updated":"20231225150140"},"Children":[{"Type":"NodeText","Data":"Goland 的方式"}]},{"ID":"20231225150142-svmckos","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20231225150142-svmckos","updated":"20231225150302"},"Children":[{"ID":"20231225150143-c216fhn","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20231225150143-c216fhn","updated":"20231225150143"},"Children":[{"ID":"20231225150143-i9xoiqh","Type":"NodeParagraph","Properties":{"id":"20231225150143-i9xoiqh","updated":"20231225150153"},"Children":[{"Type":"NodeText","Data":"选中我们的 go 源码文件"}]}]},{"ID":"20231225150154-emwg7mj","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20231225150154-emwg7mj","updated":"20231225150302"},"Children":[{"ID":"20231225150154-wxhmqwl","Type":"NodeParagraph","Properties":{"id":"20231225150154-wxhmqwl","updated":"20231225150302"},"Children":[{"Type":"NodeText","Data":"右击函数名，可以按照函数来生成 单元测试函数，也可以将整个源码都各自生成单元测试函数，生成的函数都会放到 xxx_test.go文件中。"}]}]}]},{"ID":"20231225150316-q2i0ziv","Type":"NodeParagraph","Properties":{"id":"20231225150316-q2i0ziv","updated":"20231225150316"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231225150316-47ixv7f.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231225150325-kd8s7mq","Type":"NodeParagraph","Properties":{"id":"20231225150325-kd8s7mq","updated":"20231225150325"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231225150325-iedbfej.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231225153811-jsqcbvr","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231225153811-jsqcbvr","updated":"20231225153811"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 gotests 工具"}]},{"ID":"20231225153818-2zswztb","Type":"NodeParagraph","Properties":{"id":"20231225153818-2zswztb","updated":"20231225153818"},"Children":[{"Type":"NodeText","Data":"也可以在 Linux 中使用 gotests 工具来生成单测文件和单测函数，生成的效果和 Gland 的方式一致，基本的使用方式如下："}]},{"ID":"20231225153818-dm93cmd","Type":"NodeParagraph","Properties":{"id":"20231225153818-dm93cmd","updated":"20231225153818"},"Children":[{"Type":"NodeText","Data":"在 linux 中 go get 一下 gotests 第三方工具"}]},{"ID":"20231225153818-0xckn9x","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231225153818-0xckn9x","updated":"20231225153827"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"go get -u github.com/cweill/gotests/...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231225154148-04b5zxi","Type":"NodeParagraph","Properties":{"id":"20231225154148-04b5zxi","updated":"20231225154148"},"Children":[{"Type":"NodeText","Data":"我们可以在咱们的 GOPATH 下的 bin 目录下看到已经有 gotests 这个可执行程序"}]},{"ID":"20231225154148-3weg06r","Type":"NodeParagraph","Properties":{"id":"20231225154148-3weg06r","updated":"20231225154148"},"Children":[{"Type":"NodeText","Data":"使用 gotests 也是非常简单，直接执行如下命令即可生成源码文件对应的单测文件，如需要更加详细的指令，可以查看 gotests --help"}]},{"ID":"20231225154148-dbr5tta","Type":"NodeList","ListData":{},"Properties":{"id":"20231225154148-dbr5tta","updated":"20231225163321"},"Children":[{"ID":"20231225163321-y5gfweh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163321-y5gfweh","updated":"20231225163321"},"Children":[{"ID":"20231225163321-mixozlt","Type":"NodeParagraph","Properties":{"id":"20231225163321-mixozlt","updated":"20231225163334"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gotests -all -w xxx.go"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231225163337-zv95o08","Type":"NodeParagraph","Properties":{"id":"20231225163337-zv95o08","updated":"20231225163406"},"Children":[{"Type":"NodeText","Data":"上述2个工具，生成的单测文件，单测函数，全部都是符合 goland 的单测要求。"}]},{"ID":"20231225163407-f87ijux","Type":"NodeList","ListData":{},"Properties":{"id":"20231225163407-f87ijux","updated":"20231225163415"},"Children":[{"ID":"20231225163415-12bszhe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163415-12bszhe","updated":"20231225163415"},"Children":[{"ID":"20231225163415-c3cb6lm","Type":"NodeParagraph","Properties":{"id":"20231225163415-c3cb6lm","updated":"20231225163422"},"Children":[{"Type":"NodeText","Data":"基本的单测命令"}]}]},{"ID":"20231225163422-1co3msh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163422-1co3msh"},"Children":[{"ID":"20231225163422-o8njbbc","Type":"NodeParagraph","Properties":{"id":"20231225163422-o8njbbc","updated":"20231225163428"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go test"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231225163429-zaf3c0q","Type":"NodeParagraph","Properties":{"id":"20231225163429-zaf3c0q","updated":"20231225163444"},"Children":[{"Type":"NodeText","Data":"可以直接看到执行结果是通过，还是失败"}]},{"ID":"20231225163445-pp8lnb0","Type":"NodeList","ListData":{},"Properties":{"id":"20231225163445-pp8lnb0","updated":"20231225163446"},"Children":[{"ID":"20231225163446-n89gin6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163446-n89gin6","updated":"20231225163446"},"Children":[{"ID":"20231225163446-odagg5p","Type":"NodeParagraph","Properties":{"id":"20231225163446-odagg5p","updated":"20231225163455"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go test -v"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231225163456-6uyomuc","Type":"NodeParagraph","Properties":{"id":"20231225163456-6uyomuc","updated":"20231225163513"},"Children":[{"Type":"NodeText","Data":"可以查看到每一个单测函数的执行情况"}]},{"ID":"20231225163513-mtegs4m","Type":"NodeList","ListData":{},"Properties":{"id":"20231225163513-mtegs4m","updated":"20231225163515"},"Children":[{"ID":"20231225163515-wjx11l3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163515-wjx11l3","updated":"20231225163515"},"Children":[{"ID":"20231225163515-lrx4t6g","Type":"NodeParagraph","Properties":{"id":"20231225163515-lrx4t6g","updated":"20231225163522"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go test -run=xx"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231225163523-v11saj9","Type":"NodeParagraph","Properties":{"id":"20231225163523-v11saj9","updated":"20231225163630"},"Children":[{"Type":"NodeText","Data":"run=[支持正则的字符串]，go test 会匹配 run 后面的字符串，支持正则，会去匹配到具体的单测函数，并进行测试"}]},{"ID":"20231225163632-lcck0fz","Type":"NodeList","ListData":{},"Properties":{"id":"20231225163632-lcck0fz","updated":"20231225163634"},"Children":[{"ID":"20231225163634-rndyh0k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231225163634-rndyh0k","updated":"20231225163634"},"Children":[{"ID":"20231225163634-0pazq05","Type":"NodeParagraph","Properties":{"id":"20231225163634-0pazq05","updated":"20231225163641"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go test -short"}]}]}]},{"ID":"20231225163643-c872ecn","Type":"NodeParagraph","Properties":{"id":"20231225163643-c872ecn","updated":"20231225163717"},"Children":[{"Type":"NodeText","Data":"在单测函数中，执行如下代码，并在命令运行单测的时候，可以跳过指定的单测函数"}]},{"ID":"20231225163718-7t0ci9q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231225163718-7t0ci9q","updated":"20231225163821"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func TestSkipFunc(t *testing.T) {\n  if testing.Short() {\n    t.Skipf(\"跳过当前这个用例\")\n  }\n  ...\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231225163643-1iigmtc","Type":"NodeParagraph","Properties":{"id":"20231225163643-1iigmtc","updated":"20231225163646"},"Children":[{"Type":"NodeText","Data":"​"}]},{"ID":"20231225163823-6tz1929","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231225163823-6tz1929","updated":"20231225163838"},"Children":[{"Type":"NodeText","Data":"使用 golang 的并发测试"}]},{"ID":"20231225163839-ubr3zex","Type":"NodeParagraph","Properties":{"id":"20231225163839-ubr3zex","updated":"20231225163845"},"Children":[{"Type":"NodeText","Data":"我们知道，我们写单测的时候可以使用 golang 的子测试，例如咱们测试获取用户信息的接口的时候，就可以这样："}]},{"ID":"20231225163846-jsfe75h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231225163846-jsfe75h","updated":"20231225164022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"func Test_getUserInfo(t *testing.T) {\n   type args struct {\n      uid string\n   }\n   tests := []struct {\n      name    string\n      args    args\n      want    string\n      wantErr bool\n   }{\n      // TODO: Add test cases.\n{\n         \"case1\",\n         args{\n            \"111\",\n         },\n         \"hello111\",\n         false,\n      },\n   }\n   for _, tt := range tests {\n      t.Run(tt.name, func(t *testing.T) {\n         got, err := getUserInfo(tt.args.uid)\n         if (err != nil) != tt.wantErr {\n            t.Errorf(\"getUserInfo() error = %v, wantErr %v\", err, tt.wantErr)\n            return\n         }\n         if got != tt.want {\n            t.Errorf(\"getUserInfo() got = %v, want %v\", got, tt.want)\n         }\n      })\n   }\n}"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231227095016-0ibxfla","Type":"NodeParagraph","Properties":{"id":"20231227095016-0ibxfla"}}]}