{"ID":"20230727000853-mownsry","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f336","id":"20230727000853-mownsry","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230727000853-mownsry\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230727000854-gpvae8w\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230727000921-9vp2db9\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230727000873-8j547c2\u0026quot;,\u0026quot;focusStart\u0026quot;:2,\u0026quot;focusEnd\u0026quot;:2\u0026#125;","tags":"进程,并发,goroutine,协程","title":"09. 进程、线程、协程","updated":"20230727002330"},"Children":[{"ID":"20230727000854-gpvae8w","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230727000854-gpvae8w","updated":"20230727000854"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"9. 进程、线程、协程"}]},{"ID":"20230727000855-b2xvvr7","Type":"NodeParagraph","Properties":{"id":"20230727000855-b2xvvr7","updated":"20230727000855"},"Children":[{"Type":"NodeText","Data":"进程 = 火车；线程 = 车厢"}]},{"ID":"20230727000856-kqufnev","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000856-kqufnev","updated":"20230727000856"},"Children":[{"ID":"20230727000857-t1h8bw6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000857-t1h8bw6","updated":"20230727000857"},"Children":[{"ID":"20230727000858-usb7dpc","Type":"NodeParagraph","Properties":{"id":"20230727000858-usb7dpc","updated":"20230727000858"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程在进程下进行"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（单纯的车厢无法运行）"}]}]},{"ID":"20230727000859-zm1jvre","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000859-zm1jvre","updated":"20230727000859"},"Children":[{"ID":"20230727000860-eryka7y","Type":"NodeParagraph","Properties":{"id":"20230727000860-eryka7y","updated":"20230727000860"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"一个进程可以包含多个线程"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":" （一辆火车可以有多个车厢）"}]}]},{"ID":"20230727000861-7sgtoxy","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000861-7sgtoxy","updated":"20230727000861"},"Children":[{"ID":"20230727000862-j2rx2t5","Type":"NodeParagraph","Properties":{"id":"20230727000862-j2rx2t5","updated":"20230727000862"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"同一进程下不同线程间数据很易共享"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（A车厢换到B车厢很容易）"}]}]},{"ID":"20230727000863-lggpk72","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000863-lggpk72","updated":"20230727000863"},"Children":[{"ID":"20230727000864-fsu4akn","Type":"NodeParagraph","Properties":{"id":"20230727000864-fsu4akn","updated":"20230727000864"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程要比线程消耗更多的计算机资源"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（采用多列火车相比多个车厢更耗资源）"}]}]},{"ID":"20230727000865-2iu19lv","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000865-2iu19lv","updated":"20230727000865"},"Children":[{"ID":"20230727000866-yf8c6qy","Type":"NodeParagraph","Properties":{"id":"20230727000866-yf8c6qy","updated":"20230727000866"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程间不会相互影响，一个线程挂掉将导致整个进程挂掉"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）"}]}]},{"ID":"20230727000867-ytnhrw3","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000867-ytnhrw3","updated":"20230727000867"},"Children":[{"ID":"20230727000868-1g9yvoo","Type":"NodeParagraph","Properties":{"id":"20230727000868-1g9yvoo","updated":"20230727000868"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程可以拓展到多机，进程最多适合多核"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）"}]}]},{"ID":"20230727000869-8uao9j0","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000869-8uao9j0","updated":"20230727000869"},"Children":[{"ID":"20230727000870-vlqoboh","Type":"NodeParagraph","Properties":{"id":"20230727000870-vlqoboh","updated":"20230727000870"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（比如火车上的洗手间）－\"互斥锁\""}]}]},{"ID":"20230727000871-c1sx7hz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000871-c1sx7hz","updated":"20230727000871"},"Children":[{"ID":"20230727000872-jh4lrws","Type":"NodeParagraph","Properties":{"id":"20230727000872-jh4lrws","updated":"20230727000872"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程使用的内存地址可以限定使用量"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（比如火车上的餐厅，最多只允许多少人进入，如果满了需要在门口等，等有人出来了才能进去）－“信号量”"}]}]}]},{"ID":"20230727000873-8j547c2","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000873-8j547c2","updated":"20230727000873"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"进程"}]},{"ID":"20230727000874-vuz4wqh","Type":"NodeParagraph","Properties":{"id":"20230727000874-vuz4wqh","updated":"20230727000874"},"Children":[{"Type":"NodeText","Data":"进度是资源分配的最小单位；进程是应用程序的启动实例，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"进程拥有代码和打开的文件资源，数据资源，独立的内存空间"}]},{"ID":"20230727000875-7e5uv90","Type":"NodeParagraph","Properties":{"id":"20230727000875-7e5uv90","updated":"20230727000875"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"系统是由一个个进程组成的"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"包括文本区，数据区和堆栈区"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"。进程的创建和销毁都"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"比较消耗资源和时间"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。进程是"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"抢占式的"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"争夺CPU的资源，"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"单核CPU在同一时刻只能有一个进程在执行。"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]}]},{"ID":"20230727000876-gyeiaez","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000876-gyeiaez","updated":"20230727000876"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"线程"}]},{"ID":"20230727000877-sw9rlcz","Type":"NodeParagraph","Properties":{"id":"20230727000877-sw9rlcz","updated":"20230727000877"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"线程从属于进程，是程序的实际执行者，一个进程至少包含一个主线程，也可以有更多的子线程，线程拥有自己栈空间；"}]},{"ID":"20230727000878-2636zui","Type":"NodeParagraph","Properties":{"id":"20230727000878-2636zui","updated":"20230727000878"},"Children":[{"Type":"NodeText","Data":"对操作系统而言，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程是最小的执行单元"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程是最小的资源管理单元"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，无论是进程还是线程，"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"都是由操作系统所管理的"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"；"}]},{"ID":"20230727000879-peym96o","Type":"NodeParagraph","Properties":{"id":"20230727000879-peym96o","updated":"20230727000879"},"Children":[{"Type":"NodeText","Data":"线程是"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"CPU调度的最小单位"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"，线程属于进程，它"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"共享进程的整个内存空间"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"。"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"多线程是不安全的，进程内的一个线程崩溃会导致整个进程崩溃。"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeMark2CloseMarker","Data":"=="}]}]},{"ID":"20230727000880-6kwwlhc","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000880-6kwwlhc","updated":"20230727000880"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"协程"}]},{"ID":"20230727000881-48ukwo3","Type":"NodeParagraph","Properties":{"id":"20230727000881-48ukwo3","updated":"20230727000881"},"Children":[{"Type":"NodeText","Data":"协程是一种"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"用户态"},{"Type":"NodeText","Data":"的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"轻量级线程"},{"Type":"NodeText","Data":"，正如一个进程可以拥有多个线程一样，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一个线程可以拥有多个协程。"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程不是被操作系统内核所管理的，而是完全由程序所控制，也就是在用户态执行。"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"这样带来的好处是性能大幅度的提升，因为不会像线程切换那样消耗资源。"}]},{"ID":"20230727000882-ydvbxvk","Type":"NodeParagraph","Properties":{"id":"20230727000882-ydvbxvk","updated":"20230727000882"},"Children":[{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"协程拥有自己的寄存器上下文和栈。"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此："},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"协程能保留上一次调用时的状态（即所有局部状态的一个特定组合）"},{"Type":"NodeText","Data":"，每次过程重入时，就相当于进入上一次调用的状态，换种说法：进入上一次离开时所处逻辑流的位置。"}]},{"ID":"20230727000883-fq7plfq","Type":"NodeParagraph","Properties":{"id":"20230727000883-fq7plfq","updated":"20230727000883"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"协程：协程是属于线程的，协程的程序是在线程里面跑的。"}]},{"ID":"20230727000884-ginuawt","Type":"NodeParagraph","Properties":{"id":"20230727000884-ginuawt","updated":"20230727000884"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"协程是原子操作的，不存在代码执行一半，被终止的情况。"}]},{"ID":"20230727000885-dy2ooc1","Type":"NodeParagraph","Properties":{"id":"20230727000885-dy2ooc1","updated":"20230727000885"},"Children":[{"Type":"NodeText","Data":"协程的好处："}]},{"ID":"20230727000886-mo83muv","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000886-mo83muv","updated":"20230727000886"},"Children":[{"ID":"20230727000887-sqhgbcn","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000887-sqhgbcn","updated":"20230727000887"},"Children":[{"ID":"20230727000888-7lkb1ev","Type":"NodeParagraph","Properties":{"id":"20230727000888-7lkb1ev","updated":"20230727000888"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"无需线程上下文切换的开销"}]}]},{"ID":"20230727000889-vhtpczr","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230727000889-vhtpczr","updated":"20230727000889"},"Children":[{"ID":"20230727000890-gfee4sh","Type":"NodeParagraph","Properties":{"id":"20230727000890-gfee4sh","updated":"20230727000890"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"无需原子操作锁定及同步的开销"}]}]},{"ID":"20230727000891-ln4bt2g","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230727000891-ln4bt2g","updated":"20230727000891"},"Children":[{"ID":"20230727000892-wa7szvu","Type":"NodeParagraph","Properties":{"id":"20230727000892-wa7szvu","updated":"20230727000892"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"方便切换控制流，简化编程模型"}]}]}]},{"ID":"20230727000893-d6ibkax","Type":"NodeParagraph","Properties":{"id":"20230727000893-d6ibkax","updated":"20230727000893"},"Children":[{"Type":"NodeText","Data":"高并发+高扩展性+低成本："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一个CPU支持上万的协程都不是问题。所以很适合用于高并发处理。"}]},{"ID":"20230727000894-7vllg9i","Type":"NodeParagraph","Properties":{"id":"20230727000894-7vllg9i","updated":"20230727000894"},"Children":[{"Type":"NodeText","Data":"缺点："}]},{"ID":"20230727000895-pjahzem","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000895-pjahzem","updated":"20230727000895"},"Children":[{"ID":"20230727000896-81fwrd8","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000896-81fwrd8","updated":"20230727000896"},"Children":[{"ID":"20230727000897-1gupac0","Type":"NodeParagraph","Properties":{"id":"20230727000897-1gupac0","updated":"20230727000897"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"无法利用多核资源：协程的本质是个单线程"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":",它不能同时将 单个CPU 的多个核用上,"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程需要和进程配合才能运行在多CPU上"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":".当然我们日常所编写的绝大部分应用都没有这个必要，除非是cpu密集型应用。"}]}]},{"ID":"20230727000898-esizi26","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230727000898-esizi26","updated":"20230727000898"},"Children":[{"ID":"20230727000899-astwdc6","Type":"NodeParagraph","Properties":{"id":"20230727000899-astwdc6","updated":"20230727000899"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进行阻塞（Blocking）操作（如IO时）会阻塞掉整个程序"},{"Type":"NodeMark2CloseMarker","Data":"=="}]}]}]}]},{"ID":"20230727000900-ed5u9d8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000900-ed5u9d8","updated":"20230727000900"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"进程、线程、协程的对比"}]},{"ID":"20230727000901-kd2aqpn","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000901-kd2aqpn","updated":"20230727000901"},"Children":[{"ID":"20230727000902-asrzeri","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000902-asrzeri","updated":"20230727000902"},"Children":[{"ID":"20230727000903-pq7yupg","Type":"NodeParagraph","Properties":{"id":"20230727000903-pq7yupg","updated":"20230727000903"},"Children":[{"Type":"NodeText","Data":"协程既不是进程也不是线程，"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程仅仅是一个特殊的函数"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"，协程它进程和进程不是一个维度的。"}]}]},{"ID":"20230727000904-wp99ude","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230727000904-wp99ude","updated":"20230727000904"},"Children":[{"ID":"20230727000905-fjm1evr","Type":"NodeParagraph","Properties":{"id":"20230727000905-fjm1evr","updated":"20230727000905"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程和进程都是同步机制"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程是异步机制"},{"Type":"NodeMark2CloseMarker","Data":"=="}]}]}]},{"ID":"20230727000906-7yrsfuw","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230727000906-7yrsfuw","updated":"20230727000906"},"Children":[{"ID":"20230727000907-ykcm9a5","Type":"NodeParagraph","Properties":{"id":"20230727000907-ykcm9a5","updated":"20230727000907"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程是抢占式"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程是非抢占式，需要用户释放使用权切换到其他协程，同一时间只有一个协程拥有运行权"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，相当于单线程的能力"}]}]},{"ID":"20230727000908-cq7fu8t","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20230727000908-cq7fu8t","updated":"20230727000908"},"Children":[{"ID":"20230727000909-v7mgv3a","Type":"NodeParagraph","Properties":{"id":"20230727000909-v7mgv3a","updated":"20230727000909"},"Children":[{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"一个进程可以包含多个线程，一个线程可以包含多个协程"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"。"}]}]},{"ID":"20230727000910-81l8pc2","Type":"NodeListItem","Data":"5","ListData":{"Typ":1,"Tight":true,"Start":5,"Delimiter":46,"Padding":3,"Marker":"NQ==","Num":5},"Properties":{"id":"20230727000910-81l8pc2","updated":"20230727000910"},"Children":[{"ID":"20230727000911-lpgv1sm","Type":"NodeParagraph","Properties":{"id":"20230727000911-lpgv1sm","updated":"20230727000911"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"一个线程内"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"的多个协程虽然可以切换，但是"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"多个协程是串行执行"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"的，只能在一个线程内运行，没法利用CPU多核能力。"}]}]},{"ID":"20230727000912-0fh82qm","Type":"NodeListItem","Data":"6","ListData":{"Typ":1,"Tight":true,"Start":6,"Delimiter":46,"Padding":3,"Marker":"Ng==","Num":6},"Properties":{"id":"20230727000912-0fh82qm","updated":"20230727000912"},"Children":[{"ID":"20230727000913-n1v7ef8","Type":"NodeParagraph","Properties":{"id":"20230727000913-n1v7ef8","updated":"20230727000913"},"Children":[{"Type":"NodeText","Data":"协程与进程、线程一样，切换是存在上下文切换问题的。"}]}]}]},{"ID":"20230727000914-cw8rlbj","Type":"NodeTable","Data":"|      | 调度               | 上下文切换   | 拥有资源                                 | 系统开销                                                     | 切换开销             |\n| ---- | ------------------ | ------------ | ---------------------------------------- | ------------------------------------------------------------ | -------------------- |\n| 进程 | 资源管理的基本单位 | 慢           | 拥有资源的独立单位                       | 创建或撤销==进程开销==**显著大于**创建或撤销==线程时的开销== | 进程==**大于**==线程 |\n| 线程 | 程序执行的基本单位 | 比进程快的多 | 不拥有系统资源，可以访问隶属于进程的资源 |                                                              |                      |\n| 协程 |                    |              |                                          |                                                              |                      |","TableAligns":[0,0,0,0,0,0],"Properties":{"id":"20230727000914-cw8rlbj","updated":"20230727000914"},"Children":[{"Type":"NodeTableHead","Properties":{"id":""},"Children":[{"Type":"NodeTableRow","Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"调度"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"上下文切换"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"拥有资源"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"系统开销"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换开销"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"进程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"资源管理的基本单位"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"慢"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"拥有资源的独立单位"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"创建或撤销"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"进程开销"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"显著大于"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"创建或撤销"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程时的开销"},{"Type":"NodeMark2CloseMarker","Data":"=="}]}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"进程=="},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"大于"},{"Type":"NodeText","Data":"==线程"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"线程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"程序执行的基本单位"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"比进程快的多"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"不拥有系统资源，可以访问隶属于进程的资源"}]},{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""}}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"协程"}]},{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""}},{"Type":"NodeTableCell","Properties":{"id":""}}]}]},{"ID":"20230727000915-ku6g1tp","Type":"NodeParagraph","Properties":{"id":"20230727000915-ku6g1tp","updated":"20230727000915"},"Children":[{"Type":"NodeText","Data":"上下文切换对比："}]},{"ID":"20230727000916-elqtuwy","Type":"NodeParagraph","Properties":{"id":"20230727000916-elqtuwy","updated":"20230727000916"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"(1)进程的切换者是操作系统，"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"切换时机是根据操作系统自己的切换策略，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"用户是无感知的"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。进程的"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换内容包括页全局目录、内核栈、硬件上下文，切换内容保存在内存中。"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"进程切换过程是由“用户态到内核态到用户态”的方式，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换效率低"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。"}]},{"ID":"20230727000917-zqw7ejw","Type":"NodeParagraph","Properties":{"id":"20230727000917-zqw7ejw","updated":"20230727000917"},"Children":[{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"(2)线程的切换者是操作系统"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，切换时机是根据操作系统自己的切换策略，用户是无感知的。"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程的切换内容包括内核栈和硬件上下文"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":",线程"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换内容保存在内核栈中."},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"线程切换过程是由“用户态到内核态到用户态”，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换效率中等"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。因为"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"线程的调度是在内核态运行的，而线程中的代码是在用户态运行，因此线程切换会导致用户态与内核态的切换"},{"Type":"NodeMark2CloseMarker","Data":"=="}]}]},{"ID":"20230727000918-kynbq39","Type":"NodeParagraph","Properties":{"id":"20230727000918-kynbq39","updated":"20230727000918"},"Children":[{"Type":"NodeText","Data":"(4)"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程的切换者是用户"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"（"},{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"编程者或应用程序"},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"），"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换时机是用户自己的程序所决定的"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"协程的切换内容是硬件上下文"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换内存保存在用户自己的变量（用户栈或堆）中"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。协程的切换过程只有用户态，即没有陷入内核态，因此"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"切换效率高"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"。"}]},{"ID":"20230727000919-vhonzl4","Type":"NodeTable","Data":"| 上下文切换对比 | 切换者                   | 切换时机                           | 切换内容                        | 切换内容保存位置               | 切换过程                   | 切换效率 |\n| -------------- | ------------------------ | ---------------------------------- | ------------------------------- | ------------------------------ | -------------------------- | -------- |\n| 进程           | 操作系统                 | 操作系统自己的切换策略，用户无感知 | 页全局目录、 内核栈、硬件上下文 | 内存中                         | 用户态到内核态到用户态     | 低       |\n| 线程           | 操作系统                 | 操作系统自己的切换策略，用户无感知 | 内核栈，硬件上下文              | 内核栈中                       | 用户态到内核态到用户态     | 中等     |\n| 协程           | 用户（编程者或应用程序） | 用户自己的程序决定的               | 硬件上下文                      | 用户自己的变量中（用户栈或堆） | 只有用户态，没有陷入内核态 | 高       |","TableAligns":[0,0,0,0,0,0,0],"Properties":{"id":"20230727000919-vhonzl4","updated":"20230727000919"},"Children":[{"Type":"NodeTableHead","Properties":{"id":""},"Children":[{"Type":"NodeTableRow","Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"上下文切换对比"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换者"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换时机"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换内容"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换内容保存位置"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换过程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"切换效率"}]}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"进程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"操作系统"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"操作系统自己的切换策略，用户无感知"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"页全局目录、 内核栈、硬件上下文"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"内存中"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"用户态到内核态到用户态"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"低"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"线程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"操作系统"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"操作系统自己的切换策略，用户无感知"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"内核栈，硬件上下文"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"内核栈中"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"用户态到内核态到用户态"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"中等"}]}]},{"Type":"NodeTableRow","TableAligns":[0,0,0,0,0,0,0],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"协程"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"用户（编程者或应用程序）"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"用户自己的程序决定的"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"硬件上下文"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"用户自己的变量中（用户栈或堆）"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"只有用户态，没有陷入内核态"}]},{"Type":"NodeTableCell","Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"高"}]}]}]},{"ID":"20230727000920-zplwdzq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000920-zplwdzq","updated":"20230727000920"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"最佳实践"}]},{"ID":"20230727000921-9vp2db9","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000921-9vp2db9","updated":"20230727000921"},"Children":[{"ID":"20230727000922-1w2aia0","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000922-1w2aia0","updated":"20230727000922"},"Children":[{"ID":"20230727000923-p9cg1vu","Type":"NodeParagraph","Properties":{"id":"20230727000923-p9cg1vu","updated":"20230727000923"},"Children":[{"Type":"NodeText","Data":"线程和协程推荐在IO密集型的任务(比如网络调用)中使用，而在CPU密集型的任务中，表现较差。"}]}]},{"ID":"20230727000924-dymhbh7","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230727000924-dymhbh7","updated":"20230727000924"},"Children":[{"ID":"20230727000925-ujl9lbt","Type":"NodeParagraph","Properties":{"id":"20230727000925-ujl9lbt","updated":"20230727000925"},"Children":[{"Type":"NodeText","Data":"对于CPU密集型的任务，则需要多个进程，绕开GIL的限制，利用所有可用的CPU核心，提高效率。"}]}]},{"ID":"20230727000926-w775tpl","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230727000926-w775tpl","updated":"20230727000926"},"Children":[{"ID":"20230727000927-1l1y70g","Type":"NodeParagraph","Properties":{"id":"20230727000927-1l1y70g","updated":"20230727000927"},"Children":[{"Type":"NodeText","Data":"所以大并发下的最佳实践就是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。"}]}]}]}]}