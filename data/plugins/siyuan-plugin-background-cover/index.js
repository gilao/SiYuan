/*!
 * MIT License
 *
 * Copyright (c) 2023 SiYuan 思源笔记
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */(()=>{"use strict";var A={};A.d=(n,t)=>{for(var e in t)A.o(t,e)&&!A.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},A.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),A.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var G={};A.r(G),A.d(G,{default:()=>it});const h=require("siyuan"),B=JSON.parse('{"u2":"siyuan-plugin-background-cover","i8":"0.4.5"}');var w=(n=>(n[n.image=0]="image",n[n.video=1]="video",n[n.live2d=2]="live2d",n))(w||{});const xe=2097152,L=`/data/public/${B.u2}/assets`,C=`${L}/images`.toString(),at=`${L}/live2d`.toString();let O="",j=window.siyuan.config.system.workspaceDir;window.siyuan.config.system.os==="windows"?(j=j.replaceAll("\\","/"),O=`${j}${L}`):O=`${j}${L}`;const Z=198,V=[".png",".jpeg",".jpg",".jiff",".jfif"],X="bg-cover-setting.json",Q="https://cdn.jsdelivr.net/gh/HowcanoeWang/siyuan-plugin-background-cover/static/FyBE0bUakAELfeF.jpg";var ee={autoRefresh:!0,bgObj:void 0,opacity:.5,blur:5,activate:!0,prevTheme:"",fileidx:{},version:B.i8,inDev:!1,blockTheme:{light:{},dark:{}}};const Ae={iconLogo:`<symbol id="iconLogo" viewBox="0 0 32 32">
    <path d="M26 28h-20v-4l6-10 8.219 10 5.781-4v8z"></path>
    <path d="M26 15c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3c1.657 0 3 1.343 3 3z"></path>
    <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
    </symbol>`};var te=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});class Se{constructor(){this.settings=structuredClone(ee)}setPlugin(t){this.plugin=t}get(t){var e;return(e=this.settings)==null?void 0:e[t]}set(t,e){if(!(t in this.settings)){z(`"${t}" is not a setting`);return}this.settings[t]=e}reset(){return te(this,null,function*(){this.settings=structuredClone(ee),this.save()})}load(){return te(this,null,function*(){let t=yield this.plugin.loadData(X);if(t==null||t==null||t=="")d("\u6CA1\u6709\u914D\u7F6E\u6587\u4EF6\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E"),this.save("[configs][load init]");else{d(`\u8BFB\u5165\u914D\u7F6E\u6587\u4EF6: ${X}`),typeof t=="string"&&(t=JSON.parse(t));try{for(let e in t)e in ee&&this.set(e,t[e])}catch(e){z(`Setting load error: ${e}`)}this.save("[configs][load update]")}})}save(t){return te(this,null,function*(){let e=JSON.stringify(this.settings);d(t?`${t}\u5199\u5165\u914D\u7F6E\u6587\u4EF6:`:"\u5199\u5165\u914D\u7F6E\u6587\u4EF6:",e),this.plugin.saveData(X,e)})}}const o=new Se,Ne=JSON.parse(`{"e":[{"url":"chenshinshi/Cliff-Dark@90eedd5840debb68497394d4c1f5fc325b7f6aff","updated":"2023-08-28T05:07:00Z","stars":0,"openIssues":0,"size":781483,"package":{"name":"Cliff Dark","author":"Crowds21","url":"https://github.com/chenshinshi/Cliff-Dark","version":"3.2.0","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Cliff-Dark","zh_CN":"","en_US":""},"description":{"default":"\u4E00\u6B3E\u9002\u5408\u80CC\u666F\u56FE\u7247\u63D2\u4EF6\u7684\u591C\u95F4\u4E3B\u9898\uFF0C\u7531Crowds21\u5236\u4F5C\uFF0Cchenshinshi\u9002\u914D\u65B0\u7248\u672C\u3002","zh_CN":"","en_US":""},"readme":{"default":"README.md","zh_CN":"","en_US":""},"funding":null}},{"url":"chenshinshi/toy@d6b9da2dcbffcce83b226873c3c0ebeaa826a649","updated":"2023-08-27T08:56:25Z","stars":5,"openIssues":2,"size":2978186,"package":{"name":"toy","author":"allen","url":"https://github.com/chenshinshi/toy","version":"1.5.4","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"toy","zh_CN":"\u73A9\u5177","en_US":""},"description":{"default":"\u8FD9\u662F\u4E00\u6B3E\u300C\u73A9\u5177\u300D\u4E3B\u9898\uFF0C\u5C06\u9875\u9762\u5E03\u5C40\u548C\u914D\u8272\u5206\u79BB\uFF0C\u901A\u8FC7\u7B80\u5355\u7684\u914D\u7F6E\u5373\u53EF\u5FEB\u901F\u5B9E\u73B0\u591A\u79CD\u4E3B\u9898\u6837\u5F0F\u6548\u679C\u3002","zh_CN":"\u8FD9\u662F\u4E00\u6B3E\u300C\u73A9\u5177\u300D\u4E3B\u9898\uFF0C\u5C06\u9875\u9762\u5E03\u5C40\u548C\u914D\u8272\u5206\u79BB\uFF0C\u901A\u8FC7\u7B80\u5355\u7684\u914D\u7F6E\u5373\u53EF\u5FEB\u901F\u5B9E\u73B0\u591A\u79CD\u4E3B\u9898\u6837\u5F0F\u6548\u679C\u3002","en_US":""},"readme":{"default":"README.md","zh_CN":"README.md","en_US":""},"funding":null}},{"url":"Achuan-2/siyuan-themes-tsundoku@215d3d9b5b3c4bf2d060c6ce5dc8b5df95e1057c","updated":"2023-08-24T01:58:38Z","stars":73,"openIssues":2,"size":3694211,"package":{"name":"Tsundoku","author":"Achuan-2","url":"https://github.com/Achuan-2/siyuan-themes-tsundoku","version":"1.8.0","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Tsundoku","zh_CN":"\u7A4D\u8AAD","en_US":""},"description":{"default":"Tsundoku is acquiring reading materials but letting them pile up in one's home without reading them","zh_CN":"\u8C08\u604B\u7231\u6700\u5FCC\u53EA\u611F\u52A8\u81EA\u5DF1\uFF0C\u5B66\u4E60\u6700\u5FCC\u53EA\u8BB0\u4E0D\u505A\uFF0C\u613F\u5927\u5BB6\u6E10\u8FDB\u5F0F\u8BB0\u7B14\u8BB0\uFF0C\u6E10\u8FDB\u5F0F\u751F\u6D3B\uFF0C\u6E10\u8FDB\u5F0F\u8FDB\u6B65\uFF01","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/achuan-2"]}}},{"url":"idea-zone/mini-vlook@d4f9e2be8e97f00454bee22103eb2e7376b7ef81","updated":"2023-08-24T00:53:46Z","stars":18,"openIssues":8,"size":7416706,"package":{"name":"mini-vlook","author":"\u8DEF\u4EBA\u4E8C","url":"https://github.com/idea-zone/mini-vlook","version":"2.10.1","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"mini-vlook\uFF08\u7B80\u6D01\u7248vlook\uFF09","zh_CN":"mini-vlook\uFF08\u7B80\u6D01\u7248vlook\uFF09","en_US":"mini-vlook"},"description":{"default":"\u7B80\u6D01\u800C\u4E0D\u7B80\u5355, \u8BA9\u4F60\u7684 markdown \u6709\u4E86 \u2018\u5FAE\u578B\u2019 \u7684\u65B0\u770B\u6CD5","zh_CN":"\u7B80\u6D01\u800C\u4E0D\u7B80\u5355, \u8BA9\u4F60\u7684 markdown \u6709\u4E86 \u2018\u5FAE\u578B\u2019 \u7684\u65B0\u770B\u6CD5","en_US":"Concise but not simple, let you have a 'mini' new look on markdown"},"readme":{"default":"README.md","zh_CN":"README.md","en_US":"README_en_US.md"},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/mini-vlook"]}}},{"url":"StarDustSheep/It_hurts@a821992381e4658d8d3deafe5d55f951789c0b23","updated":"2023-08-23T08:45:10Z","stars":0,"openIssues":0,"size":658008,"package":{"name":"It_hurts","author":"StarDustSheep","url":"https://github.com/StarDustSheep/It_hurts","version":"0.0.2","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"It_hurts","zh_CN":"\u75DB,\u592A\u75DB\u4E86","en_US":""},"description":{"default":"The world denied my happiness now all will die","zh_CN":"\u4E16\u754C\u5C06\u6211\u65E0\u60C5\u6BC1\u5F03\uFF0C\u73B0\u5728\u6211\u5C06\u4EE5\u75DB\u62A5\u4E4B","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://www.bilibili.com/video/BV1h3411j7EA/?vd_source=53287ba5828305cc168ced022e9c72ce"]}}},{"url":"royc01/notion-theme@8fd8fe6c234edd8bbb6eb1ca2431c529913fcc0c","updated":"2023-08-22T14:37:34Z","stars":90,"openIssues":6,"size":2141395,"package":{"name":"Savor","author":"Roy","url":"https://github.com/royc01/notion-theme","version":"3.5.6","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Savor","zh_CN":"\u5199\u672A","en_US":""},"description":{"default":"You said you couldn\u2019t bear to consume such a feeling.","zh_CN":"\u4F60\u8BF4\u4F60\u820D\u4E0D\u5F97\u5403\u6389\u8FD9\u4E00\u79CD\u611F\u89C9\u3002","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/Savor"]}}},{"url":"chenshinshi/OneNote@7f62d6d2ad031522f8a2a2ada151d5ed92132d49","updated":"2023-08-21T08:55:30Z","stars":3,"openIssues":0,"size":7445907,"package":{"name":"OneNote","author":"UserZYF","url":"https://github.com/chenshinshi/OneNote","version":"0.17","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"OneNote","zh_CN":"","en_US":""},"description":{"default":"\u7C7BOneNote\u5916\u89C2\u4E3B\u9898\u3002","zh_CN":"","en_US":""},"readme":{"default":"README.md","zh_CN":"","en_US":""},"funding":null}},{"url":"StarDustSheep/pink-room@491bc15a3cbe12c3f16bc00f3b65b3e59b5b7ea5","updated":"2023-08-19T10:09:53Z","stars":12,"openIssues":0,"size":223421,"package":{"name":"pink-room","author":"StarDustSheep","url":"https://github.com/StarDustSheep/pink-room","version":"0.8.6","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"pink-room","zh_CN":"\u7C89\u8272\u5C0F\u5C4B","en_US":""},"description":{"default":"It's a stylize theme for Siyuan. <br> In addition to the pink interface there are also blue and green interfaces.","zh_CN":"\u8FD9\u662F\u4E00\u4E2A\u6D45\u8272\u98CE\u683C\u5316\u4E3B\u9898\u3002\u9664\u4E86\u7C89\u8272\u754C\u9762\u5916\u8FD8\u53E6\u6709\u84DD\u8272\u548C\u7EFF\u8272\u754C\u9762","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/order/create?user_id=3ced5134eee011eda1375254001e7c00"]}}},{"url":"LaneDu/Knowledge-Brain@8fb4ccc9669e9b8c77230e49ba6c084c4e801460","updated":"2023-08-16T09:43:59Z","stars":19,"openIssues":13,"size":1265308,"package":{"name":"Knowledge Brain","author":"lane","url":"https://github.com/LaneDu/Knowledge-Brain","version":"3.5.3","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Knowledge Brain","zh_CN":"\u77E5\u8BC6\u5927\u8111","en_US":""},"description":{"default":"You can only remember index ,it\u2018s your second brain","zh_CN":"\u4F60\u7684\u5927\u8111\u53EA\u9700\u8981\u8BB0\u4F4F\u7D22\u5F15\uFF0C\u7B2C\u4E8C\u5927\u8111\u6765\u8BB0\u5FC6\u77E5\u8BC6","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/knowledgebrain"]}}},{"url":"TinkMingKing/siyuan-themes-wpslite@7ce46c37270136c2fba511ca2385fc436a0dffd1","updated":"2023-08-13T17:20:24Z","stars":1,"openIssues":0,"size":109855,"package":{"name":"siyuan-themes-wpslite","author":"TinkMingKing","url":"https://github.com/TinkMingKing/siyuan-themes-VSCode-Lite","version":"1.3.1","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"WPS Lite","zh_CN":"","en_US":""},"description":{"default":"Replicate the interface style of VSCode, fine-tune the layout and color scheme, enhance the visibility of headings, and support both light and dark themes.","zh_CN":"\u4EFFWPS\u754C\u9762\u98CE\u683C\uFF0C\u5FAE\u8C03\u5E03\u5C40\u53CA\u914D\u8272\uFF0C\u589E\u52A0\u6807\u9898\u8FA8\u8BC6\u5EA6\uFF0C\u540C\u65F6\u652F\u6301\u660E\u4EAE\u548C\u6697\u9ED1\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/MingKing"]}}},{"url":"RQYOU/SiYuan-Theme-Hazy-Moonlight@9b4055fd6afd43514a63ca2f079998294a08a24a","updated":"2023-08-12T07:52:07Z","stars":4,"openIssues":1,"size":12064547,"package":{"name":"Hazy-Moonlight","author":"RQYOU","url":"https://github.com/RQYOU/Hazy-Moonlight","version":"1.0.20","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"\u6726\u80E7\u6708\u5149","zh_CN":"\u6726\u80E7\u6708\u5149","en_US":"Hazy Moonlight"},"description":{"default":"\u4E00\u6B3E\u6E05\u723D\u3001\u7D27\u51D1\u7684\u601D\u6E90\u7B14\u8BB0\u6D45\u8272\u4E3B\u9898\u3002","zh_CN":"\u4E00\u6B3E\u6E05\u723D\u3001\u7D27\u51D1\u7684\u601D\u6E90\u7B14\u8BB0\u6D45\u8272\u4E3B\u9898\u3002","en_US":""},"readme":{"default":"README.md","zh_CN":"README.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":[""]}}},{"url":"Zuoqiu-Yingyi/siyuan-theme-dark-plus@217d6fdf304f702d63af1f783a6d7ad14be8b231","updated":"2023-08-11T15:39:26Z","stars":132,"openIssues":11,"size":10032734,"package":{"name":"Dark+","author":"Zuoqiu Yingyi","url":"https://github.com/Zuoqiu-Yingyi/siyuan-theme-dark-plus","version":"1.10.0","minAppVersion":"2.9.9","backends":null,"frontends":null,"displayName":{"default":"Dark+","zh_CN":"\u6697\u8272+","en_US":""},"description":{"default":"This is a multifunctional dual-mode theme","zh_CN":"\u8FD9\u662F\u4E00\u6B3E\u591A\u529F\u80FD\u53CC\u6A21\u5F0F\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/zuoqiu","https://ko-fi.com/zuoqiu"]}}},{"url":"LaneDu/Knowledge-Show@eafde5a4688a42bfc31a124c648d52f338e4bde6","updated":"2023-08-09T09:42:31Z","stars":0,"openIssues":0,"size":2174255,"package":{"name":"Knowledge Show","author":"lane","url":"https://github.com/LaneDu/Knowledge-Show","version":"2.0.1","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Knowledge Show","zh_CN":"\u77E5\u8BC6\u79C0","en_US":""},"description":{"default":"You can only remember index ,it\u2018s your second brain in the night","zh_CN":"\u4E00\u6B3E\u591C\u95F4\u6709\u70B9\u70AB\u7684\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/knowledgebrain"]}}},{"url":"StarDustSheep/StarDust@9c504a5db5fa83e5f0f87d375551860fa4f95828","updated":"2023-08-07T09:23:18Z","stars":3,"openIssues":3,"size":457694,"package":{"name":"StarDust","author":"StarDustSheep","url":"https://github.com/StarDustSheep/StarDust","version":"0.7.1","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"StarDust","zh_CN":"\u661F\u5C18","en_US":""},"description":{"default":"This is a stylized theme. Maybe it can give you the feeling of the universe and the night sky","zh_CN":"\u8FD9\u662F\u4E00\u4E2A\u98CE\u683C\u5316\u4E3B\u9898\u3002\u6216\u8BB8\u80FD\u7ED9\u4F60\u5E26\u6765\u5B87\u5B99\u548C\u591C\u7A7A\u7684\u611F\u89C9\u3002","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/StarDustSheep"]}}},{"url":"Morganwan90/Lightblue-siyuan-theme@8eb404aea5d702efed08aa4fcc517c75e8012fcc","updated":"2023-07-31T04:30:34Z","stars":25,"openIssues":1,"size":726176,"package":{"name":"Light-Blue","author":"Morgan","url":"https://github.com/Morganwan90/Lightblue-siyuan-theme/","version":"1.1.5","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Light-Blue","zh_CN":"","en_US":""},"description":{"default":"\u81EA\u7528\u4E3B\u9898","zh_CN":"","en_US":""},"readme":{"default":"README.md","zh_CN":"","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/morganwan"]}}},{"url":"Morganwan90/Darkblue-siyuan-theme@25c0814927d2d15db97c2dc22512bb13618eaf53","updated":"2023-07-31T04:28:48Z","stars":20,"openIssues":0,"size":1686137,"package":{"name":"Dark-Blue","author":"Morgan","url":"https://github.com/Morganwan90/Darkblue-siyuan-theme","version":"1.1.5","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Dark-Blue","zh_CN":"","en_US":""},"description":{"default":"\u81EA\u7528\u4E3B\u9898","zh_CN":"","en_US":""},"readme":{"default":"README.md","zh_CN":"","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/morganwan"]}}},{"url":"terwer/siyuan-theme-zhihu@0a993a3348e74d0563a980e3f5b0b1c4c7cb8e35","updated":"2023-07-25T03:16:44Z","stars":1,"openIssues":2,"size":556704,"package":{"name":"Zhihu","author":"terwer","url":"https://github.com/terwer/siyuan-theme-zhihu","version":"0.0.11","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Zhihu","zh_CN":"\u77E5\u4E4E","en_US":""},"description":{"default":"Zhihu style, focusing on creating a clean and comfortable creative experience","zh_CN":"\u77E5\u4E4E\u98CE\u683C\uFF0C\u4E13\u6CE8\u4E8E\u6253\u9020\u5E72\u51C0\u3001\u8212\u9002\u7684\u521B\u4F5C\u4F53\u9A8C","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/terwer"]}}},{"url":"royc01/Odyssey@b7121f2e249729081fb1fb6067a630ba45e54f58","updated":"2023-07-15T15:00:55Z","stars":2,"openIssues":0,"size":1158943,"package":{"name":"Odyssey","author":"Roy","url":"https://github.com/royc01/Odyssey","version":"1.0.6","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Odyssey","zh_CN":"\u4EFB\u6211\u884C","en_US":""},"description":{"default":"Since when have we started to worry that there is no one in the mountain?\xA0Since when have we started to be scared about looking at the stars?","zh_CN":"\u4ECE\u4F55\u65F6\u5F00\u59CB\u5FCC\u8BB3\u7A7A\u5C71\u65E0\u4EBA\uFF0C\u4ECE\u4F55\u65F6\u5F00\u59CB\u6015\u9065\u671B\u661F\u5C18\u3002","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/Savor"]}}},{"url":"frostime/sy-dark-purple@cb3ba0d6f2d488e0dac26b2e1e64e213fd32df4a","updated":"2023-07-11T11:06:12Z","stars":1,"openIssues":2,"size":275411,"package":{"name":"sy-dark-purple","author":"frostime","url":"https://github.com/frostime/sy-dark-purple","version":"0.4.5","minAppVersion":"2.9.5","backends":null,"frontends":null,"displayName":{"default":"Dark Purple","zh_CN":"\u7D2B\u591C","en_US":""},"description":{"default":"Dark purple theme from jetbrain fleet","zh_CN":"\u4EFF Jetbrain Fleet \u7684 Dark purple \u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/frostime"]}}},{"url":"TinkMingKing/siyuan-themes-vscodelite@52387010ecc6d96de7c950a764653577cd259cab","updated":"2023-07-10T02:05:46Z","stars":2,"openIssues":0,"size":83523,"package":{"name":"siyuan-themes-vscodelite","author":"TinkMingKing","url":"https://github.com/TinkMingKing/siyuan-themes-VSCode-Lite","version":"1.2.1","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"VSCode Lite","zh_CN":"","en_US":""},"description":{"default":"Replicate the interface style of VSCode, fine-tune the layout and color scheme, enhance the visibility of headings, and support both light and dark themes.","zh_CN":"\u4EFFVSCode\u754C\u9762\u98CE\u683C\uFF0C\u5FAE\u8C03\u5E03\u5C40\u53CA\u914D\u8272\uFF0C\u589E\u52A0\u6807\u9898\u8FA8\u8BC6\u5EA6\uFF0C\u540C\u65F6\u652F\u6301\u660E\u4EAE\u548C\u6697\u9ED1\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/MingKing"]}}},{"url":"svchord/Rem-Craft@529e1a1eca8223eff668a02547d80f8b59ddb915","updated":"2023-07-09T19:20:51Z","stars":96,"openIssues":9,"size":1620626,"package":{"name":"Rem Craft","author":"Seven Chor","url":"https://github.com/svchord/Rem-Craft","version":"2.6.12","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"\u745E\u59C6\u5DE5\u827A","zh_CN":"\u745E\u59C6\u5DE5\u827A","en_US":"Rem Craft"},"description":{"default":"\u4E00\u6B3E\u73B0\u4EE3\u5316\u3001\u6241\u5E73\u5316\u8BBE\u8BA1\u7684\u601D\u6E90\u7B14\u8BB0\u4E3B\u9898","zh_CN":"\u4E00\u6B3E\u73B0\u4EE3\u5316\u3001\u6241\u5E73\u5316\u8BBE\u8BA1\u7684\u601D\u6E90\u7B14\u8BB0\u4E3B\u9898","en_US":"A modern, flat design siyuan note theme"},"readme":{"default":"README.md","zh_CN":"README.md","en_US":"README_en_US.md"},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://afdian.net/a/sevenchord"]}}},{"url":"chenshinshi/chuizi@868ce7a9686863f19f1bfe425b5a57008e59bb2c","updated":"2023-06-29T09:44:50Z","stars":3,"openIssues":1,"size":1242812,"package":{"name":"chuizi","author":"chenshinshi","url":"https://github.com/chenshinshi/chuizi","version":"0.20","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"chuizi","zh_CN":"\u9524\u5B50","en_US":""},"description":{"default":"Upload chuizi theme by UserZYF","zh_CN":"\u642C\u8FD0UserZYF\u4EFF\u9524\u5B50\u4FBF\u7B7E\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README.md","en_US":""},"funding":null}},{"url":"siyuan-note/theme-sample@1ff7079a27543e589f0ed18effaceaf40ccdf8cf","updated":"2023-05-30T03:42:50Z","stars":2,"openIssues":0,"size":13340,"package":{"name":"theme-sample","author":"Vanessa","url":"https://github.com/siyuan-note/theme-sample","version":"0.0.3","minAppVersion":"2.8.8","backends":null,"frontends":null,"displayName":{"default":"Theme Sample","zh_CN":"\u4E3B\u9898\u793A\u4F8B","en_US":""},"description":{"default":"This is a theme sample","zh_CN":"\u8FD9\u662F\u4E00\u4E2A\u4E3B\u9898\u793A\u4F8B","en_US":""},"readme":{"default":"README.md","zh_CN":"README_zh_CN.md","en_US":""},"funding":{"openCollective":"","patreon":"","github":"","custom":["https://ld246.com/sponsor"]}}},{"url":"zuoez02/z-acrylic@94d3f40a862432c1a7949ffc47fe80e4c2e55ecc","updated":"2023-05-29T06:06:44Z","stars":0,"openIssues":0,"size":755548,"package":{"name":"z-acrylic","author":"zuoez02","url":"https://github.com/zuoez02/z-acrylic","version":"0.2.2","minAppVersion":"","backends":null,"frontends":null,"displayName":{"default":"Z-Acrylic","zh_CN":"Z-Acrylic","en_US":""},"description":{"default":"Z-Acrylic\u662F\u4E00\u6B3E\u5FAE\u8F6FAcrylic\u98CE\u683C\u7684\u4E3B\u9898","zh_CN":"Z-Acrylic\u662F\u4E00\u6B3E\u5FAE\u8F6FAcrylic\u98CE\u683C\u7684\u4E3B\u9898","en_US":""},"readme":{"default":"README.md","zh_CN":"README.md","en_US":""},"funding":null}}]}`);var S=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});function M(...n){console.log(`[BgCover Plugin][INFO] ${n}`)}function d(...n){o.get("inDev")&&console.log("[BgCover Plugin][DEBUG]",...n)}function z(...n){console.error(`[BgCover][ERROR] ${n}`)}function lt(...n){console.warn(`[BgCover][WARN] ${n}`)}function U(){const n=window.siyuan.config.appearance.mode;let t="";return n===0?t=window.siyuan.config.appearance.themeLight:t=window.siyuan.config.appearance.themeDark,[n,t]}function pe(){const n=window.siyuan.config.appearance.lightThemes,t=window.siyuan.config.appearance.darkThemes;return[n,t]}function Pe(){return S(this,null,function*(){const n="https://raw.githubusercontent.com/siyuan-note/bazaar/main/stage/themes.json";try{return yield(yield fetch(n)).json()}catch(t){d("[utiles][getGithubThemeJson] Failed to fetch data from Github:",t),(0,h.showMessage)(`[${window.bgCoverPlugin.i18n.addTopBarIcon}]${window.bgCoverPlugin.i18n.failConnectGithubJson}`,4e3,"info");return}})}function fe(n){var t={daylight:"daylight",midnight:"midnight"};const e=window.siyuan.config.lang;for(var i=0;i<n.length;i++){var a=n[i];let l=a.package.displayName[e];(l==null||l==="")&&(l=a.package.displayName.default),t[a.package.name]=l}return t}function Be(){return S(this,null,function*(){const[n,t]=pe(),e=[...new Set([...n,...t])];let i=fe(Ne.e);d("[utils][themeName2DisplayName] cached theme info:",i,"Installed themes:",e);var a=!1;for(var l of e)i.hasOwnProperty(l)||(a=!0,d(`[utils][themeName2DisplayName] the installed theme ${l} does not in the cached them info`));if(a){d("[utils][themeName2DisplayName] try to update theme info from Github");var s=yield Pe();s&&(i=fe(s.repos))}for(var l of e)i.hasOwnProperty(l)||(d(`[utils][themeName2DisplayName] Still not find theme info of [${l}], use it as theme name directly`),i[l]=l);return i})}class Me{merge(t,e){return[...new Set([...t,...e])]}}class H{addAlpha(t,e){return t.replace(")",`, ${e})`).replace("rgb","rgba")}removeAlpha(t){let e=t.split(",");return console.log(e),e[0].replace("rgba","rgb")+e[1]+e[2]+")"}editAlpha(t,e){return t.replace(/[\d\.]+\)$/g,`${e})`)}getAlpha(t){return t.slice(0,4)!=="rgba"?null:parseFloat(t.split(",")[3])}hex2rgba(t,e=-1){t=t.replace("#","");var i=parseInt(t.length==3?t.slice(0,1).repeat(2):t.slice(0,2),16),a=parseInt(t.length==3?t.slice(1,2).repeat(2):t.slice(2,4),16),l=parseInt(t.length==3?t.slice(2,3).repeat(2):t.slice(4,6),16);return e>=0?"rgba("+i+", "+a+", "+l+", "+e+")":"rgb("+i+", "+a+", "+l+")"}hsl2rgb(t){function e(m,k,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?m+(k-m)*6*p:p<1/2?k:p<2/3?m+(k-m)*(2/3-p)*6:m}var i=t.replace(/ /g,"").split(","),a=parseFloat(i[0]),l=parseFloat(i[1].slice(0,-1))/100,s=parseFloat(i[2].slice(0,-1))/100;a=a%360/360;var r,u,c;if(l===0)r=u=c=s;else{var g=s<.5?s*(1+l):s+l-s*l,f=2*s-g;r=e(f,g,a+1/3),u=e(f,g,a),c=e(f,g,a-1/3)}return"rgb("+Math.round(r*255)+", "+Math.round(u*255)+", "+Math.round(c*255)+")"}changeColorOpacity(t,e){let i="",a=getComputedStyle(document.querySelector(":root"));if(t.slice(0,1)==="#")i=this.hex2rgba(t,e);else if(t.slice(0,4)==="var("){let l=t.slice(4,-1),s=a.getPropertyValue(l);d(`[utils][CV2.changeColorOpacity] input colorStr = ${t}, extract css variable ${l} and obtained value as ${s}`),i=this.changeColorOpacity(s,e)}else if(t==="transparent"||t.replaceAll(" ","")==="rgb(0,0,0)"||t.replaceAll(" ","")==="rgb(0,0,0,0)"||t.replaceAll(" ","")==="rgba(0,0,0,0)"){const[l,s]=U();l==="light"?i=`rgba(255, 255, 255, ${e})`:i=`rgba(0, 0, 0, ${e})`}else if(t.slice(0,4)==="rgb("&&t.split(",").length===3)i=this.addAlpha(t,e);else if(t.slice(0,4)==="rgb("&&t.split(",").length===4)t=t.replace("rgb(","rgba("),i=this.editAlpha(t,e);else if(t.slice(0,4)==="rgba")i=this.editAlpha(t,e);else if(t.slice(0,4)==="hsl("){let l=this.hsl2rgb(t);i=this.addAlpha(l,e)}else z(`Unable to parse the color string [${t}], not 'var(--xxx)', 'rgb(xxx)', 'rgba(xxx)', '#hex'`);return i}getImageSize(t){return new Promise((e,i)=>{const a=new Image;a.src=t,a.onload=()=>{const{naturalWidth:l,naturalHeight:s}=a;e({width:l,height:s})},a.onerror=()=>{i(new Error("\u65E0\u6CD5\u52A0\u8F7D\u56FE\u50CF"))}})}getFullSide(t,e,i,a){const l=t/e,s=i/a;let r="";return l>s?r="X":r="Y",d(`container W:H = [${t} / ${e} = ${l}], image W:H = [${i} / ${a} = ${s}], fullsize = ${r}`),r}}class q{constructor(){this.ka=new ie}rmtree(t){return S(this,null,function*(){let e=yield this.listdir(t);for(let i in e){let a=e[i];if(a.isDir)this.rmtree(`${t}/${a.name}/`);else{let l=`${t}/${a.name}`;yield this.ka.removeFile(l)}}t.slice(-1)==="/"?yield this.ka.removeFile(t):yield this.ka.removeFile(t+"/")})}listdir(t){return S(this,null,function*(){var e;let i=yield this.ka.readDir(t);return(i!==null||i!==void 0)&&(d("[os.listdir] out.data ->",i.data),e=i.data),e})}splitext(t){let e=t.substring(t.lastIndexOf(".")+1,t.length)||t;return[t.substring(0,t.lastIndexOf("."))||t,e]}openFile(t,e,i){return S(this,null,function*(){try{const l=yield(yield fetch(t)).blob();return new File([l],e,{type:i})}catch(a){return console.error("Error fetching the file:",a),null}})}openFilePicker(t){return S(this,null,function*(){return new Promise((e,i)=>{const a=document.createElement("input");a.type="file",a.multiple=!1,a.value="",t&&(a.accept=t),a.addEventListener("change",()=>{a.files?e(Array.from(a.files)):i(new Error("No file selected"))}),a.click()})})}openFolderPicker(){return S(this,null,function*(){return new Promise((t,e)=>{const i=document.createElement("input");i.type="file",i.webkitdirectory=!0,i.multiple=!0,i.value="",i.addEventListener("change",()=>{if(i.files&&i.files.length>0){const a=i.files[0];t(Array.from(i.files))}else e(new Error("No folder selected"))}),i.click()})})}}function ze(n){var t=Ue(Te(Le(Re(n),8*n.length)));return t.toLowerCase()}function Ue(n){for(var t,e="0123456789ABCDEF",i="",a=0;a<n.length;a++)t=n.charCodeAt(a),i+=e.charAt(t>>>4&15)+e.charAt(15&t);return i}function Re(n){for(var t=Array(n.length>>2),e=0;e<t.length;e++)t[e]=0;for(e=0;e<8*n.length;e+=8)t[e>>5]|=(255&n.charCodeAt(e/8))<<e%32;return t}function Te(n){for(var t="",e=0;e<32*n.length;e+=8)t+=String.fromCharCode(n[e>>5]>>>e%32&255);return t}function Le(n,t){n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;for(var e=1732584193,i=-271733879,a=-1732584194,l=271733878,s=0;s<n.length;s+=16){var r=e,u=i,c=a,g=l;i=_(i=_(i=_(i=_(i=y(i=y(i=y(i=y(i=v(i=v(i=v(i=v(i=b(i=b(i=b(i=b(i,a=b(a,l=b(l,e=b(e,i,a,l,n[s+0],7,-680876936),i,a,n[s+1],12,-389564586),e,i,n[s+2],17,606105819),l,e,n[s+3],22,-1044525330),a=b(a,l=b(l,e=b(e,i,a,l,n[s+4],7,-176418897),i,a,n[s+5],12,1200080426),e,i,n[s+6],17,-1473231341),l,e,n[s+7],22,-45705983),a=b(a,l=b(l,e=b(e,i,a,l,n[s+8],7,1770035416),i,a,n[s+9],12,-1958414417),e,i,n[s+10],17,-42063),l,e,n[s+11],22,-1990404162),a=b(a,l=b(l,e=b(e,i,a,l,n[s+12],7,1804603682),i,a,n[s+13],12,-40341101),e,i,n[s+14],17,-1502002290),l,e,n[s+15],22,1236535329),a=v(a,l=v(l,e=v(e,i,a,l,n[s+1],5,-165796510),i,a,n[s+6],9,-1069501632),e,i,n[s+11],14,643717713),l,e,n[s+0],20,-373897302),a=v(a,l=v(l,e=v(e,i,a,l,n[s+5],5,-701558691),i,a,n[s+10],9,38016083),e,i,n[s+15],14,-660478335),l,e,n[s+4],20,-405537848),a=v(a,l=v(l,e=v(e,i,a,l,n[s+9],5,568446438),i,a,n[s+14],9,-1019803690),e,i,n[s+3],14,-187363961),l,e,n[s+8],20,1163531501),a=v(a,l=v(l,e=v(e,i,a,l,n[s+13],5,-1444681467),i,a,n[s+2],9,-51403784),e,i,n[s+7],14,1735328473),l,e,n[s+12],20,-1926607734),a=y(a,l=y(l,e=y(e,i,a,l,n[s+5],4,-378558),i,a,n[s+8],11,-2022574463),e,i,n[s+11],16,1839030562),l,e,n[s+14],23,-35309556),a=y(a,l=y(l,e=y(e,i,a,l,n[s+1],4,-1530992060),i,a,n[s+4],11,1272893353),e,i,n[s+7],16,-155497632),l,e,n[s+10],23,-1094730640),a=y(a,l=y(l,e=y(e,i,a,l,n[s+13],4,681279174),i,a,n[s+0],11,-358537222),e,i,n[s+3],16,-722521979),l,e,n[s+6],23,76029189),a=y(a,l=y(l,e=y(e,i,a,l,n[s+9],4,-640364487),i,a,n[s+12],11,-421815835),e,i,n[s+15],16,530742520),l,e,n[s+2],23,-995338651),a=_(a,l=_(l,e=_(e,i,a,l,n[s+0],6,-198630844),i,a,n[s+7],10,1126891415),e,i,n[s+14],15,-1416354905),l,e,n[s+5],21,-57434055),a=_(a,l=_(l,e=_(e,i,a,l,n[s+12],6,1700485571),i,a,n[s+3],10,-1894986606),e,i,n[s+10],15,-1051523),l,e,n[s+1],21,-2054922799),a=_(a,l=_(l,e=_(e,i,a,l,n[s+8],6,1873313359),i,a,n[s+15],10,-30611744),e,i,n[s+6],15,-1560198380),l,e,n[s+13],21,1309151649),a=_(a,l=_(l,e=_(e,i,a,l,n[s+4],6,-145523070),i,a,n[s+11],10,-1120210379),e,i,n[s+2],15,718787259),l,e,n[s+9],21,-343485551),e=I(e,r),i=I(i,u),a=I(a,c),l=I(l,g)}return Array(e,i,a,l)}function K(n,t,e,i,a,l){return I(Oe(I(I(t,n),I(i,l)),a),e)}function b(n,t,e,i,a,l,s){return K(t&e|~t&i,n,t,a,l,s)}function v(n,t,e,i,a,l,s){return K(t&i|e&~i,n,t,a,l,s)}function y(n,t,e,i,a,l,s){return K(t^e^i,n,t,a,l,s)}function _(n,t,e,i,a,l,s){return K(e^(t|~i),n,t,a,l,s)}function I(n,t){var e=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(e>>16)<<16|65535&e}function Oe(n,t){return n<<t|n>>>32-t}var E=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});const me="",ne="";class je{siyuanRequest(t,e){return E(this,null,function*(){const i=`${me}${t}`,a={body:JSON.stringify(e),method:"POST"};ne!==""&&Object.assign(a,{headers:{Authorization:`Token ${ne}`}}),d("\u5F00\u59CB\u5411\u601D\u6E90\u8BF7\u6C42\u6570\u636E\uFF0CreqUrl=>",i),d("\u5F00\u59CB\u5411\u601D\u6E90\u8BF7\u6C42\u6570\u636E\uFF0CfetchOps=>",a);const s=yield(yield fetch(i,a)).json();if(d("\u601D\u6E90\u8BF7\u6C42\u6570\u636E\u8FD4\u56DE\uFF0CresJson=>",s),s.code===-1)throw new Error(s.msg);return s})}}class ie extends je{lsNotebooks(){return E(this,null,function*(){return yield this.siyuanRequest("/api/notebook/lsNotebooks",{})})}openNotebook(t){return E(this,null,function*(){return yield this.siyuanRequest("/api/notebook/openNotebook",{notebook:t})})}readDir(t){return E(this,null,function*(){return yield this.siyuanRequest("/api/file/readDir",{path:t})})}putFile(t,e){const i=new FormData;return i.append("path",t),i.append("isDir","false"),i.append("modTime",Math.floor(Date.now()/1e3).toString()),i.append("file",e),new Promise((a,l)=>{(0,h.fetchPost)("/api/file/putFile",i,s=>{s.code===0?a(s):l(s)})})}saveTextData(t,e){return E(this,null,function*(){return new Promise(i=>{const a=`/temp/convert/pandoc/${t}`,l=new File([new Blob([e])],a.split("/").pop()),s=new FormData;s.append("path",a),s.append("file",l),s.append("isDir","false"),(0,h.fetchPost)("/api/file/putFile",s,r=>{i(r)})})})}getFile(t,e){return E(this,null,function*(){const i=yield fetch(`${me}/api/file/getFile`,{method:"POST",headers:{Authorization:`Token ${ne}`},body:JSON.stringify({path:t})});if(i.status===200){if(e==="text")return yield i.text();if(e==="json")return(yield i.json()).data}return null})}removeFile(t){return E(this,null,function*(){const e={path:t};return yield this.siyuanRequest("/api/file/removeFile",e)})}createDocWithMd(t,e,i){return E(this,null,function*(){const a={notebook:t,path:e,markdown:i};return yield this.siyuanRequest("/api/filetree/createDocWithMd",a)})}getInstalledTheme(){return E(this,null,function*(){return yield this.siyuanRequest("api/bazaar/getInstalledTheme",{})})}}function st(){showMessage(`${window.bgCoverPlugin.i18n.mobileNotSupported}`,1e3,"info")}function be(n=""){const t=new h.Dialog({title:`${window.bgCoverPlugin.i18n.inDevTitle}`,content:`<div class="b3-dialog__content">${window.bgCoverPlugin.i18n.inDev}<span>${n}</span></div>`,width:window.bgCoverPlugin.isMobileLayout?"92vw":"520px"})}function Ze(){const n=new h.Dialog({title:`${window.bgCoverPlugin.i18n.bugReportLabel}`,content:`
        <div class="b3-dialog__content">${window.bgCoverPlugin.i18n.bugReportConfirmText}</div>
        <div class="b3-dialog__action">
            <button class="b3-button b3-button--cancel">${window.bgCoverPlugin.i18n.cancel}</button><div class="fn__space"></div>
            <button class="b3-button b3-button--text">${window.bgCoverPlugin.i18n.confirmBugReport}</button>
        </div>
        <div class="b3-dialog__action">
        `,width:window.bgCoverPlugin.isMobileLayout?"92vw":"520px"}),t=n.element.querySelectorAll(".b3-button");t[0].addEventListener("click",()=>{n.destroy()}),t[1].addEventListener("click",()=>{window.open("https://github.com/HowcanoeWang/siyuan-plugin-background-cover/issues","_blank"),n.destroy()})}function Ve(){const n=new h.Dialog({title:`${window.bgCoverPlugin.i18n.themeOnChangeTitle}`,content:`
        <div class="b3-dialog__content">${window.bgCoverPlugin.i18n.themeOnChangeMsg}</div>
        <div class="b3-dialog__action">
            <button class="b3-button b3-button--cancel">${window.bgCoverPlugin.i18n.cancel}</button><div class="fn__space"></div>
            <button class="b3-button b3-button--text">${window.bgCoverPlugin.i18n.themeRefresh}</button>
        </div>
        <div class="b3-dialog__action">
        `,width:window.bgCoverPlugin.isMobileLayout?"92vw":"520px"}),t=n.element.querySelectorAll(".b3-button");t[0].addEventListener("click",()=>{n.destroy()}),t[1].addEventListener("click",()=>{n.destroy(),window.location.reload()})}function He(){let n=document.getElementsByClassName("b3-dialog__container")[0];n!==void 0&&n.parentElement.parentElement.remove()}var qe=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});let ot=new H;function Ke(){var n=document.createElement("canvas");n.id="bglayer",n.className="bglayer";var t=document.documentElement;t.insertBefore(n,document.head),d("[bgRender][createBgLayer] bgLayer created")}function Y(){d("[bgRender][applySettings] \u6CA1\u6709\u7F13\u5B58\u4EFB\u4F55\u56FE\u7247\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u7684\u4E86\u4E86\u59B9\u56FE\u7247ULR\u6765\u5F53\u4F5C\u80CC\u666F\u56FE"),N(Q,w.image),o.set("bgObj",void 0)}function N(n,t){var e=document.getElementById("bglayer");t===w.image?(d(`[bgRender][changeBackgroundContent] \u66FF\u6362\u5F53\u524D\u80CC\u666F\u56FE\u7247\u4E3A${n}`),e.style.setProperty("background-image",`url('${n}')`)):t==w.video||t==w.live2d?be():z(`[SwitchBgCover Plugin][Error] Background type [${t}] is not supported, `,7e3,"error")}function ve(){var n=o.get("blockTheme");const t=["light","dark"],[e,i]=U();var a=n[t[e]][i];return d(`[bgRender][isBlockTheme] search mode='${t[e]}', name='${i}' result is ${a}`),a}function ye(n){let t=.99-.25*n;o.get("activate")&&!ve()&&n!==0?document.body.style.setProperty("opacity",t.toString()):document.body.style.removeProperty("opacity")}function _e(n){var t=document.getElementById("bglayer");t.style.setProperty("filter",`blur(${n}px)`)}function ae(n,t){var e=document.getElementById("bglayer");n==null||n==null?(d("[bgRender][changeBgPosition] xy\u672A\u5B9A\u4E49\uFF0C\u4E0D\u8FDB\u884C\u6539\u53D8"),e.style.setProperty("background-position","center")):(d(`[bgRender][changeBgPosition] \u4FEE\u6539background-position\u4E3A${n}% ${t}%`),e.style.setProperty("background-position",`${n}% ${t}%`))}function R(){return qe(this,null,function*(){var n=document.getElementById("bglayer");d(n),o.get("activate")&&!ve()?n.style.removeProperty("display"):n.style.setProperty("display","none");const t=$();if(d(`[bgRender][applySettings] cacheImgNum= ${t}`),t===0)Y();else if(o.get("bgObj")===void 0)d("[bgRender][applySettings] \u7F13\u5B58\u4E2D\u67091\u5F20\u4EE5\u4E0A\u7684\u56FE\u7247\uFF0C\u4F46\u662F\u8BBE\u7F6E\u7684bjObj\u5374\u662Fundefined\uFF0C\u968F\u673A\u62BD\u4E00\u5F20"),yield T();else{d("[bgRender][applySettings] \u7F13\u5B58\u4E2D\u67091\u5F20\u4EE5\u4E0A\u7684\u56FE\u7247\uFF0CbjObj\u4E5F\u6709\u5185\u5BB9\u4E14\u56FE\u7247\u5B58\u5728");let e=o.get("bgObj"),i=o.get("fileidx");e.hash in i&&!o.get("autoRefresh")?(d("[bgRender][applySettings] \u6CA1\u6709\u5F00\u542F\u542F\u52A8\u81EA\u52A8\u66F4\u6362\u56FE\u7247\uFF0C\u5219\u76F4\u63A5\u663E\u793A\u5F53\u524D\u56FE\u7247"),N(e.path,e.mode)):(d("[bgRender][applySettings] \u7528\u6237\u9009\u62E9\u968F\u673A\u56FE\u7247\uFF0C\u5219\u968F\u673A\u8C03\u4E00\u5F20\u4F5C\u4E3AbjObj"),yield T())}ye(o.get("opacity")),_e(o.get("blur")),o.get("bgObj")===void 0?ae(null,null):ae(o.get("bgObj").offx,o.get("bgObj").offy),W()})}var P=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});let F=new q,le=new H,J=new ie;function $(){let n,t=o.get("fileidx");return t===null||t==null?n=0:n=Object.keys(o.get("fileidx")).length,n}function Ye(){return P(this,null,function*(){if(window.siyuan.config.system.kernelVersion>="2.9.3"){let s=`/data/plugins/${B.u2}/assets`,r=yield F.listdir(s);r!==null&&r.length>0&&((0,h.showMessage)(window.bgCoverPlugin.i18n.cacheDirectoryMove,7e3,"info"),yield F.rmtree(s))}o.get("version")<"0.3.2"&&((0,h.showMessage)(window.bgCoverPlugin.i18n.updateHashNotice,7e3,"info"),yield we(w.image),o.set("version",B.i8));let n=yield F.listdir(C),t={},e=o.get("fileidx"),i=[],a=[],l=[];e==null&&d("The settings.fileidx is empty {}");for(let s in n){let r=n[s];if(!r.isDir)if(d(`[fileManagerUI][checkCacheDirectory] Check ${r.name} in cached dir`),r.name.slice(0,5)==="hash-"){const[u,c]=F.splitext(r.name.split("-")[1]);if(d("[fileManagerUI][checkCacheDirectory] hash_name: ",u,e,a),u in e){let g=e[u];if(g.offx===void 0||g.width===void 0||g.width===0){const f=yield le.getImageSize(g.path);let m={name:g.name,path:g.path,hash:g.hash,mode:g.mode,offx:50,offy:50,height:f.height,width:f.width};t[u]=m,d("settings.fileidx\u4E3A\u65E7\u7248\u914D\u7F6E\uFF0C\u5DF2\u66F4\u65B0",m)}else t[u]=g}else{a.push(r.name);const g=`${C.slice(5)}/${r.name}`,f=yield le.getImageSize(g);d(`[fileManagerUI][checkCacheDirectory] the cached local file ${r.name} has md5: ${u}`);let m={name:r.name,path:g,hash:u,mode:w.image,offx:50,offy:50,height:f.height,width:f.width};t[u]=m}}else i.push(r.name),J.removeFile(`${C}/${r.name}`)}for(let s in e)s in t||l.push(e[s].name);if(o.set("fileidx",t),yield o.save("[fileManagerUI][checkCacheDirectory]"),i.length!==0){let s=`${window.bgCoverPlugin.i18n.cacheImgWrongName}<br>[${i}]<br>${window.bgCoverPlugin.i18n.doNotOperateCacheFolder}`;(0,h.showMessage)(s,7e3,"info"),M(s)}if(a.length!==0){let s=`${window.bgCoverPlugin.i18n.cacheImgExtra}<br>[${a}]<br>${window.bgCoverPlugin.i18n.doNotOperateCacheFolder}`;(0,h.showMessage)(s,7e3,"info"),M(s)}if(l.length!==0){let s=`${window.bgCoverPlugin.i18n.cacheImgMissing}<br>[${l}]<br>${window.bgCoverPlugin.i18n.doNotOperateCacheFolder}`;(0,h.showMessage)(s,7e3,"info"),M(s)}})}function we(n){return P(this,null,function*(){if(n==w.image){let e=yield F.listdir(C),i=o.get("fileidx");for(let s in e){let r=e[s];if(r.isDir)F.rmtree(`${C}/${r.name}/`);else{let u=`${C}/${r.name}`;yield J.removeFile(u);const[c,g]=F.splitext(r.name.split("-")[1]);delete i[c]}}o.set("fileidx",i);let a=document.getElementById("cacheImgList");a&&(a.innerHTML=null);let l=document.getElementById("displayCanvas");l&&(l.innerHTML=null)}else n==w.live2d;$()===0&&Y(),yield o.save("[fileManagerUI][clearCacheFolder]")})}function Ce(n,t=!0){return P(this,null,function*(){let e=o.get("fileidx");var a=File.prototype.slice.call(n,0,Math.min(n.size,xe));let l=yield a.text();var s=ze(`${l}${n.size}`).slice(0,15);if(d(`[fileManagerUI][imgExistsInCache] Blob content: [${l.slice(20,40)} ...] with length = ${l.length}file.size=${n.size}`),e!==void 0&&s in e){if(t){const r=new h.Dialog({title:`${window.bgCoverPlugin.i18n.inDevTitle}`,content:`<div class="b3-dialog__content">${window.bgCoverPlugin.i18n.imageFileExist}</div>`,width:window.bgCoverPlugin.isMobileLayout?"92vw":"520px"})}else d(`[fileManagerUI][imgIsInCache] \u5F53\u524D\u56FE\u7247${n.name}\u5DF2\u5B58\u5728`);return"exists"}else return s})}function Ee(n){return P(this,null,function*(){let t=n.size/1024/1024,e=yield Ce(n);e!=="exists"&&(0,h.showMessage)(`${n.name}-${t.toFixed(2)}MB<br>${window.bgCoverPlugin.i18n.addSingleImageUploadNotice}`,3e3,"info");let i=o.get("fileidx");if(i==null&&(i={}),e!=="exists"){const[a,l]=F.splitext(n.name),s=`hash-${e}.${l}`,r=yield J.putFile(`${C}/${s}`,n);if(r.code===0){const u=`${C.slice(5)}/${s}`,c=yield le.getImageSize(u);let g={name:n.name,hash:e,mode:w.image,path:u,offx:50,offy:50,width:c.width,height:c.height};return i[g.hash]=g,o.set("bgObj",g),o.set("fileidx",i),d(`[fileManagerUI][addSingleLocalImageFile]: fileidx ${i}`),g}else return z(`fail to upload file ${n.name} with error code ${r}`),null}})}function ke(n,t=!1){return P(this,null,function*(){let e;if(d("[fileManagerUI][batchUploadImages] fileArray",n),n.length===0)d("[fileManagerUI][batchUploadImages] fileArray\u4E3A\u7A7A\uFF0C\u4E0D\u5B58\u5728\u9700\u8981\u4E0A\u4F20\u7684\u56FE\u7247");else{for(let i of n)e=yield Ee(i),d("[fileManagerUI][batchUploadImages] \u5728\u4E0A\u4F20\u7684\u5FAA\u73AF\u5185",e);yield o.save("[fileManagerUI][batchUploadImages]"),t&&(d("[fileManagerUI][batchUploadImages] \u5728\u5E94\u7528\u8BBE\u7F6E\u7684\u5224\u65AD\u5185",e),N(e.path,e.mode),W())}})}function Je(){return P(this,null,function*(){const n=new h.Dialog({title:window.bgCoverPlugin.i18n.selectPictureManagerTitle,width:window.bgCoverPlugin.isMobileLayout?"92vw":"520px",height:"92vh",content:`
        <div class="fn__flex-column" style="height: 100%">
            <div class="layout-tab-bar fn__flex">

                <!-- tab 1 title -->
                <div class="item item--full item--focus" data-type="remove">
                    <span class="fn__flex-1"></span>
                    <span class="item__text">${window.bgCoverPlugin.i18n.selectPictureManagerTab1}</span>
                    <span class="fn__flex-1"></span>
                </div>

                <!-- tab 2 title -->
                <!--div class="item item--full" data-type="missing">
                    <span class="fn__flex-1"></span>
                    <span class="item__text">${window.bgCoverPlugin.i18n.selectPictureManagerTab2}</span>
                    <span class="fn__flex-1"></span>
                </div-->
            </div>
            <div class="fn__flex-1">

                <!-- tab 1 -->

                <div class="config-assets" data-type="remove" data-init="true">
                    <div class="fn__hr--b"></div>

                    <label class="fn__flex" style="justify-content: flex-end;">
                        <button id="removeAllImgs" class="b3-button b3-button--outline fn__flex-center fn__size200">
                            <svg class="svg"><use xlink:href="#iconTrashcan"></use></svg>
                            ${window.bgCoverPlugin.i18n.deleteAll}
                        </button>
                        <div class="fn__space"></div>
                    </label>

                    <div class="fn__hr"></div>

                    <ul id="cacheImgList" class="b3-list b3-list--background config-assets__list">

                        <li data-path="20230609230328-7vp057x.png" class="b3-list-item b3-list-item--hide-action">
                            <span class="b3-list-item__text">
                                20230609230328-7vp057x.png
                            </span>
                            <span data-type="open" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.bgCoverPlugin.i18n.setAsBg}">
                                <svg><use xlink:href="#iconHideDock"></use></svg>
                            </span>
                            <span data-type="clear" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.bgCoverPlugin.i18n.delete}">
                                <svg><use xlink:href="#iconTrashcan"></use></svg>
                            </span>
                        </li>
                        
                    </ul>

                    <!-- after rendering -->
                    <!--div class="config-assets__preview" data-path="assets/xxxx.png">
                        <img style="max-height: 100%" src="assets/xxxx.png">
                    </div-->

                    <!-- default empty -->
                    <div id="displayCanvas" class="config-assets__preview"></div>
                </div>

                <!-- tab 2, class add fn__none to cancle display -->

                <!--div class="fn__none config-assets" data-type="missing">
                    <div class="fn__hr"></div>
                    <ul class="b3-list b3-list--background config-assets__list">
                        <li class="fn__loading"><img src="/stage/loading-pure.svg"></li>
                    </ul>
                    <div class="fn__hr"></div>
                </div>
            </div>
        </div>
        `});let t=We();const e=document.getElementById("cacheImgList");e.innerHTML="";for(const a of t)e.appendChild(a);d("[fileManagerUI][selectPictureByHand]",t,e),document.getElementById("removeAllImgs").addEventListener("click",()=>P(this,null,function*(){yield we(w.image)}))})}function We(){let n=[],t=o.get("fileidx");for(const e in t){let i=t[e],l=new DOMParser().parseFromString(`
        <li data-hash="${i.hash}" class="b3-list-item b3-list-item--hide-action">
            <span class="b3-list-item__text">
                ${i.name}
            </span>
            <span data-type="open" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.bgCoverPlugin.i18n.setAsBg}">
                <svg><use xlink:href="#iconHideDock"></use></svg>
            </span>
            <span data-type="clear" class="b3-tooltips b3-tooltips__w b3-list-item__action" aria-label="${window.bgCoverPlugin.i18n.delete}">
                <svg><use xlink:href="#iconTrashcan"></use></svg>
            </span>
        </li>
        `,"text/html").body.firstChild,s=l.querySelectorAll("span")[1],r=l.querySelectorAll("span")[2];s.addEventListener("click",()=>{N(i.path,i.mode),o.set("bgObj",i),o.save("[fileManagerUI][generateCacheImgList][setBgBtn.click]")}),r.addEventListener("click",()=>{d("Remove the background"),document.getElementById("cacheImgList").querySelectorAll(`[data-hash="${i.hash}"]`)[0].remove();let g=document.getElementById("displayCanvas");g.innerHTML=null,T();let f=o.get("fileidx");delete f[i.hash],o.set("fileidx",f),d(`[fileManagerUI][_rmBg] \u79FB\u9664\u4E0B\u5217\u8DEF\u5F84\u7684\u56FE\u7247\uFF1A${C}/${i.name}`),J.removeFile(`data/${i.path}`),$()===0&&Y(),o.save("[fileManagerUI][generateCacheImgList][delBtn.click]")}),l.addEventListener("mouseenter",()=>{let u=document.getElementById("displayCanvas");u.innerHTML=`<img style="max-height: 100%" src="${i.path}">`}),n.push(l)}return n}var se=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});let Ge=new q,De=new H;function Ie(n){const t=$(),e=new h.Dialog({title:`${window.bgCoverPlugin.i18n.addTopBarIcon}(v${B.i8}) ${window.bgCoverPlugin.i18n.settingLabel}`,width:window.bgCoverPlugin.isMobileLayout?"92vw":"max(520px, 50vw)",height:"max(520px, 90vh)",content:`
        <div class="config__tab-container">
        <!--
        // info panel part
        -->
        <label class="fn__flex b3-label">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.imgPathLabel}
                <div class="b3-label__text">
                    <code id="crtImgName" class="fn__code">${o.get("bgObj")===void 0?Q:o.get("bgObj").name}</code>
                </div>
            </div>
            <div class="fn__flex-center">  
                <div>
                    <label for="cx">X</label> 
                    <input id="cx" class="b3-slider fn__size50"  max="100" min="0" step="5" type="range" value=${o.get("bgObj")===void 0?"50":o.get("bgObj").offx}>
                </div>
                <div>
                    <label for="cy">Y</label> 
                    <input id="cy" class="b3-slider fn__size50"  max="100" min="0" step="5" type="range" value=${o.get("bgObj")===void 0?"50":o.get("bgObj").offy}>
                </div>
            </div>
        </label>
        <label class="fn__flex b3-label">
            <div class="fn__flex-1">
                <div class="fn__flex">
                    ${window.bgCoverPlugin.i18n.cacheDirectoryLabel}
                    <span class="fn__space"></span>
                    <span style="color: var(--b3-theme-on-surface)">${window.bgCoverPlugin.i18n.cacheDirectoryDes}</span>
                    <span id="cacheImgNumElement" class="selected" style="color: rgb(255,0,0)">
                        [ ${t} ]
                    </span>
                </div>
                <div class="b3-label__text">
                    <a href="file:///${O}/" style="word-break: break-all">${O}</a>
                </div>
            </div>
            <span class="fn__space"></span>
            <button id="cacheManagerBtn" class="b3-button b3-button--outline fn__flex-center fn__size100" id="appearanceRefresh">
                <svg><use xlink:href="#iconDatabase"></use></svg>
                ${window.bgCoverPlugin.i18n.cacheManager}
            </button>
        </label>

        <!--
        // onoff switch part
        -->

        <label class="fn__flex b3-label">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.openBackgroundLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.openBackgroundLabelDes}
                </div>
            </div>
            <span class="fn__flex-center" />
            <input
                id="onoffInput"
                class="b3-switch fn__flex-center"
                type="checkbox"
                value="${o.get("activate")}"
            />
        </label>

        
        <!--
        // theme black list
        -->

        <div class="b3-label">
            ${window.bgCoverPlugin.i18n.blockThemeTitle}
            <!-- light theme block -->
            <div class="b3-list b3-list--border b3-list--background">
                <div class="b3-list-item b3-list-item--narrow toggle">
                    <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                        <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
                    </span>
                    <span class="b3-list-item__text ft__on-surface">${window.bgCoverPlugin.i18n.themeAdaptEditorMode0}</span>
                </div>
                <div class="b3-list__panel">
                    <div class="config-query" id="lightThemeBlockContainer">

                        <!-- label item add by for loop -->

                    </div>
                </div>
            </div>

            <div class="fn__hr"></div>

            <!-- dark theme block -->
            <div class="b3-list b3-list--border b3-list--background">
                <div class="b3-list-item b3-list-item--narrow toggle">
                    <span class="b3-list-item__toggle b3-list-item__toggle--hl">
                        <svg class="b3-list-item__arrow b3-list-item__arrow--open"><use xlink:href="#iconRight"></use></svg>
                    </span>
                    <span class="b3-list-item__text ft__on-surface">${window.bgCoverPlugin.i18n.themeAdaptEditorMode1}</span>
                </div>
                <div class="b3-list__panel">
                    <div class="config-query" id="darkThemeBlockContainer">
                        
                        <!-- label item add by for loop -->

                    </div>
                </div>
            </div>
            
        </div>

        
        <!--
        // \u81EA\u52A8\u66F4\u65B0\u6309\u94AE
        -->

        <label class="fn__flex b3-label">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.autoRefreshLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.autoRefreshDes}
                </div>
            </div>
            <span class="fn__flex-center" />
            <input
                id="autoRefreshInput"
                class="b3-switch fn__flex-center"
                type="checkbox"
                value="${o.get("autoRefresh")}"
            />
        </label>

        <!--
        // slider part Input[4] - Input [5]
        -->

        <label class="fn__flex b3-label config__item">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.opacityLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.opacityDes}
                </div>
            </div>
            <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${o.get("opacity")}">   
                <input id="opacityInput" class="b3-slider fn__size200" max="1" min="0" step="0.05" type="range" value="${o.get("opacity")}">
            </div>
        </label>
        <label class="fn__flex b3-label config__item">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.blurLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.blurDes}
                </div>
            </div>
            <div class="b3-tooltips b3-tooltips__n fn__flex-center" aria-label="${o.get("blur")}">   
                <input id="blurInput" class="b3-slider fn__size200" max="10" min="0" step="1" type="range" value="${o.get("blur")}">
            </div>
        </label>

        <!--
        // reset panel part, Button[0]
        -->

        <label class="b3-label config__item fn__flex">
            <div class="fn__flex-1">
            ${window.bgCoverPlugin.i18n.resetConfigLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.resetConfigDes}<span class="selected" style="color:rgb(255,0,0)">${window.bgCoverPlugin.i18n.resetConfigDes2}
                    </span>
                </div>
            </div>
            <span class="fn__space"></span>
            <button id="resetBtn" class="b3-button b3-button--outline fn__flex-center fn__size100" id="appearanceRefresh">
                <svg><use xlink:href="#iconRefresh"></use></svg>
                ${window.bgCoverPlugin.i18n.reset}
            </button>
        </label>

        <!--
        // debug panel part
        -->

        <label class="fn__flex b3-label config__item">
            <div class="fn__flex-1">
                ${window.bgCoverPlugin.i18n.inDevModeLabel}
                <div class="b3-label__text">
                    ${window.bgCoverPlugin.i18n.inDevModeDes} \u2022 
                    FrontEnd: <code class="fn__code">${(0,h.getFrontend)()}</code> \u2022 BackEnd: <code class="fn__code">${(0,h.getBackend)()}</code> \u2022 
                    isMobileLayout: <code class="fn__code">${window.bgCoverPlugin.isMobileLayout}</code> \u2022 
                    isBrowser: <code class="fn__code">${window.bgCoverPlugin.isBrowser}</code> \u2022 
                    isAndroid: <code class="fn__code">${window.bgCoverPlugin.isAndroid}</code>
                </div>
            </div>
            <span class="fn__flex-center" />
            <input
                id="devModeInput"
                class="b3-switch fn__flex-center"
                type="checkbox"
                value="${o.get("inDev")}"
            />
        </label>

        </div>`}),i=document.getElementById("cx"),a=document.getElementById("cy");ue(),window.addEventListener("resize",ue);let l=[i,a];for(let k=0;k<2;k++)l[k].addEventListener("input",()=>{d(l,i.value,a.value),ae(i.value,a.value)}),l[k].addEventListener("change",()=>{let p=o.get("bgObj");if(p!==void 0){p.offx=i.value,p.offy=a.value,o.set("bgObj",p);let D=o.get("fileidx");D[p.hash]=p,o.set("fileidx",D),o.save("[settingsUI][openSettingDialog][cxyElement.change]")}});document.getElementById("cacheManagerBtn").addEventListener("click",()=>se(this,null,function*(){e.destroy(),ce()}));const r=document.getElementById("onoffInput");r.checked=o.get("activate"),r.addEventListener("click",()=>{o.set("activate",!o.get("activate")),r.value=o.get("activate"),o.save("[settingsUI][openSettingDialog][activateElement.change]"),R()}),Xe();const u=document.getElementById("autoRefreshInput");u.checked=o.get("autoRefresh"),u.addEventListener("click",()=>{o.set("autoRefresh",!o.get("autoRefresh")),u.value=`${o.get("autoRefresh")}`,o.save("[settingsUI][openSettingDialog][autoRefreshElement.change]")});const c=document.getElementById("opacityInput");c.addEventListener("change",()=>{o.set("opacity",parseFloat(c.value)),o.get("activate")&&ye(o.get("opacity")),o.save("[settingsUI][openSettingDialog][opacityElement.change]")}),c.addEventListener("input",()=>{c.parentElement.setAttribute("aria-label",c.value)});const g=document.getElementById("blurInput");g.addEventListener("change",()=>{o.set("blur",parseFloat(g.value)),o.get("activate")&&_e(o.get("blur")),o.save("[settingsUI][openSettingDialog][blurElement.change]")}),g.addEventListener("input",()=>{g.parentElement.setAttribute("aria-label",g.value)}),document.getElementById("resetBtn").addEventListener("click",()=>se(this,null,function*(){Ge.rmtree(C),o.reset(),yield o.save("[settingsUI][openSettingDialog][resetSettingElement.click]"),yield R()}));const m=document.getElementById("devModeInput");m.checked=o.get("inDev"),m.addEventListener("click",()=>{o.set("inDev",!o.get("inDev")),m.value=`${o.get("inDev")}`,o.save("[settingsUI][openSettingDialog][devModeElement.change]")})}function Xe(){const[n,t]=U(),e=pe(),i=[document.getElementById("lightThemeBlockContainer"),document.getElementById("darkThemeBlockContainer")];var a=o.get("blockTheme");const l=["light","dark"];d("[settingsUI][generateBlockThemeElement] Current block theme config:",a);for(var s=0;s<e.length;s++)for(var r=e[s],u=0;u<r.length;u++){var c=r[u],g,f=a[l[s]];c in f?g=f[c]:(g=!1,f[c]=g);var m=new DOMParser().parseFromString(`
            <label class="fn__flex" style="width:28%;margin: 8px 5% 0 0">
                <div class="fn__flex-1">
                    ${window.bgCoverPlugin.themeName2DisplayName[c]}
                </div>
                <span class="fn__space"></span>
                <input class="b3-switch" data-mode="${l[s]}" data-theme="${c}" type="checkbox">
            </label>`,"text/html").body.firstChild;if(i[s].appendChild(m),n===s&&c===t){let D=m.querySelectorAll("div")[0];D.style.setProperty("color","var(--b3-theme-primary)"),D.textContent+=`(${window.bgCoverPlugin.i18n.crtThemeText})`}let p=m.querySelectorAll("input")[0];p.checked=g,p.addEventListener("click",()=>se(this,null,function*(){var D=o.get("blockTheme");let ge=p.getAttribute("data-mode"),he=p.getAttribute("data-theme");D[ge][he]=!D[ge][he],d(`[settingsUI] User changed blockTheme ${he} in ${ge} mode`),o.set("blockTheme",D),o.save("[settingsUI][generateBlockThemeElement][onOffBtn.click]"),yield R()}))}o.set("blockTheme",a),o.save("[settingsUI][generateBlockThemeElement]")}function Fe(n,t,e=!0){let i=document.getElementById(n);i==null||(i.value=t,e&&i.parentElement.setAttribute("aria-label",t))}function oe(n,t){let e=document.getElementById(n);e==null||(e.checked=t)}function W(){let n=document.getElementById("crtImgName");if(n!=null){let e=o.get("bgObj");o.get("bgObj")===void 0?n.textContent=Q.toString():n.textContent=e.name}ue();let t=document.getElementById("cacheImgNumElement");if(t!=null){const e=$();t.textContent=`[ ${e} ]`}oe("onoffInput",o.get("activate")),oe("autoRefreshInput",o.get("autoRefresh")),Fe("opacityInput",o.get("opacity")),Fe("blurInput",o.get("blur")),oe("devModeInput",o.get("inDev"))}function ue(){let n=document.getElementById("cx"),t=document.getElementById("cy");if(n!=null){let e=document.getElementById("bglayer");if(o.get("activate")){const i=parseInt(getComputedStyle(e).height),a=parseInt(getComputedStyle(e).width);let l;o.get("bgObj")===void 0?(l=De.getFullSide(a,i,2458,1383),n.value="50",t.value="50"):l=De.getFullSide(a,i,o.get("bgObj").width,o.get("bgObj").height),l==="X"?(n.disabled=!0,t.disabled=!1,n.style.setProperty("opacity","0.1"),t.style.removeProperty("opacity")):(t.disabled=!0,n.disabled=!1,t.style.setProperty("opacity","0.1"),n.style.removeProperty("opacity"))}else t.disabled=!0,n.disabled=!0,t.style.setProperty("opacity","0.1"),n.style.setProperty("opacity","0.1")}}var x=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())}),Qe=(n,t,e)=>(t=n[Symbol.asyncIterator],e=(i,a)=>(a=n[i])&&(t[i]=l=>new Promise((s,r,u)=>(l=a.call(n,l),u=l.done,Promise.resolve(l.value).then(c=>s({value:c,done:u}),r)))),t?t.call(n):(n=n[Symbol.iterator](),t={},e("next"),e("return"),t));let re=new q;function et(n){return x(this,null,function*(){const t=n.addTopBar({icon:"iconLogo",title:window.bgCoverPlugin.i18n.addTopBarIcon,position:"right",callback:()=>{d("[topbarUI][initTopbar] click and open toolbar")}});t.addEventListener("click",()=>x(this,null,function*(){let e=t.getBoundingClientRect();e.width===0&&(e=document.querySelector("#barMore").getBoundingClientRect()),e.width===0&&(e=document.querySelector("#barPlugins").getBoundingClientRect());const i=new h.Menu("topBarSample",()=>{});i.addItem({icon:"iconIndent",label:`${window.bgCoverPlugin.i18n.selectPictureLabel}`,type:"submenu",submenu:[{icon:"iconHand",label:`${window.bgCoverPlugin.i18n.selectPictureManualLabel}`,accelerator:n.commands[0].customHotkey,click:()=>{ce()}},{icon:"iconMark",label:`${window.bgCoverPlugin.i18n.selectPictureRandomLabel}`,accelerator:n.commands[1].customHotkey,click:()=>{T(!0)}}]});let a=[{icon:"iconImage",label:`${window.bgCoverPlugin.i18n.addSingleImageLabel}`,click:()=>{tt()}},{icon:"iconFolder",label:`${window.bgCoverPlugin.i18n.addDirectoryLabel}`,click:()=>{nt()}}];const l=(0,h.getFrontend)(),s=(0,h.getBackend)();window.bgCoverPlugin.isAndroid&&!window.bgCoverPlugin.isBrowser&&a.unshift({icon:"iconSparkles",label:`${window.bgCoverPlugin.i18n.androidLimitNotice}`,type:"readonly"}),i.addItem({icon:"iconAdd",label:`${window.bgCoverPlugin.i18n.addImageLabel}`,type:"submenu",submenu:a}),i.addItem({id:"pluginOnOffMenu",icon:`${o.get("activate")?"iconClose":"iconSelect"}`,label:`${o.get("activate")?window.bgCoverPlugin.i18n.closeBackgroundLabel:window.bgCoverPlugin.i18n.openBackgroundLabel}`,accelerator:n.commands[2].customHotkey,click:()=>{$e()}}),i.addSeparator(),i.addItem({icon:"iconGithub",label:`${window.bgCoverPlugin.i18n.bugReportLabel}`,click:()=>{Ze()}}),i.addItem({icon:"iconSettings",label:`${window.bgCoverPlugin.i18n.settingLabel}`,click:()=>{Ie(n)}}),window.bgCoverPlugin.isMobileLayout?i.fullscreen():i.open({x:e.right,y:e.bottom,isLeft:!0})}))})}function $e(){return x(this,null,function*(){o.set("activate",!o.get("activate")),o.save("[topbarUI][pluginOnOff]"),R()})}function ce(){return x(this,null,function*(){yield Je()})}function T(n=!1){return x(this,null,function*(){const t=$();if(t===0)Y(),(0,h.showMessage)(`${window.bgCoverPlugin.i18n.noCachedImg4random}`,3e3,"info");else if(t===1){if(n&&(0,h.showMessage)(`${window.bgCoverPlugin.i18n.selectPictureRandomNotice}`,3e3,"info"),document.getElementById("bglayer").style.getPropertyValue("background-image")===""){let i=o.get("bgObj");N(i.path,i.mode)}}else{let e=o.get("fileidx"),i=o.get("bgObj").hash,a="";for(;;){let l=Math.floor(Math.random()*t);if(a=Object.keys(e)[l],d(`[topbarUI][selectPictureRandom] \u968F\u673A\u62BD\u4E00\u5F20\uFF0C\u4E4B\u524D\uFF1A${i}\uFF0C\u968F\u673A\u5230\uFF1A${a}`),a!==i){d(`[topbarUI][selectPictureRandom] \u5DF2\u62BD\u5230\u4E0D\u540C\u7684\u80CC\u666F\u56FE${a}\uFF0C\u8FDB\u884C\u66FF\u6362`);break}}d("[topbarUI][selectPictureRandom] \u8DF3\u51FA\u62BD\u5361\u6B7B\u5FAA\u73AF,\u524D\u666F\u56FE\u4E3A\uFF1A",e[a]),N(e[a].path,e[a].mode),o.set("bgObj",e[a])}yield o.save("[topbarUI][selectPictureRandom]"),W()})}function tt(){return x(this,null,function*(){if($()>=Z)(0,h.showMessage)(window.bgCoverPlugin.i18n.addSingleImageExceed1+Z+window.bgCoverPlugin.i18n.addSingleImageExceed2,7e3,"error");else{let e=(yield re.openFilePicker(V.toString()))[0],i=yield Ee(e);i!==void 0&&(yield o.save("[topbarUI][addSinglelocalImageFile]"),N(i.path,i.mode),W())}})}function nt(){return x(this,null,function*(){const n=$(),t=yield re.openFolderPicker();let e=[];try{for(var i=Qe(t),a,l,s;a=!(l=yield i.next()).done;a=!1){const r=l.value,u=r.name,[c,g]=re.splitext(u);if(d(`[topbarUI][addDirectory] \u5F53\u524D\u56FE\u7247${u}\u540E\u7F00\u4E3A${g}, \u5B58\u5728\u4E8E\u5141\u8BB8\u7684\u56FE\u7247\u540E\u7F00(${V})\u4E2D\uFF1A${V.includes(`.${g}`)}`),V.includes(`.${g}`)){let f=yield Ce(r,!1);f!=="exists"?e.push(r):d(`[topbarUI][addDirectory] \u5F53\u524D\u56FE\u7247${u}md5\u4E3A${f}, \u5B58\u5728\u4E8E\u7F13\u5B58\u4E2D`)}if(d("[topbarUI][addDirectory] fileContainer",e),e.length>=Z-n){(0,h.showMessage)(window.bgCoverPlugin.i18n.addDirectoryLabelError1+Z+window.bgCoverPlugin.i18n.addDirectoryLabelError2,7e3,"error");break}}}catch(r){s=[r]}finally{try{a&&(l=i.return)&&(yield l.call(i))}finally{if(s)throw s[0]}}e.length>=30?(0,h.confirm)(window.bgCoverPlugin.i18n.addDirectoryLabelConfirmTitle,`${window.bgCoverPlugin.i18n.addDirectoryLabelConfirm1} ${e.length} ${window.bgCoverPlugin.i18n.addDirectoryLabelConfirm2}`,()=>x(this,null,function*(){yield ke(e,!0)})):yield ke(e,!0)})}var de=(n,t,e)=>new Promise((i,a)=>{var l=u=>{try{r(e.next(u))}catch(c){a(c)}},s=u=>{try{r(e.throw(u))}catch(c){a(c)}},r=u=>u.done?i(u.value):Promise.resolve(u.value).then(l,s);r((e=e.apply(n,t)).next())});let ut=new q,rt=new ie,ct=new H,dt=new Me;class it extends h.Plugin{constructor(){super(...arguments),this.htmlThemeNode=document.getElementsByTagName("html")[0]}onload(){return de(this,null,function*(){const t=(0,h.getFrontend)(),e=(0,h.getBackend)();this.isMobileLayout=t==="mobile"||t==="browser-mobile",this.isBrowser=t.includes("browser"),this.isAndroidBackend=e==="android",window.bgCoverPlugin={i18n:this.i18n,isMobileLayout:this.isMobileLayout,isBrowser:this.isBrowser,isAndroid:this.isAndroidBackend},this.addIcons(Ae.iconLogo),o.setPlugin(this),yield o.load(),yield et(this),this.addCommand({langKey:"selectPictureManualLabel",hotkey:"\u21E7\u2318F6",callback:()=>{ce()}}),this.addCommand({langKey:"selectPictureRandomLabel",hotkey:"\u21E7\u2318F7",callback:()=>{T(!0)}}),this.addCommand({langKey:"openBackgroundLabel",hotkey:"\u21E7\u2318F4",callback:()=>{$e()}}),new MutationObserver(yield this.themeOnChange.bind(this)).observe(this.htmlThemeNode,{attributes:!0}),M(this.i18n.helloPlugin)})}onLayoutReady(){return de(this,null,function*(){Ke(),yield Ye();const[t,e]=U();o.set("prevTheme",e),yield R(),d(`frontend: ${(0,h.getFrontend)()}; backend: ${(0,h.getBackend)()}`),He();const i=yield Be();window.bgCoverPlugin.themeName2DisplayName=i})}onunload(){M(`${this.i18n.byePlugin}`),o.save("[index.ts][onunload]");var t=document.getElementById("bglayer");t.remove(),document.body.style.removeProperty("opacity")}themeOnChange(){return de(this,null,function*(){const[t,e]=U();let i=o.get("prevTheme");d(`Theme changed! from ${i} to ${t} | ${e}`),i!==e&&(o.set("prevTheme",e),yield o.save("[index][themeOnChange]"),Ve())})}openSetting(){Ie(this)}}module.exports=G})();
