{"ID":"20230724220134-cig8fqw","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230724220134-cig8fqw","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230724220134-cig8fqw\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230724220141-z0e7iua\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230724220134-094o0z0\u0026quot;,\u0026quot;scrollTop\u0026quot;:1870,\u0026quot;focusId\u0026quot;:\u0026quot;20230724220141-8rty3gu\u0026quot;,\u0026quot;focusStart\u0026quot;:45,\u0026quot;focusEnd\u0026quot;:45\u0026#125;","title":"2.2、OpenTelemetry 本机支持","updated":"20230724220219"},"Children":[{"ID":"20230724220141-z0e7iua","Type":"NodeParagraph","Properties":{"id":"20230724220141-z0e7iua","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Elastic Stack 原生支持 OpenTelemetry 协议 (OTLP)。这意味着 OpenTelemetry 代理从您的应用程序和基础设施收集的跟踪数据和指标可以直接发送到 Elastic Stack。"}]},{"ID":"20230724220141-cd86bzz","Type":"NodeList","ListData":{},"Properties":{"id":"20230724220141-cd86bzz","updated":"20230724220141"},"Children":[{"ID":"20230724220141-tg2ckev","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724220141-tg2ckev","updated":"20230724220141"},"Children":[{"ID":"20230724220141-x31fnd2","Type":"NodeParagraph","Properties":{"id":"20230724220141-x31fnd2","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/current/open-telemetry-direct.html#connect-open-telemetry-collector","TextMarkTextContent":"从OpenTelemetry 收集器"},{"Type":"NodeText","Data":" 向 Elastic Stack 发送数据"}]}]},{"ID":"20230724220141-a5xw9hf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724220141-a5xw9hf","updated":"20230724220141"},"Children":[{"ID":"20230724220141-w18u0u8","Type":"NodeParagraph","Properties":{"id":"20230724220141-w18u0u8","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/current/open-telemetry-direct.html#instrument-apps-otel","TextMarkTextContent":"从OpenTelemetry 代理"},{"Type":"NodeText","Data":" 向 Elastic Stack 发送数据"}]}]}]},{"ID":"20230724220141-yw92kai","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724220141-yw92kai","updated":"20230724220141"},"Children":[{"Type":"NodeText","Data":"从 OpenTelemetry 收集器发送数据"}]},{"ID":"20230724220141-gfcg4uw","Type":"NodeParagraph","Properties":{"id":"20230724220141-gfcg4uw","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 OTLP 导出器将您的 OpenTelemetry 收集器实例连接到 Elastic Observability："}]},{"ID":"20230724220141-oyenvrt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724220141-oyenvrt","updated":"20230724220141"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"receivers: \n  # ...\n  otlp:\n\nprocessors: \n  # ...\n  memory_limiter:\n    check_interval: 1s\n    limit_mib: 2000\n  batch:\n\nexporters:\n  logging:\n    loglevel: warn \n  otlp/elastic: \n    # Elastic APM server https endpoint without the \"https://\" prefix\n    endpoint: \"${ELASTIC_APM_SERVER_ENDPOINT}\"  \n    headers:\n      # Elastic APM Server secret token\n      Authorization: \"Bearer ${ELASTIC_APM_SECRET_TOKEN}\"  \n\nservice:\n  pipelines:\n    traces:\n      receivers: [otlp]\n      exporters: [logging, otlp/elastic]\n    metrics:\n      receivers: [otlp]\n      exporters: [logging, otlp/elastic]\n    logs: \n      receivers: [otlp]\n      exporters: [logging, otlp/elastic]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724220141-2m1qsxv","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724220141-2m1qsxv","updated":"20230724220203"},"Children":[{"ID":"20230724220141-p6ordlp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724220141-p6ordlp","updated":"20230724220200"},"Children":[{"ID":"20230724220141-igolo4l","Type":"NodeParagraph","Properties":{"id":"20230724220141-igolo4l","updated":"20230724220200"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"receivers:  接收器，如"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver","TextMarkTextContent":"OTLP 接收器"},{"Type":"NodeText","Data":"，转发由 APM 代理或"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/hostmetricsreceiver","TextMarkTextContent":"主机指标接收器"},{"Type":"NodeText","Data":"发出的数据。"}]}]},{"ID":"20230724220141-4cjung9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20230724220141-4cjung9","updated":"20230724220141"},"Children":[{"ID":"20230724220141-0f755nc","Type":"NodeParagraph","Properties":{"id":"20230724220141-0f755nc","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"processors: 我们推荐使用"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md","TextMarkTextContent":"批处理处理器"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/memorylimiter/README.md","TextMarkTextContent":"内存限制处理器"},{"Type":"NodeText","Data":"。有关详细信息，请参阅"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/README.md#recommended-processors","TextMarkTextContent":"推荐的处理器"},{"Type":"NodeText","Data":"。"}]}]},{"ID":"20230724220141-t2j0n90","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20230724220141-t2j0n90","updated":"20230724220203"},"Children":[{"ID":"20230724220141-59a79sm","Type":"NodeParagraph","Properties":{"id":"20230724220141-59a79sm","updated":"20230724220203"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"exporters:"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/loggingexporter","TextMarkTextContent":" 日志记录导出器"},{"Type":"NodeText","Data":"有助于故障排除并支持各种日志记录级别，如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"debug"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"info"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"warn"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"error"},{"Type":"NodeText","Data":"​。"}]}]},{"ID":"20230724220141-kbwohv2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20230724220141-kbwohv2","updated":"20230724220141"},"Children":[{"ID":"20230724220141-u6nuooy","Type":"NodeParagraph","Properties":{"id":"20230724220141-u6nuooy","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"otlp/elastic:  弹性可观察性端点配置。APM 服务器通过基于 gRPC 传输的 OTLP 协议"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlpgrpc","TextMarkTextContent":"(OTLP/gRPC)"},{"Type":"NodeText","Data":" 和基于 HTTP 传输的 OTLP 协议"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp","TextMarkTextContent":"(OTLP/HTTP)"},{"Type":"NodeText","Data":"支持 ProtoBuf 负载。要了解有关这些导出器的更多信息，请参阅 OpenTelemetry 收集器文档： "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/otlphttpexporter","TextMarkTextContent":"OTLP/HTTP 导出器"},{"Type":"NodeText","Data":"或 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/otlpexporter","TextMarkTextContent":"OTLP/gRPC 导出器"},{"Type":"NodeText","Data":"。"}]}]},{"ID":"20230724220141-g6j43jd","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20230724220141-g6j43jd","updated":"20230724220141"},"Children":[{"ID":"20230724220141-n8altb8","Type":"NodeParagraph","Properties":{"id":"20230724220141-n8altb8","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"APM 服务器端点的主机名和端口。例如，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"elastic-apm-server:8200"},{"Type":"NodeText","Data":"​。"}]}]},{"ID":"20230724220141-kqt1cx5","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20230724220141-kqt1cx5","updated":"20230724220141"},"Children":[{"ID":"20230724220141-xvt7q92","Type":"NodeParagraph","Properties":{"id":"20230724220141-xvt7q92","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Elastic APM"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/current/secret-token.html","TextMarkTextContent":"秘密令牌授权"},{"Type":"NodeText","Data":"( "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Authorization: \u0026quot;Bearer a_secret_token\u0026quot;"},{"Type":"NodeText","Data":"​) 或"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/current/api-key.html","TextMarkTextContent":"API 密钥授权"},{"Type":"NodeText","Data":"( "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Authorization: \u0026quot;ApiKey an_api_key\u0026quot;"},{"Type":"NodeText","Data":"​) 的凭据。"}]}]},{"ID":"20230724220141-pss5gll","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ny4=","Num":7},"Properties":{"id":"20230724220141-pss5gll","updated":"20230724220141"},"Children":[{"ID":"20230724220141-lbxn2kk","Type":"NodeParagraph","Properties":{"id":"20230724220141-lbxn2kk","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://opentelemetry.io/docs/collector/configuration/#configuration-environment-variables","TextMarkTextContent":" 特定于环境的配置参数可以方便地作为此处"},{"Type":"NodeText","Data":"记录的环境变量传入（例如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ELASTIC_APM_SERVER_ENDPOINT"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ELASTIC_APM_SECRET_TOKEN"},{"Type":"NodeText","Data":"​）。"}]}]},{"ID":"20230724220141-1ctmyli","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"OC4=","Num":8},"Properties":{"id":"20230724220141-1ctmyli","updated":"20230724220141"},"Children":[{"ID":"20230724220141-mjiwkvy","Type":"NodeParagraph","Properties":{"id":"20230724220141-mjiwkvy","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"要将 OpenTelemetry 日志发送到 Elastic Stack 版本 8.0+，请声明一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"logs"},{"Type":"NodeText","Data":"​管道。"}]}]}]},{"ID":"20230724220141-3elo98j","Type":"NodeParagraph","Properties":{"id":"20230724220141-3elo98j","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"您现在已准备好从您的服务和应用程序中导出跟踪和指标。"}]},{"ID":"20230724220141-vus0bbc","Type":"NodeParagraph","Properties":{"id":"20230724220141-vus0bbc","updated":"20230724220208"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 OpenTelemetry 收集器时，您应该始终更喜欢通过"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector/tree/main/exporter/otlphttpexporter","TextMarkTextContent":"OTLPexporter"},{"Type":"NodeText","Data":" 将数据发送到 Elastic APM 服务器。其他方法，如使用 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/elasticsearchexporter","TextMarkTextContent":" elasticsearchexporter"},{"Type":"NodeText","Data":" 将数据直接发送到 Elasticsearch 会将数据发送到 Elastic Stack，但会绕过 APM 服务器执行的所有验证和数据处理。此外，如果您使用elasticsearch导出器，您的数据将无法在 Kibana 可观察性应用程序中查看。"}]},{"ID":"20230724220141-4i7bymk","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724220141-4i7bymk","updated":"20230724220141"},"Children":[{"Type":"NodeText","Data":"从OpenTelemetry 代理发送数据"}]},{"ID":"20230724220141-orl20q2","Type":"NodeParagraph","Properties":{"id":"20230724220141-orl20q2","updated":"20230724220210"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"要将跟踪和指标导出到 APM 服务器，请使用 OpenTelemetry API、SDK 或两者检测您的服务和应用程序。例如，如果您是 Java 开发人员，则需要使用适用于"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-java-instrumentation","TextMarkTextContent":"Java 的 OpenTelemetry 代理来"},{"Type":"NodeText","Data":"检测您的 Java 应用程序。请参阅"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://opentelemetry.io/docs/instrumentation/","TextMarkTextContent":"OpenTelemetry Instrumentation 指南"},{"Type":"NodeText","Data":"以下载适用于您的语言的 OpenTelemetry Agent 或 SDK。"}]},{"ID":"20230724220141-su04o62","Type":"NodeParagraph","Properties":{"id":"20230724220141-su04o62","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"定义以下环境变量以配置 OpenTelemetry 代理并启用与 Elastic APM 的通信。"}]},{"ID":"20230724220141-9prja0d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724220141-9prja0d","updated":"20230724220141"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"export OTEL_RESOURCE_ATTRIBUTES=service.name=checkoutService,service.version=1.1,deployment.environment=production\nexport OTEL_EXPORTER_OTLP_ENDPOINT=https://apm_server_url:8200\nexport OTEL_EXPORTER_OTLP_HEADERS=\"Authorization=Bearer an_apm_secret_token\"\nexport OTEL_METRICS_EXPORTER=\"otlp\" \\\nexport OTEL_LOGS_EXPORTER=\"otlp\" \\\njava -javaagent:/path/to/opentelemetry-javaagent-all.jar \\\n     -classpath lib/*:classes/ \\\n     com.mycompany.checkout.CheckoutServiceServer\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724220141-0ieqv6k","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20230724220141-0ieqv6k","updated":"20230724220141"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"OTEL_RESOURCE_ATTRIBUTES"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"描述服务和服务运行环境的字段。 有关更多信息，请参阅"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/current/open-telemetry-resource-attributes.html","TextMarkTextContent":"资源属性。"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"OTEL_EXPORTER_OTLP_ENDPOINT"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"APM 服务器 URL。APM 服务器侦听事件的主机和端口。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"OTEL_EXPORTER_OTLP_HEADERS"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"包含 Elastic APM 秘密令牌或 API 密钥的授权标头："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;Authorization=Bearer an_apm_secret_token\u0026quot;"},{"Type":"NodeText","Data":"​或"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;Authorization=ApiKey an_api_key\u0026quot;"},{"Type":"NodeText","Data":"​.有关如何格式化 API 密钥的信息，请参阅"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.elastic.co/guide/en/apm/guide/8.6/api-key.html","TextMarkTextContent":"API 密钥"},{"Type":"NodeText","Data":"。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Bearer"},{"Type":"NodeText","Data":"​请注意和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"an_apm_secret_token"},{"Type":"NodeText","Data":"​、 和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"APIKey"},{"Type":"NodeText","Data":"​之间所需的空格"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"an_api_key"},{"Type":"NodeText","Data":"​。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"OTEL_EXPORTER_OTLP_CERTIFICATE"},{"Type":"NodeText","Data":"​"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用于验证客户端的 TLS 凭据的可信证书。（选修的）"}]}]}]},{"ID":"20230724220141-jq91555","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724220141-jq91555","updated":"20230724220141"},"Children":[{"Type":"NodeText","Data":"对 APM 服务器的代理请求"}]},{"ID":"20230724220141-2jvy256","Type":"NodeParagraph","Properties":{"id":"20230724220141-2jvy256","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"APM 服务器在与 Elastic APM 代理请求相同的端口上同时支持"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlpgrpc","TextMarkTextContent":"(OTLP/gRPC)"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/protocol/otlp.md#otlphttp","TextMarkTextContent":"(OTLP/HTTP)协议。"},{"Type":"NodeText","Data":"为了便于设置，我们建议在向 APM 服务器代理或负载平衡请求时使用 OTLP/HTTP。"}]},{"ID":"20230724220141-p4j3j7g","Type":"NodeParagraph","Properties":{"id":"20230724220141-p4j3j7g","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果您使用 OTLP/gRPC 协议，对 APM 服务器的请求必须使用 HTTP/2 over TLS 或 HTTP/2 Cleartext (H2C)。无论使用哪种协议，OTLP/gRPC 请求都将具有标头："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;Content-Type: application/grpc\u0026quot;"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724220141-9g7to0w","Type":"NodeParagraph","Properties":{"id":"20230724220141-9g7to0w","updated":"20230724220141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 AWS ALB 等第 7 层 (L7) 代理时，必须以确保对 APM 服务器的请求遵循上述规则的方式代理请求。例如，使用 ALB，您可以创建规则以根据进入 ALB 的请求标头选择替代后端协议。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026quot;Content-Type: application/grpc\u0026quot;"},{"Type":"NodeText","Data":"​在此示例中，当请求中存在标头时，您将选择 gRPC 协议 。"}]},{"ID":"20230724220141-8rty3gu","Type":"NodeParagraph","Properties":{"id":"20230724220141-8rty3gu","updated":"20230724220219"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有关如何配置 AWS ALB 以支持 gRPC 的更多信息，请参阅这篇 AWS 博客文章："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://aws.amazon.com/blogs/aws/new-application-load-balancer-support-for-end-to-end-http-2-and-grpc/","TextMarkTextContent":"Application Load Balancer Support for End-to-End HTTP/2 and gRPC"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230724220141-s3d7bw5","Type":"NodeParagraph","Properties":{"id":"20230724220141-s3d7bw5","updated":"20230724220218"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有关 APM 服务器如何服务 gRPC 请求的更多信息，请参阅"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/elastic/apm-server/blob/main/dev_docs/otel.md#muxing-grpc-and-http11","TextMarkTextContent":"Muxing gRPC 和 HTTP/1.1"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230724220134-094o0z0","Type":"NodeParagraph","Properties":{"id":"20230724220134-094o0z0","updated":"20230724220134"}}]}