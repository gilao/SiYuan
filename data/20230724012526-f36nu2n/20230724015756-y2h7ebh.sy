{"ID":"20230724015756-y2h7ebh","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4e8","id":"20230724015756-y2h7ebh","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230724015756-y2h7ebh\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230724015758-49fterh\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230724015758-8dcltlm\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230724015758-8dcltlm\u0026quot;,\u0026quot;focusStart\u0026quot;:206,\u0026quot;focusEnd\u0026quot;:206\u0026#125;","tags":"Docker,需要仔细看","title":"16. 深入理解 images、containers、service、swarm","updated":"20230724015956"},"Children":[{"ID":"20230724015758-49fterh","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"|","id":"20230724015758-49fterh","updated":"20230724015815"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"名称"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker images 镜像"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 镜像是用于创建Docker容器的模板"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker Container 容器"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"容器是独立运行的一个或一组应用"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker Client 客户端"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 客户端通过命令行或者其他工具使用Docker API\n与Docker的守护进程通信"},{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker Host 主机"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"一个物理或者虚拟的机器用于执行Docker守护进程和容器"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker Registry 仓库"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker仓库用来保存镜像，可以理解为代码控制中的代码仓库，\nDocker Hub 提供了庞大的镜像集合供使用"},{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker Machine"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"DockerMachine 是一个简化Docker安装的命令行工具、\n通过一个简单的命令行即可在相应的平台上安装Docker，\n比如VirtualBox、Digital Ocean、Microsoft Azure。"},{"Type":"NodeBr","Data":"br"}]}]}]},{"ID":"20230724015758-uvl8ujz","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724015758-uvl8ujz","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"容器"}]},{"ID":"20230724015758-vzxjm2f","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724015758-vzxjm2f","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"用Dockerfile定义一个容器"}]},{"ID":"20230724015758-ie43olq","Type":"NodeParagraph","Properties":{"id":"20230724015758-ie43olq","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dockerfile将定义容器内的环境中发生的情况。访问资源（如网络接口和磁盘驱动器）在此环境中进行虚拟化，这与您系统的其余部分是隔离的，因此您必须将端口映射到外部世界，并具体说明要将哪些文件“复制”到那个环境。这样做之后，Dockerfile构建的应用程序将能在任何地方运行。"}]},{"ID":"20230724015758-eysnvrm","Type":"NodeParagraph","Properties":{"id":"20230724015758-eysnvrm","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"将三个文件放到同一个文件中"}]},{"ID":"20230724015758-650jf9a","Type":"NodeParagraph","Properties":{"id":"20230724015758-650jf9a","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dockerfile"}]},{"ID":"20230724015758-hfsp7ig","Type":"NodeParagraph","Properties":{"id":"20230724015758-hfsp7ig","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"requirements.txt"}]},{"ID":"20230724015758-grfa6a9","Type":"NodeParagraph","Properties":{"id":"20230724015758-grfa6a9","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"app.py"}]},{"ID":"20230724015758-l7hghdt","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724015758-l7hghdt","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"服务"}]},{"ID":"20230724015758-e78naop","Type":"NodeParagraph","Properties":{"id":"20230724015758-e78naop","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在分布式应用程序中，应用程序的不同部分称为服务"}]},{"ID":"20230724015758-3do3ewz","Type":"NodeParagraph","Properties":{"id":"20230724015758-3do3ewz","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"服务只能“在容器中生成” 。一个服务只运行一个镜像"}]},{"ID":"20230724015758-y1eido4","Type":"NodeParagraph","Properties":{"id":"20230724015758-y1eido4","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用Docker运行和改变服务非常简单，只需要编写一个docker-compose.yml文件"}]},{"ID":"20230724015758-420t4sj","Type":"NodeParagraph","Properties":{"id":"20230724015758-420t4sj","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"　一个docker-compose.yml文件是一个YAML文件，用于定义Docker容器在生产过程中的行为。 　　将此文件保存docker-compose.yml到您想要的位置。确保您上一节创建的镜像推送到注册表(也就是自己的仓库里)。"}]},{"ID":"20230724015758-ah3dx5z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724015758-ah3dx5z","updated":"20230724015943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2g="},{"Type":"NodeCodeBlockCode","Data":"docker-compose.yml\n\nversion:\"3\"\n\nservices:\n\n\tweb:\n\n\t\t\\#replace username/repo:tag with your name and image details\n\n\t\timage: john/get-started:part1\n\n\t\tdeploy:\n\n\t\treplicas: 5\n\n\t\tresources:\n\n\t\tlimits:\n\n\t\tcups: \"0.1\"\n\n\t\t\tmemory:50M\n\nrestart_policy:\n\n\t\tcondition:on-failure\n\nports:\n\n\t\\-  \"80:80\"\n\nnetworks:\n\n\t\t\\- webnet\n\nnetworks:\n\n\twebnet:\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724015758-2hu78fx","Type":"NodeParagraph","Properties":{"id":"20230724015758-2hu78fx","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"该docker-compose.yml文件告诉Docker执行以下操作："}]},{"ID":"20230724015758-pbyjxmw","Type":"NodeList","ListData":{},"Properties":{"id":"20230724015758-pbyjxmw","updated":"20230724015758"},"Children":[{"ID":"20230724015758-rol84z1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-rol84z1","updated":"20230724015758"},"Children":[{"ID":"20230724015758-y5bfiab","Type":"NodeParagraph","Properties":{"id":"20230724015758-y5bfiab","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"从registry(自己的仓库)中pull我们在上一节上传的图像。"}]}]},{"ID":"20230724015758-oncsoy9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-oncsoy9","updated":"20230724015758"},"Children":[{"ID":"20230724015758-9n13jc8","Type":"NodeParagraph","Properties":{"id":"20230724015758-9n13jc8","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行该镜像的五个实例作为调用的服务web，限制每个实例使用最多使用10％的CPU（跨所有内核）和50MB RAM。"}]}]},{"ID":"20230724015758-xz1bu08","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-xz1bu08","updated":"20230724015758"},"Children":[{"ID":"20230724015758-0h8jiyt","Type":"NodeParagraph","Properties":{"id":"20230724015758-0h8jiyt","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果发生故障，立即重新启动容器。"}]}]},{"ID":"20230724015758-ut5hs3z","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-ut5hs3z","updated":"20230724015758"},"Children":[{"ID":"20230724015758-qpo872f","Type":"NodeParagraph","Properties":{"id":"20230724015758-qpo872f","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"将端口80映射到主机web端口80。"}]}]},{"ID":"20230724015758-st8aeq9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-st8aeq9","updated":"20230724015758"},"Children":[{"ID":"20230724015758-rbf3ip8","Type":"NodeParagraph","Properties":{"id":"20230724015758-rbf3ip8","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Instruct web’s containers to share port 80 via a load-balanced network called webnet. (Internally, the containers themselves will publish to web’s port 80 at an ephemeral port.) (指示web容器通过称为负载平衡网络共享端口80 webnet。（在内部，集装箱本身将web在短暂的港口发布到 80号港口。）)"}]}]},{"ID":"20230724015758-cpciazy","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724015758-cpciazy","updated":"20230724015758"},"Children":[{"ID":"20230724015758-n7fapbu","Type":"NodeParagraph","Properties":{"id":"20230724015758-n7fapbu","updated":"20230724015758"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Define the webnet network with the default settings (which is a load-balanced overlay network).(webnet使用默认设置（这是一个负载平衡的重叠网络）来定义网络)。"}]}]}]},{"ID":"20230724015758-gxo51gi","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724015758-gxo51gi","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"Swarm"}]},{"ID":"20230724015758-j0f01aa","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724015758-j0f01aa","updated":"20230724015758"},"Children":[{"Type":"NodeText","Data":"了解Swarm集群"}]},{"ID":"20230724015758-8dcltlm","Type":"NodeParagraph","Properties":{"id":"20230724015758-8dcltlm","updated":"20230724015956"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"swarm一组在Docker上运行并加入集群的机器。之后，您继续运行以前使用的Docker命令，但现在它们是在集群上执行的由swarm管理。在swarm中的机器可以是物理的或虚拟的。加入swarm后，它们被称为节点。"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Swarm管理者是swarm中唯一可以执行命令，或授权其他机器作为工作人员加入swarm的管理机器,(加入的节点不能)。工作机器只是提供能力，没有权力告诉任何其他机器它可以做什么和不能做什么。"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"到目前为止，您已经在本地计算机上以单主机模式使用Docker，Docker也可以切换到swarm 模式。swarm 模式可以立使当前的机器成为swarm管理员。从那时起，Docker将运行您正在管理的swarm上执行的命令，而不是在当前的机器。"}]}]}