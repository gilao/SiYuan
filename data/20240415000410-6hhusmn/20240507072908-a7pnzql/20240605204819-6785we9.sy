{"ID":"20240605204819-6785we9","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f312","id":"20240605204819-6785we9","title":"第六章 数组","type":"doc","updated":"20240605210602"},"Children":[{"ID":"20240605204819-euk9lu7","Type":"NodeParagraph","Properties":{"id":"20240605204819-euk9lu7","updated":"20240605204901"},"Children":[{"Type":"NodeText","Data":"本节将介绍Go语言中重要的数据类型——"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"数组"},{"Type":"NodeText","Data":"。几乎所有主流语言都支持数组，它"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"是一片连续的内存区域。"}]},{"ID":"20240605204902-74rv1wr","Type":"NodeParagraph","Properties":{"id":"20240605204902-74rv1wr","updated":"20240605204929"},"Children":[{"Type":"NodeText","Data":"Go语言中的数组与其他语言中的数组有显著不同的特性："}]},{"ID":"20240605204929-xmlzayh","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240605204929-xmlzayh","updated":"20240605204959"},"Children":[{"ID":"20240605204930-5xm9wra","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240605204930-5xm9wra","updated":"20240605204930"},"Children":[{"ID":"20240605204930-k6uoz0w","Type":"NodeParagraph","Properties":{"id":"20240605204930-k6uoz0w","updated":"20240605204935"},"Children":[{"Type":"NodeText","Data":"不能进行扩容"}]}]},{"ID":"20240605204935-lazo8b9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240605204935-lazo8b9","updated":"20240605204959"},"Children":[{"ID":"20240605204935-ydlqvpr","Type":"NodeParagraph","Properties":{"id":"20240605204935-ydlqvpr","updated":"20240605204959"},"Children":[{"Type":"NodeText","Data":"在复制和传递时为值复制"}]}]}]},{"ID":"20240605205016-hvz4bsa","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240605205016-hvz4bsa","updated":"20240605205028"},"Children":[{"Type":"NodeText","Data":"6.1 数组的声明方式"}]},{"ID":"20240605205028-50c14i9","Type":"NodeParagraph","Properties":{"id":"20240605205028-50c14i9","updated":"20240605205044"},"Children":[{"Type":"NodeText","Data":"数组的声明主要有三种方式："}]},{"ID":"20240605205044-oo4s0pc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240605205044-oo4s0pc","updated":"20240605205133"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"var arr [3]int\nvar arr2 = [4]int{1,2,3,4}\narr3 := [...]int{2,3,4}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240605205154-e90tctw","Type":"NodeParagraph","Properties":{"id":"20240605205154-e90tctw","updated":"20240605205200"},"Children":[{"Type":"NodeText","Data":"可以在声明的同时为数组赋值。"}]},{"ID":"20240605205200-uzovwix","Type":"NodeParagraph","Properties":{"id":"20240605205200-uzovwix","updated":"20240605205215"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":"数组是内存中一片连续的区域，需要在初始化时被指定长度，数组的大小取决于数组中存放的元素大小。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"}]},{"ID":"20240605205155-4x76ymj","Type":"NodeParagraph","Properties":{"id":"20240605205155-4x76ymj","updated":"20240605205226"},"Children":[{"Type":"NodeText","Data":"对于数组还有一种语法糖，可以不用指定类型，如arr3：=[...]int{2，3，4}，这种声明方式在编译时自动推断长度。"}]},{"ID":"20240605205237-r8qqaaq","Type":"NodeParagraph","Properties":{"id":"20240605205237-r8qqaaq","updated":"20240605205250"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color2);"},"TextMarkType":"strong text","TextMarkTextContent":"不同类型的数组之间不能进行比较。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color2);\"}"}]},{"ID":"20240605205251-39b6udx","Type":"NodeParagraph","Properties":{"id":"20240605205251-39b6udx","updated":"20240605205313"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":"数组长度可以通过内置的len函数获取，数组中的元素可以通过下标获取。只能访问数组中已有的元素，如果数组访问越界，则在编译时会报错。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"}]},{"ID":"20240605205319-rvnje2b","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240605205319-rvnje2b","updated":"20240605205328"},"Children":[{"Type":"NodeText","Data":"6.2 数组值复制"}]},{"ID":"20240605205328-iz5lwc0","Type":"NodeParagraph","Properties":{"id":"20240605205328-iz5lwc0","updated":"20240605205344"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"strong text","TextMarkTextContent":"Go语言中的数组在赋值和函数调用时的形参都是值复制。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"}]},{"ID":"20240605205345-gb9adxy","Type":"NodeParagraph","Properties":{"id":"20240605205345-gb9adxy","updated":"20240605205408"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color7);"},"TextMarkType":"strong text","TextMarkTextContent":"如下所示，无论是赋值的b还是函数调用中的c，都是值复制的。这意味着不管是修改b还是c的值，都不会影响a的值，因为他们是完全不同的数组。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color7);\"}"}]},{"ID":"20240605205409-nz2cc8y","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240605205409-nz2cc8y","updated":"20240605205443"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"a := [3]int[1,2,3]\nb = a\nfunc Change(c [3]int) {}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240605205451-olhhltv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240605205451-olhhltv","updated":"20240605205502"},"Children":[{"Type":"NodeText","Data":"6.3 数组底层原理"}]},{"ID":"20240605205502-ilohkgp","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240605205502-ilohkgp","updated":"20240605205514"},"Children":[{"Type":"NodeText","Data":"6.3.1 编译时数组解析"}]},{"ID":"20240605205514-oivs49m","Type":"NodeParagraph","Properties":{"id":"20240605205514-oivs49m","updated":"20240605205633"},"Children":[{"Type":"NodeText","Data":"数组形如[n]T，在编译时就需要确定其长度和类型。数组在编译时构建抽象语法树阶段的数据类型为TARRAY，通过NewArray函数进行创建，AST节点的Op操作为OARRAYLIT。"}]},{"ID":"20240605205643-ojaunr9","Type":"NodeParagraph","Properties":{"id":"20240605205643-ojaunr9","updated":"20240605205644"},"Children":[{"Type":"NodeText","Data":"TARRAY内部的Array结构存储了数组中元素的类型及数组的大小。"}]},{"ID":"20240605205645-18hzktz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240605205645-18hzktz","updated":"20240605205717"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type Array struct {\n  Elem *Type\n  Bound int64\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240605205725-gkq99lr","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240605205725-gkq99lr","updated":"20240605205740"},"Children":[{"Type":"NodeText","Data":"6.3.2 数组字面量初始化原理"}]},{"ID":"20240605205740-vuuassp","Type":"NodeParagraph","Properties":{"id":"20240605205740-vuuassp","updated":"20240605205749"},"Children":[{"Type":"NodeText","Data":"数组字面量的初始化在编译时类型检查阶段进行，通过typecheckcomplit函数循环字面量并分别进行赋值。"}]},{"ID":"20240605205808-qszywon","Type":"NodeParagraph","Properties":{"id":"20240605205808-qszywon","updated":"20240605205808"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240605205808-jdi2r9c.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240605205809-1ijgo4p","Type":"NodeParagraph","Properties":{"id":"20240605205809-1ijgo4p","updated":"20240605205823"},"Children":[{"Type":"NodeText","Data":"数组声明中存在语法糖[...]int{2，3，4}，其实质与一般的数组声明类似。"}]},{"ID":"20240605205824-34vqjt8","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240605205824-34vqjt8","updated":"20240605205850"},"Children":[{"Type":"NodeText","Data":"6.3.3 数组字面量编译时内存优化"}]},{"ID":"20240605205909-71xgmg9","Type":"NodeParagraph","Properties":{"id":"20240605205909-71xgmg9","updated":"20240605205909"},"Children":[{"Type":"NodeText","Data":"在编译时还会进行重要的优化。在函数walk遍历阶段，anylit函数用于处理各种类型的字面量。当数组的长度小于4时，在运行时数组会被放置在栈中，当数组的长度大于4时，数组会被放置到内存的静态只读区。fixedlit函数将执行数组初始化与赋值的逻辑。"}]},{"ID":"20240605205932-07q6kf5","Type":"NodeParagraph","Properties":{"id":"20240605205932-07q6kf5","updated":"20240605205932"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240605205932-047o60q.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240605205933-cro5zu6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240605205933-cro5zu6","updated":"20240605205946"},"Children":[{"Type":"NodeText","Data":"6.3.4 数组索引与访问越界原理"}]},{"ID":"20240605205946-xz4evvh","Type":"NodeParagraph","Properties":{"id":"20240605205946-xz4evvh","updated":"20240605205952"},"Children":[{"Type":"NodeText","Data":"数组访问越界是非常严重的错误，Go语言中对越界的判断有一部分是在编译期间类型检查阶段完成的，typecheck1函数会对访问数组的索引进行验证。"}]},{"ID":"20240605210002-9joworo","Type":"NodeParagraph","Properties":{"id":"20240605210002-9joworo","updated":"20240605210002"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240605210002-t58zv7w.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240605210003-ibs3pfj","Type":"NodeParagraph","Properties":{"id":"20240605210003-ibs3pfj","updated":"20240605210012"},"Children":[{"Type":"NodeText","Data":"具体验证逻辑如下："}]},{"ID":"20240605210012-o6yza59","Type":"NodeList","ListData":{},"Properties":{"id":"20240605210012-o6yza59","updated":"20240605210216"},"Children":[{"ID":"20240605210014-wffzbxk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210014-wffzbxk","updated":"20240605210014"},"Children":[{"ID":"20240605210014-b285ttw","Type":"NodeParagraph","Properties":{"id":"20240605210014-b285ttw","updated":"20240605210043"},"Children":[{"Type":"NodeText","Data":"访问数组的索引是非整数时报错为 non-integer array index %v"}]}]},{"ID":"20240605210043-62gq7fo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210043-62gq7fo"},"Children":[{"ID":"20240605210043-lmur1tw","Type":"NodeParagraph","Properties":{"id":"20240605210043-lmur1tw","updated":"20240605210126"},"Children":[{"Type":"NodeText","Data":"访问数组的索引是负数时报错为 invalid array index %v（index must be non-negative)"}]}]},{"ID":"20240605210126-4xmvxhe","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210126-4xmvxhe","updated":"20240605210216"},"Children":[{"ID":"20240605210126-77yfzz2","Type":"NodeParagraph","Properties":{"id":"20240605210126-77yfzz2","updated":"20240605210216"},"Children":[{"Type":"NodeText","Data":"访问数组的索引越界时报错为 invalid array index %v（out of bounds for %d -element array）"}]}]}]},{"ID":"20240605210228-2htznb8","Type":"NodeParagraph","Properties":{"id":"20240605210228-2htznb8","updated":"20240605210229"},"Children":[{"Type":"NodeText","Data":"使用未命名常量索引访问数组时，例如a[3]，数组的一些简单越界错误能够在编译期间被发现。但是如果使用变量去访问数组或者字符串，编译器无法发现对应的错误，因为变量的值随时可能变化。下例在运行时也会检查数组的越界错误。"}]},{"ID":"20240605210230-j4qx8ws","Type":"NodeParagraph","Properties":{"id":"20240605210230-j4qx8ws","updated":"20240605210235"},"Children":[{"Type":"NodeText","Data":"Go语言运行时在发现数组、切片和字符串的越界操作时，会由运行时的panicIndex和runtime.goPanicIndex函数触发程序的运行时错误并导致崩溃"}]},{"ID":"20240605210254-l8bscly","Type":"NodeParagraph","Properties":{"id":"20240605210254-l8bscly","updated":"20240605210254"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240605210254-z1zf0bm.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240605210256-sd126fj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240605210256-sd126fj","updated":"20240605210318"},"Children":[{"Type":"NodeText","Data":"6.4"}]},{"ID":"20240605210319-22fbih5","Type":"NodeParagraph","Properties":{"id":"20240605210319-22fbih5","updated":"20240605210329"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Go语言数组特性："}]},{"ID":"20240605210329-xrasxlc","Type":"NodeList","ListData":{},"Properties":{"id":"20240605210329-xrasxlc","updated":"20240605210602"},"Children":[{"ID":"20240605210330-fpgtw19","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210330-fpgtw19","updated":"20240605210330"},"Children":[{"ID":"20240605210330-bkorwpb","Type":"NodeParagraph","Properties":{"id":"20240605210330-bkorwpb","updated":"20240605210337"},"Children":[{"Type":"NodeText","Data":"不可以添加值"}]}]},{"ID":"20240605210341-vmh57sj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210341-vmh57sj"},"Children":[{"ID":"20240605210341-nyvwzcc","Type":"NodeParagraph","Properties":{"id":"20240605210341-nyvwzcc","updated":"20240605210349"},"Children":[{"Type":"NodeText","Data":"可以获取值和长度"}]}]},{"ID":"20240605210349-hru11s8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210349-hru11s8"},"Children":[{"ID":"20240605210349-cukylcp","Type":"NodeParagraph","Properties":{"id":"20240605210349-cukylcp","updated":"20240605210421"},"Children":[{"Type":"NodeText","Data":"数组中的复制都是值复制，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"因此尽量不要进行大数组的复制"}]}]},{"ID":"20240605210423-ig2bief","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210423-ig2bief"},"Children":[{"ID":"20240605210423-nt8beo3","Type":"NodeParagraph","Properties":{"id":"20240605210423-nt8beo3","updated":"20240605210503"},"Children":[{"Type":"NodeText","Data":"常量的下标及某些变量的下标的越界访问问题可以在编译时被检测到"}]}]},{"ID":"20240605210506-1bk4p49","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210506-1bk4p49"},"Children":[{"ID":"20240605210506-f9nng6f","Type":"NodeParagraph","Properties":{"id":"20240605210506-f9nng6f","updated":"20240605210523"},"Children":[{"Type":"NodeText","Data":"变量下标的数组越界问题只会在运行时报错"}]}]},{"ID":"20240605210525-wsf13ob","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210525-wsf13ob"},"Children":[{"ID":"20240605210525-ph3pimb","Type":"NodeParagraph","Properties":{"id":"20240605210525-ph3pimb","updated":"20240605210545"},"Children":[{"Type":"NodeText","Data":"数组的声明中存在一个语法糖——[...]int{2，3，4}，依靠编译器进行数组长度的推断。"}]}]},{"ID":"20240605210546-y1mkyqw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210546-y1mkyqw"},"Children":[{"ID":"20240605210546-dp34rpa","Type":"NodeParagraph","Properties":{"id":"20240605210546-dp34rpa","updated":"20240605210556"},"Children":[{"Type":"NodeText","Data":"在编译时对数组还会进行重要的优化。当数组的长度小于4时，在运行时会选择在栈中初始化数组。当数组的长度大于4时，程序会在启动时在静态区初始化数组。"}]}]},{"ID":"20240605210557-dbynaja","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240605210557-dbynaja","updated":"20240605210602"},"Children":[{"ID":"20240605210557-4dxei1s","Type":"NodeParagraph","Properties":{"id":"20240605210557-4dxei1s","updated":"20240605210602"},"Children":[{"Type":"NodeText","Data":"Go语言中较少使用数组，更多的时候会使用切片。"}]}]}]}]}