{"ID":"20240313165353-nti1agw","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f453","id":"20240313165353-nti1agw","title":"Fastchat：基于fastapi 构建大模型加载服务","updated":"20240313173128"},"Children":[{"ID":"20240313165959-ezslq4f","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240313165959-ezslq4f","updated":"20240313170032"},"Children":[{"Type":"NodeText","Data":"Fastapi LLM 支持"}]},{"ID":"20240313170032-zdzizhy","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240313170032-zdzizhy","updated":"20240313170047"},"Children":[{"Type":"NodeText","Data":"FastChat 服务架构"}]},{"ID":"20240313170049-rr5iux1","Type":"NodeParagraph","Properties":{"id":"20240313170049-rr5iux1","updated":"20240313170049"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313170048-x4hremv.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313170050-dtj8w5v","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240313170050-dtj8w5v","updated":"20240313170055"},"Children":[{"Type":"NodeText","Data":"安装"}]},{"ID":"20240313170055-9xdcuic","Type":"NodeParagraph","Properties":{"id":"20240313170055-9xdcuic","updated":"20240313170102"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"方法一： pip"}]},{"ID":"20240313170103-6d9u6as","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313170103-6d9u6as","updated":"20240313170127"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip3 install \"fschat[model_worker,wbui]\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313165408-da6jm98","Type":"NodeParagraph","Properties":{"id":"20240313165408-da6jm98","updated":"20240313170140"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"方法二：源文件"}]},{"ID":"20240313170140-mgdlhur","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313170140-mgdlhur","updated":"20240313170211"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"git clone https://github.com/lm-sys/FastChat.git\ncd FastChat\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313165353-en3cje4","Type":"NodeParagraph","Properties":{"id":"20240313165353-en3cje4","updated":"20240313170223"},"Children":[{"Type":"NodeText","Data":"Mac 上运行"}]},{"ID":"20240313170223-pj3ilqj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313170223-pj3ilqj","updated":"20240313170234"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"brew install rust cmake\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313170235-w2prvsy","Type":"NodeParagraph","Properties":{"id":"20240313170235-w2prvsy","updated":"20240313170240"},"Children":[{"Type":"NodeText","Data":"从源文件安装"}]},{"ID":"20240313170241-kc3zr4t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313170241-kc3zr4t","updated":"20240313170326"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip3 install --upgrade pip # enable PEP 660 support\npip3 isntall -e \".[model_worker,webui]\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313170328-zyeis7g","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240313170328-zyeis7g","updated":"20240313170340"},"Children":[{"Type":"NodeText","Data":"加载大模型推理"}]},{"ID":"20240313170340-4osjw2q","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240313170340-4osjw2q","updated":"20240313170346"},"Children":[{"Type":"NodeText","Data":"1. 命令行"}]},{"ID":"20240313170346-fzrxrb6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313170346-fzrxrb6","updated":"20240313170426"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.server.cli --model-path lmsys/vicuna-7b-v1.3\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313170436-s3h4p4t","Type":"NodeParagraph","Properties":{"id":"20240313170436-s3h4p4t","updated":"20240313170436"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313170436-hqwoy97.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313170437-6un7oq5","Type":"NodeParagraph","Properties":{"id":"20240313170437-6un7oq5","updated":"20240313170502"},"Children":[{"Type":"NodeText","Data":"关键参数汇总"}]},{"ID":"20240313170502-am2k2n3","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240313170502-am2k2n3","updated":"20240313172010"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"参数"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"说明"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-model-path"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"模型路径，可以是本地文件夹或HuggingFace的repo ID"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-revision"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HuggingFace Hub 模型修订版本标识"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-device"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"设备类型，可选择 cpu/cuda/mps/xpu"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-gpus"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"指定单个或多个GPU，如1或0，2"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-num-gpus"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GPU数量"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-max-gpu-memory"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"每个GPU 用于存储模型权重的最大内存，使用字符串表示如 '13Gib'"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-load-8bit"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"使用8位量化"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-cpu-offloading"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"仅用于8位量化将超出GPU容量的权重卸载到CPU"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-gptq-ckpt"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GPTQ 检查点路径，用于GPTQ量化"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-gptq-wbits"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GPTQ量化比特数，可选择2/3/4/8/16"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-gptq-groupsize"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"GPTQ量化分组大小，默认为整行"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-gptq-act-order"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否应用GPTQ激活顺序启发式方法"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-awq-ckpt"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"AWQ检查点路径，用于AWQ量化"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-awq-wbits"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"AWQ量化比特数，可选择4/16"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-awq-groupsize"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"AWQ量化分组大小，默认为整行"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-conv-template"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对话提示模板"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-conv-system-msg"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对话系统消息"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-temperature"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"温度参数"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-repetition_penalty"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"重复惩罚参数"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-max-new-tokens"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"最大新生成词元数量"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-no-history"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不保留历史记录"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-style"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"显示样式，可选择simple/rich/programmatic"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-multiline"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"启用多行输入"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-mouse"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"启动鼠标支持光标定位 ，仅限rich样式"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-judges-sent-end"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否启用识别句子结束的逻辑纠正"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"-debug"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"打印调试信息 如prompt"}]}]}]},{"ID":"20240313171626-h3f9jv4","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240313171626-h3f9jv4","updated":"20240313172029"},"Children":[{"Type":"NodeText","Data":"2. Web"}]},{"ID":"20240313172029-jn67x9y","Type":"NodeBlockquote","Properties":{"id":"20240313172029-jn67x9y","updated":"20240313172049"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172030-bydqnnr","Type":"NodeParagraph","Properties":{"id":"20240313172030-bydqnnr","updated":"20240313172047"},"Children":[{"Type":"NodeText","Data":"要使用Web UI 提供服务，您需要三个主要组件："}]},{"ID":"20240313172048-n6urvo4","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240313172048-n6urvo4","updated":"20240313172049"},"Children":[{"ID":"20240313172049-sx4xomz","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240313172049-sx4xomz","updated":"20240313172049"},"Children":[{"ID":"20240313172049-7wsrvs5","Type":"NodeParagraph","Properties":{"id":"20240313172049-7wsrvs5","updated":"20240313172100"},"Children":[{"Type":"NodeText","Data":"与用户交互的Web服务器"}]}]},{"ID":"20240313172100-2dht10n","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240313172100-2dht10n"},"Children":[{"ID":"20240313172100-xzsutlw","Type":"NodeParagraph","Properties":{"id":"20240313172100-xzsutlw","updated":"20240313172114"},"Children":[{"Type":"NodeText","Data":"托管一个或多个模型的模型工作人员"}]}]},{"ID":"20240313172114-q6kou1f","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240313172114-q6kou1f"},"Children":[{"ID":"20240313172114-olunjy8","Type":"NodeParagraph","Properties":{"id":"20240313172114-olunjy8","updated":"20240313172128"},"Children":[{"Type":"NodeText","Data":"协调网络服务器和模型工作人员的控制器"}]}]}]}]},{"ID":"20240313172128-k7gusp5","Type":"NodeParagraph","Properties":{"id":"20240313172128-k7gusp5","updated":"20240313172136"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"启动控制器"}]},{"ID":"20240313172136-e4xzu3w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172136-e4xzu3w","updated":"20240313172151"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.controller\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172157-wfrk2oa","Type":"NodeParagraph","Properties":{"id":"20240313172157-wfrk2oa","updated":"20240313172157"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313172157-u3e9xin.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313172158-jghgvty","Type":"NodeParagraph","Properties":{"id":"20240313172158-jghgvty","updated":"20240313172208"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"启动模型工作"}]},{"ID":"20240313172209-uwiuqsc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172209-uwiuqsc","updated":"20240313172249"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.model_worker --model-path lmsys/vicuna-7b-v1.3\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172252-3t5ft1a","Type":"NodeParagraph","Properties":{"id":"20240313172252-3t5ft1a","updated":"20240313172335"},"Children":[{"Type":"NodeText","Data":"等到进程完成加载模型，您会看到 \"Uvicorn runing on ...\"。模型工作者将自己注册到控制器"}]},{"ID":"20240313172342-2fag7ej","Type":"NodeParagraph","Properties":{"id":"20240313172342-2fag7ej","updated":"20240313172342"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313172342-cbhz4ic.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313172352-i1xhqr1","Type":"NodeParagraph","Properties":{"id":"20240313172352-i1xhqr1"}},{"ID":"20240313172353-3xlfx9j","Type":"NodeBlockquote","Properties":{"id":"20240313172353-3xlfx9j","updated":"20240313172407"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172353-69eiguz","Type":"NodeParagraph","Properties":{"id":"20240313172353-69eiguz","updated":"20240313172358"},"Children":[{"Type":"NodeText","Data":"测试模型是否注册到控制器，成功会有一个简短的输出"}]},{"ID":"20240313172407-tlkl9ds","Type":"NodeParagraph","Properties":{"id":"20240313172407-tlkl9ds","updated":"20240313172407"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313172407-y14a8yh.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20240313172357-xvk19j9","Type":"NodeParagraph","Properties":{"id":"20240313172357-xvk19j9","updated":"20240313172417"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"启动 Gradio Web 服务器"}]},{"ID":"20240313172417-lgbxc2m","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172417-lgbxc2m","updated":"20240313172435"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.gradio_web_server\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172438-a1mw63o","Type":"NodeBlockquote","Properties":{"id":"20240313172438-a1mw63o","updated":"20240313172452"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172438-cda381c","Type":"NodeParagraph","Properties":{"id":"20240313172438-cda381c","updated":"20240313172452"},"Children":[{"Type":"NodeText","Data":"这是用户将之交互的用户界面"}]}]},{"ID":"20240313172458-lc78ym0","Type":"NodeParagraph","Properties":{"id":"20240313172458-lc78ym0","updated":"20240313172458"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313172458-h9camqp.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313172459-iaq03wj","Type":"NodeBlockquote","Properties":{"id":"20240313172459-iaq03wj","updated":"20240313172525"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172502-gl3h7za","Type":"NodeParagraph","Properties":{"id":"20240313172502-gl3h7za","updated":"20240313172525"},"Children":[{"Type":"NodeText","Data":"打开 http://0.0.0.0:7860，可以看到交互界面"}]}]},{"ID":"20240313172532-d9wix5d","Type":"NodeParagraph","Properties":{"id":"20240313172532-d9wix5d","updated":"20240313172532"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313172531-kksnz25.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313172706-zsovqxc","Type":"NodeParagraph","Properties":{"id":"20240313172706-zsovqxc","updated":"20240313172711"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注册多个模型"}]},{"ID":"20240313172711-ujzla73","Type":"NodeBlockquote","Properties":{"id":"20240313172711-ujzla73","updated":"20240313172718"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172718-pnfhv4b","Type":"NodeList","ListData":{},"Properties":{"id":"20240313172718-pnfhv4b","updated":"20240313172718"},"Children":[{"ID":"20240313172718-dzuebsg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240313172718-dzuebsg","updated":"20240313172718"},"Children":[{"ID":"20240313172718-flndjas","Type":"NodeParagraph","Properties":{"id":"20240313172718-flndjas","updated":"20240313172718"},"Children":[{"Type":"NodeText","Data":"您可以将多个模型工作人员注册到单个控制器，该控制器可用于为具有更高吞吐量的单个模型提供服务或同时为多个模型提供服务。执行此操作时，请为不同的模型工作人员分配不同的 GPU 和端口。"}]}]}]}]},{"ID":"20240313172718-9vwjh13","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172718-9vwjh13","updated":"20240313172724"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"# worker 0\nCUDA_VISIBLE_DEVICES=0 python3 -m fastchat.serve.model_worker --model-path lmsys/vicuna-7b-v1.3 --controller http://localhost:21001 --port 31000 --worker http://localhost:31000\n# worker 1\nCUDA_VISIBLE_DEVICES=1 python3 -m fastchat.serve.model_worker --model-path lmsys/fastchat-t5-3b-v1.0 --controller http://localhost:21001 --port 31001 --worker http://localhost:31001\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172729-n9zpptq","Type":"NodeBlockquote","Properties":{"id":"20240313172729-n9zpptq","updated":"20240313172732"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313172732-dl05il5","Type":"NodeList","ListData":{},"Properties":{"id":"20240313172732-dl05il5","updated":"20240313172732"},"Children":[{"ID":"20240313172732-hfm59cl","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240313172732-hfm59cl","updated":"20240313172732"},"Children":[{"ID":"20240313172732-qtxxves","Type":"NodeParagraph","Properties":{"id":"20240313172732-qtxxves","updated":"20240313172732"},"Children":[{"Type":"NodeText","Data":"您还可以启动多选项卡 gradio 服务器，其中包括 Chatbot Arena 选项卡。"}]}]}]}]},{"ID":"20240313172736-1c4s875","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172736-1c4s875","updated":"20240313172738"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.gradio_web_server_multi\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172750-mbtbmkf","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240313172750-mbtbmkf","updated":"20240313172810"},"Children":[{"Type":"NodeText","Data":"3. 兼容 OpenAI 的RESTful API"}]},{"ID":"20240313172813-z4bcby8","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240313172813-z4bcby8","updated":"20240313172819"},"Children":[{"ID":"20240313172819-pmwxeb9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240313172819-pmwxeb9","updated":"20240313172819"},"Children":[{"ID":"20240313172819-mmnwj0a","Type":"NodeParagraph","Properties":{"id":"20240313172819-mmnwj0a","updated":"20240313172819"},"Children":[{"Type":"NodeText","Data":"启动控制器"}]}]}]},{"ID":"20240313172822-u22emal","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172822-u22emal","updated":"20240313172828"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.controller\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172829-va8fsty","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240313172829-va8fsty","updated":"20240313172832"},"Children":[{"ID":"20240313172832-g9z793a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240313172832-g9z793a","updated":"20240313172832"},"Children":[{"ID":"20240313172832-utsuu7t","Type":"NodeParagraph","Properties":{"id":"20240313172832-utsuu7t","updated":"20240313172836"},"Children":[{"Type":"NodeText","Data":"启动模型加载"}]}]}]},{"ID":"20240313172837-8k3n9a0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172837-8k3n9a0","updated":"20240313172843"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.model_worker --model-path /mnt/code/LLM_Service/model/Baichuan-13b-Chat \n#多卡运行\npython3 -m fastchat.serve.model_worker --model-path my_model_path --num-gpus 4 --max-gpu-memory \"20GiB\"\n# CUDA_VISIBLE_DEVICES=0,1,2,3 --gpus \"0,1,2,3\"这几个参数多卡没有效果，必须加--max-gpu-memory\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172847-x9nod4v","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240313172847-x9nod4v","updated":"20240313172900"},"Children":[{"ID":"20240313172900-1lkpr0e","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240313172900-1lkpr0e","updated":"20240313172900"},"Children":[{"ID":"20240313172900-8bt6jjs","Type":"NodeParagraph","Properties":{"id":"20240313172900-8bt6jjs","updated":"20240313172900"},"Children":[{"Type":"NodeText","Data":"启动RESTful API 服务器"}]}]}]},{"ID":"20240313172903-wfhpgjf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172903-wfhpgjf","updated":"20240313172911"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.openai_api_server --host localhost --port 8000\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172912-fwna0di","Type":"NodeList","ListData":{},"Properties":{"id":"20240313172912-fwna0di","updated":"20240313172916"},"Children":[{"ID":"20240313172916-ojai5er","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240313172916-ojai5er","updated":"20240313172916"},"Children":[{"ID":"20240313172916-1v5nya0","Type":"NodeParagraph","Properties":{"id":"20240313172916-1v5nya0","updated":"20240313172921"},"Children":[{"Type":"NodeText","Data":"安装 openai-python "}]}]}]},{"ID":"20240313172922-vx1t852","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172922-vx1t852","updated":"20240313172928"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip install --upgrade openai\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313172931-vnk7n9z","Type":"NodeParagraph","Properties":{"id":"20240313172931-vnk7n9z","updated":"20240313172954"},"Children":[{"Type":"NodeText","Data":"通过 ChatOpenAI 接口调用模型："}]},{"ID":"20240313172954-i86qjov","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313172954-i86qjov","updated":"20240313173003"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"from langchain.chat_models import ChatOpenAI\nfrom langchain import LLMChain\nfrom langchain.prompts.chat import (\n    ChatPromptTemplate,\n    HumanMessagePromptTemplate,\n)\n\napi_base_url = \"http://192.168.175.6:8000/v1\" \napi_key= \"EMPTY\"\nLLM_MODEL = \"Baichuan-13b-Chat\"\nmodel = ChatOpenAI(\n    streaming=True,\n    verbose=True,\n    # callbacks=[callback],\n    openai_api_key=api_key,\n    openai_api_base=api_base_url,\n    model_name=LLM_MODEL\n)\n\n\nhuman_prompt = \"{input}\"\nhuman_message_template = HumanMessagePromptTemplate.from_template(human_prompt)\n\nchat_prompt = ChatPromptTemplate.from_messages(\n    [(\"human\", \"我们来玩成语接龙，我先来，生龙活虎\"),\n     (\"ai\", \"虎头虎脑\"),\n     (\"human\", \"{input}\")])\n\n\nchain = LLMChain(prompt=chat_prompt, llm=model, verbose=True)\nprint(chain({\"input\": \"恼羞成怒\"}))\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313173016-qe9fqpn","Type":"NodeParagraph","Properties":{"id":"20240313173016-qe9fqpn","updated":"20240313173016"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240313173016-mzhhbm6.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240313173017-2y67bm7","Type":"NodeParagraph","Properties":{"id":"20240313173017-2y67bm7"}},{"ID":"20240313173019-67l6j8g","Type":"NodeBlockquote","Properties":{"id":"20240313173019-67l6j8g","updated":"20240313173025"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313173019-z4usfa5","Type":"NodeParagraph","Properties":{"id":"20240313173019-z4usfa5","updated":"20240313173025"},"Children":[{"Type":"NodeText","Data":"如果您想在同一台机器上、同一进程中运行多个模型，可以将"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"model_worker"},{"Type":"NodeText","Data":"​上述步骤替换为多模型变体："}]}]},{"ID":"20240313173024-chhne9w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313173024-chhne9w","updated":"20240313173032"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.multi_model_worker \\\n    --model-path lmsys/vicuna-7b-v1.3 \\\n    --model-names vicuna-7b-v1.3 \\\n    --model-path lmsys/longchat-7b-16k \\\n    --model-names longchat-7b-16k\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313173034-1mcliqy","Type":"NodeParagraph","Properties":{"id":"20240313173034-1mcliqy","updated":"20240313173041"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"本地GPU 微调"}]},{"ID":"20240313173041-sts7rxa","Type":"NodeParagraph","Properties":{"id":"20240313173041-sts7rxa","updated":"20240313173044"},"Children":[{"Type":"NodeText","Data":"安装依赖"}]},{"ID":"20240313173045-ebof1ba","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313173045-ebof1ba","updated":"20240313173100"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip3 install -e \".[train]\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240313173103-q954bfi","Type":"NodeParagraph","Properties":{"id":"20240313173103-q954bfi","updated":"20240313173109"},"Children":[{"Type":"NodeText","Data":"微调"}]},{"ID":"20240313173109-vnsgryn","Type":"NodeBlockquote","Properties":{"id":"20240313173109-vnsgryn","updated":"20240313173118"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240313173113-vh3gz42","Type":"NodeParagraph","Properties":{"id":"20240313173113-vh3gz42","updated":"20240313173118"},"Children":[{"Type":"NodeText","Data":"您可以使用以下命令使用 4 x A100 (40GB) 训练 Vicuna-7B。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--model_name_or_path"},{"Type":"NodeText","Data":"​使用 LLaMA 权重的实际路径和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--data_path"},{"Type":"NodeText","Data":"​数据的实际路径进行更新。"}]}]},{"ID":"20240313173117-0eqgbbk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240313173117-0eqgbbk","updated":"20240313173128"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"torchrun --nproc_per_node=4 --master_port=20001 fastchat/train/train_mem.py \\\n    --model_name_or_path ~/model_weights/llama-7b  \\\n    --data_path data/dummy_conversation.json \\\n    --bf16 True \\\n    --output_dir output_vicuna \\\n    --num_train_epochs 3 \\\n    --per_device_train_batch_size 2 \\\n    --per_device_eval_batch_size 2 \\\n    --gradient_accumulation_steps 16 \\\n    --evaluation_strategy \"no\" \\\n    --save_strategy \"steps\" \\\n    --save_steps 1200 \\\n    --save_total_limit 10 \\\n    --learning_rate 2e-5 \\\n    --weight_decay 0. \\\n    --warmup_ratio 0.03 \\\n    --lr_scheduler_type \"cosine\" \\\n    --logging_steps 1 \\\n    --fsdp \"full_shard auto_wrap\" \\\n    --fsdp_transformer_layer_cls_to_wrap 'LlamaDecoderLayer' \\\n    --tf32 True \\\n    --model_max_length 2048 \\\n    --gradient_checkpointing True \\\n    --lazy_preprocess True\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}