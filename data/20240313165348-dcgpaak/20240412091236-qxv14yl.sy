{"ID":"20240412091236-qxv14yl","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f985","id":"20240412091236-qxv14yl","title":"OpenAI 兼容的 RESTful API","updated":"20240412154938"},"Children":[{"ID":"20240412091238-le1o0da","Type":"NodeParagraph","Properties":{"id":"20240412091238-le1o0da","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"FastChat 为其支持的模型提供了 OpenAI 兼容的 API，因此您可以使用 FastChat 作为本地替换 OpenAI API 的解决方案。\nFastChat 服务器与 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/openai/openai-python","TextMarkTextContent":"openai-python"},{"Type":"NodeText","Data":" 库和 cURL 命令都兼容。\n支持以下 OpenAI API："}]},{"ID":"20240412091238-8b8f6cu","Type":"NodeList","ListData":{},"Properties":{"id":"20240412091238-8b8f6cu","updated":"20240412091245"},"Children":[{"ID":"20240412091238-w0mo5cd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240412091238-w0mo5cd","updated":"20240412091238"},"Children":[{"ID":"20240412091238-wjug2g7","Type":"NodeParagraph","Properties":{"id":"20240412091238-wjug2g7","updated":"20240412091238"},"Children":[{"Type":"NodeText","Data":"聊天补全。 (参考：https://platform.openai.com/docs/api-reference/chat)"}]}]},{"ID":"20240412091238-cdavovd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240412091238-cdavovd","updated":"20240412091238"},"Children":[{"ID":"20240412091238-gx00xfq","Type":"NodeParagraph","Properties":{"id":"20240412091238-gx00xfq","updated":"20240412091238"},"Children":[{"Type":"NodeText","Data":"补全。 (参考：https://platform.openai.com/docs/api-reference/completions)"}]}]},{"ID":"20240412091238-nodfgej","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240412091238-nodfgej","updated":"20240412091238"},"Children":[{"ID":"20240412091238-jobmut6","Type":"NodeParagraph","Properties":{"id":"20240412091238-jobmut6","updated":"20240412091238"},"Children":[{"Type":"NodeText","Data":"嵌入。 (参考：https://platform.openai.com/docs/api-reference/embeddings)\nREST API 可以在 Google Colab 中无缝操作，正如我们的仓库中可用的 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/lm-sys/FastChat/blob/main/playground/FastChat_API_GoogleColab.ipynb","TextMarkTextContent":"FastChat_API_GoogleColab.ipynb"},{"Type":"NodeText","Data":" 笔记本所演示的。这个笔记本提供了如何在 Google Colab 环境中有效利用 API 的实际示例。"}]}]}]},{"ID":"20240412091238-ab2352y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240412091238-ab2352y","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"RESTful API 服务器"}]},{"ID":"20240412091238-9bh52az","Type":"NodeParagraph","Properties":{"id":"20240412091238-9bh52az","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"首先，启动控制器"}]},{"ID":"20240412091238-4ws8kh7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-4ws8kh7","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.controller\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-vc0804w","Type":"NodeParagraph","Properties":{"id":"20240412091238-vc0804w","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"然后，启动模型工作进程"}]},{"ID":"20240412091238-g9kzfr0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-g9kzfr0","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.model_worker --model-path lmsys/vicuna-7b-v1.5\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-1f3wnwp","Type":"NodeParagraph","Properties":{"id":"20240412091238-1f3wnwp","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"最后，启动 RESTful API 服务器"}]},{"ID":"20240412091238-ju3f6kx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-ju3f6kx","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.openai_api_server --host localhost --port 8000\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-joi2p6r","Type":"NodeParagraph","Properties":{"id":"20240412091238-joi2p6r","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"现在，让我们测试 API 服务器。"}]},{"ID":"20240412091238-oc16fl9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240412091238-oc16fl9","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"OpenAI 官方 SDK"}]},{"ID":"20240412091238-dd99wrh","Type":"NodeParagraph","Properties":{"id":"20240412091238-dd99wrh","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"openai_api_server.py"},{"Type":"NodeText","Data":"​ 的目标是实现一个完全 OpenAI 兼容的 API 服务器，这样模型就可以直接与 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/openai/openai-python","TextMarkTextContent":"openai-python"},{"Type":"NodeText","Data":" 库一起使用。\n首先，安装 OpenAI python 包 \u003e= 1.0："}]},{"ID":"20240412091238-8hmac66","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-8hmac66","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"pip install --upgrade openai\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-18mbmux","Type":"NodeParagraph","Properties":{"id":"20240412091238-18mbmux","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"然后，与 Vicuna 模型交互："}]},{"ID":"20240412091238-66qczin","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-66qczin","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"import openai\nopenai.api_key = \"EMPTY\"\nopenai.base_url = \"http://localhost:8000/v1/\"\nmodel = \"vicuna-7b-v1.5\"\nprompt = \"Once upon a time\"\n# 创建一个补全\ncompletion = openai.completions.create(model=model, prompt=prompt, max_tokens=64)\n# 打印补全\nprint(prompt + completion.choices[0].text)\n# 创建一个聊天补全\ncompletion = openai.chat.completions.create(\n  model=model,\n  messages=[{\"role\": \"user\", \"content\": \"Hello! What is your name?\"}]\n)\n# 打印补全\nprint(completion.choices[0].message.content)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-vgvx4a3","Type":"NodeParagraph","Properties":{"id":"20240412091238-vgvx4a3","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"也支持流式传输。请参阅 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"../tests/test_openai_api.py","TextMarkTextContent":"test_openai_api.py"},{"Type":"NodeText","Data":"。如果你的 api 服务器在代理后面，你需要关闭缓冲，你可以在 Nginx 中通过在代理的位置块中设置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"proxy_buffering off;"},{"Type":"NodeText","Data":"​ 来实现。"}]},{"ID":"20240412091238-ud5vr6o","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240412091238-ud5vr6o","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"cURL"}]},{"ID":"20240412091238-x8htj71","Type":"NodeParagraph","Properties":{"id":"20240412091238-x8htj71","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"cURL 是观察 api 输出的另一个好工具。\n列出模型："}]},{"ID":"20240412091238-oqm425s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-oqm425s","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"curl http://localhost:8000/v1/models\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-w92j1pj","Type":"NodeParagraph","Properties":{"id":"20240412091238-w92j1pj","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"聊天补全："}]},{"ID":"20240412091238-vf77gge","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-vf77gge","updated":"20240412154938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"curl http://localhost:8000/v1/chat/completions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"model\": \"chatglm3-6b\",\n    \"messages\": [{\"role\": \"user\", \"content\": \"Hello! What is your name?\"}]\n  }'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-27r9krv","Type":"NodeParagraph","Properties":{"id":"20240412091238-27r9krv","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"文本补全："}]},{"ID":"20240412091238-xpjgkus","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-xpjgkus","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"curl http://localhost:8000/v1/completions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"model\": \"vicuna-7b-v1.5\",\n    \"prompt\": \"Once upon a time\",\n    \"max_tokens\": 41,\n    \"temperature\": 0.5\n  }'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-x1d4l3w","Type":"NodeParagraph","Properties":{"id":"20240412091238-x1d4l3w","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"嵌入："}]},{"ID":"20240412091238-0id2439","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-0id2439","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"curl http://localhost:8000/v1/embeddings \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"model\": \"vicuna-7b-v1.5\",\n    \"input\": \"Hello world!\"\n  }'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-aguafvk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240412091238-aguafvk","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"运行多个"}]},{"ID":"20240412091238-nowz0e1","Type":"NodeParagraph","Properties":{"id":"20240412091238-nowz0e1","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"如果你想在同一台机器和同一进程中运行多个模型，\n你可以将上面的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"model_worker"},{"Type":"NodeText","Data":"​ 步骤替换为多模型变体："}]},{"ID":"20240412091238-uimqrer","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240412091238-uimqrer","updated":"20240412091245"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"YmFzaA=="},{"Type":"NodeCodeBlockCode","Data":"python3 -m fastchat.serve.multi_model_worker \\\n    --model-path lmsys/vicuna-7b-v1.5 \\\n    --model-names vicuna-7b-v1.5 \\\n    --model-path lmsys/longchat-7b-16k \\\n    --model-names longchat-7b-16k\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240412091238-t7aa8uo","Type":"NodeParagraph","Properties":{"id":"20240412091238-t7aa8uo","updated":"20240412091245"},"Children":[{"Type":"NodeText","Data":"这将两个模型加载到同一个加速器中并在同一个进程中运行。使用触发"}]}]}