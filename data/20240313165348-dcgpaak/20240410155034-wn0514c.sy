{"ID":"20240410155034-wn0514c","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f351","id":"20240410155034-wn0514c","title":"用通俗易懂的方式讲解大模型：使用FastChat 部署的体验太爽了","updated":"20240411092335"},"Children":[{"ID":"20240410155034-2zwo2fn","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410155034-2zwo2fn","updated":"20240410161538"},"Children":[{"Type":"NodeText","Data":"FastChat 介绍"}]},{"ID":"20240410161539-blas984","Type":"NodeParagraph","Properties":{"id":"20240410161539-blas984","updated":"20240410161625"},"Children":[{"Type":"NodeText","Data":"FastChat 是一个用于训练、服务和评估基于大型语言模型的聊天机器人的开放平台。其核心功能包括："}]},{"ID":"20240410161625-0mdbmga","Type":"NodeList","ListData":{},"Properties":{"id":"20240410161625-0mdbmga","updated":"20240410161626"},"Children":[{"ID":"20240410161626-ilu8xjr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240410161626-ilu8xjr","updated":"20240410161626"},"Children":[{"ID":"20240410161626-abze14w","Type":"NodeParagraph","Properties":{"id":"20240410161626-abze14w","updated":"20240410161642"},"Children":[{"Type":"NodeText","Data":"最先进的LLM模型的权重、训练代码和评估代码"}]}]},{"ID":"20240410161644-ca728fr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240410161644-ca728fr"},"Children":[{"ID":"20240410161644-srhlc5q","Type":"NodeParagraph","Properties":{"id":"20240410161644-srhlc5q","updated":"20240410161719"},"Children":[{"Type":"NodeText","Data":"带有 WebUI 和 与 OpenAI 兼容的API的分布式多模型服务系统"}]}]}]},{"ID":"20240410161719-y06ec3u","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410161719-y06ec3u","updated":"20240410161727"},"Children":[{"Type":"NodeText","Data":"FastChat安装"}]},{"ID":"20240410161727-xqova74","Type":"NodeParagraph","Properties":{"id":"20240410161727-xqova74","updated":"20240410161738"},"Children":[{"Type":"NodeText","Data":"FastChat 的安装方式有两种，一种是通过 Pip 进行安装，一种是通过源码安装，由于源码的方式比较复杂，这里就不介绍了，我们使用 Pip 的方式来安装。"}]},{"ID":"20240410161739-g57mr1r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410161739-g57mr1r","updated":"20240410161744"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip install fschat\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410161745-aqcrcx5","Type":"NodeParagraph","Properties":{"id":"20240410161745-aqcrcx5","updated":"20240410161751"},"Children":[{"Type":"NodeText","Data":"有些环境在安装完成后，运行 FastChat 的命令会报缺少"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accelerate"},{"Type":"NodeText","Data":"​这个依赖库的错误，所以为了安全起见，我们也一并安装"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"accelerate"},{"Type":"NodeText","Data":"​这个库。"}]},{"ID":"20240410161752-jrk1csl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410161752-jrk1csl","updated":"20240410161802"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"pip install accelerate\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410161804-a2ii52s","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410161804-a2ii52s","updated":"20240410162333"},"Children":[{"Type":"NodeText","Data":"LLM 下载"}]},{"ID":"20240410162333-dqh1568","Type":"NodeParagraph","Properties":{"id":"20240410162333-dqh1568","updated":"20240410162341"},"Children":[{"Type":"NodeText","Data":"LLM 的下载我们可以通过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"git clone"},{"Type":"NodeText","Data":"​直接从"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HuggingFace"},{"Type":"NodeText","Data":"​上进行下载，我们在这次演示中需要下载 2 个 LLM，一个是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ChatGLM2-6B"},{"Type":"NodeText","Data":"​，一个是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Llama2"},{"Type":"NodeText","Data":"​，下载命令如下所示："}]},{"ID":"20240410162354-pqz7l67","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410162354-pqz7l67","updated":"20240410162400"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"# 开启大文件下载\ngit lfs install\n# 下载 ChatGLM2-6B\ngit clone https://huggingface.co/THUDM/chatglm2-6b\n# 下载 Llama2-7B-chat-hf\ngit clone https://huggingface.co/meta-llama/Llama-2-7b-chat-hf\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410162410-e67nbsy","Type":"NodeParagraph","Properties":{"id":"20240410162410-e67nbsy","updated":"20240410162410"},"Children":[{"Type":"NodeText","Data":"如果 Llama2 下载不下来，可能是没有同意协议，可以参考我之前的文章来解决。"}]},{"ID":"20240410162410-urxr8g7","Type":"NodeParagraph","Properties":{"id":"20240410162410-urxr8g7","updated":"20240410162410"},"Children":[{"Type":"NodeText","Data":"另外如果你是用 AutoDL 的 GPU 服务器的话，可以在终端开启学术资源加速[4]，开启后下载 HuggingFace 的资源会快很多。"}]},{"ID":"20240410162411-aeb5603","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410162411-aeb5603","updated":"20240410162423"},"Children":[{"Type":"NodeText","Data":"FastChat 命令行部署"}]},{"ID":"20240410162423-o4h7ne8","Type":"NodeParagraph","Properties":{"id":"20240410162423-o4h7ne8","updated":"20240410162432"},"Children":[{"Type":"NodeText","Data":"准备工作做好后，我们就可以使用 FastChat 来部署 LLM 了，FastChat 提供了命令行的方式来部署 LLM，命令行的方式比较简单，可以在命令行和 LLM 进行问答交互，我们先看下 FastChat 与 ChatGLM2 的命令行交互："}]},{"ID":"20240410162432-eb9io9i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410162432-eb9io9i","updated":"20240410162441"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"$ python -m fastchat.serve.cli --model-path /你的下载路径/chatglm2-6b\n问: 你好\n答: 你好！我是人工智能助手 ChatGLM2-6B，很高兴见到你，欢迎问我任何问题。\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410162447-7dbxmkr","Type":"NodeParagraph","Properties":{"id":"20240410162447-7dbxmkr","updated":"20240410162447"},"Children":[{"Type":"NodeText","Data":"再看看 FastChat 与 Llama2 的命令行交互："}]},{"ID":"20240410162448-el75lec","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410162448-el75lec","updated":"20240410162453"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"$ python -m fastchat.serve.cli --model-path /你的下载路径/Llam2-2-7n-chat-hf\n[INST]: who r u\n[/INST]: I'm just an AI, I don't have personal information or a physical identity like a human. I'm here to help answer your questions and provide information to the best of my ability. Is there something specific you would like to know or talk about?\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410162454-3lhkcoe","Type":"NodeParagraph","Properties":{"id":"20240410162454-3lhkcoe","updated":"20240410162501"},"Children":[{"Type":"NodeText","Data":"可以看到我们主要使用了 FastChat 的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fastchat.serve.cli"},{"Type":"NodeText","Data":"​命令，然后加上参数"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--model-path"},{"Type":"NodeText","Data":"​，参数的值就是我们下载的 LLM 具体路径。"}]},{"ID":"20240410162501-fwc00uz","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410162501-fwc00uz","updated":"20240410162508"},"Children":[{"Type":"NodeText","Data":"FastChat API 部署"}]},{"ID":"20240410162508-4bkfvq5","Type":"NodeParagraph","Properties":{"id":"20240410162508-4bkfvq5","updated":"20240410162920"},"Children":[{"Type":"NodeText","Data":"我们再来看 FastChat API 的部署，部署 API 服务分三步："}]},{"ID":"20240410162921-rrkp4po","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240410162921-rrkp4po","updated":"20240410162925"},"Children":[{"Type":"NodeText","Data":"第一步是启动控制器服务："}]},{"ID":"20240410162926-bv15gbt","Type":"NodeParagraph","Properties":{"id":"20240410162926-bv15gbt","updated":"20240410162925"},"Children":[{"Type":"NodeText","Data":"启动命令如下所示："}]},{"ID":"20240410162521-b3jkvcc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410162521-b3jkvcc","updated":"20240410162925"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python -m fastchat.serve.controller --host 0.0.0.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410162855-oted53w","Type":"NodeParagraph","Properties":{"id":"20240410162855-oted53w","updated":"20240410162911"},"Children":[{"Type":"NodeText","Data":"这次使用的是 FastChat 的fastchat.serve.controller命令，--host参数是设置服务的主机地址，这里设置为0.0.0.0，表示可以通过任何地址访问，如果不设置 host 的话在 AutoDL 环境上会报错，服务启动后默认端口是 21001。如果想查看该命令的更多信息可以执行python -m fastchat.serve.controller --help命令。"}]},{"ID":"20240410162946-g4om0jj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240410162946-g4om0jj","updated":"20240410163013"},"Children":[{"Type":"NodeText","Data":"第二步是启动 Model Worker 服务，启动命令如下所示："}]},{"ID":"20240410163013-0scqb6w","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410163013-0scqb6w","updated":"20240410163033"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python -m fastchat.serve.model_worker --model-path /你的下载路径/chatglm2-6b(或者是Llam2-2-7n-chat-hf) --host 0.0.0.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410163302-aozxpqh","Type":"NodeParagraph","Properties":{"id":"20240410163302-aozxpqh","updated":"20240410163315"},"Children":[{"Type":"NodeText","Data":"使用 FastChat 的fastchat.serve.model_worker命令来启动服务，通过--model-path参数来指定 LLM 的路径，服务启动后默认端口是 21002，可以通过--port参数来修改端口，如果想查看该命令的更多信息可以执行python -m fastchat.serve.model_worker --help命令。"}]},{"ID":"20240410163320-srt4bkv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240410163320-srt4bkv","updated":"20240410163348"},"Children":[{"Type":"NodeText","Data":"第三步是启动 RESTFul API服务，启动命令如下所示："}]},{"ID":"20240410163348-47wi0nm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240410163348-47wi0nm","updated":"20240410163354"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python -m fastchat.serve.openai_api_server --host 0.0.0.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410163404-o8nr8wg","Type":"NodeParagraph","Properties":{"id":"20240410163404-o8nr8wg","updated":"20240410163404"},"Children":[{"Type":"NodeText","Data":"服务启动后，默认端口是 8000，可以通过--port参数来修改端口，在浏览器中访问服务的这个路径http://127.0.0.1/docs可以查看接口信息，这个服务就是我们最终要用的 LLM API 服务，它的接口跟 OpenAI 的接口是兼容的，不仅可以推理，还可以进行 Embedding 操作，接口信息如下所示："}]},{"ID":"20240410163418-vbbepbt","Type":"NodeParagraph","Properties":{"id":"20240410163418-vbbepbt","updated":"20240410163423"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240410163418-wmv8z1r.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240410163458-qreyqf3","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240410163458-qreyqf3","updated":"20240410163507"},"Children":[{"Type":"NodeText","Data":"FastChat WebUI 部署"}]},{"ID":"20240410163508-8p3ocio","Type":"NodeParagraph","Properties":{"id":"20240410163508-8p3ocio","updated":"20240411092233"},"Children":[{"Type":"NodeText","Data":"FastChat 还提供了 WebUI 界面，我们可以通过浏览器来访问 WebUI 服务来进行问答交互，在启动 WebUI 服务之前，请确保已经启动好了上面的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"控制器服务"},{"Type":"NodeText","Data":"​和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Model Work 服务"},{"Type":"NodeText","Data":"​，启动 WebUI 服务的命令如下所示："}]},{"ID":"20240411092234-ifzh0fg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240411092234-ifzh0fg","updated":"20240411092241"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"python -m fastchat.serve.gradio_web_server --host 0.0.0.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240410163423-fpf6tf0","Type":"NodeParagraph","Properties":{"id":"20240410163423-fpf6tf0","updated":"20240411092249"},"Children":[{"Type":"NodeText","Data":"服务默认端口是 7860，可以通过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--port"},{"Type":"NodeText","Data":"​参数来修改端口，还可以通过添加"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--share"},{"Type":"NodeText","Data":"​参数来开启 Gradio 的共享模式，这样就可以通过外网访问 WebUI 服务了，WebUI 界面如下所示："}]},{"ID":"20240411092256-j7k27ht","Type":"NodeParagraph","Properties":{"id":"20240411092256-j7k27ht","updated":"20240411092256"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240411092256-rw4rsjx.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240411092307-nj35qyc","Type":"NodeParagraph","Properties":{"id":"20240411092307-nj35qyc","updated":"20240411092307"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240411092307-y8txqr1.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240411092308-jpyswq9","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240411092308-jpyswq9","updated":"20240411092318"},"Children":[{"Type":"NodeText","Data":"总结"}]},{"ID":"20240411092324-mgv2x0n","Type":"NodeParagraph","Properties":{"id":"20240411092324-mgv2x0n","updated":"20240411092324"},"Children":[{"Type":"NodeText","Data":"其实 FastChat 的功能非常强大，今天介绍的部署功能只是冰山一角，如果你对 FastChat 感兴趣的话，可以去官方仓库查看更多的信息。今天的文章就到这里，如果在部署的过程中遇到问题，欢迎在评论区讨论。"}]},{"ID":"20240411092324-rqh1h4r","Type":"NodeParagraph","Properties":{"id":"20240411092324-rqh1h4r","updated":"20240411092335"},"Children":[{"Type":"NodeText","Data":"关注我，一起学习各种人工智能和 AIGC 新技术，欢迎交流，如果你有什么想问想说的，欢迎在评论区留言。"}]}]}