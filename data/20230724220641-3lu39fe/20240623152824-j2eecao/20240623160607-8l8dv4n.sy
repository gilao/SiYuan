{"ID":"20240623160607-8l8dv4n","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f306","id":"20240623160607-8l8dv4n","title":"Doc Values","type":"doc","updated":"20240623160619"},"Children":[{"ID":"20240623160612-s425nga","Type":"NodeParagraph","Properties":{"id":"20240623160612-s425nga","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"Elasticsearch 中的 Doc Values 是一种存储在磁盘上的列式存储结构，它主要用于提升文档的排序、聚合以及脚本处理等操作的效率。以下是关于 Doc Values 的详细说明："}]},{"ID":"20240623160612-ou9hnem","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240623160612-ou9hnem","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"功能与目的"}]},{"ID":"20240623160612-djra65r","Type":"NodeList","ListData":{},"Properties":{"id":"20240623160612-djra65r","updated":"20240623160613"},"Children":[{"ID":"20240623160612-02u74ye","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-02u74ye","updated":"20240623160612"},"Children":[{"ID":"20240623160612-lgz0y76","Type":"NodeParagraph","Properties":{"id":"20240623160612-lgz0y76","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"高效访问"},{"Type":"NodeText","Data":": Doc Values 以列式存储方式组织数据，使得在执行排序、聚合操作时能够直接从磁盘高效读取所需的数据，无需像 fielddata 那样将数据加载到内存中，从而减少内存消耗。"}]}]},{"ID":"20240623160612-avaff40","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-avaff40","updated":"20240623160612"},"Children":[{"ID":"20240623160612-y03bjaj","Type":"NodeParagraph","Properties":{"id":"20240623160612-y03bjaj","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"支持类型广泛"},{"Type":"NodeText","Data":": 几乎支持所有字段类型，除了 analyzed string（经过分析的文本字段，因为它们会被分割成多个 term）和 annotated_text 类型。"}]}]},{"ID":"20240623160612-g3cwh8g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-g3cwh8g","updated":"20240623160612"},"Children":[{"ID":"20240623160612-5rjzs65","Type":"NodeParagraph","Properties":{"id":"20240623160612-5rjzs65","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"创建时机"},{"Type":"NodeText","Data":": Doc Values 是在文档索引时创建的，这意味着它们是索引过程的一部分，不需要额外的处理步骤。"}]}]},{"ID":"20240623160612-ow175m3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-ow175m3","updated":"20240623160612"},"Children":[{"ID":"20240623160612-h3i7pgb","Type":"NodeParagraph","Properties":{"id":"20240623160612-h3i7pgb","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"默认启用"},{"Type":"NodeText","Data":": 在 Elasticsearch 中，Doc Values 默认是开启的，可以通过在字段映射中设置 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"doc_values"},{"Type":"NodeText","Data":"​ 为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"false"},{"Type":"NodeText","Data":"​ 来禁用，但这通常只在确实需要节省磁盘空间且不使用该字段进行排序、聚合时考虑。"}]}]}]},{"ID":"20240623160612-abs3an7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240623160612-abs3an7","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"与倒排索引的区别"}]},{"ID":"20240623160612-fpdngig","Type":"NodeList","ListData":{},"Properties":{"id":"20240623160612-fpdngig","updated":"20240623160613"},"Children":[{"ID":"20240623160612-mwpp03o","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-mwpp03o","updated":"20240623160612"},"Children":[{"ID":"20240623160612-9w825jx","Type":"NodeParagraph","Properties":{"id":"20240623160612-9w825jx","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"倒排索引"},{"Type":"NodeText","Data":"主要用于快速查找包含特定词条的文档，它是基于词的索引，而 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Doc Values"},{"Type":"NodeText","Data":" 则是基于文档的，存储的是原始字段值，专为聚合、排序和脚本计算设计。"}]}]},{"ID":"20240623160612-rbj7ded","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-rbj7ded","updated":"20240623160612"},"Children":[{"ID":"20240623160612-3oc5cbr","Type":"NodeParagraph","Properties":{"id":"20240623160612-3oc5cbr","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"倒排索引存储在内存中，主要用于快速检索；而 Doc Values 存储在磁盘上，但在需要时由操作系统缓存到内存中以提高访问速度。"}]}]}]},{"ID":"20240623160612-jp568hx","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240623160612-jp568hx","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"优点"}]},{"ID":"20240623160612-bg0yqx6","Type":"NodeList","ListData":{},"Properties":{"id":"20240623160612-bg0yqx6","updated":"20240623160613"},"Children":[{"ID":"20240623160612-q45ekyj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-q45ekyj","updated":"20240623160612"},"Children":[{"ID":"20240623160612-7joor40","Type":"NodeParagraph","Properties":{"id":"20240623160612-7joor40","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内存效率"},{"Type":"NodeText","Data":": 由于 Doc Values 存储在磁盘上并可由OS自动缓存，对于大数据集来说，这显著减少了内存需求。"}]}]},{"ID":"20240623160612-d33ljvo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-d33ljvo","updated":"20240623160612"},"Children":[{"ID":"20240623160612-2udsac9","Type":"NodeParagraph","Properties":{"id":"20240623160612-2udsac9","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能提升"},{"Type":"NodeText","Data":": 对于排序和聚合操作，直接从磁盘读取预处理过的列式数据比从_source字段或fielddata中提取要快得多。"}]}]},{"ID":"20240623160612-cxq2mbj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-cxq2mbj","updated":"20240623160612"},"Children":[{"ID":"20240623160612-qexaycf","Type":"NodeParagraph","Properties":{"id":"20240623160612-qexaycf","updated":"20240623160612"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"稳定性"},{"Type":"NodeText","Data":": 避免了因fielddata占用过多内存导致的内存溢出问题，提升了系统的稳定性和可预测性。"}]}]}]},{"ID":"20240623160612-69ntd7i","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240623160612-69ntd7i","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"应用场景"}]},{"ID":"20240623160612-492fqxh","Type":"NodeList","ListData":{},"Properties":{"id":"20240623160612-492fqxh","updated":"20240623160613"},"Children":[{"ID":"20240623160612-me93xc2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-me93xc2","updated":"20240623160612"},"Children":[{"ID":"20240623160612-fjg6iqo","Type":"NodeParagraph","Properties":{"id":"20240623160612-fjg6iqo","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"当你需要对某个字段进行频繁的排序、聚合或者脚本计算时，启用 Doc Values 是非常必要的。"}]}]},{"ID":"20240623160612-mnyr73c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240623160612-mnyr73c","updated":"20240623160612"},"Children":[{"ID":"20240623160612-ukc6fbb","Type":"NodeParagraph","Properties":{"id":"20240623160612-ukc6fbb","updated":"20240623160612"},"Children":[{"Type":"NodeText","Data":"对于那些不需要进行全文搜索，但是经常用于聚合和统计分析的字段（例如日期、数字、关键词类型字段），Doc Values 尤其重要。"}]}]}]},{"ID":"20240623160612-27v3dp5","Type":"NodeParagraph","Properties":{"id":"20240623160612-27v3dp5","updated":"20240623160613"},"Children":[{"Type":"NodeText","Data":"总之，Doc Values 是Elasticsearch中用于优化查询效率，特别是针对排序和聚合操作的一种高效数据结构，它通过牺牲一定的磁盘空间来换取更高的性能和更低的内存使用。"}]}]}