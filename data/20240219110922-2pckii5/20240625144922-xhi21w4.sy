{"ID":"20240625144922-xhi21w4","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4a7","id":"20240625144922-xhi21w4","title":"JadeSlips","type":"doc","updated":"20240625150632"},"Children":[{"ID":"20240625144922-piphhmn","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240625144922-piphhmn","updated":"20240625145132"},"Children":[{"Type":"NodeText","Data":"技术栈"}]},{"ID":"20240625145132-whuj1vr","Type":"NodeTable","TableAligns":[0,0],"Properties":{"colgroup":"min-width: 60px;|min-width: 60px;","id":"20240625145132-whuj1vr","updated":"20240625145417"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"功能"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"实现"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"http框架"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"go-zero"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"rpc框架"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"go-zero"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"orm框架"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"gorm框架"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"数据库"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"MySQL、Redis"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对象存储"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Minio"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"服务发现与配置中心"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"etcd"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"链路追踪"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"jaeger"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"服务监控"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"prometheus、grafana"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"消息队列"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"kafka"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"日志搜索"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"filebeat、go-stash、elasticsearch、kibana"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"网关"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"traefik"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"部署"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Docker、docker-compose"}]}]}]},{"ID":"20240625145420-gcuienc","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240625145420-gcuienc","updated":"20240625145502"},"Children":[{"Type":"NodeText","Data":"微服务化"}]},{"ID":"20240625145504-8cportf","Type":"NodeParagraph","Properties":{"id":"20240625145504-8cportf","updated":"20240625145531"},"Children":[{"Type":"NodeText","Data":"使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go-zero"},{"Type":"NodeText","Data":"​框架，将整个项目拆分为五个服务："}]},{"ID":"20240625145532-3t63l6m","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240625145532-3t63l6m","updated":"20240625145549"},"Children":[{"Type":"NodeText","Data":"User 服务"}]},{"ID":"20240625145549-2yth56w","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145549-2yth56w","updated":"20240625145620"},"Children":[{"Type":"NodeText","Data":"手机短信一键注册登录"}]},{"ID":"20240625145622-1cyo4jv","Type":"NodeParagraph","Properties":{"id":"20240625145622-1cyo4jv","updated":"20240625145655"},"Children":[{"Type":"NodeText","Data":"外接腾讯云 SMS 服务，填写验证码后自动进行注册或者登录判断，免得先注册才能再登录，提高用户体验"}]},{"ID":"20240625145655-5qalqsh","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145655-5qalqsh","updated":"20240625145710"},"Children":[{"Type":"NodeText","Data":"格式和边界值的校验"}]},{"ID":"20240625145710-7jf93hl","Type":"NodeParagraph","Properties":{"id":"20240625145710-7jf93hl","updated":"20240625145719"},"Children":[{"Type":"NodeText","Data":"使用valiata包进行校验，并且加上中文翻译器，这样也不必进行繁琐的格式或者边界校验，自动返回翻译后的错误"}]},{"ID":"20240625145720-yu63az4","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145720-yu63az4","updated":"20240625145729"},"Children":[{"Type":"NodeText","Data":"github第三方登录"}]},{"ID":"20240625145729-5e1y23u","Type":"NodeParagraph","Properties":{"id":"20240625145729-5e1y23u","updated":"20240625145751"},"Children":[{"Type":"NodeText","Data":"使用 GitHub OAuth 进行第三方登录"}]},{"ID":"20240625145751-hmset0v","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240625145751-hmset0v","updated":"20240625145800"},"Children":[{"Type":"NodeText","Data":"Upload 服务"}]},{"ID":"20240625145800-3smvy6t","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145800-3smvy6t","updated":"20240625145810"},"Children":[{"Type":"NodeText","Data":"普通上传"}]},{"ID":"20240625145811-iuo9xkw","Type":"NodeParagraph","Properties":{"id":"20240625145811-iuo9xkw","updated":"20240625145833"},"Children":[{"Type":"NodeText","Data":"可以选择本地或者 minio 存储或者腾讯云 COS 进行存储"}]},{"ID":"20240625145833-c325q0e","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145833-c325q0e","updated":"20240625145902"},"Children":[{"Type":"NodeText","Data":"kafka 异步处理MySQL 存储文件元信息"}]},{"ID":"20240625145903-01m5px0","Type":"NodeParagraph","Properties":{"id":"20240625145903-01m5px0","updated":"20240625145910"},"Children":[{"Type":"NodeText","Data":"异步处理，可以让用户不用等待文件元信息存入mysql的所需的时间，提高用户体验。针对高并发场景，提高吞吐量。"}]},{"ID":"20240625145924-af7vze1","Type":"NodeList","ListData":{},"Properties":{"id":"20240625145924-af7vze1","updated":"20240625145924"},"Children":[{"ID":"20240625145924-3j0dayg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240625145924-3j0dayg","updated":"20240625145924"},"Children":[{"ID":"20240625145924-u5clo1x","Type":"NodeParagraph","Properties":{"id":"20240625145924-u5clo1x","updated":"20240625145924"},"Children":[{"Type":"NodeText","Data":"使用批量消息聚合提升kafka性能"}]}]}]},{"ID":"20240625145924-qwnf974","Type":"NodeParagraph","Properties":{"id":"20240625145924-qwnf974","updated":"20240625145924"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image20230708153904061"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"http://localhost:63342/markdownPreview/36201469/fileSchemeResource/5db552ecc4fe62b5991c96b429266322-image-20230708153904061.png?_ijt=5gtkuo1avvilrtmgkrl4a8clo9"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240625145924-g4dxcft","Type":"NodeParagraph","Properties":{"id":"20240625145924-g4dxcft","updated":"20240625145924"},"Children":[{"Type":"NodeText","Data":"之前每向kafka发送一条消息就会产生一次网络 IO 和一次磁盘 IO，做消息聚合后，比如聚合 100 条消息后再发送给 Kafka，这个时候 100 条消息才会产生一次网络 IO 和磁盘 IO，这样大大提高 Kafka 的吞吐和性能。并且有聚合时间兜底，就算消息数量达不到聚合要求，超过聚合最大时间也会聚合当前所有消息发送给Kafka"}]},{"ID":"20240625145926-klpaclc","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625145926-klpaclc","updated":"20240625145934"},"Children":[{"Type":"NodeText","Data":"妙传"}]},{"ID":"20240625145934-hq4q7z1","Type":"NodeParagraph","Properties":{"id":"20240625145934-hq4q7z1","updated":"20240625145944"},"Children":[{"Type":"NodeText","Data":"根据文件的sha1值判断，先从file表里面查出是否有该sha1值，如果有就只需要将file表里的file添加到对应userfile表里面就可以了，这样就实现了秒传的功能"}]},{"ID":"20240625150314-7vim6pb","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625150314-7vim6pb","updated":"20240625150328"},"Children":[{"Type":"NodeText","Data":"分块上传\u0026\u0026断点续传"}]},{"ID":"20240625150328-oy3lovq","Type":"NodeParagraph","Properties":{"id":"20240625150328-oy3lovq","updated":"20240625150335"},"Children":[{"Type":"NodeText","Data":"客户端将文件分成几份，每次一都上传一份，然后服务端接受客户端上传的分块文件存入本地，在redis中记录分块文件信息，等客户端上传完后调用服务端的接口，服务端校验文件分块已经上传成功后进行合并文件再上传到对应的存储，之后也使用kafka来异步处理文件元信息。断点续传就是查询之前上传过的分块，从未上传的分块开始继续传"}]},{"ID":"20240625150336-pjrkw50","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240625150336-pjrkw50","updated":"20240625150347"},"Children":[{"Type":"NodeText","Data":"download 服务"}]},{"ID":"20240625150347-zq4koxm","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625150347-zq4koxm","updated":"20240625150405"},"Children":[{"Type":"NodeText","Data":"腾讯云COS 下载"}]},{"ID":"20240625150405-onypcoq","Type":"NodeParagraph","Properties":{"id":"20240625150405-onypcoq","updated":"20240625150405"},"Children":[{"Type":"NodeText","Data":"利用官方SDK进行分块下载到本地，然后返回文件给客户端"}]},{"ID":"20240625150428-i3jqbzn","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240625150428-i3jqbzn","updated":"20240625150441"},"Children":[{"Type":"NodeText","Data":"Minio 下载"}]},{"ID":"20240625150441-hvepyid","Type":"NodeParagraph","Properties":{"id":"20240625150441-hvepyid","updated":"20240625150524"},"Children":[{"Type":"NodeText","Data":"实现了并发从minio下载分块文件，下载所有分块后进行合并分块返回合并后的文件给客户端"}]},{"ID":"20240625150524-uue7ayy","Type":"NodeParagraph","Properties":{"id":"20240625150524-uue7ayy","updated":"20240625150524"}},{"ID":"20240625150526-fw2kd1q","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240625150526-fw2kd1q","updated":"20240625150530"},"Children":[{"Type":"NodeText","Data":"transfer 服务"}]},{"ID":"20240625150531-e7lafjp","Type":"NodeParagraph","Properties":{"id":"20240625150531-e7lafjp","updated":"20240625150612"},"Children":[{"Type":"NodeText","Data":"通过将消息随机发到多个goroutine 中来并发消费数据，再将消费的文件元信息写入MySQL"}]},{"ID":"20240625150612-3uf2e23","Type":"NodeParagraph","Properties":{"id":"20240625150612-3uf2e23","updated":"20240625150612"}},{"ID":"20240625150613-pq7c4n4","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240625150613-pq7c4n4","updated":"20240625150617"},"Children":[{"Type":"NodeText","Data":"filemeta 服务"}]},{"ID":"20240625150618-01f6yc8","Type":"NodeParagraph","Properties":{"id":"20240625150618-01f6yc8","updated":"20240625150631"},"Children":[{"Type":"NodeText","Data":"提供文件元数据相关操作"}]},{"ID":"20240625150632-4gdqq8v","Type":"NodeParagraph","Properties":{"id":"20240625150632-4gdqq8v","updated":"20240625150632"}}]}