{"ID":"20240307204848-6ao3ba3","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f6b0","id":"20240307204848-6ao3ba3","title":"大文件上传原理及实现方案","updated":"20240307213131"},"Children":[{"ID":"20240307204905-x5k6w7f","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240307204905-x5k6w7f","updated":"20240307204926"},"Children":[{"Type":"NodeText","Data":"大文件的定义"}]},{"ID":"20240307204927-8cmlq91","Type":"NodeParagraph","Properties":{"id":"20240307204927-8cmlq91","updated":"20240307205007"},"Children":[{"Type":"NodeText","Data":"我们传送大文件是指传送大于100M的文件，而普通文件是指小于100M，常见的是20M、30M和50M，两者主要的区别在于文件大小上，还有传送速度上。"}]},{"ID":"20240307205008-eaaif4c","Type":"NodeParagraph","Properties":{"id":"20240307205008-eaaif4c","updated":"20240307205014"},"Children":[{"Type":"NodeText","Data":"一般普通“邮件附件”只能发20M、30M，50M的文件，而几百M的照片、文件、设计图等大文件传送起来就不是那么容易了。"}]},{"ID":"20240307205015-vdhw845","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240307205015-vdhw845","updated":"20240307205034"},"Children":[{"Type":"NodeText","Data":"大文件和普通文件上传时的区别"}]},{"ID":"20240307205034-6egxvcu","Type":"NodeParagraph","Properties":{"id":"20240307205034-6egxvcu","updated":"20240307205240"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"普通文件上传只需要注意两点"},{"Type":"NodeText","Data":"："}]},{"ID":"20240307205053-7dp1b9y","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307205053-7dp1b9y","updated":"20240307205054"},"Children":[{"ID":"20240307205054-xxhv15j","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307205054-xxhv15j","updated":"20240307205054"},"Children":[{"ID":"20240307205054-wdltofw","Type":"NodeParagraph","Properties":{"id":"20240307205054-wdltofw","updated":"20240307205101"},"Children":[{"Type":"NodeText","Data":"指定上传的接口地址。"}]}]},{"ID":"20240307205101-t5t6u63","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307205101-t5t6u63"},"Children":[{"ID":"20240307205101-wj3fuvj","Type":"NodeParagraph","Properties":{"id":"20240307205101-wj3fuvj","updated":"20240307205150"},"Children":[{"Type":"NodeText","Data":"将请求头的Content-Type 设置为： "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"multipart/form-data"},{"Type":"NodeText","Data":"​，将文件对象以二进制流的形式传给后端。"}]}]}]},{"ID":"20240307205150-hnpcjiq","Type":"NodeParagraph","Properties":{"id":"20240307205150-hnpcjiq","updated":"20240307205236"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"大文件上传时会遇到的问题"}]},{"ID":"20240307205242-qeytyxc","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307205242-qeytyxc","updated":"20240307205243"},"Children":[{"ID":"20240307205243-geikev4","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307205243-geikev4","updated":"20240307205243"},"Children":[{"ID":"20240307205243-5367oe0","Type":"NodeParagraph","Properties":{"id":"20240307205243-5367oe0","updated":"20240307205313"},"Children":[{"Type":"NodeText","Data":"前后端上传请求超时限制，一次性传输大小限制；"}]}]},{"ID":"20240307205314-u65kefd","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307205314-u65kefd"},"Children":[{"ID":"20240307205314-yvqby99","Type":"NodeParagraph","Properties":{"id":"20240307205314-yvqby99","updated":"20240307205329"},"Children":[{"Type":"NodeText","Data":"网络抖动等，失败后需要重新上传"}]}]},{"ID":"20240307205330-f13ywyr","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240307205330-f13ywyr"},"Children":[{"ID":"20240307205330-o43wew3","Type":"NodeParagraph","Properties":{"id":"20240307205330-o43wew3","updated":"20240307205516"},"Children":[{"Type":"NodeText","Data":"http1.1 版本，TCP连接默认是Open的，所有请求都通过同一个连接进行数据传输，如果前面的请求被阻塞了，后面的请求也得不到响应，也叫HTTP/1.1 中的队头阻塞问题，除非建立多个连接，但是多个连接会浪费资源"}]}]},{"ID":"20240307205516-3bvo0uf","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240307205516-3bvo0uf"},"Children":[{"ID":"20240307205516-vtap65a","Type":"NodeParagraph","Properties":{"id":"20240307205516-vtap65a","updated":"20240307205525"},"Children":[{"Type":"NodeText","Data":"无进度条，用户体验极差"}]}]}]},{"ID":"20240307205525-gjs4ofq","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240307205525-gjs4ofq","updated":"20240307205544"},"Children":[{"Type":"NodeText","Data":"大文件上传的原理及思路"}]},{"ID":"20240307205925-z5bpyfx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240307205925-z5bpyfx","updated":"20240307205925"},"Children":[{"Type":"NodeText","Data":"前端"}]},{"ID":"20240307205551-jlzpqc5","Type":"NodeParagraph","Properties":{"id":"20240307205551-jlzpqc5","updated":"20240307205925"},"Children":[{"Type":"NodeText","Data":"获取文件的二进制内容，然后对其内容拆分成指定大小的切片文件，最后将每个切片上传到服务端即可。"}]},{"ID":"20240307205610-ownok5o","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307205610-ownok5o","updated":"20240307210050"},"Children":[{"Type":"NodeText","Data":"流程"}]},{"ID":"20240307205614-v3mek04","Type":"NodeBlockquote","Properties":{"id":"20240307205614-v3mek04","updated":"20240307210050"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240307205615-bgphpp3","Type":"NodeParagraph","Properties":{"id":"20240307205615-bgphpp3","updated":"20240307205634"},"Children":[{"Type":"NodeText","Data":"获取文件 -\u003e 分片 -\u003e 上传"}]}]},{"ID":"20240307204848-h0dm11q","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307204848-h0dm11q","updated":"20240307210052"},"Children":[{"Type":"NodeText","Data":"需要优化的点"}]},{"ID":"20240307205645-bhpy9w4","Type":"NodeList","ListData":{},"Properties":{"id":"20240307205645-bhpy9w4","updated":"20240307210052"},"Children":[{"ID":"20240307205647-d1jgcn2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307205647-d1jgcn2","updated":"20240307205846"},"Children":[{"ID":"20240307205647-pjqdtxw","Type":"NodeParagraph","Properties":{"id":"20240307205647-pjqdtxw","updated":"20240307205846"},"Children":[{"Type":"NodeText","Data":"中断后无需重新上传（断点续传）"}]}]},{"ID":"20240307205719-1c5dxwh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307205719-1c5dxwh"},"Children":[{"ID":"20240307205719-95pv4yr","Type":"NodeParagraph","Properties":{"id":"20240307205719-95pv4yr","updated":"20240307205750"},"Children":[{"Type":"NodeText","Data":"上传过的文件无需上传（秒传）"}]}]},{"ID":"20240307205751-ailwxkq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307205751-ailwxkq","updated":"20240307205758"},"Children":[{"ID":"20240307205751-8bezrh9","Type":"NodeParagraph","Properties":{"id":"20240307205751-8bezrh9","updated":"20240307205758"},"Children":[{"Type":"NodeText","Data":"显示上传进度"}]}]}]},{"ID":"20240307205918-vjnyhgr","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240307205918-vjnyhgr","updated":"20240307205921"},"Children":[{"Type":"NodeText","Data":"后端"}]},{"ID":"20240307205930-x0l0qr7","Type":"NodeParagraph","Properties":{"id":"20240307205930-x0l0qr7","updated":"20240307205944"},"Children":[{"Type":"NodeText","Data":"根据切片文件的唯一标识在后端将多个相同文件的切片还原成一个文件"}]},{"ID":"20240307205947-flejs29","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307205947-flejs29","updated":"20240307210046"},"Children":[{"Type":"NodeText","Data":"流程"}]},{"ID":"20240307210005-13jxhfe","Type":"NodeBlockquote","Properties":{"id":"20240307210005-13jxhfe","updated":"20240307210046"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240307210006-4fz9r2b","Type":"NodeParagraph","Properties":{"id":"20240307210006-4fz9r2b","updated":"20240307210031"},"Children":[{"Type":"NodeText","Data":"获取分片文件 -\u003e 还原分片 -\u003e 返回拼接好的信息"}]}]},{"ID":"20240307210033-oi1r4u4","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307210033-oi1r4u4","updated":"20240307210041"},"Children":[{"Type":"NodeText","Data":"需要优化的点"}]},{"ID":"20240307210042-czz0w5n","Type":"NodeList","ListData":{},"Properties":{"id":"20240307210042-czz0w5n","updated":"20240307210058"},"Children":[{"ID":"20240307210058-dg6im10","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307210058-dg6im10","updated":"20240307210058"},"Children":[{"ID":"20240307210058-dz4bsy9","Type":"NodeParagraph","Properties":{"id":"20240307210058-dz4bsy9","updated":"20240307210103"},"Children":[{"Type":"NodeText","Data":"删除碎片文件"}]}]}]},{"ID":"20240307210113-zyslmt0","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307210113-zyslmt0","updated":"20240307210124"},"Children":[{"Type":"NodeText","Data":"还原切片时需要注意的问题"}]},{"ID":"20240307210124-yrkvvcz","Type":"NodeList","ListData":{},"Properties":{"id":"20240307210124-yrkvvcz","updated":"20240307210126"},"Children":[{"ID":"20240307210126-sfmd0hc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307210126-sfmd0hc","updated":"20240307210126"},"Children":[{"ID":"20240307210126-ro18155","Type":"NodeParagraph","Properties":{"id":"20240307210126-ro18155","updated":"20240307210201"},"Children":[{"Type":"NodeText","Data":"在后端需要将多个相同文件切片还原成一个文件，如果不能识别一个切片是属于哪一个文件的，当同时发生多个请求时，追加的文件内容会出错。"}]}]},{"ID":"20240307210202-x6u86bm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240307210202-x6u86bm"},"Children":[{"ID":"20240307210202-rzb3bl9","Type":"NodeParagraph","Properties":{"id":"20240307210202-rzb3bl9","updated":"20240307210208"},"Children":[{"Type":"NodeText","Data":"切片上传接口是异步的，无法保证服务器接收到的切片是按照请求顺序拼接的。 解决办法"}]}]}]},{"ID":"20240307210209-ehtajq2","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307210209-ehtajq2","updated":"20240307211858"},"Children":[{"ID":"20240307210225-ahthpza","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307210225-ahthpza","updated":"20240307211858"},"Children":[{"ID":"20240307210225-d972m5o","Type":"NodeParagraph","Properties":{"id":"20240307210225-d972m5o","updated":"20240307211858"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如何识别多个切片是来自于同一个文件的？"}]}]}]},{"ID":"20240307210234-hw0su8w","Type":"NodeParagraph","Properties":{"id":"20240307210234-hw0su8w","updated":"20240307210239"},"Children":[{"Type":"NodeText","Data":"这个可以在发送请求时，为每个切片传递一个相同文件的identifier参数。"}]},{"ID":"20240307210240-211151w","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307210240-211151w","updated":"20240307211854"},"Children":[{"ID":"20240307210241-afn9vgb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307210241-afn9vgb","updated":"20240307211854"},"Children":[{"ID":"20240307210241-68os41z","Type":"NodeParagraph","Properties":{"id":"20240307210241-68os41z","updated":"20240307211854"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如何将多个切片还原成一个文件？"}]}]}]},{"ID":"20240307210253-rmk8qm0","Type":"NodeParagraph","Properties":{"id":"20240307210253-rmk8qm0","updated":"20240307210253"},"Children":[{"Type":"NodeText","Data":"什么时候开始拼接：确认所有切片都已上传完后开始进行拼接，这个可以通过客户端在切片全部上传后调用后端定义的mkfile接口来通知服务端进行拼接，或者前端传递切片的总数totalChunks, 服务端判断接收的切片数量如果等于totalChunks的值就开始进行拼接，无须前端通知后端进行拼接。"}]},{"ID":"20240307210253-re16i4w","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307210253-re16i4w","updated":"20240307211852"},"Children":[{"ID":"20240307210410-fv4sp0a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240307210410-fv4sp0a","updated":"20240307211852"},"Children":[{"ID":"20240307210410-c6xmkxe","Type":"NodeParagraph","Properties":{"id":"20240307210410-c6xmkxe","updated":"20240307211852"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"怎么按顺序拼接"}]}]}]},{"ID":"20240307210415-2yjasnv","Type":"NodeParagraph","Properties":{"id":"20240307210415-2yjasnv","updated":"20240307211901"},"Children":[{"Type":"NodeText","Data":"可以在每个切片上标记一个位置索引值，找到同一个context下的所有切片，根据chunkNumber确认每个切片的顺序，这个按顺序拼接切片，还原成文件;"}]},{"ID":"20240307211902-jx8nbwf","Type":"NodeParagraph","Properties":{"id":"20240307211902-jx8nbwf","updated":"20240307211953"},"Children":[{"Type":"NodeText","Data":"上面有几个重要的参数："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"identifier"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"chunkNumber"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"totalChunks"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20240307212000-de5jc35","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240307212000-de5jc35","updated":"20240307212024"},"Children":[{"Type":"NodeText","Data":"indentifier"}]},{"ID":"20240307212025-tw59fn6","Type":"NodeParagraph","Properties":{"id":"20240307212025-tw59fn6","updated":"20240307212030"},"Children":[{"Type":"NodeText","Data":"我们需要获取为一个文件的唯一标识，可以通过下面两种方式获取"}]},{"ID":"20240307212031-ktg5zs0","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307212031-ktg5zs0","updated":"20240307212033"},"Children":[{"ID":"20240307212033-4wr6p6h","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307212033-4wr6p6h","updated":"20240307212033"},"Children":[{"ID":"20240307212033-imqiqwn","Type":"NodeParagraph","Properties":{"id":"20240307212033-imqiqwn","updated":"20240307212134"},"Children":[{"Type":"NodeText","Data":"根据文件名、文件长度信息等基本信息进行拼接，为了避免多个用户上传相同的文件，可以再额外拼接用户信息，如uid等保证唯一性；"}]}]},{"ID":"20240307212134-axo102z","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307212134-axo102z"},"Children":[{"ID":"20240307212134-r2gzp6q","Type":"NodeParagraph","Properties":{"id":"20240307212134-r2gzp6q","updated":"20240307212227"},"Children":[{"Type":"NodeText","Data":"根据文件的二进制内容计算文件的hash，这样只要文件内容不一样，则标识也会不一样，缺点就在于计算量比较大；"}]}]}]},{"ID":"20240307212227-2lx0lgn","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240307212227-2lx0lgn","updated":"20240307212252"},"Children":[{"Type":"NodeText","Data":"chunkNumber 当前切片的索引"}]},{"ID":"20240307212253-nr6m303","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240307212253-nr6m303","updated":"20240307212317"},"Children":[{"Type":"NodeText","Data":"totalChunks 总的切片数"}]},{"ID":"20240307212318-uk93vip","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240307212318-uk93vip","updated":"20240307212338"},"Children":[{"Type":"NodeText","Data":"大文件上传的实现方案 "}]},{"ID":"20240307212350-kw0on0b","Type":"NodeParagraph","Properties":{"id":"20240307212350-kw0on0b"}},{"ID":"20240307212354-c5zwflm","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240307212354-c5zwflm","updated":"20240307212403"},"Children":[{"Type":"NodeText","Data":"断点续传"}]},{"ID":"20240307212423-1rx5vjk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307212423-1rx5vjk","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"为什么需要断点续传？"}]},{"ID":"20240307212423-xyuscb8","Type":"NodeParagraph","Properties":{"id":"20240307212423-xyuscb8","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"即使将大文件拆分成切片上传，我们仍需等待所有切片上传完毕，在等待过程中，可能发生一系列导致部分切片上传失败的情形，如网络故障、页面关闭等。由于切片未全部上传，因此无法通知服务端合成文件。这种情况下可以通过断点续传来进行处理。"}]},{"ID":"20240307212423-65r2cri","Type":"NodeParagraph","Properties":{"id":"20240307212423-65r2cri","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"断点续传指的是：可以从已经上传部分开始继续上传未完成的部分，而没有必要从头开始上传，节省上传时间。 怎么实现断点续传？"}]},{"ID":"20240307212423-8q40oy4","Type":"NodeParagraph","Properties":{"id":"20240307212423-8q40oy4","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"由于整个上传过程是按切片维度进行的，且mkfile接口是在所有切片上传完成后由客户端主动调用的，因此断点续传的实现也十分简单："}]},{"ID":"20240307212423-a761xdn","Type":"NodeParagraph","Properties":{"id":"20240307212423-a761xdn","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"在切片上传成功后，保存已上传的切片信息"}]},{"ID":"20240307212423-r8o2sj4","Type":"NodeParagraph","Properties":{"id":"20240307212423-r8o2sj4","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"当下次传输相同文件时，遍历切片列表，只选择未上传的切片进行上传"}]},{"ID":"20240307212423-c4zzz2s","Type":"NodeParagraph","Properties":{"id":"20240307212423-c4zzz2s","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"所有切片上传完毕后，再调用mkfile接口通知服务端进行文件合并"}]},{"ID":"20240307212423-ux3hcvu","Type":"NodeParagraph","Properties":{"id":"20240307212423-ux3hcvu","updated":"20240307212423"},"Children":[{"Type":"NodeText","Data":"因此问题就落在了如何保存已上传切片的信息了，保存一般有两种策略"}]},{"ID":"20240307212423-k38oda8","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307212423-k38oda8","updated":"20240307212423"},"Children":[{"ID":"20240307212443-dxsifr3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307212443-dxsifr3","updated":"20240307212503"},"Children":[{"ID":"20240307212443-t2tqro6","Type":"NodeParagraph","Properties":{"id":"20240307212443-t2tqro6","updated":"20240307212503"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以通过locaStorage等方式保存在前端浏览器中，这种方式不依赖于服务端，实现起来也比较方便，缺点在于如果用户清除了本地文件，会导致上传记录丢失"}]}]}]},{"ID":"20240307212423-rx98vks","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307212423-rx98vks","updated":"20240307212423"},"Children":[{"ID":"20240307212446-yn78zjs","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307212446-yn78zjs","updated":"20240307212507"},"Children":[{"ID":"20240307212446-j6wo2v8","Type":"NodeParagraph","Properties":{"id":"20240307212446-j6wo2v8","updated":"20240307212507"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"服务端本身知道哪些切片已经上传，因此可以由服务端额外提供一个根据文件context查询已上传切片的接口，在上传文件前调用该文件的历史上传记录 前端断点续传代码"}]}]}]},{"ID":"20240307212507-lwj7zd9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307212507-lwj7zd9","updated":"20240307212616"},"Children":[{"Type":"NodeText","Data":"清除切片的时机"}]},{"ID":"20240307212617-jpr3aua","Type":"NodeParagraph","Properties":{"id":"20240307212617-jpr3aua","updated":"20240307212616"},"Children":[{"Type":"NodeText","Data":"此外断点续传还需要考虑切片过期的情况"}]},{"ID":"20240307212849-c6ad1zw","Type":"NodeParagraph","Properties":{"id":"20240307212849-c6ad1zw","updated":"20240307212616"},"Children":[{"Type":"NodeText","Data":"如果调用了mkfile接口，则磁盘上的切片内容就可以清除掉了，如果客户端一直不调用mkfile的接口，放任这些切片一直保存在磁盘显然是不可靠的，一般情况下，切片上传都有一段时间的有效期，超过该有效期，就会被清除掉。基于上述原因，断点续传也必须同步切片过期的实现逻辑。"}]},{"ID":"20240307212849-arsxb4n","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240307212849-arsxb4n","updated":"20240307212917"},"Children":[{"Type":"NodeText","Data":"秒传"}]},{"ID":"20240307212919-i1ul24d","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240307212919-i1ul24d","updated":"20240307212930"},"Children":[{"Type":"NodeText","Data":"什么是秒传"}]},{"ID":"20240307212930-b4glpvf","Type":"NodeParagraph","Properties":{"id":"20240307212930-b4glpvf","updated":"20240307212944"},"Children":[{"Type":"NodeText","Data":"已经上传过的文件，并且在后端已经拼接完成，如果再次上传的话后端不做处理，直接返回拼接好的文件的信息即可"}]},{"ID":"20240307212946-crjaehx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240307212946-crjaehx","updated":"20240307213005"},"Children":[{"Type":"NodeText","Data":"上传进度和暂停"}]},{"ID":"20240307213005-o9a5rhy","Type":"NodeParagraph","Properties":{"id":"20240307213005-o9a5rhy","updated":"20240307213015"},"Children":[{"Type":"NodeText","Data":"监控每一个切片上传进度"}]},{"ID":"20240307213016-137ekjq","Type":"NodeParagraph","Properties":{"id":"20240307213016-137ekjq","updated":"20240307213025"},"Children":[{"Type":"NodeText","Data":"上传暂停的实现也比较简单，通过xhr.abort可以取消当前未完成上传切片的上传，实现上传暂停的效果，恢复上传就跟断点续传类似，先获取已上传的切片列表，然后重新发送未上传的切片。"}]},{"ID":"20240307213026-8orzqns","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240307213026-8orzqns","updated":"20240307213050"},"Children":[{"Type":"NodeText","Data":"目前成熟的大文件上传方案"}]},{"ID":"20240307213050-7l0qcl6","Type":"NodeParagraph","Properties":{"id":"20240307213050-7l0qcl6","updated":"20240307213123"},"Children":[{"Type":"NodeText","Data":"推荐的前端vue 组件： "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"vue-simple-uploader"},{"Type":"NodeText","Data":"​，支持 vue2，vue3"}]},{"ID":"20240307213131-8qfpujs","Type":"NodeParagraph","Properties":{"id":"20240307213131-8qfpujs","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"vue-simple-uploader是基于simple-Uploader.js封装的大文件上传组件，具有以下优点："}]},{"ID":"20240307213131-qlqndeo","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240307213131-qlqndeo","updated":"20240307213131"},"Children":[{"ID":"20240307213131-2a2wglg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240307213131-2a2wglg","updated":"20240307213131"},"Children":[{"ID":"20240307213131-ua13mmi","Type":"NodeParagraph","Properties":{"id":"20240307213131-ua13mmi","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"支持单文件、多文件、文件夹上传；支持拖拽文件、文件夹上传"}]}]},{"ID":"20240307213131-bmceoo9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240307213131-bmceoo9","updated":"20240307213131"},"Children":[{"ID":"20240307213131-gefji4r","Type":"NodeParagraph","Properties":{"id":"20240307213131-gefji4r","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"可暂停、继续上传"}]}]},{"ID":"20240307213131-xdn2coe","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240307213131-xdn2coe","updated":"20240307213131"},"Children":[{"ID":"20240307213131-3ihz6k9","Type":"NodeParagraph","Properties":{"id":"20240307213131-3ihz6k9","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"错误处理"}]}]},{"ID":"20240307213131-av8byzo","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240307213131-av8byzo","updated":"20240307213131"},"Children":[{"ID":"20240307213131-1dbfvr2","Type":"NodeParagraph","Properties":{"id":"20240307213131-1dbfvr2","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"支持“秒传”，通过文件判断服务端是否已存在从而实现“秒传”"}]}]},{"ID":"20240307213131-jdxml6k","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20240307213131-jdxml6k","updated":"20240307213131"},"Children":[{"ID":"20240307213131-l5tlz7j","Type":"NodeParagraph","Properties":{"id":"20240307213131-l5tlz7j","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"分块上传"}]}]},{"ID":"20240307213131-fm765u4","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20240307213131-fm765u4","updated":"20240307213131"},"Children":[{"ID":"20240307213131-u2tiqip","Type":"NodeParagraph","Properties":{"id":"20240307213131-u2tiqip","updated":"20240307213131"},"Children":[{"Type":"NodeText","Data":"支持进度、预估剩余时间、出错自动重试、重传等操作"}]}]}]}]}