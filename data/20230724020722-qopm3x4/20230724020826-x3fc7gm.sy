{"ID":"20230724020826-x3fc7gm","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1fa84","id":"20230724020826-x3fc7gm","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230724020826-x3fc7gm\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230724020833-778m568\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230724020955-1tg17jg\u0026quot;,\u0026quot;scrollTop\u0026quot;:500\u0026#125;","tags":"Dockerfile","title":"Dockerfile详解","updated":"20230724020955"},"Children":[{"ID":"20230724020833-778m568","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020833-778m568","updated":"20230724020853"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"ZG9ja2VyZmlsZQ=="},{"Type":"NodeCodeBlockCode","Data":"# dockerfile 分为四部分：基础镜像信息，维护者信息，镜像操作指令和容器启动时执行的指令\n\nFROM golang:1.16-alpine AS builder\n#基础镜像信息\nWORKDIR /usr/src/wire-controller\n#配置工作目录\nCOPY ./go.mod /usr/src/wire-controller/\n# 复制指定的\u003cscr\u003e路径下的内容到容器中的\u003cdest\u003e 路径下，\u003csrc\u003e可以为URL；如果为tar 文件，会自动解压到\u003cdest\u003e 路径下\nCOPY ./go.sum /usr/src/wire-controller/\n\nENV GOPROXY=https://goproxy.cn,direct CGO_ENABLED=0\n# 指定环境变量\nRUN go mod download\n# 运行命令\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories \u0026\u0026 \\\n  apk add --no-cache ca-certificates tzdata\n\nCOPY . /usr/src/wire-controller/\n\nRUN go build -tags netgo -ldflags \"-s -w\" -o wire-controller\n\nFROM alpine as runner\n# 指定所创建镜像的基础镜像\nCOPY --from=builder /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n\nCOPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\n\nCOPY --from=builder /usr/src/wire-controller /opt/app/\n\nCMD [\"/opt/app/wire-controller\",\"-url=http://e-con-01:8500\",\"-token=77fd441e-2e8a-a433-4a3a-acf66a3dc68b\"]\n#指定启动容器时默认执行的m\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-5z45hml","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230724020955-5z45hml","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"Dockerfile文件全面详解"}]},{"ID":"20230724020955-chfdedk","Type":"NodeParagraph","Properties":{"id":"20230724020955-chfdedk","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 可以通过读取 Dockerfile 中的指令自动构建镜像。 Dockerfile 是一个文本文档，其中包含了用户创建镜像的所有命令和说明。"}]},{"ID":"20230724020955-j88hk03","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-j88hk03","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"一、 变量"}]},{"ID":"20230724020955-ieisqqa","Type":"NodeParagraph","Properties":{"id":"20230724020955-ieisqqa","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**变量用 **"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"$variable_name"},{"Type":"NodeText","Data":" 或者 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"${variable_name}"},{"Type":"NodeText","Data":" 表示"}]},{"ID":"20230724020955-4sowwf8","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-4sowwf8","updated":"20230724020955"},"Children":[{"ID":"20230724020955-5axt376","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-5axt376","updated":"20230724020955"},"Children":[{"ID":"20230724020955-q3117bn","Type":"NodeParagraph","Properties":{"id":"20230724020955-q3117bn","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"${variable:-word}"},{"Type":"NodeText","Data":"​表示如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"variable"},{"Type":"NodeText","Data":"​设置，则结果将是该值。如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"variable"},{"Type":"NodeText","Data":"​未设置，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"word"},{"Type":"NodeText","Data":"​则将是结果。"}]}]},{"ID":"20230724020955-rqfuww2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-rqfuww2","updated":"20230724020955"},"Children":[{"ID":"20230724020955-4rfmlu5","Type":"NodeParagraph","Properties":{"id":"20230724020955-4rfmlu5","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"${variable:+word}"},{"Type":"NodeText","Data":"​表示如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"variable"},{"Type":"NodeText","Data":"​设置则为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"word"},{"Type":"NodeText","Data":"​结果，否则为空字符串。"}]}]}]},{"ID":"20230724020955-1zt98it","Type":"NodeParagraph","Properties":{"id":"20230724020955-1zt98it","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**变量前加 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\"},{"Type":"NodeText","Data":"​ 可以转义成普通字符串："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\$foo"},{"Type":"NodeText","Data":"​or"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\${foo}"},{"Type":"NodeText","Data":"​，表示转换为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$foo"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"${foo}"},{"Type":"NodeText","Data":"​文字。"}]},{"ID":"20230724020955-kkyz3l7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-kkyz3l7","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"二、FROM"}]},{"ID":"20230724020955-t9fydgz","Type":"NodeParagraph","Properties":{"id":"20230724020955-t9fydgz","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"初始化一个新的构建阶段，并设置基础映像："}]},{"ID":"20230724020955-qpf2i0r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-qpf2i0r","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM [--platform=\u003cplatform\u003e] \u003cimage\u003e [AS \u003cname\u003e]\nFROM [--platform=\u003cplatform\u003e] \u003cimage\u003e[:\u003ctag\u003e] [AS \u003cname\u003e]\nFROM [--platform=\u003cplatform\u003e] \u003cimage\u003e[@\u003cdigest\u003e] [AS \u003cname\u003e]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-3oupw5j","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-3oupw5j","updated":"20230724020955"},"Children":[{"ID":"20230724020955-xpvickf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-xpvickf","updated":"20230724020955"},"Children":[{"ID":"20230724020955-gvngqj4","Type":"NodeParagraph","Properties":{"id":"20230724020955-gvngqj4","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**单个dockfile可以多次出现 **"},{"Type":"NodeTextMark","TextMarkType":"em strong","TextMarkTextContent":"FROM ，"},{"Type":"NodeText","Data":"以使用之前的构建阶段作为另一个构建阶段的依赖项"}]}]},{"ID":"20230724020955-lj2fqec","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-lj2fqec","updated":"20230724020955"},"Children":[{"ID":"20230724020955-aj52gvn","Type":"NodeParagraph","Properties":{"id":"20230724020955-aj52gvn","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AS name"},{"Type":"NodeText","Data":"​表示为构建阶段命名，在后续"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY --from=\u0026lt;name\u0026gt;"},{"Type":"NodeText","Data":"​说明中可以使用这个名词，引用此阶段构建的映像"}]}]},{"ID":"20230724020955-wortzeg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-wortzeg","updated":"20230724020955"},"Children":[{"ID":"20230724020955-quv9tgu","Type":"NodeParagraph","Properties":{"id":"20230724020955-quv9tgu","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"digest"},{"Type":"NodeText","Data":"​其实就是就是根据镜像内容产生的一个ID，只要镜像的内容不变digest也不会变"}]}]},{"ID":"20230724020955-oxdhx74","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-oxdhx74","updated":"20230724020955"},"Children":[{"ID":"20230724020955-xq8sxvq","Type":"NodeParagraph","Properties":{"id":"20230724020955-xq8sxvq","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tag"},{"Type":"NodeText","Data":"​或"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"digest"},{"Type":"NodeText","Data":"​值是可选的。如果您省略其中任何一个，构建器默认使用一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"latest"},{"Type":"NodeText","Data":"​标签。如果找不到该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"tag"},{"Type":"NodeText","Data":"​值，构建器将返回错误。"}]}]},{"ID":"20230724020955-6n6be12","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-6n6be12","updated":"20230724020955"},"Children":[{"ID":"20230724020955-bv7jmez","Type":"NodeParagraph","Properties":{"id":"20230724020955-bv7jmez","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--platform"},{"Type":"NodeText","Data":"​标志可用于在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FROM"},{"Type":"NodeText","Data":"​引用多平台镜像的情况下指定平台。例如，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"linux/amd64"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"linux/arm64"},{"Type":"NodeText","Data":"​、 或"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"windows/amd64"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20230724020955-ao3r6pf","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-ao3r6pf","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"三、RUN"}]},{"ID":"20230724020955-apmb5pt","Type":"NodeParagraph","Properties":{"id":"20230724020955-apmb5pt","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"将在当前镜像之上的新层中执行命令，在 docker build时运行"}]},{"ID":"20230724020955-4vviwq2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-4vviwq2","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"RUN /bin/bash -c 'source $HOME/.bashrc; \\\necho $HOME'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-7qyp5do","Type":"NodeParagraph","Properties":{"id":"20230724020955-7qyp5do","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"RUN有两种形式："}]},{"ID":"20230724020955-8vj1vqq","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-8vj1vqq","updated":"20230724020955"},"Children":[{"ID":"20230724020955-ygufged","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-ygufged","updated":"20230724020955"},"Children":[{"ID":"20230724020955-7bibdja","Type":"NodeParagraph","Properties":{"id":"20230724020955-7bibdja","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN \u0026lt;command\u0026gt;"},{"Type":"NodeText","Data":"​（"},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":" 形式，命令在 shell 中运行，默认"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/bin/sh -c"},{"Type":"NodeText","Data":"​在 Linux 或"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"cmd /S /C"},{"Type":"NodeText","Data":"​Windows 上）"}]}]},{"ID":"20230724020955-173qx5y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-173qx5y","updated":"20230724020955"},"Children":[{"ID":"20230724020955-hfa5t7i","Type":"NodeParagraph","Properties":{"id":"20230724020955-hfa5t7i","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN [\u0026quot;executable\u0026quot;, \u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;]"},{"Type":"NodeText","Data":"​（"},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"执行"},{"Type":"NodeText","Data":"形式）"}]}]}]},{"ID":"20230724020955-n7o1gcv","Type":"NodeParagraph","Properties":{"id":"20230724020955-n7o1gcv","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"说明："}]},{"ID":"20230724020955-civ8o7p","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-civ8o7p","updated":"20230724020955"},"Children":[{"ID":"20230724020955-54yfhyb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-54yfhyb","updated":"20230724020955"},"Children":[{"ID":"20230724020955-myxeja3","Type":"NodeParagraph","Properties":{"id":"20230724020955-myxeja3","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\"},{"Type":"NodeText","Data":"​（反斜杠）将单个 RUN 指令延续到下一行"}]}]},{"ID":"20230724020955-as0zn1r","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-as0zn1r","updated":"20230724020955"},"Children":[{"ID":"20230724020955-9l9znoi","Type":"NodeParagraph","Properties":{"id":"20230724020955-9l9znoi","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​在下一次构建期间，指令缓存不会自动失效。可以使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--no-cache"},{"Type":"NodeText","Data":"​标志使指令缓存无效"}]}]},{"ID":"20230724020955-ef5e284","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-ef5e284","updated":"20230724020955"},"Children":[{"ID":"20230724020955-fiy237e","Type":"NodeParagraph","Properties":{"id":"20230724020955-fiy237e","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大，可以使用****\u0026amp;\u0026amp;"},{"Type":"NodeText","Data":"符号连接命令，这样执行后，只会创建 1 层镜像"}]}]}]},{"ID":"20230724020955-vy5ee6j","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-vy5ee6j","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"四、CMD"}]},{"ID":"20230724020955-ga07730","Type":"NodeParagraph","Properties":{"id":"20230724020955-ga07730","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行程序，在docker run 时运行，但是和run命令不同，RUN 是在 docker build时运行"}]},{"ID":"20230724020955-vddl7ng","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-vddl7ng","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM ubuntu\nCMD [\"/usr/bin/wc\",\"--help\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-cwju1wa","Type":"NodeParagraph","Properties":{"id":"20230724020955-cwju1wa","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"支持三种格式"}]},{"ID":"20230724020955-s00nhkz","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-s00nhkz","updated":"20230724020955"},"Children":[{"ID":"20230724020955-vmdgnuv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-vmdgnuv","updated":"20230724020955"},"Children":[{"ID":"20230724020955-j9yta7y","Type":"NodeParagraph","Properties":{"id":"20230724020955-j9yta7y","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD [\u0026quot;executable\u0026quot;,\u0026quot;param1\u0026quot;,\u0026quot;param2\u0026quot;]"},{"Type":"NodeText","Data":"​ 使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"​ 执行，推荐方式；"}]}]},{"ID":"20230724020955-5gz1fff","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-5gz1fff","updated":"20230724020955"},"Children":[{"ID":"20230724020955-0xz94y9","Type":"NodeParagraph","Properties":{"id":"20230724020955-0xz94y9","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD command param1 param2"},{"Type":"NodeText","Data":"​ 在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/bin/sh"},{"Type":"NodeText","Data":"​ 中执行，提供给需要交互的应用；"}]}]},{"ID":"20230724020955-3scsry4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-3scsry4","updated":"20230724020955"},"Children":[{"ID":"20230724020955-ifsse1q","Type":"NodeParagraph","Properties":{"id":"20230724020955-ifsse1q","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD [\u0026quot;param1\u0026quot;,\u0026quot;param2\u0026quot;]"},{"Type":"NodeText","Data":"​ 提供给 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 的默认参数；"}]}]}]},{"ID":"20230724020955-cloh3cg","Type":"NodeParagraph","Properties":{"id":"20230724020955-cloh3cg","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**指定启动容器时执行的命令，每个 Dockerfile 只能有一条 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 命令。如果指定了多条命令，只有最后一条会被执行。"}]},{"ID":"20230724020955-m31mr8d","Type":"NodeParagraph","Properties":{"id":"20230724020955-m31mr8d","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**如果用户启动容器时候指定了运行的命令，则会覆盖掉 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 指定的命令。"}]},{"ID":"20230724020955-ir0oums","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-ir0oums","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"五、LABEL"}]},{"ID":"20230724020955-hkdwozn","Type":"NodeParagraph","Properties":{"id":"20230724020955-hkdwozn","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"添加元数据"}]},{"ID":"20230724020955-xiesd1g","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-xiesd1g","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"LABEL multi.label1=\"value1\" \\\n      multi.label2=\"value2\" \\\n      other=\"value3\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-zatdxt7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-zatdxt7","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"六、EXPOSE"}]},{"ID":"20230724020955-yb70qoc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-yb70qoc","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"EXPOSE \u003cport\u003e [\u003cport\u003e/\u003cprotocol\u003e...]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-d2g3l94","Type":"NodeParagraph","Properties":{"id":"20230724020955-d2g3l94","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 容器在运行时侦听指定的网络端口。可以指定端口是监听TCP还是UDP，如果不指定协议，默认为TCP。"}]},{"ID":"20230724020955-f69fzfq","Type":"NodeParagraph","Properties":{"id":"20230724020955-f69fzfq","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EXPOSE"},{"Type":"NodeText","Data":"​指令实际上并未发布端口。要在运行容器时实际发布端口，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker run"},{"Type":"NodeText","Data":"​ -P 来发布和映射一个或多个端口。"}]},{"ID":"20230724020955-umzr05m","Type":"NodeParagraph","Properties":{"id":"20230724020955-umzr05m","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"默认情况下，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EXPOSE"},{"Type":"NodeText","Data":"​假定 TCP。您还可以指定 UDP："}]},{"ID":"20230724020955-prfvudk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-prfvudk","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"EXPOSE 80/udp\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-5m30lr3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-5m30lr3","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"七、ENV"}]},{"ID":"20230724020955-dxvb5jx","Type":"NodeParagraph","Properties":{"id":"20230724020955-dxvb5jx","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"设置环境变量"}]},{"ID":"20230724020955-ld7m7dq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-ld7m7dq","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ENV \u003ckey\u003e=\u003cvalue\u003e ...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-exmhcew","Type":"NodeParagraph","Properties":{"id":"20230724020955-exmhcew","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"设置的环境变量将持续存在，您可以使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker inspect"},{"Type":"NodeText","Data":"​来查看。使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker run --env \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt;"},{"Type":"NodeText","Data":"​来更改环境变量的值。"}]},{"ID":"20230724020955-dpouoik","Type":"NodeParagraph","Properties":{"id":"20230724020955-dpouoik","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果环境变量只在构建期间需要，请考虑为单个命令设置一个值："}]},{"ID":"20230724020955-64ph9tw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-64ph9tw","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"RUN DEBIAN_FRONTEND=noninteractive apt-get update \u0026\u0026 apt-get install -y ...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-jjz4zbo","Type":"NodeParagraph","Properties":{"id":"20230724020955-jjz4zbo","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"或者使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ARG"},{"Type":"NodeText","Data":"​，它不会保留在最终镜像中："}]},{"ID":"20230724020955-vp7km4m","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-vp7km4m","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ARG DEBIAN_FRONTEND=noninteractive\nRUN apt-get update \u0026\u0026 apt-get install -y ...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-qnltf3r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-qnltf3r","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"八、ADD"}]},{"ID":"20230724020955-jsdb6mq","Type":"NodeParagraph","Properties":{"id":"20230724020955-jsdb6mq","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"**复制新文件、目录或远程文件 URL **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;src\u0026gt;"},{"Type":"NodeText","Data":"​ ，并将它们添加到"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;dest\u0026gt;"},{"Type":"NodeText","Data":"​中。"}]},{"ID":"20230724020955-7gt98mi","Type":"NodeParagraph","Properties":{"id":"20230724020955-7gt98mi","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;src\u0026gt;"},{"Type":"NodeText","Data":"​可以指定多个资源，但如果它们是文件或目录，则它们的路径被解释为相对于构建上下文的源，也就是"},{"Type":"NodeTextMark","TextMarkType":"em strong","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230724020955-aqr31u5","Type":"NodeParagraph","Properties":{"id":"20230724020955-aqr31u5","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每个都"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;src\u0026gt;"},{"Type":"NodeText","Data":"​可能包含通配符，匹配将使用 Go 的 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=http%3A//golang.org/pkg/path/filepath%23Match","TextMarkTextContent":"filepath.Match"},{"Type":"NodeText","Data":"规则。例如："}]},{"ID":"20230724020955-tgm3odl","Type":"NodeParagraph","Properties":{"id":"20230724020955-tgm3odl","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"添加所有以“hom”开头的文件："}]},{"ID":"20230724020955-s0l2zbj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-s0l2zbj","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ADD hom* /mydir/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-91qacud","Type":"NodeParagraph","Properties":{"id":"20230724020955-91qacud","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在下面的示例中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"?"},{"Type":"NodeText","Data":"​被替换为任何单个字符，例如“home.txt”。"}]},{"ID":"20230724020955-lru62qj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-lru62qj","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ADD hom?.txt /mydir/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-v6i5yk2","Type":"NodeParagraph","Properties":{"id":"20230724020955-v6i5yk2","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;dest\u0026gt;"},{"Type":"NodeText","Data":"​是一个绝对路径，或相对"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​的相对路径。"}]},{"ID":"20230724020955-yfh5sz9","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-yfh5sz9","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"九、COPY"}]},{"ID":"20230724020955-u7v37wv","Type":"NodeParagraph","Properties":{"id":"20230724020955-u7v37wv","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"语法同ADD一致，复制拷贝文件。"}]},{"ID":"20230724020955-8y1xr29","Type":"NodeParagraph","Properties":{"id":"20230724020955-8y1xr29","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"COPY指令和ADD指令的唯一区别在于：是否支持从远程URL获取资源。COPY指令只能从执行docker build所在的主机上读取资源并复制到镜像中。而ADD指令还支持通过URL从远程服务器读取资源并复制到镜像中。"}]},{"ID":"20230724020955-z4tjw61","Type":"NodeParagraph","Properties":{"id":"20230724020955-z4tjw61","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"相同需求时，推荐使用COPY指令。ADD指令更擅长读取本地tar文件并解压缩。"}]},{"ID":"20230724020955-nzdzo86","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-nzdzo86","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十、ENTRYPOINT"}]},{"ID":"20230724020955-ry5zho8","Type":"NodeParagraph","Properties":{"id":"20230724020955-ry5zho8","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"和 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"一样，都是在指定容器启动程序及参数，不过它不会被 docker run 的命令行参数指定的指令所覆盖。如果要覆盖的话，需要通过docker run --entrypoint 来指定。"}]},{"ID":"20230724020955-f3demrx","Type":"NodeParagraph","Properties":{"id":"20230724020955-f3demrx","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"它有2种格式："}]},{"ID":"20230724020955-xsm92dh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-xsm92dh","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ENTRYPOINT [\"executable\", \"param1\", \"param2\"]\nENTRYPOINT command param1 param2\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-17fy46r","Type":"NodeParagraph","Properties":{"id":"20230724020955-17fy46r","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"当指定了 ENTRYPOINT 后， CMD 的内容作为参数传给 ENTRYPOINT 指令，实际执行时，将变为："}]},{"ID":"20230724020955-5iqlubm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-5iqlubm","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"\u003cENTRYPOINT\u003e \u003cCMD\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-mra39of","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-mra39of","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十一、VOLUME"}]},{"ID":"20230724020955-0ivd8y5","Type":"NodeParagraph","Properties":{"id":"20230724020955-0ivd8y5","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"创建一个具有指定名称的挂载数据卷"}]},{"ID":"20230724020955-lxoahme","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-lxoahme","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"VOLUME [\"/var/log/\"]\nVOLUME /var/log\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-f7hm8ei","Type":"NodeParagraph","Properties":{"id":"20230724020955-f7hm8ei","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"它的主要作用是："}]},{"ID":"20230724020955-z10zfgs","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-z10zfgs","updated":"20230724020955"},"Children":[{"ID":"20230724020955-tnfv0l0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-tnfv0l0","updated":"20230724020955"},"Children":[{"ID":"20230724020955-zjvpbrv","Type":"NodeParagraph","Properties":{"id":"20230724020955-zjvpbrv","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"避免重要的数据，因容器重启而丢失"}]}]},{"ID":"20230724020955-n6elslp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-n6elslp","updated":"20230724020955"},"Children":[{"ID":"20230724020955-akabmmc","Type":"NodeParagraph","Properties":{"id":"20230724020955-akabmmc","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"避免容器不断变大"}]}]}]},{"ID":"20230724020955-lufggb8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-lufggb8","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十二、ARG"}]},{"ID":"20230724020955-k2537re","Type":"NodeParagraph","Properties":{"id":"20230724020955-k2537re","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"定义变量，与****ENV"},{"Type":"NodeText","Data":"作用相同，不过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ARG"},{"Type":"NodeText","Data":"​变量不会像"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV"},{"Type":"NodeText","Data":"​变量那样持久化到构建好的镜像中。"}]},{"ID":"20230724020955-7k6g0gr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-7k6g0gr","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ARG \u003cname\u003e[=\u003cdefault value\u003e]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-66mzlr7","Type":"NodeParagraph","Properties":{"id":"20230724020955-66mzlr7","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 有一组预定义的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ARG"},{"Type":"NodeText","Data":"​变量，您可以在 Dockerfile 中没有相应指令的情况下使用这些变量。"}]},{"ID":"20230724020955-93o4vop","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-93o4vop","updated":"20230724020955"},"Children":[{"ID":"20230724020955-gjxr0py","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-gjxr0py","updated":"20230724020955"},"Children":[{"ID":"20230724020955-fhbdcaa","Type":"NodeParagraph","Properties":{"id":"20230724020955-fhbdcaa","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HTTP_PROXY"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-fztohy0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-fztohy0","updated":"20230724020955"},"Children":[{"ID":"20230724020955-i0fvwtv","Type":"NodeParagraph","Properties":{"id":"20230724020955-i0fvwtv","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"http_proxy"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-7vrqar8","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-7vrqar8","updated":"20230724020955"},"Children":[{"ID":"20230724020955-zkhsgmv","Type":"NodeParagraph","Properties":{"id":"20230724020955-zkhsgmv","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HTTPS_PROXY"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-mjbbgxk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-mjbbgxk","updated":"20230724020955"},"Children":[{"ID":"20230724020955-nwiet9u","Type":"NodeParagraph","Properties":{"id":"20230724020955-nwiet9u","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"https_proxy"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-aevbqqr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-aevbqqr","updated":"20230724020955"},"Children":[{"ID":"20230724020955-7rrf2zt","Type":"NodeParagraph","Properties":{"id":"20230724020955-7rrf2zt","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FTP_PROXY"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-zpkjbri","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-zpkjbri","updated":"20230724020955"},"Children":[{"ID":"20230724020955-yb2y34d","Type":"NodeParagraph","Properties":{"id":"20230724020955-yb2y34d","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ftp_proxy"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-2ywc1pk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-2ywc1pk","updated":"20230724020955"},"Children":[{"ID":"20230724020955-5cboaiu","Type":"NodeParagraph","Properties":{"id":"20230724020955-5cboaiu","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"NO_PROXY"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724020955-w61aztg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-w61aztg","updated":"20230724020955"},"Children":[{"ID":"20230724020955-u4ls5fd","Type":"NodeParagraph","Properties":{"id":"20230724020955-u4ls5fd","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"no_proxy"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20230724020955-edult36","Type":"NodeParagraph","Properties":{"id":"20230724020955-edult36","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"要使用这些，请使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--build-arg"},{"Type":"NodeText","Data":"​标志在命令行上传递它们，例如："}]},{"ID":"20230724020955-phwxcim","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-phwxcim","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":" docker build --build-arg HTTPS_PROXY=https://my-proxy.example.com .\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-s8i0qvx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-s8i0qvx","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十三、ONBUILD"}]},{"ID":"20230724020955-vmtyqg7","Type":"NodeParagraph","Properties":{"id":"20230724020955-vmtyqg7","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"将一个触发指令添加到镜像中，以便稍后在该镜像用作另一个构建的基础时执行。也就是另外一个dockerfile FROM了这个镜像的时候执行。"}]},{"ID":"20230724020955-63icyev","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-63icyev","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ONBUILD ADD . /app/src\nONBUILD RUN /usr/local/bin/python-build --dir /app/src\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-o87ossk","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-o87ossk","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十四、STOPSIGNAL"}]},{"ID":"20230724020955-bhawwia","Type":"NodeParagraph","Properties":{"id":"20230724020955-bhawwia","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"设置将发送到容器退出的系统调用信号。该信号可以是与内核系统调用表中的位置匹配的有效无符号数，例如 9，或格式为 SIGNAME 的信号名称，例如 SIGKILL。"}]},{"ID":"20230724020955-jpi7i74","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-jpi7i74","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"STOPSIGNAL signal\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-9fb9olx","Type":"NodeParagraph","Properties":{"id":"20230724020955-9fb9olx","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"默认的 stop-signal 是 ****SIGTERM"},{"Type":"NodeText","Data":"，在docker stop的时候会给容器内PID为1的进程发送这个signal，通过--stop-signal 可以设置自己需要的signal，主要目的是为了让容器内的应用程序在接收到signal之后可以先处理一些事物，实现容器的平滑退出，如果不做任何处理，容器将在一段时间之后强制退出，会造成业务的强制中断，默认时间是10s。"}]},{"ID":"20230724020955-rxe0ef5","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-rxe0ef5","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十五、HEALTHCHECK"}]},{"ID":"20230724020955-m9rzrqx","Type":"NodeParagraph","Properties":{"id":"20230724020955-m9rzrqx","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用于指定某个程序或者指令来监控 docker 容器服务的运行状态。该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​指令有两种形式："}]},{"ID":"20230724020955-an3u0g5","Type":"NodeList","ListData":{},"Properties":{"id":"20230724020955-an3u0g5","updated":"20230724020955"},"Children":[{"ID":"20230724020955-ckmo7uu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-ckmo7uu","updated":"20230724020955"},"Children":[{"ID":"20230724020955-njomak3","Type":"NodeParagraph","Properties":{"id":"20230724020955-njomak3","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK [OPTIONS] CMD command"},{"Type":"NodeText","Data":"​ （通过在容器内运行命令来检查容器健康状况）"}]}]},{"ID":"20230724020955-va6uh2e","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724020955-va6uh2e","updated":"20230724020955"},"Children":[{"ID":"20230724020955-wqevk57","Type":"NodeParagraph","Properties":{"id":"20230724020955-wqevk57","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK NONE"},{"Type":"NodeText","Data":"​ （禁用从基础镜像继承的任何健康检查）"}]}]}]},{"ID":"20230724020955-zgo9ywe","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-zgo9ywe","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十六、SHELL"}]},{"ID":"20230724020955-ffwcalu","Type":"NodeParagraph","Properties":{"id":"20230724020955-ffwcalu","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"覆盖用于命令的****shell"},{"Type":"NodeText","Data":"形式的默认 shell。Linux 上的默认 shell 是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"[\u0026quot;/bin/sh\u0026quot;, \u0026quot;-c\u0026quot;]"},{"Type":"NodeText","Data":"​，Windows 上是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"[\u0026quot;cmd\u0026quot;, \u0026quot;/S\u0026quot;, \u0026quot;/C\u0026quot;]"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724020955-c08cov6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-c08cov6","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"SHELL [\"executable\", \"parameters\"] \n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-n5acziv","Type":"NodeParagraph","Properties":{"id":"20230724020955-n5acziv","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"SHELL"},{"Type":"NodeText","Data":"​指令在 Windows 上特别有用，因为 Windows 有两种常用且截然不同的本机 shell："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"cmd"},{"Type":"NodeText","Data":"​和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"powershell"},{"Type":"NodeText","Data":"​，以及可用的备用 shell，包括"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sh"},{"Type":"NodeText","Data":"​。该SHELL指令可以出现多次。每条SHELL指令都会覆盖所有先前的SHELL指令，并影响所有后续指令。"}]},{"ID":"20230724020955-8ng24bd","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-8ng24bd","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十七、WORKDIR"}]},{"ID":"20230724020955-2w4xxtn","Type":"NodeParagraph","Properties":{"id":"20230724020955-2w4xxtn","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"工作目录，如果"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​不存在，即使它没有在后续"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​指令中使用，它也会被创建。"}]},{"ID":"20230724020955-4aoqdju","Type":"NodeParagraph","Properties":{"id":"20230724020955-4aoqdju","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"docker build 构建镜像过程中，每一个 RUN 命令都会新建一层。只有通过 WORKDIR 创建的目录才会一直存在。"}]},{"ID":"20230724020955-w2t769e","Type":"NodeParagraph","Properties":{"id":"20230724020955-w2t769e","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以设置多个WORKDIR，如果提供了相对路径，它将相对于前一条"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​指令的路径。例如："}]},{"ID":"20230724020955-65ufz02","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-65ufz02","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"WORKDIR /a\nWORKDIR b\nWORKDIR c\nRUN pwd \n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-2dxslif","Type":"NodeParagraph","Properties":{"id":"20230724020955-2dxslif","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"最终"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"pwd"},{"Type":"NodeText","Data":"​命令的输出是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/a/b/c"},{"Type":"NodeText","Data":"​."}]},{"ID":"20230724020955-832crpm","Type":"NodeParagraph","Properties":{"id":"20230724020955-832crpm","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​指令可以解析先前使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV"},{"Type":"NodeText","Data":"​，例如："}]},{"ID":"20230724020955-hdhlbvb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-hdhlbvb","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ENV DIRPATH=/path\nWORKDIR $DIRPATH/$DIRNAME\nRUN pwd\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724020955-peftkhc","Type":"NodeParagraph","Properties":{"id":"20230724020955-peftkhc","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"最终"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"pwd"},{"Type":"NodeText","Data":"​命令的输出是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/path/$DIRNAME"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724020955-q20rm00","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724020955-q20rm00","updated":"20230724020955"},"Children":[{"Type":"NodeText","Data":"十八、USER"}]},{"ID":"20230724020955-p3q7gj2","Type":"NodeParagraph","Properties":{"id":"20230724020955-p3q7gj2","updated":"20230724020955"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"设置用户名（或 UID）和可选的用户组（或 GID）"}]},{"ID":"20230724020955-1tg17jg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724020955-1tg17jg","updated":"20230724020955"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"USER \u003cuser\u003e[:\u003cgroup\u003e]\nUSER \u003cUID\u003e[:\u003cGID\u003e]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}