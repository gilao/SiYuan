{"ID":"20240326094108-vn8iwwc","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f4d0","id":"20240326094108-vn8iwwc","title":"Jaeger 快速指南","updated":"20240326095223"},"Children":[{"ID":"20240326094108-0y4s5dg","Type":"NodeParagraph","Properties":{"id":"20240326094108-0y4s5dg","updated":"20240326094124"},"Children":[{"Type":"NodeText","Data":"分布式追踪可观测平台（如 Jaeger）对于架构为微服务的现代软件应用程序至关重要。Jaeger 可以映射分布式系统中的请求流和数据流。这些请求可能会调用多个服务，而这些服务可能会带来各自的延迟或错误。Jaeger 将这些不同组件之间的点连接起来，帮助识别性能瓶颈、排除故障并提高整体应用程序的可靠性。Jaeger是100%开源、云原生、可无限扩展的。"}]},{"ID":"20240326094127-9fd492k","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326094127-9fd492k","updated":"20240326094135"},"Children":[{"Type":"NodeText","Data":"什么是Jaeger"}]},{"ID":"20240326094141-2h3wnuf","Type":"NodeParagraph","Properties":{"id":"20240326094141-2h3wnuf","updated":"20240326094141"},"Children":[{"Type":"NodeText","Data":"Jaeger 是一个分布式追踪系统。Jaeger的灵感来自 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dapper"},{"Type":"NodeText","Data":" 和 OpenZipkin，是一个由 Uber 创建并捐赠给 云原生计算基金会（CNCF） 的分布式跟踪平台。它可以用于监控基于微服务的分布式系统："}]},{"ID":"20240326094141-oy22gqn","Type":"NodeList","ListData":{},"Properties":{"id":"20240326094141-oy22gqn","updated":"20240326094141"},"Children":[{"ID":"20240326094141-yrhfc1j","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240326094141-yrhfc1j","updated":"20240326094141"},"Children":[{"ID":"20240326094141-p7hf5c6","Type":"NodeParagraph","Properties":{"id":"20240326094141-p7hf5c6","updated":"20240326094141"},"Children":[{"Type":"NodeText","Data":"分布式上下文传递"}]}]},{"ID":"20240326094141-rcho9aw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240326094141-rcho9aw","updated":"20240326094141"},"Children":[{"ID":"20240326094141-p2d0wqx","Type":"NodeParagraph","Properties":{"id":"20240326094141-p2d0wqx","updated":"20240326094141"},"Children":[{"Type":"NodeText","Data":"分布式事务监听"}]}]},{"ID":"20240326094141-dv6jmhw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240326094141-dv6jmhw","updated":"20240326094141"},"Children":[{"ID":"20240326094141-l1ggap4","Type":"NodeParagraph","Properties":{"id":"20240326094141-l1ggap4","updated":"20240326094141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"根因分析"}]}]},{"ID":"20240326094141-9rpft2m","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240326094141-9rpft2m","updated":"20240326094141"},"Children":[{"ID":"20240326094141-acxoiqb","Type":"NodeParagraph","Properties":{"id":"20240326094141-acxoiqb","updated":"20240326094141"},"Children":[{"Type":"NodeText","Data":"服务依赖性分析"}]}]},{"ID":"20240326094141-3n53kz6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240326094141-3n53kz6","updated":"20240326094141"},"Children":[{"ID":"20240326094141-2oeixbm","Type":"NodeParagraph","Properties":{"id":"20240326094141-2oeixbm","updated":"20240326094141"},"Children":[{"Type":"NodeText","Data":"性能/延迟优化"}]}]}]},{"ID":"20240326094143-sp1yi4x","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326094143-sp1yi4x","updated":"20240326094200"},"Children":[{"Type":"NodeText","Data":"Jaeger 架构"}]},{"ID":"20240326094206-k2rrpv2","Type":"NodeParagraph","Properties":{"id":"20240326094206-k2rrpv2","updated":"20240326094206"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"df3934b8107c3d8df53df6166c8ede46"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/df3934b8107c3d8df53df6166c8ede46-20240326094206-dmdvji3.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240326094208-e6vpk3k","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326094208-e6vpk3k","updated":"20240326094214"},"Children":[{"Type":"NodeText","Data":"特性"}]},{"ID":"20240326094214-x4z7dy8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094214-x4z7dy8","updated":"20240326094219"},"Children":[{"Type":"NodeText","Data":"高可扩展性"}]},{"ID":"20240326094220-428fqjx","Type":"NodeParagraph","Properties":{"id":"20240326094220-428fqjx","updated":"20240326094227"},"Children":[{"Type":"NodeText","Data":"Jaeger后端设计为无单点故障，并可根据业务需求进行扩展。例如，Uber 的任何一个 Jaeger 实例通常每天都要处理数十亿个 span。"}]},{"ID":"20240326094228-ddrqd7b","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094228-ddrqd7b","updated":"20240326094241"},"Children":[{"Type":"NodeText","Data":"与 OpenTelemetry 的关系"}]},{"ID":"20240326094247-ryxqq3s","Type":"NodeParagraph","Properties":{"id":"20240326094247-ryxqq3s","updated":"20240326094247"},"Children":[{"Type":"NodeText","Data":"Jaeger 项目和 OpenTelemetry 项目有着不同的目标。OpenTelemetry 的目标是提供多种语言的应用程序接口（API）和 SDK，允许应用程序将各种遥测数据输出到任意数量的度量和跟踪后端。Jaeger 项目主要是跟踪后端，它接收跟踪遥测数据，并对数据进行处理、汇总、数据挖掘和可视化。如需了解更多信息，请参阅博客 《Jaeger and OpenTelemetry》。"}]},{"ID":"20240326094247-0j7ad39","Type":"NodeParagraph","Properties":{"id":"20240326094247-0j7ad39","updated":"20240326094247"},"Children":[{"Type":"NodeText","Data":"Jaeger 最初是为支持 OpenTracing 标准而设计的，它实现了一套客户端工具——Jaeger SDK，但是目前 Jaeger 项目推荐使用 OpenTelemetry SDK 作为仪器（Jaeger SDK已废弃）。"}]},{"ID":"20240326094247-2l6l2aa","Type":"NodeParagraph","Properties":{"id":"20240326094247-2l6l2aa","updated":"20240326094247"},"Children":[{"Type":"NodeText","Data":"Jaeger Collector 现在已能够接收 OTLP 格式的数据。"}]},{"ID":"20240326094248-44pavk4","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094248-44pavk4","updated":"20240326094309"},"Children":[{"Type":"NodeText","Data":"支持多种存储后端"}]},{"ID":"20240326094317-roy5vim","Type":"NodeParagraph","Properties":{"id":"20240326094317-roy5vim","updated":"20240326094320"},"Children":[{"Type":"NodeText","Data":"Jaeger 可以与多种存储后端配合使用，它原生支持两种流行的开源 NoSQL 数据库作为跟踪存储后端："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Cassandra"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Elasticsearch"},{"Type":"NodeText","Data":"​，此外它通过 gRPC API 与 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"ClickHouse"},{"Type":"NodeText","Data":" 集成。"}]},{"ID":"20240326094309-e78u49y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094309-e78u49y","updated":"20240326094333"},"Children":[{"Type":"NodeText","Data":"现代化的Web UI"}]},{"ID":"20240326094340-7c0fqab","Type":"NodeParagraph","Properties":{"id":"20240326094340-7c0fqab","updated":"20240326094340"},"Children":[{"Type":"NodeText","Data":"Jaeger Web UI 使用流行的开源框架（React）实现。v1.0 版本支持高效处理大量数据，并显示数以万计 span 的 trace。"}]},{"ID":"20240326094341-b3f77qh","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094341-b3f77qh","updated":"20240326094348"},"Children":[{"Type":"NodeText","Data":"云原生部署"}]},{"ID":"20240326094354-1jqhsro","Type":"NodeParagraph","Properties":{"id":"20240326094354-1jqhsro","updated":"20240326094354"},"Children":[{"Type":"NodeText","Data":"Jaeger 后端以 Docker 镜像集的形式发布。"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"二进制文件"},{"Type":"NodeText","Data":"支持多种配置方法，包括命令行选项、环境变量和多种格式的配置文件（yaml、toml 等）。"}]},{"ID":"20240326094354-665wd6t","Type":"NodeParagraph","Properties":{"id":"20240326094354-665wd6t","updated":"20240326094354"},"Children":[{"Type":"NodeText","Data":"在生产 Kubernetes 集群中部署 Jaeger 的推荐方式是通过 Jaeger Operator。Jaeger Operator提供了一个 CLI，用于从 Jaeger CR 生成 Kubernetes manifests 。"}]},{"ID":"20240326094354-ux9s0jq","Type":"NodeParagraph","Properties":{"id":"20240326094354-ux9s0jq","updated":"20240326094354"},"Children":[{"Type":"NodeText","Data":"Jaeger 生态系统还提供了 Helm chart 部署 Jaeger 的替代方式。"}]},{"ID":"20240326094333-hrea4ow","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094333-hrea4ow","updated":"20240326094403"},"Children":[{"Type":"NodeText","Data":"可观测性"}]},{"ID":"20240326094403-o0yjie1","Type":"NodeParagraph","Properties":{"id":"20240326094403-o0yjie1","updated":"20240326094408"},"Children":[{"Type":"NodeText","Data":"默认情况下，所有 Jaeger 后端组件都公开 Prometheus 指标（也支持其他指标后端）。使用结构化日志库 zap 将日志写入标准输出。"}]},{"ID":"20240326094409-el4h42f","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326094409-el4h42f","updated":"20240326094427"},"Children":[{"Type":"NodeText","Data":"使用Docker 在本地运行 Jaeger"}]},{"ID":"20240326094428-usnpzwx","Type":"NodeParagraph","Properties":{"id":"20240326094428-usnpzwx","updated":"20240326094548"},"Children":[{"Type":"NodeText","Data":"Jaeger 提供了一个随时可用的 all-in-one Docker 镜像，其中包含 Jaeger UI、Jaeger-collector、jaeger-query 和 jaeger-agent，以及一个内存存储组件。"}]},{"ID":"20240326094548-e67wp8d","Type":"NodeParagraph","Properties":{"id":"20240326094548-e67wp8d","updated":"20240326094606"},"Children":[{"Type":"NodeText","Data":"在你的电脑上执行以下命令运行 Jaeger:"}]},{"ID":"20240326094606-fg4evkx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240326094606-fg4evkx","updated":"20240326094632"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"docker run -rm --name jaeger \\\n  -e COLLECTOR_ZIPKIN_HOST_PORT=:9411 \\\n  -p 6831:6831/udp \\\n  -p 6832:6832/udp \\\n  -p 5778:5778 \\\n  -p 16686:16686 \\\n  -p 4317:4317 \\\n  -p 4318:4318 \\\n  -p 14250:14250 \\\n  -p 14268:14268 \\\n  -p 14269:14269 \\\n  -p 9411:9411 \\\n  jaegertracing/all-in-one:1.55\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240326094634-i6sg48s","Type":"NodeParagraph","Properties":{"id":"20240326094634-i6sg48s","updated":"20240326094638"},"Children":[{"Type":"NodeText","Data":"容器公开以下端口："}]},{"ID":"20240326094645-9bz80ow","Type":"NodeTable","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20240326094645-9bz80ow","updated":"20240326094645"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Port"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Protocol"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Component"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"Function"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"6831"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"UDP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"agent"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept jaeger.thrift over Thrift-compact protocol (used by most SDKs)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"6832"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"UDP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"agent"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept jaeger.thrift over Thrift-binary protocol (used by Node.js SDK)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"5775"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"UDP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"agent"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"(deprecated) accept zipkin.thrift over compact Thrift protocol (used by legacy clients only)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"5778"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"agent"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"serve configs (sampling, etc.)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"16686"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"query"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"serve frontend"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"4317"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"collector"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept OpenTelemetry Protocol (OTLP) over gRPC"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"4318"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"collector"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept OpenTelemetry Protocol (OTLP) over HTTP"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"14268"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"collector"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept jaeger.thrift directly from clients"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"14250"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"collector"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"accept model.proto"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"9411"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"HTTP"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"collector"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Zipkin compatible endpoint (optional)"}]}]}]},{"ID":"20240326094645-3s3qyee","Type":"NodeParagraph","Properties":{"id":"20240326094645-3s3qyee","updated":"20240326094645"},"Children":[{"Type":"NodeText","Data":"容器启动后，使用浏览器打开 http://localhost:16686 即可访问 Jaeger UI。"}]},{"ID":"20240326094651-kmfad71","Type":"NodeParagraph","Properties":{"id":"20240326094651-kmfad71","updated":"20240326094651"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"3a3ca7876628ee1b269eee77946c25aa"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/3a3ca7876628ee1b269eee77946c25aa-20240326094651-3jpk6qo.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240326094654-akev8x4","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326094654-akev8x4","updated":"20240326094707"},"Children":[{"Type":"NodeText","Data":"Jaeger Tracing Go 示例"}]},{"ID":"20240326094707-8i1ttog","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094707-8i1ttog","updated":"20240326094713"},"Children":[{"Type":"NodeText","Data":"Jaeger Go 示例"}]},{"ID":"20240326094713-2nvd7l8","Type":"NodeParagraph","Properties":{"id":"20240326094713-2nvd7l8","updated":"20240326094740"},"Children":[{"Type":"NodeText","Data":"下面是一个批量创建 span 并将 trace 数据发送到 Jaeger 的Go 语言示例"}]},{"ID":"20240326094740-iebsjaj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240326094740-iebsjaj","updated":"20240326094907"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"math/rand\"\n\t\"time\"\n\n\t\"go.opentelemetry.io/otel\"\n\t\"go.opentelemetry.io/otel/attribute\"\n\t\"go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracehttp\"\n\t\"go.opentelemetry.io/otel/sdk/resource\"\n\ttraceSDK \"go.opentelemetry.io/otel/sdk/trace\"\n\tsemconv \"go.opentelemetry.io/otel/semconv/v1.17.0\"\n\t\"go.opentelemetry.io/otel/trace\"\n)\n\n// jaeger trace Go demo by Q1mi\n\nconst (\n\tserviceName    = \"Go-Jaeger-Demo\"\n\tjaegerEndpoint = \"127.0.0.1:4318\"\n)\n\n// setupTracer 设置Tracer\nfunc setupTracer(ctx context.Context) (func(context.Context) error, error) {\n\ttracerProvider, err := newJaegerTraceProvider(ctx)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\totel.SetTracerProvider(tracerProvider)\n\treturn tracerProvider.Shutdown, nil\n}\n\n// newJaegerTraceProvider 创建一个 Jaeger Trace Provider\nfunc newJaegerTraceProvider(ctx context.Context) (*traceSDK.TracerProvider, error) {\n\t// 创建一个使用 HTTP 协议连接本机Jaeger的 Exporter\n\texp, err := otlptracehttp.New(ctx,\n\t\totlptracehttp.WithEndpoint(jaegerEndpoint),\n\t\totlptracehttp.WithInsecure())\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tres, err := resource.New(ctx, resource.WithAttributes(semconv.ServiceName(serviceName)))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\ttraceProvider := traceSDK.NewTracerProvider(\n\t\ttraceSDK.WithResource(res),\n\t\ttraceSDK.WithSampler(traceSDK.AlwaysSample()), // 采样\n\t\ttraceSDK.WithBatcher(exp, traceSDK.WithBatchTimeout(time.Second)),\n\t)\n\treturn traceProvider, nil\n}\n\n// testTracer 编写一个批量创建span的tracer\n// trace 和 span\nfunc testTracer(ctx context.Context) {\n\ttracer := otel.Tracer(\"test-tracer\")\n\tbaseAttrs := []attribute.KeyValue{\n\t\tattribute.String(\"domain\", \"liwenzhou.com\"),\n\t\tattribute.Bool(\"plagiarize\", false),\n\t\tattribute.Int(\"code\", 7),\n\t}\n\n\t// 开启span\n\tctx, span := tracer.Start(ctx, \"parent-span\", trace.WithAttributes(baseAttrs...))\n\t// 结束span\n\tdefer span.End()\n\t// 使用for循环创建多个子span，方便查看效果\n\tfor i := range 10 { // Go1.22+\n\t\t// 传入父ctx，开启子span\n\t\t_, iSpan := tracer.Start(ctx, fmt.Sprintf(\"span-%d\", i))\n\t\t// 随机sleep，模拟子span中耗时的操作\n\t\ttime.Sleep(time.Duration(rand.Int63n(100)) * time.Millisecond)\n\t\t// 子span结束\n\t\tiSpan.End()\n\t}\n\tfmt.Println(\"done!\")\n}\n\nfunc main() {\n\tctx := context.Background()\n\tshutdown, err := setupTracer(ctx)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tdefer func() {\n\t\t_ = shutdown(ctx)\n\t}()\n\n\t// 批量创建span并上报至Jaeger\n\ttestTracer(ctx)\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240326094915-fjz8vsc","Type":"NodeParagraph","Properties":{"id":"20240326094915-fjz8vsc","updated":"20240326094923"},"Children":[{"Type":"NodeText","Data":"将上述代码运行."}]},{"ID":"20240326094924-xiicr3b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240326094924-xiicr3b","updated":"20240326094933"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHl0aG9u"},{"Type":"NodeCodeBlockCode","Data":"go run .\ndone!\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240326094936-3708tja","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240326094936-3708tja","updated":"20240326094947"},"Children":[{"Type":"NodeText","Data":"Jaeger UI 使用"}]},{"ID":"20240326094951-n1p74d2","Type":"NodeParagraph","Properties":{"id":"20240326094951-n1p74d2","updated":"20240326094951"},"Children":[{"Type":"NodeText","Data":"你可以使用Jaeger UI 左侧的搜索面板来搜索具有特定属性的 trace: 它们来自哪个服务、进行了什么操作、包含在跟踪中的特定标记(例如，HTTP状态码)、过去需要查找多长时间以及结果数量限制。"}]},{"ID":"20240326094957-1g18ltv","Type":"NodeParagraph","Properties":{"id":"20240326094957-1g18ltv","updated":"20240326094957"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"8c975352b557c0b79332db8ce6fccde9"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/8c975352b557c0b79332db8ce6fccde9-20240326094957-keqi9j2.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240326094959-x5ep8dv","Type":"NodeParagraph","Properties":{"id":"20240326094959-x5ep8dv","updated":"20240326095002"},"Children":[{"Type":"NodeText","Data":"当你输入了搜索条件后，点击\"Find Traces\"按钮后，即可看到类似下面的搜索结果。"}]},{"ID":"20240326095008-jr4bne5","Type":"NodeParagraph","Properties":{"id":"20240326095008-jr4bne5","updated":"20240326095008"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"0e019b75fb3dd340021e44814f85b03b"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/0e019b75fb3dd340021e44814f85b03b-20240326095008-zyxr33e.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240326095013-dwe2fco","Type":"NodeParagraph","Properties":{"id":"20240326095013-dwe2fco","updated":"20240326095013"},"Children":[{"Type":"NodeText","Data":"由于我运行了两次程序，所以页面上会有两条 trace 记录，可以点击其中一条记录查看详情。"}]},{"ID":"20240326095016-kbdb7nz","Type":"NodeParagraph","Properties":{"id":"20240326095016-kbdb7nz","updated":"20240326095016"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"762a29a6a973a8ee9d7b1253f175b08f"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/762a29a6a973a8ee9d7b1253f175b08f-20240326095016-gzqc4gy.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240326095021-3mp9exj","Type":"NodeParagraph","Properties":{"id":"20240326095021-3mp9exj","updated":"20240326095021"},"Children":[{"Type":"NodeText","Data":"在这个页面，你可以找到关于执行时间、都发出了哪些调用、调用的持续时间以及携带的特定属性等信息。"}]},{"ID":"20240326095023-u44o4sp","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240326095023-u44o4sp","updated":"20240326095027"},"Children":[{"Type":"NodeText","Data":"总结"}]},{"ID":"20240326095027-8of4dd0","Type":"NodeParagraph","Properties":{"id":"20240326095027-8of4dd0","updated":"20240326095223"},"Children":[{"Type":"NodeText","Data":"随着 OpenTelemetry 的稳步发展，Jaeger 更倾向于遵循 OpenTelemetry 规范，并把精力集中在构建跟踪后端、可视化工具和数据挖掘技术上。作为普通的开发者，使用 OpenTelemetry SDK + Jaeger 将是分布式的理想方案。"}]},{"ID":"20240326095223-us2li8v","Type":"NodeParagraph","Properties":{"id":"20240326095223-us2li8v","updated":"20240326095223"}}]}