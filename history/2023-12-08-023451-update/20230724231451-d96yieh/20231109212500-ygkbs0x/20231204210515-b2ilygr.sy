{"ID":"20231204210515-b2ilygr","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f355","id":"20231204210515-b2ilygr","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20231204210515-b2ilygr\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20231204210558-wnyh02c\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20231204211801-nsug33v\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20231204210558-wnyh02c\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","tags":"Go-Handler,公众号-凉凉的知识库,Go-http,Go-http-server","title":"深入理解Go标准库-http server 启动","updated":"20231208022648"},"Children":[{"ID":"20231204210558-wnyh02c","Type":"NodeParagraph","Properties":{"id":"20231204210558-wnyh02c","updated":"20231204210616"},"Children":[{"Type":"NodeText","Data":"如何用最少的代码创建一个HTTP server？"}]},{"ID":"20231204210616-vz7u3nz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204210616-vz7u3nz","updated":"20231204211031"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport \"net/http\"\n\nfunc main() {\n\terr := http.ListenAndServe(\":8080\", nil)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204210515-jpl4a4e","Type":"NodeParagraph","Properties":{"id":"20231204210515-jpl4a4e","updated":"20231204211124"},"Children":[{"Type":"NodeText","Data":"点开 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"http.ListenAndServer"},{"Type":"NodeText","Data":"​ 可以看到函数只是创建了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Server"},{"Type":"NodeText","Data":"​ 类型并调用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"server.ListenAndServer()"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231204211125-0br2shz","Type":"NodeParagraph","Properties":{"id":"20231204211125-0br2shz","updated":"20231204211131"},"Children":[{"Type":"NodeText","Data":"所以下面的和上面的代码没有区别"}]},{"ID":"20231204211132-g3c7ws0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204211132-g3c7ws0","updated":"20231204211242"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport \"net/http\"\n\nfunc main() {\n\tserver := \u0026http.Server{Addr: \":8080\"}\n\terr := server.ListenAndServe()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204211250-2n0wmhp","Type":"NodeParagraph","Properties":{"id":"20231204211250-2n0wmhp","updated":"20231204211250"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ListenAndServe()"},{"Type":"NodeText","Data":"​如其名会干两件事"}]},{"ID":"20231204211250-q00x76c","Type":"NodeList","ListData":{},"Properties":{"id":"20231204211250-q00x76c","updated":"20231204211250"},"Children":[{"ID":"20231204211250-gja4h85","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231204211250-gja4h85","updated":"20231204211250"},"Children":[{"ID":"20231204211250-w1lz9s9","Type":"NodeParagraph","Properties":{"id":"20231204211250-w1lz9s9","updated":"20231204211250"},"Children":[{"Type":"NodeText","Data":"监听一个端口，即"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Listen"},{"Type":"NodeText","Data":"​的过程"}]}]},{"ID":"20231204211250-0rak7hp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231204211250-0rak7hp","updated":"20231204211250"},"Children":[{"ID":"20231204211250-antiy01","Type":"NodeParagraph","Properties":{"id":"20231204211250-antiy01","updated":"20231204211250"},"Children":[{"Type":"NodeText","Data":"处理进入端口的连接，即"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Serve"},{"Type":"NodeText","Data":"​的过程"}]}]}]},{"ID":"20231204211250-9b3ewy0","Type":"NodeParagraph","Properties":{"id":"20231204211250-9b3ewy0","updated":"20231204211250"},"Children":[{"Type":"NodeText","Data":"所以下面的代码和上面的代码也没区别"}]},{"ID":"20231204211253-6vzqitj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204211253-6vzqitj","updated":"20231204211311"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport (\n \"net\"\n \"net/http\"\n)\n\nfunc main() {\n // 方式3\n ln, err := net.Listen(\"tcp\", \":8080\")\n if err != nil {\n  panic(err)\n }\n\n server := \u0026http.Server{}\n err = server.Serve(ln)\n if err != nil {\n  panic(err)\n }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204211336-n1obgls","Type":"NodeParagraph","Properties":{"id":"20231204211336-n1obgls","updated":"20231204211336"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"4bb65525ef165890baa2c3783de5a87c"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/4bb65525ef165890baa2c3783de5a87c-20231204211336-g36e13s.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231204211337-54wkzn6","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231204211337-54wkzn6","updated":"20231204211357"},"Children":[{"Type":"NodeText","Data":"路由？ no！ Handler！"}]},{"ID":"20231204211357-5n1v8ex","Type":"NodeParagraph","Properties":{"id":"20231204211357-5n1v8ex","updated":"20231204211403"},"Children":[{"Type":"NodeText","Data":"按上面的代码启动HTTP Server没有太大意义，因为我们还没有设定路由，所以无法正常响应请求"}]},{"ID":"20231204211404-ccir2bo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204211404-ccir2bo","updated":"20231204211415"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"curl 127.0.0.1:8080\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204211428-ovesu9f","Type":"NodeParagraph","Properties":{"id":"20231204211428-ovesu9f","updated":"20231204211429"},"Children":[{"Type":"NodeText","Data":"暂停思考一下，服务器返回404是因为没有设定路由么？no，no，no，你需要转变一下思维。服务器返回404不是因为我们没有设置"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"路由"},{"Type":"NodeText","Data":"，而是因为没有设置请求的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"处理程序"},{"Type":"NodeText","Data":"，这个处理程序在Go中叫作："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Handler"},{"Type":"NodeText","Data":"​！"}]},{"ID":"20231204211725-8xss5oq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204211725-8xss5oq","updated":"20231204211726"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type Handler interface {\n\tServeHTTP(ResponseWriter, *Request)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204211612-2c4ayyo","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231204211612-2c4ayyo","updated":"20231204211644"},"Children":[{"Type":"NodeText","Data":"怎么定义请求的处理程序"}]},{"ID":"20231204211650-7q47l97","Type":"NodeParagraph","Properties":{"id":"20231204211650-7q47l97","updated":"20231204211650"},"Children":[{"Type":"NodeText","Data":"由上可知，仅需要实现"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ServeHTTP(ResponseWriter, *Request)"},{"Type":"NodeText","Data":"​接口即可"}]},{"ID":"20231204211650-1emossq","Type":"NodeParagraph","Properties":{"id":"20231204211650-1emossq","updated":"20231204211650"},"Children":[{"Type":"NodeText","Data":"注意，示例代码没有判断任何路由（PATH）"}]},{"ID":"20231204211651-6pn16vb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231204211651-6pn16vb","updated":"20231204211744"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type handlerImp struct {\n}\n\nfunc (imp handlerImp) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\tif r.Method == \"GET\" {\n\t\tw.Write([]byte(\"Receive GET request\"))\n\t\treturn\n\t}\n\tif r.Method == \"POST\" {\n\t\tw.Write([]byte(\"Receive POST request\"))\n\t\treturn\n\t}\n\treturn\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231204211745-crtvc8r","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231204211745-crtvc8r","updated":"20231204211801"},"Children":[{"Type":"NodeText","Data":"怎么设置请求的处理程序"}]},{"ID":"20231208015046-91efdg7","Type":"NodeParagraph","Properties":{"id":"20231208015046-91efdg7","updated":"20231208015046"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231208015046-mad9f8v.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231208015049-05dea8w","Type":"NodeParagraph","Properties":{"id":"20231208015049-05dea8w","updated":"20231208015416"},"Children":[{"Type":"NodeText","Data":"三种方式本质上都是把自定义的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Handler"},{"Type":"NodeText","Data":"​ 赋值到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Server"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Handler"},{"Type":"NodeText","Data":"​属性中。"}]},{"ID":"20231208020650-5blkgwu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231208020650-5blkgwu","updated":"20231208021324"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type handlerImp struct {\n}\n\nfunc (imp handlerImp) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\tif r.Method == \"GET\" {\n\t\tw.Write([]byte(\"Receiver GET request\"))\n\t\treturn\n\t}\n\tif r.Method == \"POST\" {\n\t\tw.Write([]byte(\"Receiver POST request\"))\n\t\treturn\n\t}\n\treturn\n}\n\nfunc main() {\n\n\t// 方式一\n\t//err := http.ListenAndServe(\":8080\", handlerImp{})\n\t//if err != nil {\n\t//\tpanic(err)\n\t//}\n\n\t// 方式2\n\t//server := \u0026http.Server{Addr: \":8080\",Handler: handlerImp{}}\n\t//err := server.ListenAndServe()\n\t//if err != nil {\n\t//\tpanic(err)\n\t//}\n\n\t// 方式3\n\tIn, err := net.Listen(\"tcp\", \":8080\")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n\tserver := \u0026http.Server{Handler: handlerImp{}}\n\terr = server.Serve(In)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231208020654-re57q88","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231208020654-re57q88","updated":"20231208020725"},"Children":[{"Type":"NodeText","Data":"设置请求的处理程序之后的效果"}]},{"ID":"20231208020727-6487tl1","Type":"NodeParagraph","Properties":{"id":"20231208020727-6487tl1","updated":"20231208021339"},"Children":[{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"handlerImp"},{"Type":"NodeText","Data":"​只针对Method做了不同的响应，没有对PATH做任何的判断，所以无论请求什么样的路径都能拿到一个预期的响应。"}]},{"ID":"20231208021326-08hdo14","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231208021326-08hdo14","updated":"20231208021359"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"$ curl  -X POST 127.0.0.1:8080/foo\nReceive POST request%  \n\n$ curl  127.0.0.1:8080/foo/bar \nReceive GET request%  \n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231208021401-cwskyyy","Type":"NodeParagraph","Properties":{"id":"20231208021401-cwskyyy","updated":"20231208021407"},"Children":[{"Type":"NodeText","Data":"此时再体会一下这句话：我们设置的不是"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"路由"},{"Type":"NodeText","Data":"，而是设置请求的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"处理程序"}]},{"ID":"20231208021407-bhmx5t3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231208021407-bhmx5t3","updated":"20231208021628"},"Children":[{"Type":"NodeText","Data":"再聊 Handler"}]},{"ID":"20231208021922-28537gm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231208021922-28537gm","updated":"20231208022614"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type handlerImp struct {\n}\n\nfunc (imp handlerImp) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\tif r.Method == \"GET\" {\n\t\tw.Write([]byte(\"Receiver GET request\"))\n\t\treturn\n\t}\n\tif r.Method == \"POST\" {\n\t\tw.Write([]byte(\"Receiver POST request\"))\n\t\treturn\n\t}\n\treturn\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231208021951-i1f536a","Type":"NodeParagraph","Properties":{"id":"20231208021951-i1f536a","updated":"20231208021951"},"Children":[{"Type":"NodeText","Data":"如上所述，无论任何PATH，任何Method等，所有的请求都会被"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"handlerImp.ServeHTTP"},{"Type":"NodeText","Data":"​处理。"}]},{"ID":"20231208021951-99b0y5l","Type":"NodeParagraph","Properties":{"id":"20231208021951-99b0y5l","updated":"20231208021951"},"Children":[{"Type":"NodeText","Data":"我们可以判断PATH、Method等，根据不同的请求特征执行不同的逻辑，并且全部在这一个函数中全部完成"}]},{"ID":"20231208021951-w1y5cek","Type":"NodeParagraph","Properties":{"id":"20231208021951-w1y5cek","updated":"20231208021951"},"Children":[{"Type":"NodeText","Data":"很明显，这违反了高内聚，低耦合的编程范式"}]},{"ID":"20231208021951-qf5iisa","Type":"NodeParagraph","Properties":{"id":"20231208021951-qf5iisa","updated":"20231208021951"},"Children":[{"Type":"NodeText","Data":"停下来思考下，如何编写一个高内聚，低耦合的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"handlerImp.ServeHTTP"},{"Type":"NodeText","Data":"​，使之针对不同HTTP请求执行不同的逻辑呢"}]},{"ID":"20231208022002-mena3r4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231208022002-mena3r4","updated":"20231208022610"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type handlerImp struct {\n}\n\nfunc (imp handlerImp) handleMethodGet(w http.ResponseWriter, r *http.Request) {\n\tw.Write([]byte(\"Receive GET request\"))\n\treturn\n}\n\nfunc (imp handlerImp) handleMethodPost(w http.ResponseWriter, r *http.Request) {\n\tw.Write([]byte(\"Recevice POST request\"))\n}\n\nfunc (imp handlerImp) handlePathFoo(w http.ResponseWriter, r *http.Request) {\n\tw.Write([]byte(\"Receive path foo\"))\n\treturn\n}\n\nfunc (imp handlerImp) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\tif r.URL.Path == \"/foo\" {\n\t\timp.handlePathFoo(w, r)\n\t\treturn\n\t}\n\tif r.Method == \"GET\" {\n\t\timp.handleMethodGet(w, r)\n\t\treturn\n\t}\n\tif r.Method == \"POST\" {\n\t\timp.handleMethodPost(w, r)\n\t\treturn\n\t}\n\treturn\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231208022318-dagh1ta","Type":"NodeParagraph","Properties":{"id":"20231208022318-dagh1ta","updated":"20231208022319"},"Children":[{"Type":"NodeText","Data":"如果你的答案和上面的代码类似，那么我对于这段代码的点评是："},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不太高明"},{"Type":"NodeText","Data":"☹️"}]},{"ID":"20231208022320-jbhfzgh","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231208022320-jbhfzgh","updated":"20231208022415"},"Children":[{"Type":"NodeText","Data":"如何编写一个高内聚，低耦合的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ServeHTTP"},{"Type":"NodeText","Data":"​, 针对不同HTTP请求执行不同的逻辑？"}]},{"ID":"20231208022416-kmbriz8","Type":"NodeParagraph","Properties":{"id":"20231208022416-kmbriz8","updated":"20231208022424"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不知道你有没有听过设计模式中，组合模式。没有了解可以去了解下，或者看下图"}]},{"ID":"20231208022442-db5mi1v","Type":"NodeParagraph","Properties":{"id":"20231208022442-db5mi1v","updated":"20231208022442"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"acd3604f0879ea4f96b826a514e86a69"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/acd3604f0879ea4f96b826a514e86a69-20231208022442-s4wrtl9.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231208022505-4n9g0dy","Type":"NodeParagraph","Properties":{"id":"20231208022505-4n9g0dy","updated":"20231208022505"},"Children":[{"Type":"NodeText","Data":"经过组合模式重新设计的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"handlerImp"},{"Type":"NodeText","Data":"​，已经不再包含具体的逻辑了，它先搜索有没有针对PATH处理的逻辑，再搜索有没有针对Method处理的逻辑，它专注于逻辑分派，它是组合模式中的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"容器"},{"Type":"NodeText","Data":"。"}]},{"ID":"20231208022519-2jux22o","Type":"NodeParagraph","Properties":{"id":"20231208022519-2jux22o","updated":"20231208022520"},"Children":[{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"容器（Container）：容器接收到请求后会将工作分配给自己的子项目， 处理中间结果， 然后将最终结果返回给客户端。"}]},{"ID":"20231208022521-kppybq0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231208022521-kppybq0","updated":"20231208022603"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"type handlerImp struct {\n\tpathHandlers   map[string]http.Handler\n\tmethodHandlers map[string]http.Handler\n}\n\nfunc NewHandlerImp() handlerImp {\n\treturn handlerImp{\n\t\tpathHandlers:   make(map[string]http.Handler),\n\t\tmethodHandlers: make(map[string]http.Handler),\n\t}\n}\n\nfunc (imp handlerImp) AddPathHandler(path string, h http.Handler) {\n\timp.pathHandlers[path] = h\n}\n\nfunc (imp handlerImp) AddMethodHandler(method string, h http.Handler) {\n\timp.methodHandlers[method] = h\n}\n\nfunc (imp handlerImp) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\tif h, ok := imp.pathHandlers[r.URL.Path]; ok {\n\t\th.ServeHTTP(w, r)\n\t\treturn\n\t}\n\n\tif h, ok := imp.methodHandlers[r.Method]; ok {\n\t\th.ServeHTTP(w, r)\n\t\treturn\n\t}\n\n\treturn\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231208022648-s6i2w5k","Type":"NodeParagraph","Properties":{"id":"20231208022648-s6i2w5k","updated":"20231208022648"},"Children":[{"Type":"NodeText","Data":"重新设计的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"handlerImp"},{"Type":"NodeText","Data":"​不执行逻辑，实际的逻辑被分离到每一个叶子结点中，而每一个叶子结点也都实现了"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ServeHTTP"},{"Type":"NodeText","Data":"​函数，即"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Handler"},{"Type":"NodeText","Data":"​接口"}]}]}