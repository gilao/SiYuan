{"ID":"20231108153502-8nak3av","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f319","id":"20231108153502-8nak3av","title":"CPU 指令集权限","updated":"20231108154346"},"Children":[{"ID":"20231108153528-fgexlck","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231108153528-fgexlck","updated":"20231108153549"},"Children":[{"Type":"NodeText","Data":"了解一下CPU指令集"}]},{"ID":"20231108153549-nzf0sdk","Type":"NodeParagraph","Properties":{"id":"20231108153549-nzf0sdk","updated":"20231108153606"},"Children":[{"Type":"NodeText","Data":"指令集是 CPU 实现软件指挥硬件执行工作的媒介，具体来说每一条汇编语句都对应了一条 CPU 指令，CPU 指令不止一条的，而是由非常非常多的 CPU 指令集合在一起，组成了一个、甚至多个的集合，每个指令的集合叫："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CPU 指令集"},{"Type":"NodeText","Data":"​。随着时间的推移，CPU 指令越来越多，从最早的几十条，到现在的几千条。"}]},{"ID":"20231108153606-fh2t8e2","Type":"NodeParagraph","Properties":{"id":"20231108153606-fh2t8e2"}},{"ID":"20231108153502-ante8gh","Type":"NodeParagraph","Properties":{"id":"20231108153502-ante8gh","updated":"20231108153616"},"Children":[{"Type":"NodeText","Data":"Inter、AMD CPU 都是复杂指令集 CPU，支持的 CPU 指令多达几千个，每一个指令都指代一种数学运算，比如加减乘除4种数学计算在 CPU 中就是 4条 CPU 指令，以此类推，大家脑补下"}]},{"ID":"20231108153617-txiocc3","Type":"NodeParagraph","Properties":{"id":"20231108153617-txiocc3","updated":"20231108153640"},"Children":[{"Type":"NodeText","Data":"CPU 指令集发展到现在有很多的，典型的 Intel CPU 支持："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EM64T, MMX, SSE, SSE2 ，SSE3，SSE4A, SSE4.1, SSE4.2, AVX, AVX2, AVX-512, VMX 等指令集"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20231108153623-mphe0if","Type":"NodeParagraph","Properties":{"id":"20231108153623-mphe0if","updated":"20231108153634"},"Children":[{"Type":"NodeText","Data":"这些指令集中，每个 CPU 指令都有唯一的、不重复的指令编号，CPU 硬件中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"控制单元"},{"Type":"NodeText","Data":"​ 可以解析、识别程序想要执行的 CPU 指令的编号，然后指挥相关硬件执行相关操作，所以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"汇编语言"},{"Type":"NodeText","Data":"​ 被视为是最底层的编程语言。"}]},{"ID":"20231108153634-8h2zaik","Type":"NodeParagraph","Properties":{"id":"20231108153634-8h2zaik","updated":"20231108153654"},"Children":[{"Type":"NodeText","Data":"一般认为："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CPU 硬件直接支持的数学计算公式执行效率最高"},{"Type":"NodeText","Data":"​。就是因为 CPU 指令集中包含这个数学公式，数学计算只需要一条指令就可以执行完毕。反之就需要通过多条 CPU 指令以组合的方式完成数学计算，需要执行多条 CPU 指令，在空间和时间复杂度上都会复杂 N 倍。所以请大家理解 CPU 执行效率高低的来源，当然指令集只是制约 CPU 执行效率高低的其中一个因素，但是该因素绝对是重量级的、起决定性的因素。"}]},{"ID":"20231108153702-fu01cw3","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231108153702-fu01cw3","updated":"20231108153720"},"Children":[{"Type":"NodeText","Data":"CPU 指令权限分级"}]},{"ID":"20231108153720-e7lk7b2","Type":"NodeParagraph","Properties":{"id":"20231108153720-e7lk7b2","updated":"20231108153801"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CPU指令也是有权限分级的， "}]},{"ID":"20231108153810-3j7cosb","Type":"NodeParagraph","Properties":{"id":"20231108153810-3j7cosb","updated":"20231108153827"},"Children":[{"Type":"NodeText","Data":"大家试想，CPU 指令是可以直接操作硬件的，"},{"Type":"NodeTextMark","Properties":{"style":"background-color: var(--b3-card-success-background); color: var(--b3-card-success-color);"},"TextMarkType":"text","TextMarkTextContent":"要是因为指令操作的不规范，造成的错误是会影响整个 计算机系统 的。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"background-color: var(--b3-card-success-background); color: var(--b3-card-success-color);\"}"},{"Type":"NodeText","Data":"好比你写 一个程序，但是因为你对 硬件操作 不熟悉，出现问题，那么影响范围是多大？是整个计算机系统，操作系统内核、及其其他所有正在运行的程序，都会因为你操作失误而受到不可挽回的错误，那么你只有重启整个计算机才行。"}]},{"ID":"20231108153827-m4c8cje","Type":"NodeParagraph","Properties":{"id":"20231108153827-m4c8cje","updated":"20231108153839"},"Children":[{"Type":"NodeText","Data":"而对于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"硬件的操作"},{"Type":"NodeText","Data":"​ 是非常复杂的，参数众多，出问题的几率相当大，必须及其谨慎的进行操作，这对于个人开发者来说是个艰巨的任务，同时个人开发者在这方面也是不被信任的。所以 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"操作系统内核"},{"Type":"NodeText","Data":"​ 直接屏蔽了个人开发者对于硬件操作的可能，我都不让你能碰到这些 CPU 指令，你还能搞个大新闻出来嘛~"}]},{"ID":"20231108153847-qyt0n7v","Type":"NodeParagraph","Properties":{"id":"20231108153847-qyt0n7v","updated":"20231108153855"},"Children":[{"Type":"NodeText","Data":"这方面 系统内核 对 硬件操作 进行了封装处理，对外提供标准函数库，操作更简单、更安全。比如 我们要打开一个文件，C标准函数库中对应的是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fopen()"},{"Type":"NodeText","Data":"​，其内部封装的是内核中的系统函数"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"open()"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231108154256-wb6utri","Type":"NodeParagraph","Properties":{"id":"20231108154256-wb6utri","updated":"20231108154257"},"Children":[{"Type":"NodeText","Data":"因为这个需求，硬件设备商直接提供了硬件级别的支持，做法就是对 CPU 指令设置了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"权限"},{"Type":"NodeText","Data":"​，不同级别的权限可以使用的 CPU 指令是有限制的。以 Inter CPU 为例，Inter 把 CPU 指令操作的权限划为4级："}]},{"ID":"20231108154306-ws4igqb","Type":"NodeList","ListData":{},"Properties":{"id":"20231108154306-ws4igqb","updated":"20231108154306"},"Children":[{"ID":"20231108154306-kcuf20q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154306-kcuf20q","updated":"20231108154306"},"Children":[{"ID":"20231108154306-g2uddx4","Type":"NodeParagraph","Properties":{"id":"20231108154306-g2uddx4","updated":"20231108154306"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 0"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231108154306-3pdjvna","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154306-3pdjvna","updated":"20231108154306"},"Children":[{"ID":"20231108154306-4201mk0","Type":"NodeParagraph","Properties":{"id":"20231108154306-4201mk0","updated":"20231108154306"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 1"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231108154306-9gqt4ez","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154306-9gqt4ez","updated":"20231108154306"},"Children":[{"ID":"20231108154306-r4s76ux","Type":"NodeParagraph","Properties":{"id":"20231108154306-r4s76ux","updated":"20231108154306"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 2"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231108154306-p39b07t","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154306-p39b07t","updated":"20231108154306"},"Children":[{"ID":"20231108154306-xx4vc10","Type":"NodeParagraph","Properties":{"id":"20231108154306-xx4vc10","updated":"20231108154306"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 3"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20231108154309-fiwnj33","Type":"NodeParagraph","Properties":{"id":"20231108154309-fiwnj33","updated":"20231108154319"},"Children":[{"Type":"NodeText","Data":"其中 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 0"},{"Type":"NodeText","Data":"​ 权限最高，可以使用所有 CPU 指令，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 3"},{"Type":"NodeText","Data":"​ 权限最低，仅能使用常规 CPU 指令，这个级别的权限不能使用访问硬件资源的指令，比如 IO 读写、网卡访问、申请内存都不行，都没有权限."}]},{"ID":"20231108154329-3tilkwr","Type":"NodeParagraph","Properties":{"id":"20231108154329-3tilkwr","updated":"20231108154329"},"Children":[{"Type":"NodeText","Data":"Linux 系统内核采用了："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 0"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 3"},{"Type":"NodeText","Data":"​ 这2个权限"}]},{"ID":"20231108154329-stdtzm8","Type":"NodeList","ListData":{},"Properties":{"id":"20231108154329-stdtzm8","updated":"20231108154329"},"Children":[{"ID":"20231108154329-88jvwfa","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154329-88jvwfa","style":"color: var(--b3-font-color3); background-color: var(--b3-font-background3);","updated":"20231108154329"},"Children":[{"ID":"20231108154329-j78it77","Type":"NodeParagraph","Properties":{"id":"20231108154329-j78it77","updated":"20231108154332"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 0"},{"Type":"NodeText","Data":"​ 被叫做 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"内核态"},{"Type":"NodeText","Data":"​，完全在 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"操作系统内核"},{"Type":"NodeText","Data":" 中运行，由专门的 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内核线程"},{"Type":"NodeText","Data":" 在 CPU 中执行其任务"}]}]},{"ID":"20231108154329-xejbqk2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231108154329-xejbqk2","style":"color: var(--b3-font-color3); background-color: var(--b3-font-background3);","updated":"20231108154329"},"Children":[{"ID":"20231108154329-0jjy1p4","Type":"NodeParagraph","Properties":{"id":"20231108154329-0jjy1p4","updated":"20231108154329"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ring 3"},{"Type":"NodeText","Data":"​ 被叫做 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"用户态"},{"Type":"NodeText","Data":"​，在 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"应用程序"},{"Type":"NodeText","Data":" 中运行，由 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用户线程"},{"Type":"NodeText","Data":" 在 CPU 中执行其任务"}]}]}]},{"ID":"20231108154346-vvmeipw","Type":"NodeParagraph","Properties":{"id":"20231108154346-vvmeipw"}}]}