{"ID":"20231011091235-yypew1y","Spec":"1","Type":"NodeDocument","Properties":{"id":"20231011091235-yypew1y","tags":"未完成,楼仔公众号,苏三说技术公众号","title":"如何设计一个高并发系统？","updated":"20231011095208"},"Children":[{"ID":"20231011094242-x52l676","Type":"NodeParagraph","Properties":{"id":"20231011094242-x52l676","updated":"20231011094242"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"如何设计一个高并发系统"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/如何设计一个高并发系统-20231011094242-5b2mucg.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231011094102-3fuql5s","Type":"NodeParagraph","Properties":{"id":"20231011094102-3fuql5s","updated":"20231011094111"},"Children":[{"Type":"NodeText","Data":"​​"}]},{"ID":"20231011091235-v5ujl4j","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231011091235-v5ujl4j","updated":"20231011094059"},"Children":[{"Type":"NodeText","Data":"页面静态化"}]},{"ID":"20231011094034-h005c32","Type":"NodeParagraph","Properties":{"id":"20231011094034-h005c32","updated":"20231011094034"},"Children":[{"Type":"NodeText","Data":"对于高并发系统的页面功能，我们必须要做"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"静态化"},{"Type":"NodeText","Data":"​设计。"}]},{"ID":"20231011094034-fchd0s5","Type":"NodeParagraph","Properties":{"id":"20231011094034-fchd0s5","updated":"20231011094034"},"Children":[{"Type":"NodeText","Data":"如果并发访问系统的用户非常多，每次用户访问页面的时候，都通过服务器动态渲染，会导致服务端承受过大的压力，而导致页面无法正常加载的情况发生。"}]},{"ID":"20231011094043-bzuumec","Type":"NodeParagraph","Properties":{"id":"20231011094043-bzuumec","updated":"20231011094043"},"Children":[{"Type":"NodeText","Data":"我们可以使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Freemarker"},{"Type":"NodeText","Data":"​或"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Velocity"},{"Type":"NodeText","Data":"​模板引擎，实现页面静态化功能。"}]},{"ID":"20231011094043-4u4tecr","Type":"NodeParagraph","Properties":{"id":"20231011094043-4u4tecr","updated":"20231011094043"},"Children":[{"Type":"NodeText","Data":"以商城官网首页为例，我们可以在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Job"},{"Type":"NodeText","Data":"​中，每隔一段时间，查询出所有需要在首页展示的数据，汇总到一起，使用模板引擎生成到html文件当中。"}]},{"ID":"20231011094043-5se6jg7","Type":"NodeParagraph","Properties":{"id":"20231011094043-5se6jg7","updated":"20231011094043"},"Children":[{"Type":"NodeText","Data":"然后将该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"html"},{"Type":"NodeText","Data":"​文件，通过"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​脚本，自动同步到前端页面相关的服务器上。"}]},{"ID":"20231011094045-i0rzhc3","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231011094045-i0rzhc3","updated":"20231011094053"},"Children":[{"Type":"NodeText","Data":"CDN加速"}]},{"ID":"20231011094255-e7zy6ln","Type":"NodeParagraph","Properties":{"id":"20231011094255-e7zy6ln","updated":"20231011094255"},"Children":[{"Type":"NodeText","Data":"虽说页面静态化可以提升网站网页的访问速度，但还不够，因为用户分布在全国各地，有些人在北京，有些人在成都，有些人在深圳，地域相差很远，他们访问网站的网速各不相同。"}]},{"ID":"20231011094255-nkfrohi","Type":"NodeParagraph","Properties":{"id":"20231011094255-nkfrohi","updated":"20231011094255"},"Children":[{"Type":"NodeText","Data":"如何才能让用户最快访问到活动页面呢？"}]},{"ID":"20231011094255-1oabx5x","Type":"NodeParagraph","Properties":{"id":"20231011094255-1oabx5x","updated":"20231011094255"},"Children":[{"Type":"NodeText","Data":"这就需要使用CDN，它的全称是Content Delivery Network，即内容分发网络。"}]},{"ID":"20231011094304-b5fqu5w","Type":"NodeParagraph","Properties":{"id":"20231011094304-b5fqu5w","updated":"20231011094304"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231011094304-blmzdkj.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231011094313-tinr9zu","Type":"NodeParagraph","Properties":{"id":"20231011094313-tinr9zu","updated":"20231011094313"},"Children":[{"Type":"NodeText","Data":"使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。"}]},{"ID":"20231011094313-8ywx93u","Type":"NodeParagraph","Properties":{"id":"20231011094313-8ywx93u","updated":"20231011094313"},"Children":[{"Type":"NodeText","Data":"CDN加速的基本原理是：将网站的静态内容（如图片、CSS、JavaScript文件等）复制并存储到分布在全球各地的服务器节点上。"}]},{"ID":"20231011094313-n789y7o","Type":"NodeParagraph","Properties":{"id":"20231011094313-n789y7o","updated":"20231011094313"},"Children":[{"Type":"NodeText","Data":"当用户请求访问网站时，CDN系统会根据用户的地理位置，自动将内容分发给离用户最近的服务器，从而实现快速访问。"}]},{"ID":"20231011094313-n2lntck","Type":"NodeParagraph","Properties":{"id":"20231011094313-n2lntck","updated":"20231011094313"},"Children":[{"Type":"NodeText","Data":"国内常见的CDN提供商有阿里云CDN、腾讯云CDN、百度云加速等，它们提供了全球分布的节点服务器，为全球范围内的网站加速服务。"}]},{"ID":"20231011094607-yn7jlrd","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231011094607-yn7jlrd","updated":"20231011094612"},"Children":[{"Type":"NodeText","Data":"缓存"}]},{"ID":"20231011094618-ofp01zt","Type":"NodeParagraph","Properties":{"id":"20231011094618-ofp01zt","updated":"20231011094618"},"Children":[{"Type":"NodeText","Data":"在高并发的系统中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"缓存"},{"Type":"NodeText","Data":"​可以说是必不可少的技术之一。"}]},{"ID":"20231011094618-po7p5l4","Type":"NodeParagraph","Properties":{"id":"20231011094618-po7p5l4","updated":"20231011094618"},"Children":[{"Type":"NodeText","Data":"目前缓存有两种："}]},{"ID":"20231011094618-pgjqoa8","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20231011094618-pgjqoa8","updated":"20231011094618"},"Children":[{"ID":"20231011094618-7c4n6pv","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20231011094618-7c4n6pv","updated":"20231011094618"},"Children":[{"ID":"20231011094618-o679832","Type":"NodeParagraph","Properties":{"id":"20231011094618-o679832","updated":"20231011094618"},"Children":[{"Type":"NodeText","Data":"基于应用服务器的内存缓存，也就是我们说的二级缓存。"}]}]},{"ID":"20231011094618-vuf27xq","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20231011094618-vuf27xq","updated":"20231011094618"},"Children":[{"ID":"20231011094618-yf0x226","Type":"NodeParagraph","Properties":{"id":"20231011094618-yf0x226","updated":"20231011094618"},"Children":[{"Type":"NodeText","Data":"使用缓存中间件，比如：Redis、Memcached等，这种是分布式缓存。"}]}]}]},{"ID":"20231011094627-1s2gl0v","Type":"NodeParagraph","Properties":{"id":"20231011094627-1s2gl0v","updated":"20231011094627"},"Children":[{"Type":"NodeText","Data":"这两种缓存各有优缺点。"}]},{"ID":"20231011094627-xc4ljmg","Type":"NodeParagraph","Properties":{"id":"20231011094627-xc4ljmg","updated":"20231011094627"},"Children":[{"Type":"NodeText","Data":"二级缓存的性能更好，但因为是基于应用服务器内存的缓存，如果系统部署到了多个服务器节点，可能会存在数据不一致的情况。"}]},{"ID":"20231011094627-x211755","Type":"NodeParagraph","Properties":{"id":"20231011094627-x211755","updated":"20231011094627"},"Children":[{"Type":"NodeText","Data":"而Redis或Memcached虽说性能上比不上二级缓存，但它们是分布式缓存，避免多个服务器节点数据不一致的问题。"}]},{"ID":"20231011094627-ltgouea","Type":"NodeParagraph","Properties":{"id":"20231011094627-ltgouea","updated":"20231011094627"},"Children":[{"Type":"NodeText","Data":"缓存的用法一般是这样的："}]},{"ID":"20231011094641-vaelna8","Type":"NodeParagraph","Properties":{"id":"20231011094641-vaelna8","updated":"20231011094641"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231011094641-xhkl3zo.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231011094658-5o1z3w3","Type":"NodeParagraph","Properties":{"id":"20231011094658-5o1z3w3","updated":"20231011094658"},"Children":[{"Type":"NodeText","Data":"使用缓存之后，可以减轻访问数据库的压力，显著的提升系统的性能。"}]},{"ID":"20231011094658-kl4t92h","Type":"NodeParagraph","Properties":{"id":"20231011094658-kl4t92h","updated":"20231011094658"},"Children":[{"Type":"NodeText","Data":"有些业务场景，甚至会分布式缓存和二级缓存一起使用。"}]},{"ID":"20231011094658-egl79u4","Type":"NodeParagraph","Properties":{"id":"20231011094658-egl79u4","updated":"20231011094658"},"Children":[{"Type":"NodeText","Data":"比如获取商品分类数据，流程如下："}]},{"ID":"20231011094724-ih7y601","Type":"NodeParagraph","Properties":{"id":"20231011094724-ih7y601","updated":"20231011094724"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231011094724-v8n6w6k.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231011094735-snn0t6h","Type":"NodeParagraph","Properties":{"id":"20231011094735-snn0t6h","updated":"20231011094736"},"Children":[{"Type":"NodeText","Data":"不过引入缓存，虽说给我们的系统性能带来了提升，但同时也给我们带来了一些新的问题，比如：《"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==\u0026amp;mid=2247493521\u0026amp;idx=1\u0026amp;sn=bff84e7a819d79e4b8eb7e722e96ddfc\u0026amp;chksm=c0e83f79f79fb66f2e7bf03a104580b404ea0a3c977846e428f13c1f12fbad46d4d778b2da14\u0026amp;token=902535653\u0026amp;lang=zh_CN\u0026amp;scene=21#wechat_redirect","TextMarkTextContent":"数据库和缓存双向数据库一致性问题"},{"Type":"NodeText","Data":"》、《"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==\u0026amp;mid=2247491225\u0026amp;idx=1\u0026amp;sn=bfb14f28911efaa6e3a615870fff9a5c\u0026amp;chksm=c0ebc671f79c4f6718a63bbec91d79a4b05e1dd2a7c00ed9bf6a9f582abd4c6e5c870148ff89\u0026amp;token=902535653\u0026amp;lang=zh_CN\u0026amp;scene=21#wechat_redirect","TextMarkTextContent":"缓存穿透、击穿和雪崩问题"},{"Type":"NodeText","Data":"》等。"}]},{"ID":"20231011094750-9dnorb5","Type":"NodeParagraph","Properties":{"id":"20231011094750-9dnorb5","updated":"20231011094750"},"Children":[{"Type":"NodeText","Data":"我们在使用缓存时，一定要结合实际业务场景，切记不要为了缓存而缓存。"}]},{"ID":"20231011095134-krrjq8l","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231011095134-krrjq8l","updated":"20231011095139"},"Children":[{"Type":"NodeText","Data":"异步"}]},{"ID":"20231011095147-2xi6r5t","Type":"NodeParagraph","Properties":{"id":"20231011095147-2xi6r5t","updated":"20231011095147"},"Children":[{"Type":"NodeText","Data":"有时候，我们在高并发系统当中，某些接口的业务逻辑，没必要都同步执行。"}]},{"ID":"20231011095147-0j5pl1z","Type":"NodeParagraph","Properties":{"id":"20231011095147-0j5pl1z","updated":"20231011095147"},"Children":[{"Type":"NodeText","Data":"比如有个用户请求接口中，需要做业务操作，发站内通知，和记录操作日志。为了实现起来比较方便，通常我们会将这些逻辑放在接口中同步执行，势必会对接口性能造成一定的影响。"}]},{"ID":"20231011095151-x0hq0ru","Type":"NodeParagraph","Properties":{"id":"20231011095151-x0hq0ru","updated":"20231011095152"},"Children":[{"Type":"NodeText","Data":"接口内部流程图如下："}]},{"ID":"20231011095201-nxzjz4a","Type":"NodeParagraph","Properties":{"id":"20231011095201-nxzjz4a","updated":"20231011095201"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20231011095201-bagmzyq.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231011095208-lxn2bxn","Type":"NodeParagraph","Properties":{"id":"20231011095208-lxn2bxn","updated":"20231011095208"},"Children":[{"Type":"NodeText","Data":"这个接口表面上看起来没有问题，但如果你仔细梳理一下业务逻辑，会发现只有业务操作才是核心逻辑，其他的功能都是非核心逻辑。"}]},{"ID":"20231011095208-evgyqvj","Type":"NodeParagraph","Properties":{"id":"20231011095208-evgyqvj","updated":"20231011095208"},"Children":[{"Type":"NodeText","Data":"在这里有个原则就是：核心逻辑可以同步执行，同步写库。非核心逻辑，可以异步执行，异步写库。"}]},{"ID":"20231011095208-mtpvn2p","Type":"NodeParagraph","Properties":{"id":"20231011095208-mtpvn2p","updated":"20231011095208"},"Children":[{"Type":"NodeText","Data":"上面这个例子中，发站内通知和用户操作日志功能，对实时性要求不高，即使晚点写库，用户无非是晚点收到站内通知，或者运营晚点看到用户操作日志，对业务影响不大，所以完全可以异步处理。"}]},{"ID":"20231011095208-b2kiikn","Type":"NodeParagraph","Properties":{"id":"20231011095208-b2kiikn","updated":"20231011095208"},"Children":[{"Type":"NodeText","Data":"通常异步主要有两种：多线程 和 mq。"}]}]}