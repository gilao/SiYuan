{"ID":"20230727000922-wt9xyav","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f9e6","id":"20230727000922-wt9xyav","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230727000922-wt9xyav\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230727000923-pkcv1l3\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230727000955-yqeoinz\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230727000923-pkcv1l3\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","tags":"Go init函数","title":"30. init函数","updated":"20230727000922"},"Children":[{"ID":"20230727000923-pkcv1l3","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230727000923-pkcv1l3","updated":"20230727000923"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"30. init函数"}]},{"ID":"20230727000924-g8kp7vb","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000924-g8kp7vb","updated":"20230727000924"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"介绍"}]},{"ID":"20230727000925-zt3inh0","Type":"NodeParagraph","Properties":{"id":"20230727000925-zt3inh0","updated":"20230727000925"},"Children":[{"Type":"NodeText","Data":"init() 函数是一个特殊的函数，存在以下特性："}]},{"ID":"20230727000926-dsjxmpz","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000926-dsjxmpz","updated":"20230727000926"},"Children":[{"ID":"20230727000927-op1733u","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230727000927-op1733u","updated":"20230727000927"},"Children":[{"ID":"20230727000928-r8uypty","Type":"NodeParagraph","Properties":{"id":"20230727000928-r8uypty","updated":"20230727000928"},"Children":[{"Type":"NodeText","Data":"不能被其他函数调用，而是在main函数执行之前自动的被调用"}]}]},{"ID":"20230727000929-ru9pk0r","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230727000929-ru9pk0r","updated":"20230727000929"},"Children":[{"ID":"20230727000930-woou2aq","Type":"NodeParagraph","Properties":{"id":"20230727000930-woou2aq","updated":"20230727000930"},"Children":[{"Type":"NodeText","Data":"init 函数不能作为参数传入"}]}]},{"ID":"20230727000931-m5qitmi","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230727000931-m5qitmi","updated":"20230727000931"},"Children":[{"ID":"20230727000932-6ewdnpg","Type":"NodeParagraph","Properties":{"id":"20230727000932-6ewdnpg","updated":"20230727000932"},"Children":[{"Type":"NodeText","Data":"不能有传参或者返回值"}]}]}]},{"ID":"20230727000933-e2tvfy0","Type":"NodeParagraph","Properties":{"id":"20230727000933-e2tvfy0","updated":"20230727000933"},"Children":[{"Type":"NodeText","Data":"《the way to go》中的解释："}]},{"ID":"20230727000934-u9ul1t6","Type":"NodeParagraph","Properties":{"id":"20230727000934-u9ul1t6","updated":"20230727000934"},"Children":[{"Type":"NodeText","Data":"变量除了可以在全局声明中初始化，也可以在 init ()函数中初始化。这是一类非常特殊的函数，它不能够被人为调用，而是在每个包完成初始化后自动执行，并且执行优先级比 main 函数高。"}]},{"ID":"20230727000935-86bwea6","Type":"NodeParagraph","Properties":{"id":"20230727000935-86bwea6","updated":"20230727000935"},"Children":[{"Type":"NodeText","Data":"初始化总是以单线程执行，并且按照包的依赖关系顺序执行。"}]},{"ID":"20230727000936-ug0xcu9","Type":"NodeParagraph","Properties":{"id":"20230727000936-ug0xcu9","updated":"20230727000936"},"Children":[{"Type":"NodeText","Data":"一个可能的用途是在开始执行程序之前对数据进行检验或修复，以保证程序状态的正确性。"}]},{"ID":"20230727000937-0c8tnd6","Type":"NodeParagraph","Properties":{"id":"20230727000937-0c8tnd6","updated":"20230727000937"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"1、每个源文件能包含多个init函数"},{"Type":"NodeText","Data":"："}]},{"ID":"20230727000938-4z5hya5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"Z28=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000938-4z5hya5","updated":"20230727000938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"package main\n\nimport \"fmt\"\n//经测试，每个源文件可以包含多个init函数，而且会按先后顺序执行，优先级高于main\nfunc main() {\n\tfmt.Println(\"main\")\n}\n\nfunc init() {\n\tfmt.Println(\"init1\")\n}\n\nfunc init() {\n\tfmt.Println(\"init2\")\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000939-4vc6219","Type":"NodeParagraph","Properties":{"id":"20230727000939-4vc6219","updated":"20230727000939"},"Children":[{"Type":"NodeText","Data":"上述程序的运行结果是："}]},{"ID":"20230727000940-7v4k8a7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000940-7v4k8a7","updated":"20230727000940"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"init1\ninit2\nmain\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000941-gxb4bmg","Type":"NodeParagraph","Properties":{"id":"20230727000941-gxb4bmg","updated":"20230727000941"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"2、导包顺序决定init函数执行顺序"},{"Type":"NodeText","Data":"："}]},{"ID":"20230727000942-g0omg1f","Type":"NodeParagraph","Properties":{"id":"20230727000942-g0omg1f","updated":"20230727000942"},"Children":[{"Type":"NodeText","Data":"go中不同包中init函数的执行顺序是根据包的导入关系决定的。"}]},{"ID":"20230727000943-7d8l4x2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"Z28=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000943-7d8l4x2","updated":"20230727000943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"//=====================main包\npackage main\n\nimport (\n\t\"fmt\"\n\t_ \"mytest/level1\"\n)\n\nfunc main() {\n\tfmt.Println(\"main\")\n}\n\n//=====================level1包\npackage level1\n\nimport (\n\t\"fmt\"\n\t_ \"mytest/level2\"\n)\n\nfunc init() {\n\tfmt.Println(\"level1 init\")\n}\n//=====================level2包\npackage level2\n\nimport \"fmt\"\n\nfunc init() {\n\tfmt.Println(\"level2 init\")\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000944-r093ca8","Type":"NodeParagraph","Properties":{"id":"20230727000944-r093ca8","updated":"20230727000944"},"Children":[{"Type":"NodeText","Data":"从以上代码可以看出，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"main"},{"Type":"NodeText","Data":"包导入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"level1"},{"Type":"NodeText","Data":"包，而在"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"level1"},{"Type":"NodeText","Data":"包内导入"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"level2"},{"Type":"NodeText","Data":"包。"}]},{"ID":"20230727000945-xy7y2n9","Type":"NodeParagraph","Properties":{"id":"20230727000945-xy7y2n9","updated":"20230727000945"},"Children":[{"Type":"NodeText","Data":"执行结果："}]},{"ID":"20230727000946-xhlkgmw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000946-xhlkgmw","updated":"20230727000946"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"level2 init\nlevel1 init\nmain\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000947-z4rgonp","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230727000947-z4rgonp","updated":"20230727000947"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"应用场景实例"}]},{"ID":"20230727000948-0bneyij","Type":"NodeParagraph","Properties":{"id":"20230727000948-0bneyij","updated":"20230727000948"},"Children":[{"Type":"NodeText","Data":"1、对变量进行初始化"}]},{"ID":"20230727000949-8b9rs94","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000949-8b9rs94","updated":"20230727000949"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"package trans\n\nimport \"math\"\n\nvar Pi float64\n\nfunc init() {\n   Pi = 4 * math.Atan(1)\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000950-uthr7kf","Type":"NodeParagraph","Properties":{"id":"20230727000950-uthr7kf","updated":"20230727000950"},"Children":[{"Type":"NodeText","Data":"2、当一个程序开始之前调用后台执行的 goroutine"}]},{"ID":"20230727000951-t4f1wag","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000951-t4f1wag","updated":"20230727000951"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"func init() {\n   go backend()\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000952-6a0z9sc","Type":"NodeParagraph","Properties":{"id":"20230727000952-6a0z9sc","updated":"20230727000952"},"Children":[{"Type":"NodeText","Data":"3、用于注册驱动"}]},{"ID":"20230727000953-lklxgm6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230727000953-lklxgm6","updated":"20230727000953"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"//=====================postgres包\npackage postgres\nimport (\n    \"database/sql\"\n    \"database/sql/driver\"\n    \"errors\"\n)\n// PostgresDriver provides our implementation for the\n// sql package.\ntype PostgresDriver struct{}\n// Open provides a connection to the database.\nfunc (dr PostgresDriver) Open(string) (driver.Conn, error) {\n    return nil, errors.New(\"Unimplemented\")\n}\nvar d *PostgresDriver\n// init is called prior to main.\nfunc init() {\n    d = new(PostgresDriver)\n    sql.Register(\"postgres\", d)\n}\n//=====================main包\npackage main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/goinaction/code/chapter3/dbdriver/postgres\"\n)\n\nfunc main() {\n    sql.Open(\"postgres\", \"mydb\")\n}\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230727000954-6tm733q","Type":"NodeParagraph","Properties":{"id":"20230727000954-6tm733q","updated":"20230727000954"},"Children":[{"Type":"NodeText","Data":"我再把今天文章里得到的结论总结一下，一共有五条："}]},{"ID":"20230727000955-yqeoinz","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000955-yqeoinz","updated":"20230727000955"},"Children":[{"ID":"20230727000956-9ovq699","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000956-9ovq699","updated":"20230727000956"},"Children":[{"ID":"20230727000957-yp0u9bp","Type":"NodeParagraph","Properties":{"id":"20230727000957-yp0u9bp","updated":"20230727000957"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"包级别变量的初始化先于包内"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"init"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"函数的执行。"}]}]},{"ID":"20230727000958-wvk0lvu","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000958-wvk0lvu","updated":"20230727000958"},"Children":[{"ID":"20230727000959-oijys8p","Type":"NodeParagraph","Properties":{"id":"20230727000959-oijys8p","updated":"20230727000959"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"一个包下可以有多个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"init"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"函数，每个文件也可以有多个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"init"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":" 函数。"}]}]},{"ID":"20230727000960-g3ic6fx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000960-g3ic6fx","updated":"20230727000960"},"Children":[{"ID":"20230727000961-h9ljnjm","Type":"NodeParagraph","Properties":{"id":"20230727000961-h9ljnjm","updated":"20230727000961"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"多个 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"init"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":" 函数按照它们的文件名顺序逐个初始化。"}]}]},{"ID":"20230727000962-n4k08u5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000962-n4k08u5","updated":"20230727000962"},"Children":[{"ID":"20230727000963-vjvowkx","Type":"NodeParagraph","Properties":{"id":"20230727000963-vjvowkx","updated":"20230727000963"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"应用初始化时初始化工作的顺序是，从被导入的最深层包开始进行初始化，层层递出最后到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"main"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"包。"}]}]},{"ID":"20230727000964-i5atslp","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000964-i5atslp","updated":"20230727000964"},"Children":[{"ID":"20230727000965-28g3819","Type":"NodeParagraph","Properties":{"id":"20230727000965-28g3819","updated":"20230727000965"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"不管包被导入多少次，包内的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"init"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"函数只会执行一次。"}]}]},{"ID":"20230727000966-bp04l7s","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230727000966-bp04l7s","updated":"20230727000966"},"Children":[{"ID":"20230727000967-rd2408o","Type":"NodeParagraph","Properties":{"id":"20230727000967-rd2408o","updated":"20230727000967"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"应用在所有初始化工作完成后才会执行"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong code","TextMarkTextContent":"main"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"函数。"}]}]}]}]}