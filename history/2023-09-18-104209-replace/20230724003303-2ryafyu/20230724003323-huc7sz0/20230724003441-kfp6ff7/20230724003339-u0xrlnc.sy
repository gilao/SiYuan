{"ID":"20230724003339-u0xrlnc","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230724003339-u0xrlnc","title":"4. NFS服务器搭建配置","updated":"20230724003339"},"Children":[{"ID":"20230724003340-z5u95z4","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230724003340-z5u95z4","updated":"20230724003340"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"NFS服务器搭建配置"}]},{"ID":"20230724003341-sppapci","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230724003341-sppapci","updated":"20230724003341"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"1.NFS 部署步骤"}]},{"ID":"20230724003342-19lgjz7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003342-19lgjz7","updated":"20230724003342"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"1. 检查NFS是否安装"}]},{"ID":"20230724003343-t595pfy","Type":"NodeParagraph","Properties":{"id":"20230724003343-t595pfy","updated":"20230724003343"},"Children":[{"Type":"NodeText","Data":"rpm -qa | grep  nfs-utilsd"}]},{"ID":"20230724003344-qh766fu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003344-qh766fu","updated":"20230724003344"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"2. 如果未安装，执行如下安装命令"}]},{"ID":"20230724003345-pzgtc6z","Type":"NodeParagraph","Properties":{"id":"20230724003345-pzgtc6z","updated":"20230724003345"},"Children":[{"Type":"NodeText","Data":"yum install nfs-utils"}]},{"ID":"20230724003346-b1uc79p","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003346-b1uc79p","updated":"20230724003346"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"3. 查看当前nfs 服务所支持得nfs版本"}]},{"ID":"20230724003347-k2drq7s","Type":"NodeParagraph","Properties":{"id":"20230724003347-k2drq7s","updated":"20230724003347"},"Children":[{"Type":"NodeText","Data":"cat /proc/fs/nfsd/versions"}]},{"ID":"20230724003348-xqb8tcu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003348-xqb8tcu","updated":"20230724003348"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"4. NFS 服务操作命令"}]},{"ID":"20230724003349-6p3xtyb","Type":"NodeParagraph","Properties":{"id":"20230724003349-6p3xtyb","updated":"20230724003349"},"Children":[{"Type":"NodeText","Data":"查看NFS 服务状态"}]},{"ID":"20230724003350-ppske3j","Type":"NodeParagraph","Properties":{"id":"20230724003350-ppske3j","updated":"20230724003350"},"Children":[{"Type":"NodeText","Data":"systemctl status nfs-server"}]},{"ID":"20230724003351-pfefaz2","Type":"NodeParagraph","Properties":{"id":"20230724003351-pfefaz2","updated":"20230724003351"},"Children":[{"Type":"NodeText","Data":"启动NFS服务"}]},{"ID":"20230724003352-xyk3ixw","Type":"NodeParagraph","Properties":{"id":"20230724003352-xyk3ixw","updated":"20230724003352"},"Children":[{"Type":"NodeText","Data":"systemctl start nfs-server"}]},{"ID":"20230724003353-xhlp0ga","Type":"NodeParagraph","Properties":{"id":"20230724003353-xhlp0ga","updated":"20230724003353"},"Children":[{"Type":"NodeText","Data":"停止NFS服务"}]},{"ID":"20230724003354-zovwc2o","Type":"NodeParagraph","Properties":{"id":"20230724003354-zovwc2o","updated":"20230724003354"},"Children":[{"Type":"NodeText","Data":"systemctl stop nfs-server"}]},{"ID":"20230724003355-eflii7m","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003355-eflii7m","updated":"20230724003355"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"5. 配置共享文件目录"}]},{"ID":"20230724003356-y2sx70e","Type":"NodeParagraph","Properties":{"id":"20230724003356-y2sx70e","updated":"20230724003356"},"Children":[{"Type":"NodeText","Data":"创建目录树"}]},{"ID":"20230724003357-6qsknkc","Type":"NodeParagraph","Properties":{"id":"20230724003357-6qsknkc","updated":"20230724003357"},"Children":[{"Type":"NodeText","Data":"mkdir -p /data/nfs"}]},{"ID":"20230724003358-uckuwij","Type":"NodeParagraph","Properties":{"id":"20230724003358-uckuwij","updated":"20230724003358"},"Children":[{"Type":"NodeText","Data":"进入data 目录"}]},{"ID":"20230724003359-r3hriul","Type":"NodeParagraph","Properties":{"id":"20230724003359-r3hriul","updated":"20230724003359"},"Children":[{"Type":"NodeText","Data":"cd  /data"}]},{"ID":"20230724003360-0dwf39q","Type":"NodeParagraph","Properties":{"id":"20230724003360-0dwf39q","updated":"20230724003360"},"Children":[{"Type":"NodeText","Data":"更改data 目录下的所有文件目录所有者为 worker"}]},{"ID":"20230724003361-7bb6z7k","Type":"NodeParagraph","Properties":{"id":"20230724003361-7bb6z7k","updated":"20230724003361"},"Children":[{"Type":"NodeText","Data":"chown worker:worker *"}]},{"ID":"20230724003362-pf6mzrq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003362-pf6mzrq","updated":"20230724003362"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"6.编辑配置文件 及做本地挂载测试"}]},{"ID":"20230724003363-ci8heg5","Type":"NodeParagraph","Properties":{"id":"20230724003363-ci8heg5","updated":"20230724003363"},"Children":[{"Type":"NodeText","Data":"编辑配置文件"}]},{"ID":"20230724003364-5a60wiw","Type":"NodeParagraph","Properties":{"id":"20230724003364-5a60wiw","updated":"20230724003364"},"Children":[{"Type":"NodeText","Data":"vi /etc/exports"}]},{"ID":"20230724003365-pu6tfb5","Type":"NodeParagraph","Properties":{"id":"20230724003365-pu6tfb5","updated":"20230724003365"},"Children":[{"Type":"NodeText","Data":"增加一下内容，其中 192.168.153.134 为本机IP"}]},{"ID":"20230724003366-t8zfgpi","Type":"NodeParagraph","Properties":{"id":"20230724003366-t8zfgpi","updated":"20230724003366"},"Children":[{"Type":"NodeText","Data":"/data/nfs  192.168.153.*(rw,sync,all_squash,anonuid=1000,anongid=1001)"}]},{"ID":"20230724003367-13nfqwe","Type":"NodeParagraph","Properties":{"id":"20230724003367-13nfqwe","updated":"20230724003367"},"Children":[{"Type":"NodeText","Data":"支持所有IP可访问共享在磁盘"}]},{"ID":"20230724003368-l344yxo","Type":"NodeParagraph","Properties":{"id":"20230724003368-l344yxo","updated":"20230724003368"},"Children":[{"Type":"NodeText","Data":"/data/nfs *(insecure,rw,async,no_root_squash)"}]},{"ID":"20230724003369-ud6brjw","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003369-ud6brjw","updated":"20230724003369"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"7. 配置完成，使 nfs 配置生效"}]},{"ID":"20230724003370-abdh11j","Type":"NodeParagraph","Properties":{"id":"20230724003370-abdh11j","updated":"20230724003370"},"Children":[{"Type":"NodeText","Data":"使用exportfs 使用程序有选择地导出目录，而无需重新启动NFS 服务"}]},{"ID":"20230724003371-934tdxa","Type":"NodeParagraph","Properties":{"id":"20230724003371-934tdxa","updated":"20230724003371"},"Children":[{"Type":"NodeText","Data":"sudo exportfs -rv"}]},{"ID":"20230724003372-bgey9tr","Type":"NodeParagraph","Properties":{"id":"20230724003372-bgey9tr","updated":"20230724003372"},"Children":[{"Type":"NodeText","Data":"exportfs: could not open /var/lib/nfs/.etab.lock for locking: errno 13 (Permission denied)"}]},{"ID":"20230724003373-9vg78dl","Type":"NodeParagraph","Properties":{"id":"20230724003373-9vg78dl","updated":"20230724003373"},"Children":[{"Type":"NodeText","Data":"**[解决方案]：sudo exportfs -r **"}]},{"ID":"20230724003374-5ubptwr","Type":"NodeParagraph","Properties":{"id":"20230724003374-5ubptwr","updated":"20230724003374"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"sudo service nfs restart"}]},{"ID":"20230724003375-p0z5q7s","Type":"NodeParagraph","Properties":{"id":"20230724003375-p0z5q7s","updated":"20230724003375"},"Children":[{"Type":"NodeText","Data":"查看当前配置为nfs 共享地目录及其状态"}]},{"ID":"20230724003376-4dkgli2","Type":"NodeParagraph","Properties":{"id":"20230724003376-4dkgli2","updated":"20230724003376"},"Children":[{"Type":"NodeText","Data":"sudo exportfs -v"}]},{"ID":"20230724003377-7setif3","Type":"NodeParagraph","Properties":{"id":"20230724003377-7setif3","updated":"20230724003377"},"Children":[{"Type":"NodeText","Data":"exportfs: could not open /var/lib/nfs/.etab.lock for locking: errno 13 (Permission denied)"}]},{"ID":"20230724003378-hnqzmt7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003378-hnqzmt7","updated":"20230724003378"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"8. 挂载本机测试"}]},{"ID":"20230724003379-3vb2ted","Type":"NodeParagraph","Properties":{"id":"20230724003379-3vb2ted","updated":"20230724003379"},"Children":[{"Type":"NodeText","Data":"将远程磁盘挂载到本地"}]},{"ID":"20230724003380-y0gfhqk","Type":"NodeParagraph","Properties":{"id":"20230724003380-y0gfhqk","updated":"20230724003380"},"Children":[{"Type":"NodeText","Data":"mount 192.168.153.134：/data/nfs /mnt"}]},{"ID":"20230724003381-q29ofxt","Type":"NodeParagraph","Properties":{"id":"20230724003381-q29ofxt","updated":"20230724003381"},"Children":[{"Type":"NodeText","Data":"查看磁盘情况"}]},{"ID":"20230724003382-a0dlbi0","Type":"NodeParagraph","Properties":{"id":"20230724003382-a0dlbi0","updated":"20230724003382"},"Children":[{"Type":"NodeText","Data":"df -hT"}]},{"ID":"20230724003383-d21978u","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003383-d21978u","updated":"20230724003383"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9. 如果firewall正在运行，请允许NFS 服务，否则其他客户端无法访问"}]},{"ID":"20230724003384-caa5q1b","Type":"NodeParagraph","Properties":{"id":"20230724003384-caa5q1b","updated":"20230724003384"},"Children":[{"Type":"NodeText","Data":"firewall-cmd --add-service=nfs --permanent"}]},{"ID":"20230724003385-yi5uhy3","Type":"NodeParagraph","Properties":{"id":"20230724003385-yi5uhy3","updated":"20230724003385"},"Children":[{"Type":"NodeText","Data":"firewall-cmd --add-service={rpc-bind,mountd,nfs,nlockmgr,portmapper} --permanent"}]},{"ID":"20230724003386-9onpsvk","Type":"NodeParagraph","Properties":{"id":"20230724003386-9onpsvk","updated":"20230724003386"},"Children":[{"Type":"NodeText","Data":"firewall-cmd --reload"}]},{"ID":"20230724003387-hve16vx","Type":"NodeParagraph","Properties":{"id":"20230724003387-hve16vx","updated":"20230724003387"},"Children":[{"Type":"NodeText","Data":"需要请启用 SELinux boolean"}]},{"ID":"20230724003388-bl760qd","Type":"NodeParagraph","Properties":{"id":"20230724003388-bl760qd","updated":"20230724003388"},"Children":[{"Type":"NodeText","Data":"setsebool -P nfs_export_all_rw 1"}]},{"ID":"20230724003389-f6dktc2","Type":"NodeParagraph","Properties":{"id":"20230724003389-f6dktc2","updated":"20230724003389"},"Children":[{"Type":"NodeText","Data":"开机启动NFS"}]},{"ID":"20230724003390-u5lk56q","Type":"NodeParagraph","Properties":{"id":"20230724003390-u5lk56q","updated":"20230724003390"},"Children":[{"Type":"NodeText","Data":"systemctl enable nfs-server"}]},{"ID":"20230724003391-hjufplg","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724003391-hjufplg","updated":"20230724003391"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"10. 客户端挂载"}]},{"ID":"20230724003392-tmyjkl8","Type":"NodeParagraph","Properties":{"id":"20230724003392-tmyjkl8","updated":"20230724003392"},"Children":[{"Type":"NodeText","Data":"查询远程NFS 磁盘"}]},{"ID":"20230724003393-u7khqmd","Type":"NodeParagraph","Properties":{"id":"20230724003393-u7khqmd","updated":"20230724003393"},"Children":[{"Type":"NodeText","Data":"showmount -e 192.168.153.134"}]},{"ID":"20230724003394-65azwk2","Type":"NodeParagraph","Properties":{"id":"20230724003394-65azwk2","updated":"20230724003394"},"Children":[{"Type":"NodeText","Data":"挂载点为/home/fileserver 目录不存在时需要创建"}]},{"ID":"20230724003395-ex1avyu","Type":"NodeParagraph","Properties":{"id":"20230724003395-ex1avyu","updated":"20230724003395"},"Children":[{"Type":"NodeText","Data":"创建目录树"}]},{"ID":"20230724003396-vzfiix3","Type":"NodeParagraph","Properties":{"id":"20230724003396-vzfiix3","updated":"20230724003396"},"Children":[{"Type":"NodeText","Data":"mkdir -p /home/fileserver"}]},{"ID":"20230724003397-fo2gdz3","Type":"NodeParagraph","Properties":{"id":"20230724003397-fo2gdz3","updated":"20230724003397"},"Children":[{"Type":"NodeText","Data":"授权"}]},{"ID":"20230724003398-1q9ifzq","Type":"NodeParagraph","Properties":{"id":"20230724003398-1q9ifzq","updated":"20230724003398"},"Children":[{"Type":"NodeText","Data":"chown worker:worker /home/*"}]},{"ID":"20230724003399-rnnd7os","Type":"NodeParagraph","Properties":{"id":"20230724003399-rnnd7os","updated":"20230724003399"},"Children":[{"Type":"NodeText","Data":"挂载磁盘"}]},{"ID":"20230724003400-r6syf3j","Type":"NodeParagraph","Properties":{"id":"20230724003400-r6syf3j","updated":"20230724003400"},"Children":[{"Type":"NodeText","Data":"mount -t nfs 192.168.153.134:/data/nfs /home/fileserver"}]}]}