{"ID":"20231022100654-6m2a6uh","Spec":"1","Type":"NodeDocument","Properties":{"id":"20231022100654-6m2a6uh","tags":"公众号-熊猫云原生Go,Dockerfile,shell脚本","title":"Dockerfile 支持内置Shell脚本， 从此告别 \u0026amp;\u0026amp; 链接符号","updated":"20231022204014"},"Children":[{"ID":"20231022100655-x2ji4ab","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20231022100655-x2ji4ab","updated":"20231022101245"},"Children":[{"Type":"NodeText","Data":"Dockerfile Here-Document Syntax 语法"}]},{"ID":"20231022101245-4c8ub00","Type":"NodeParagraph","Properties":{"id":"20231022101245-4c8ub00","updated":"20231022101305"},"Children":[{"Type":"NodeText","Data":"首先， 按照官网文档将 docker engine 版本升到最新。 以 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://docs.docker.com/engine/install/ubuntu/","TextMarkTextContent":"ubuntu - docker"},{"Type":"NodeText","Data":" 为例"}]},{"ID":"20231022101306-g06l9me","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231022101306-g06l9me","updated":"20231022101313"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"sudo apt-get install docker-ce docker-ce-cli containerd.io \\\n    docker-buildx-plugin docker-compose-plugin\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231022101331-j8j8exs","Type":"NodeParagraph","Properties":{"id":"20231022101331-j8j8exs","updated":"20231022101352"},"Children":[{"Type":"NodeText","Data":"其次， 在 Docker Hub 上找到对应的 redis 官方 dockerfile"}]},{"ID":"20231022101331-b8q1txm","Type":"NodeParagraph","Properties":{"id":"20231022101331-b8q1txm","updated":"20231022101331"},"Children":[{"Type":"NodeText","Data":"可以看到， "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 内容虽然没有通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026amp;\u0026amp;"},{"Type":"NodeText","Data":"​ 链接， 但是都是使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"; 和 \\"},{"Type":"NodeText","Data":"​ 进行 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"分段，换行"},{"Type":"NodeText","Data":" 管理的， 还是有一定不便。"}]},{"ID":"20231022101404-5n8gzcq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231022101404-5n8gzcq","updated":"20231022101942"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"ZG9ja2VyZmlsZQ=="},{"Type":"NodeCodeBlockCode","Data":"RUN set -eux; \\\n    \\\n    savedAptMark=\"$(apt-mark showmanual)\"; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends \\\n        cat-certificates \\\n        wget \\\n        \\\n        dpkg-dev \\\n        gcc \\\n        libc6-dev \\\n        libssl-dev \\\n        make \\\n; \\\nrm -rf /var/lib/apt/lists/*; \\\n\\\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231022101433-88v52el","Type":"NodeParagraph","Properties":{"id":"20231022101433-88v52el","updated":"20231022102017"},"Children":[{"Type":"NodeText","Data":"稍微改造一下， (1) 删除所有 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"链接作用"},{"Type":"NodeText","Data":" 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"; 和 \\"},{"Type":"NodeText","Data":"​， (2) 取消 RUN 的所有缩进。 这就是 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"一个Shell脚本"},{"Type":"NodeText","Data":" 了"}]},{"ID":"20231022202956-8d6li8i","Type":"NodeParagraph","Properties":{"id":"20231022202956-8d6li8i","updated":"20231022203025"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"划重点："},{"Type":"NodeText","Data":"这就是 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"一个Shell脚本"},{"Type":"NodeText","Data":" 了。 换句话说， "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在本地测试完成之后， 可以直接复制到  Dockerfile 中了"},{"Type":"NodeText","Data":"。而之前， 还需要使用 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"\u0026amp;\u0026amp;"},{"Type":"NodeText","Data":" 链接整理命令。"}]},{"ID":"20231022102018-04okwe0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231022102018-04okwe0","updated":"20231022204014"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"ZG9ja2VyZmlsZQ=="},{"Type":"NodeCodeBlockCode","Data":"RUN \u003c\u003cEOT\n#!/bin/bash\nset -eux;\nsavedAptMark=\"$(apt-mark showmanual)\";\napt-get update \napt-get install -y --no-install-recommends ca-certificates gnupg wget;\nrm -rf /var/lib/apt/lists/*;\ndpkgArch=\"$(dpkg --print-arch\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}