{"ID":"20230727000954-9fb4o6u","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230727000954-9fb4o6u","title":"19. Golang的运行调度GMP模型","updated":"20230727000954"},"Children":[{"ID":"20230727000955-whoopeg","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230727000955-whoopeg","updated":"20230727000955"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"19. Golang的运行调度GMP"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://blog.csdn.net/qq_33690342/article/details/115209536","TextMarkTextContent":"模型"}]},{"ID":"20230727000956-l63y3ov","Type":"NodeParagraph","Properties":{"id":"20230727000956-l63y3ov","updated":"20230727000956"},"Children":[{"Type":"NodeText","Data":"https://zhuanlan.zhihu.com/p/558260342"}]},{"ID":"20230727000957-a3nfqsc","Type":"NodeParagraph","Properties":{"id":"20230727000957-a3nfqsc","updated":"20230727000957"},"Children":[{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"G："},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"GO运行时"},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"对goroutine的描述"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，G中存放并发执行的代码入口地址、上下文、运行环境（关联的P和M）、运行栈等执行相关的信息。G的新建、休眠、恢复、停止都受到Go运行时的管理。"}]},{"ID":"20230727000958-fw4l8rj","Type":"NodeParagraph","Properties":{"id":"20230727000958-fw4l8rj","updated":"20230727000958"},"Children":[{"Type":"NodeText","Data":"GO运行时的监控线程会监控G的调度，G不会长久地阻塞系统线程，运行时的调度器会自动切换到其他G上运行。G新建或恢复时会添加到运行队列，等待M取出并运行。"}]},{"ID":"20230727000959-do7r8r1","Type":"NodeParagraph","Properties":{"id":"20230727000959-do7r8r1","updated":"20230727000959"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"M："},{"Type":"NodeMark","Children":[{"Type":"NodeMark2OpenMarker","Data":"=="},{"Type":"NodeText","Data":"OS内核线程"},{"Type":"NodeMark2CloseMarker","Data":"=="}]},{"Type":"NodeText","Data":"，是操作系统层面调度和执行的实体。M仅负责执行，M不停地被唤醒或创建。然后执行。"}]},{"ID":"20230727000960-heewf7w","Type":"NodeParagraph","Properties":{"id":"20230727000960-heewf7w","updated":"20230727000960"},"Children":[{"Type":"NodeStrong","Children":[{"Type":"NodeStrongA6kOpenMarker","Data":"**"},{"Type":"NodeText","Data":"P："},{"Type":"NodeStrongA6kCloseMarker","Data":"**"}]},{"Type":"NodeText","Data":"Processer，代表M和G所需要的资源，是对资源的一种抽象管理，P不是一个段代码实体，而是一个管理的数据结构，P主要是降低M对G的复杂性，增加一个间接的控制层数据结构。P控制GO代码的并行度，它不是实体。"}]},{"ID":"20230727000961-oxmep9p","Type":"NodeParagraph","Properties":{"id":"20230727000961-oxmep9p","updated":"20230727000961"},"Children":[{"Type":"NodeText","Data":"P持有G的队列，P可以隔离调度，解除P和M的绑定就解除了M对一串G的调用。"}]},{"ID":"20230727000962-mm025us","Type":"NodeParagraph","Properties":{"id":"20230727000962-mm025us","updated":"20230727000962"},"Children":[{"Type":"NodeText","Data":"G并不是执行体，而是存放并发执行体的元信息，包括并发执行的入口函数、堆栈、上下文等信息。G由于保存的是元信息，为了减少对象的分配和回收，G对象是可以复用，只需要将相关元信息初始化为新值即可。"}]},{"ID":"20230727000963-5740x5l","Type":"NodeParagraph","Properties":{"id":"20230727000963-5740x5l","updated":"20230727000963"},"Children":[{"Type":"NodeText","Data":"M仅负责执行，M启动时进入运行时的管理代码，这段管理代码必须拿到P后，才能执行调度。"}]},{"ID":"20230727000964-b8m90a4","Type":"NodeParagraph","Properties":{"id":"20230727000964-b8m90a4","updated":"20230727000964"},"Children":[{"Type":"NodeText","Data":"P的数目默认是CPU核心的数量。M和P的数目差不多，但运行时会根据当前的状态动态地创建M，M有一个最大值上限：10000；G与P是M:N的关系，M可以成千上万，远远大于N."}]},{"ID":"20230727000965-5lj3tos","Type":"NodeParagraph","Properties":{"id":"20230727000965-5lj3tos","updated":"20230727000965"},"Children":[{"Type":"NodeText","Data":"GMP模型设计思想："}]},{"ID":"20230727000966-cecwl24","Type":"NodeParagraph","Properties":{"id":"20230727000966-cecwl24","updated":"20230727000966"},"Children":[{"Type":"NodeText","Data":"\u003cimg src=\"E:\\Typora picture\\Untitled-2023-06-15-2344.png\" alt=\"Untitled-2023-06-15-2344\" style=\"zoom:200%;\" /\u003e"}]},{"ID":"20230727000967-c38ycc7","Type":"NodeParagraph","Properties":{"id":"20230727000967-c38ycc7","updated":"20230727000967"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"image-20230615222743100","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"E:\\Typora picture\\image-20230615222743100.png","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]}]}