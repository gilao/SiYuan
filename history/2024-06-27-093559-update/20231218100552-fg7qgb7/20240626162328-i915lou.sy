{"ID":"20240626162328-i915lou","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240626162328-i915lou","title":"什么是JWT？深入理解JWT从原理到应用","type":"doc","updated":"20240627092630"},"Children":[{"ID":"20240626162413-syxhv0c","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240626162413-syxhv0c","updated":"20240626162420"},"Children":[{"Type":"NodeText","Data":"一、前言"}]},{"ID":"20240626162420-52g1xxo","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240626162420-52g1xxo","updated":"20240626162426"},"Children":[{"Type":"NodeText","Data":"1. 什么是JWT"}]},{"ID":"20240626162524-uc8sm47","Type":"NodeParagraph","Properties":{"id":"20240626162524-uc8sm47","updated":"20240626162426"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在介绍JWT之前，我们先来回顾一下利用token进行用户身份验证的流程："}]},{"ID":"20240626162524-u9vvgkf","Type":"NodeList","ListData":{},"Properties":{"id":"20240626162524-u9vvgkf","updated":"20240626162426"},"Children":[{"ID":"20240626162524-n1m89ox","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-n1m89ox","updated":"20240626162524"},"Children":[{"ID":"20240626162524-v9ipk1b","Type":"NodeParagraph","Properties":{"id":"20240626162524-v9ipk1b","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"客户端使用用户名和密码请求登录"}]}]},{"ID":"20240626162524-go0eysb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-go0eysb","updated":"20240626162524"},"Children":[{"ID":"20240626162524-xwtozyt","Type":"NodeParagraph","Properties":{"id":"20240626162524-xwtozyt","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"服务端收到请求，验证用户名和密码"}]}]},{"ID":"20240626162524-vjlxdum","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-vjlxdum","updated":"20240626162524"},"Children":[{"ID":"20240626162524-d0b81sz","Type":"NodeParagraph","Properties":{"id":"20240626162524-d0b81sz","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"验证成功后，服务端会签发一个token，再把这个token返回给客户端"}]}]},{"ID":"20240626162524-v0bwkec","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-v0bwkec","updated":"20240626162524"},"Children":[{"ID":"20240626162524-avdid82","Type":"NodeParagraph","Properties":{"id":"20240626162524-avdid82","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"客户端收到token后可以把它存储起来，比如放到cookie中"}]}]},{"ID":"20240626162524-wdlljfb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-wdlljfb","updated":"20240626162524"},"Children":[{"ID":"20240626162524-6p0ug4o","Type":"NodeParagraph","Properties":{"id":"20240626162524-6p0ug4o","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"客户端每次向服务端请求资源时需要携带服务端签发的token，可以在cookie或者header中携带"}]}]},{"ID":"20240626162524-8a0mhkz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626162524-8a0mhkz","updated":"20240626162524"},"Children":[{"ID":"20240626162524-ylh3jcc","Type":"NodeParagraph","Properties":{"id":"20240626162524-ylh3jcc","updated":"20240626162524"},"Children":[{"Type":"NodeText","Data":"服务端收到请求，然后去验证客户端请求里面带着的token，如果验证成功，就向客户端返回请求数据"}]}]}]},{"ID":"20240626163012-cnz8kph","Type":"NodeParagraph","Properties":{"id":"20240626163012-cnz8kph","updated":"20240626163012"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这种基于token的认证方式相比传统的session认证方式更节约服务器资源，并且对移动端和"},{"Type":"NodeText","Data":"分布式"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"更加友好。其优点如下："}]},{"ID":"20240626163012-cck4yfa","Type":"NodeList","ListData":{},"Properties":{"id":"20240626163012-cck4yfa","updated":"20240626163045"},"Children":[{"ID":"20240626163012-eh8vwul","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163012-eh8vwul","updated":"20240626163018"},"Children":[{"ID":"20240626163012-5snbzuf","Type":"NodeParagraph","Properties":{"id":"20240626163012-5snbzuf","updated":"20240626163018"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"支持跨域访问"},{"Type":"NodeText","Data":"：cookie是无法跨域的，而token由于没有用到cookie(前提是将token放到请求头中)，所以跨域后不会存在信息丢失问题"}]}]},{"ID":"20240626163012-lb6fvb9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163012-lb6fvb9","updated":"20240626163036"},"Children":[{"ID":"20240626163012-9eh7rsu","Type":"NodeParagraph","Properties":{"id":"20240626163012-9eh7rsu","updated":"20240626163036"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无状态"},{"Type":"NodeText","Data":"：token机制在服务端不需要存储session信息，因为token自身包含了所有登录用户的信息，所以可以减轻服务端压力"}]}]},{"ID":"20240626163012-zzgvw42","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163012-zzgvw42","updated":"20240626163040"},"Children":[{"ID":"20240626163012-jgcf2ea","Type":"NodeParagraph","Properties":{"id":"20240626163012-jgcf2ea","updated":"20240626163040"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"更适用CDN"},{"Type":"NodeText","Data":"：可以通过内容分发网络请求服务端的所有资料"}]}]},{"ID":"20240626163012-5jiznlb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163012-5jiznlb","updated":"20240626163042"},"Children":[{"ID":"20240626163012-shkz4am","Type":"NodeParagraph","Properties":{"id":"20240626163012-shkz4am","updated":"20240626163042"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"更适用于移动端"},{"Type":"NodeText","Data":"：当客户端是非浏览器平台时，cookie是不被支持的，此时采用token认证方式会简单很多"}]}]},{"ID":"20240626163012-h79due4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163012-h79due4","updated":"20240626163045"},"Children":[{"ID":"20240626163012-vrb1p9o","Type":"NodeParagraph","Properties":{"id":"20240626163012-vrb1p9o","updated":"20240626163045"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"无需考虑CSRF"},{"Type":"NodeText","Data":"：由于不再依赖cookie，所以采用token认证方式不会发生CSRF，所以也就无需考虑CSRF的防御"}]}]}]},{"ID":"20240626163140-dq0bbb6","Type":"NodeParagraph","Properties":{"id":"20240626163140-dq0bbb6","updated":"20240626163147"},"Children":[{"Type":"NodeText","Data":"而JWT就是上述流程当中token的一种具体实现方式，其全称是JSON Web Token，官网地址："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://jwt.io/","TextMarkTextContent":"https://jwt.io/"}]},{"ID":"20240626163154-h9jb3ok","Type":"NodeParagraph","Properties":{"id":"20240626163154-h9jb3ok","updated":"20240626163216"},"Children":[{"Type":"NodeText","Data":"通俗地说，JWT的本质就是一个字符串，它是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color7);"},"TextMarkType":"strong text","TextMarkTextContent":"将用户信息保存到一个Json字符串中，然后进行编码后得到一个JWT token，并且这个JWT token带有签名信息，接收后可以校验是否被篡改，所以可以用于在各方之间安全地将信息作为Json对象传输。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color7);\"}"},{"Type":"NodeText","Data":"JWT的认证流程如下："}]},{"ID":"20240626163154-mz92xun","Type":"NodeList","ListData":{},"Properties":{"id":"20240626163154-mz92xun","updated":"20240626163154"},"Children":[{"ID":"20240626163154-0zp6i70","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-0zp6i70","updated":"20240626163154"},"Children":[{"ID":"20240626163154-nk2j16p","Type":"NodeParagraph","Properties":{"id":"20240626163154-nk2j16p","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"首先，前端通过Web表单将自己的用户名和密码发送到后端的接口，这个过程一般是一个POST请求。建议的方式是通过SSL加密的传输(HTTPS)，从而避免敏感信息被嗅探"}]}]},{"ID":"20240626163154-06nku32","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-06nku32","updated":"20240626163154"},"Children":[{"ID":"20240626163154-koyicz1","Type":"NodeParagraph","Properties":{"id":"20240626163154-koyicz1","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"后端核对用户名和密码成功后，将包含用户信息的数据作为JWT的Payload，将其与JWT Header分别进行Base64编码拼接后签名，形成一个JWT Token，形成的JWT Token就是一个如同lll.zzz.xxx的字符串"}]}]},{"ID":"20240626163154-p1d274b","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-p1d274b","updated":"20240626163154"},"Children":[{"ID":"20240626163154-d18195m","Type":"NodeParagraph","Properties":{"id":"20240626163154-d18195m","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"后端将JWT Token字符串作为登录成功的结果返回给前端。前端可以将返回的结果保存在浏览器中，退出登录时删除保存的JWT Token即可"}]}]},{"ID":"20240626163154-2d3w8ig","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-2d3w8ig","updated":"20240626163154"},"Children":[{"ID":"20240626163154-acbdkq8","Type":"NodeParagraph","Properties":{"id":"20240626163154-acbdkq8","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"前端在每次请求时将JWT Token放入HTTP请求头中的Authorization属性中(解决XSS和XSRF问题)"}]}]},{"ID":"20240626163154-fgcyspg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-fgcyspg","updated":"20240626163154"},"Children":[{"ID":"20240626163154-5ejqqq2","Type":"NodeParagraph","Properties":{"id":"20240626163154-5ejqqq2","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"后端检查前端传过来的JWT Token，验证其有效性，比如检查签名是否正确、是否过期、token的接收方是否是自己等等"}]}]},{"ID":"20240626163154-gd7jf0x","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240626163154-gd7jf0x","updated":"20240626163154"},"Children":[{"ID":"20240626163154-so165c5","Type":"NodeParagraph","Properties":{"id":"20240626163154-so165c5","updated":"20240626163154"},"Children":[{"Type":"NodeText","Data":"验证通过后，后端解析出JWT Token中包含的用户信息，进行其他逻辑操作(一般是根据用户信息得到权限等)，返回结果"}]}]}]},{"ID":"20240626164523-zqfuvo2","Type":"NodeParagraph","Properties":{"id":"20240626164523-zqfuvo2","updated":"20240626164523"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240626164523-ln31ymr.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240626164526-w7mhvbm","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240626164526-w7mhvbm","updated":"20240626164735"},"Children":[{"Type":"NodeText","Data":"2. 为什么要用 JWT"}]},{"ID":"20240626164735-54tx58k","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240626164735-54tx58k","updated":"20240626164751"},"Children":[{"Type":"NodeText","Data":"2.1 传统Session 认证的弊端"}]},{"ID":"20240626164751-99b8mmq","Type":"NodeParagraph","Properties":{"id":"20240626164751-99b8mmq","updated":"20240627092618"},"Children":[{"Type":"NodeText","Data":"我们知道HTTP本身是一种无状态的协议，这就意味着如果用户向我们的应用提供了用户名和密码来进行用户认证，认证通过后HTTP协议不会记录下认证后的状态，那么下一次请求时，用户还要再一次进行认证，因为根据HTTP协议，我们并不知道是哪个用户发出的请求，所以为了让我们的应用能识别是哪个用户发出的请求，我们只能在用户首次登录成功后，在服务器存储一份用户登录的信息，这份登录信息会在响应时传递给浏览器，告诉其保存为cookie，以便下次请求时发送给我们的应用，这样我们的应用就能识别请求来自哪个用户了，这是传统的基于session认证的过程"}]},{"ID":"20240627092623-phm3hy5","Type":"NodeParagraph","Properties":{"id":"20240627092623-phm3hy5","updated":"20240627092623"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240627092623-60bb5g0.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240627092630-m7xspms","Type":"NodeParagraph","Properties":{"id":"20240627092630-m7xspms","updated":"20240627092630"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"然而，传统的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"session"},{"Type":"NodeText","Data":"​认证有如下的问题："}]},{"ID":"20240627092630-z59e0x9","Type":"NodeList","ListData":{},"Properties":{"id":"20240627092630-z59e0x9","updated":"20240627092630"},"Children":[{"ID":"20240627092630-4c7f8fu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-4c7f8fu","updated":"20240627092630"},"Children":[{"ID":"20240627092630-2v4y2pn","Type":"NodeParagraph","Properties":{"id":"20240627092630-2v4y2pn","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"每个用户的登录信息都会保存到服务器的session中，随着用户的增多，服务器开销会明显增大"}]}]},{"ID":"20240627092630-lr0izpx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-lr0izpx","updated":"20240627092630"},"Children":[{"ID":"20240627092630-t18urwx","Type":"NodeParagraph","Properties":{"id":"20240627092630-t18urwx","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"由于session是存在与服务器的物理内存中，所以在分布式系统中，这种方式将会失效。虽然可以将session统一保存到Redis中，但是这样做无疑增加了系统的复杂性，对于不需要redis的应用也会白白多引入一个缓存中间件"}]}]},{"ID":"20240627092630-1p8o6gd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-1p8o6gd","updated":"20240627092630"},"Children":[{"ID":"20240627092630-fxh2lwp","Type":"NodeParagraph","Properties":{"id":"20240627092630-fxh2lwp","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"对于非浏览器的客户端、手机移动端等不适用，因为session依赖于cookie，而移动端经常没有cookie"}]}]},{"ID":"20240627092630-h3x0c6y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-h3x0c6y","updated":"20240627092630"},"Children":[{"ID":"20240627092630-w5ja3ld","Type":"NodeParagraph","Properties":{"id":"20240627092630-w5ja3ld","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"因为session认证本质基于cookie，所以如果cookie被截获，用户很容易收到跨站请求伪造攻击。并且如果浏览器禁用了cookie，这种方式也会失效"}]}]},{"ID":"20240627092630-8wpeorq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-8wpeorq","updated":"20240627092630"},"Children":[{"ID":"20240627092630-m8dnfxg","Type":"NodeParagraph","Properties":{"id":"20240627092630-m8dnfxg","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"前后端分离系统中更加不适用，后端部署复杂，前端发送的请求往往经过多个中间件到达后端，cookie中关于session的信息会转发多次"}]}]},{"ID":"20240627092630-0kc7hbs","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240627092630-0kc7hbs","updated":"20240627092630"},"Children":[{"ID":"20240627092630-nqsxvav","Type":"NodeParagraph","Properties":{"id":"20240627092630-nqsxvav","updated":"20240627092630"},"Children":[{"Type":"NodeText","Data":"由于基于Cookie，而cookie无法跨域，所以session的认证也无法跨域，对单点登录不适用"}]}]}]}]}