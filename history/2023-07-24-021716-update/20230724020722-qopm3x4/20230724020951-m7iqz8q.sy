{"ID":"20230724020951-m7iqz8q","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f368","id":"20230724020951-m7iqz8q","tags":"Dockerfile","title":"Dockerfile 教程","updated":"20230724021231"},"Children":[{"ID":"20230724021022-xzckq0b","Type":"NodeParagraph","Properties":{"id":"20230724021022-xzckq0b","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"我们可以把刚才的对容器的所有操作命令都记录到一个文件里，就像写更脚本程序。"}]},{"ID":"20230724021022-mfy47i9","Type":"NodeParagraph","Properties":{"id":"20230724021022-mfy47i9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"之后用 docker build 命令以此文件为基础制作一个镜像，并会自动提交到本地仓库。"}]},{"ID":"20230724021022-39ghobf","Type":"NodeParagraph","Properties":{"id":"20230724021022-39ghobf","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这样的话镜像的构建会变的透明化，对镜像的维护起来也更加简单，只修改这个文件即可。"}]},{"ID":"20230724021022-wppl8r9","Type":"NodeParagraph","Properties":{"id":"20230724021022-wppl8r9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"同时分享也更加简单快捷，因为只要分享这个文件即可。"}]},{"ID":"20230724021022-qmi2qez","Type":"NodeParagraph","Properties":{"id":"20230724021022-qmi2qez","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dokcerfile 是一个普通的文本文件，文件名一般叫 Dockerfile"}]},{"ID":"20230724021022-9bruoew","Type":"NodeParagraph","Properties":{"id":"20230724021022-9bruoew","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"其中包含了一系列的指令(Instruction)， 每一条指令都会构建一层，就是描述该层是如何创建的。"}]},{"ID":"20230724021022-fybgdnd","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724021022-fybgdnd","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"小试牛刀"}]},{"ID":"20230724021022-2mv3gzu","Type":"NodeParagraph","Properties":{"id":"20230724021022-2mv3gzu","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"示例："}]},{"ID":"20230724021022-cph9cg2","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-cph9cg2","updated":"20230724021022"},"Children":[{"ID":"20230724021022-nqedgyc","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-nqedgyc","updated":"20230724021022"},"Children":[{"ID":"20230724021022-pc45b4f","Type":"NodeParagraph","Properties":{"id":"20230724021022-pc45b4f","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编辑 Dockerfile 文件"}]}]}]},{"ID":"20230724021022-q0h741n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-q0h741n","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost ~]# mkdir centos_dockerfile\n[root@localhost ~]# cd centos_dockerfile/\n[root@localhost centos_dockerfile]# vi Dockerfile\nFROM centos:latest\nLABEL maintainer=\"yangge \u003cyangge@qf.com\u003e\"  description=\"Install tree vim*\"\nRUN rpm -qa | grep tree || yum  install -y tree vim*\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-9e5wkbz","Type":"NodeParagraph","Properties":{"id":"20230724021022-9e5wkbz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"指令介绍："}]},{"ID":"20230724021022-wpgnq18","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-wpgnq18","updated":"20230724021022"},"Children":[{"ID":"20230724021022-jkanr97","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-jkanr97","updated":"20230724021022"},"Children":[{"ID":"20230724021022-9a2yzlc","Type":"NodeParagraph","Properties":{"id":"20230724021022-9a2yzlc","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"FORM 定义一个基础镜像"}]}]},{"ID":"20230724021022-caqzbox","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-caqzbox","updated":"20230724021022"},"Children":[{"ID":"20230724021022-whrrucn","Type":"NodeParagraph","Properties":{"id":"20230724021022-whrrucn","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"LABEL 定义一些元数据信息，比如作者、版本、关于镜像的描述信息"}]}]},{"ID":"20230724021022-qxdp1kx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-qxdp1kx","updated":"20230724021022"},"Children":[{"ID":"20230724021022-95gedj9","Type":"NodeParagraph","Properties":{"id":"20230724021022-95gedj9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"RUN 执行命令行的命令"}]}]}]},{"ID":"20230724021022-evgge1s","Type":"NodeParagraph","Properties":{"id":"20230724021022-evgge1s","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编辑完，保存退出"}]},{"ID":"20230724021022-5u0q7da","Type":"NodeParagraph","Properties":{"id":"20230724021022-5u0q7da","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2.开始构建镜像"}]},{"ID":"20230724021022-phfjz3i","Type":"NodeParagraph","Properties":{"id":"20230724021022-phfjz3i","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"命令语法格式："}]},{"ID":"20230724021022-fd6xuvb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-fd6xuvb","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker bulid -t 仓库名/镜像名:tag .\ndocker build [选项] \u003c上下文路径/URL/-\u003e\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-4906tgo","Type":"NodeParagraph","Properties":{"id":"20230724021022-4906tgo","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"示例："}]},{"ID":"20230724021022-t0lg52r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-t0lg52r","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost centos_dockerfile]# docker build -t centos:1.20 .\nSending build context to Docker daemon  2.048kB\nStep 1/3 : FROM centos:latest\n ---\u003e e934aafc2206\nStep 2/3 : LABEL maintainer=\"shark\u003cdockerhub@163.com\u003e\" description=\"Install tree vim*\"\n ---\u003e Using cache\n ---\u003e 1207b2848015\nStep 3/3 : RUN rpm -qa | grep tree || yum  install -y tree     vim*\n ---\u003e Running in 33d321b249d7\nLoaded plugins: fastestmirror, ovl\nDetermining fastest mirrors\n...略...\nComplete!\nRemoving intermediate container 33d321b249d7\n ---\u003e adc30981bc84\nSuccessfully built adc30981bc84    # 表示构建成功\nSuccessfully tagged centos:1.20    # TAG 标签\n[root@localhost centos_dockerfile]#\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-omq3qrm","Type":"NodeBlockquote","Properties":{"id":"20230724021022-omq3qrm","updated":"20230724021022"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20230724021022-dr0i6us","Type":"NodeParagraph","Properties":{"id":"20230724021022-dr0i6us","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"请允许我无耻的插播一条广告"},{"Type":"NodeTextMark","TextMarkType":"sup","TextMarkTextContent":"_"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":", 这里有一整套完整的 Python3 基础教程，图文并茂。"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/15a0f505177e","TextMarkTextContent":"点我传送门：Python3 完整基础教程"},{"Type":"NodeText","Data":" 同时欢迎购买我的基础全套视频微我 y86000153优惠100 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//www.51ean.com/courses/536","TextMarkTextContent":"点我"}]}]},{"ID":"20230724021022-imu5b2r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724021022-imu5b2r","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"构建镜像的上下文(context)"}]},{"ID":"20230724021022-t86przm","Type":"NodeParagraph","Properties":{"id":"20230724021022-t86przm","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**这个 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"."},{"Type":"NodeText","Data":"​ 表示当前目录，这实际上是在指定上下文的目录是当前目录，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker build"},{"Type":"NodeText","Data":"​ 命令会将该目录下的内容打包交给 Docker 引擎以帮助构建镜像。"}]},{"ID":"20230724021022-fvwf59f","Type":"NodeParagraph","Properties":{"id":"20230724021022-fvwf59f","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker build"},{"Type":"NodeText","Data":"​ 命令得知这个路径后，会将路径下的所有内容打包，然后上传给 Docker 引擎。这样 Docker 引擎收到这个上下文包后，展开就会获得构建镜像所需的一切文件。"}]},{"ID":"20230724021022-llu90rv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724021022-llu90rv","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"最佳实战"}]},{"ID":"20230724021022-lps2z98","Type":"NodeParagraph","Properties":{"id":"20230724021022-lps2z98","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**一般来说，应该会将 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 置于一个空目录下，或者项目根目录下。如果该目录下没有所需文件，那么应该把所需文件复制一份过来。如果目录下有些东西确实不希望构建时传给 Docker 引擎，那么可以用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".gitignore"},{"Type":"NodeText","Data":"​ 一样的语法写一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".dockerignore"},{"Type":"NodeText","Data":"​，该文件是用于剔除不需要作为上下文传递给 Docker 引擎的"}]},{"ID":"20230724021022-yndq5dd","Type":"NodeParagraph","Properties":{"id":"20230724021022-yndq5dd","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 的文件名并不要求必须为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​，而且并不要求必须位于上下文目录中，比如可以用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-f ../Dockerfile.qf"},{"Type":"NodeText","Data":"​ 参数指定某个文件作为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-pxdrem7","Type":"NodeParagraph","Properties":{"id":"20230724021022-pxdrem7","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**一般大家习惯性的会使用默认的文件名 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​，以及会将其置于镜像构建上下文目录中。"}]},{"ID":"20230724021022-oj9lrll","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-oj9lrll","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost dockerfile_qf_ignore]# tree .\n.\n├── Dockerfile.qf\n└── test\n    ├── a.txt\n    ├── b.txt\n    └── test.qf\n[root@localhost dockerfile_qf_ignore]# cat Dockerfile.qf\nFROM alpine\nCOPY ./test.qf /root/test.qf\n[root@localhost dockerfile_qf_ignore]# docker build -f ../Dockerfile.qf -t alpine:test.qf .\n[root@localhost dockerfile_qf_ignore]# docker run -it alpine:test.qf /bin/sh\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-9asnrzg","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724021022-9asnrzg","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"Dockerfile 详解"}]},{"ID":"20230724021022-s3o2ff7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-s3o2ff7","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"FROM 指令"}]},{"ID":"20230724021022-i29fpyi","Type":"NodeParagraph","Properties":{"id":"20230724021022-i29fpyi","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"主要作用是指定一个镜像作为构建自定义镜像的基础镜像，在这个基础镜像之上进行修改定制。"}]},{"ID":"20230724021022-2q0deq2","Type":"NodeParagraph","Properties":{"id":"20230724021022-2q0deq2","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这个指令是 Dockerfile 中的必备指令，同时也必须是第一条指令。"}]},{"ID":"20230724021022-73l1rwf","Type":"NodeParagraph","Properties":{"id":"20230724021022-73l1rwf","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**在 **"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/","TextMarkTextContent":"Docker Store"},{"Type":"NodeText","Data":" 上有很多高质量的官方镜像，可以直接作为我们的基础镜像。"}]},{"ID":"20230724021022-sjy5hvm","Type":"NodeParagraph","Properties":{"id":"20230724021022-sjy5hvm","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**作为服务类的，如 **"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/nginx/","TextMarkTextContent":"Nginx"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/mongo/","TextMarkTextContent":"Mongo"},{"Type":"NodeText","Data":" 等"}]},{"ID":"20230724021022-0v4f70b","Type":"NodeParagraph","Properties":{"id":"20230724021022-0v4f70b","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**用于开发的， 如 **"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/python/","TextMarkTextContent":"Python"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/golang/","TextMarkTextContent":"golang"}]},{"ID":"20230724021022-t9widxs","Type":"NodeParagraph","Properties":{"id":"20230724021022-t9widxs","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**操作系统类， 如 **"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/centos/","TextMarkTextContent":"Centos"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//store.docker.com/images/ubuntu/","TextMarkTextContent":"ubuntu"}]},{"ID":"20230724021022-58cg4lw","Type":"NodeParagraph","Properties":{"id":"20230724021022-58cg4lw","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**除了一些现有的镜像，Docker 还有一个特殊的镜像 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"scratch"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-x97skdl","Type":"NodeParagraph","Properties":{"id":"20230724021022-x97skdl","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这个镜像是虚拟的，表示空白镜像"}]},{"ID":"20230724021022-c1xuogv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-c1xuogv","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FORM scratch\n...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-snkmlgx","Type":"NodeParagraph","Properties":{"id":"20230724021022-snkmlgx","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这以为着这将不以任何镜像为基础镜像。"}]},{"ID":"20230724021022-90oxf2o","Type":"NodeParagraph","Properties":{"id":"20230724021022-90oxf2o","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以把可执行的二进制文件复制到镜像中直接执行，容器本身就是和宿主机共享 Linux内核的。"}]},{"ID":"20230724021022-we4t8aq","Type":"NodeParagraph","Properties":{"id":"20230724021022-we4t8aq","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 Go 语言开发的应用很多会使用这种方式来制作镜像，这也是为什么有人认为 Go 是特别适合容器微服务架构的语言的原因之一。"}]},{"ID":"20230724021022-jbvtwj7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-jbvtwj7","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"制作自己的 Hello world"}]},{"ID":"20230724021022-8t2g2xn","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-8t2g2xn","updated":"20230724021022"},"Children":[{"ID":"20230724021022-1q31o8j","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-1q31o8j","updated":"20230724021022"},"Children":[{"ID":"20230724021022-sjamhq9","Type":"NodeParagraph","Properties":{"id":"20230724021022-sjamhq9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在任意一台 Linux 机器上，安装 gcc"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"查看有没有安装"}]}]}]},{"ID":"20230724021022-b4p0hrq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-b4p0hrq","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# rpm -qa gcc glibc-static\nglibc-static-2.17-222.el7.x86_64\ngcc-4.8.5-11.el7.x86_64\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-qp9fuwi","Type":"NodeParagraph","Properties":{"id":"20230724021022-qp9fuwi","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"没有的话，进行安装即可"}]},{"ID":"20230724021022-4sjdqu5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-4sjdqu5","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# yum install gcc glibc-static\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-dto22un","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-dto22un","updated":"20230724021022"},"Children":[{"ID":"20230724021022-6ic1ka0","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-6ic1ka0","updated":"20230724021022"},"Children":[{"ID":"20230724021022-cu8rsuo","Type":"NodeParagraph","Properties":{"id":"20230724021022-cu8rsuo","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编辑 C 源代码文件"}]}]}]},{"ID":"20230724021022-pui9ggd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-pui9ggd","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost docker]# cat hello.c\n#include \u003cstdio.h\u003e\n\nint main()\n{\n   printf(\"Hello, Yangge! \\n\");\n   return 0;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-iqn6htp","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-iqn6htp","updated":"20230724021022"},"Children":[{"ID":"20230724021022-mfpq79k","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-mfpq79k","updated":"20230724021022"},"Children":[{"ID":"20230724021022-z2v4gqj","Type":"NodeParagraph","Properties":{"id":"20230724021022-z2v4gqj","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"将源代码文件编译为可执行的二进制文件"}]}]}]},{"ID":"20230724021022-sopk5fo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-sopk5fo","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# gcc --static hello.c -o hello\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-vtkxkql","Type":"NodeParagraph","Properties":{"id":"20230724021022-vtkxkql","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编译好后，测试一下"}]},{"ID":"20230724021022-4npqvfb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-4npqvfb","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# ls\nhello  hello.c\n# hello   是我们编译好的二进制文件\n# hello.c 是 C 的源码文件\n[root@localhost hello_qf]# ./hello\nHello Yangge     # 输出结果，说明编译成功\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-rjvdr56","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-rjvdr56","updated":"20230724021022"},"Children":[{"ID":"20230724021022-p49nztw","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-p49nztw","updated":"20230724021022"},"Children":[{"ID":"20230724021022-xudf9ac","Type":"NodeParagraph","Properties":{"id":"20230724021022-xudf9ac","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"编辑 Dockerfile"}]}]}]},{"ID":"20230724021022-pmgm0b1","Type":"NodeParagraph","Properties":{"id":"20230724021022-pmgm0b1","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在有 hello 二进制的文件目录下，编译 Dockerfile 文件，内容如下："}]},{"ID":"20230724021022-g57jjwv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-g57jjwv","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# ls\nDockerfile  hello  hello.c\n[root@localhost hello_qf]# cat Dockerfile\nFROM scratch\nADD hello /\nCMD [\"/hello\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-amsouw4","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-amsouw4","updated":"20230724021022"},"Children":[{"ID":"20230724021022-sx7dj6g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-sx7dj6g","updated":"20230724021022"},"Children":[{"ID":"20230724021022-yun2iu8","Type":"NodeParagraph","Properties":{"id":"20230724021022-yun2iu8","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"ADD 是把当前目录下的 hello 文档拷贝到 容器中的根目录下"}]}]},{"ID":"20230724021022-d93hg6s","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-d93hg6s","updated":"20230724021022"},"Children":[{"ID":"20230724021022-hvhqc36","Type":"NodeParagraph","Properties":{"id":"20230724021022-hvhqc36","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD 执行根目录下的 hello 文件"}]}]},{"ID":"20230724021022-tjl4py4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-tjl4py4","updated":"20230724021022"},"Children":[{"ID":"20230724021022-wc7frsj","Type":"NodeParagraph","Properties":{"id":"20230724021022-wc7frsj","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"构建新的镜像"}]}]}]},{"ID":"20230724021022-348quk9","Type":"NodeParagraph","Properties":{"id":"20230724021022-348quk9","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**注意命令的最后有个 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"."},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-2qedjek","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-2qedjek","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@ hello_qf]# docker build -t xiguatian/hello-yangge .\nSending build context to Docker daemon  868.9kB\nStep 1/3 : FROM scratch\n ---\u003e\nStep 2/3 : ADD hello /\n ---\u003e 63ed3c13b7fd\nStep 3/3 : CMD [\"/hello\"]\n ---\u003e Running in a26622affa68\nRemoving intermediate container a26622affa68\n ---\u003e dfadd4a86525\nSuccessfully built dfadd4a86525\nSuccessfully tagged xiguatian/hello-yange:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-33mlq0l","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-33mlq0l","updated":"20230724021022"},"Children":[{"ID":"20230724021022-r3st672","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-r3st672","updated":"20230724021022"},"Children":[{"ID":"20230724021022-5hl4e5y","Type":"NodeParagraph","Properties":{"id":"20230724021022-5hl4e5y","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"查看本地仓库验证"}]}]}]},{"ID":"20230724021022-cul6119","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-cul6119","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# docker image ls xiguatian/hello-yange\nREPOSITORY             TAG    IMAGE ID     CREATED         SIZE\nxiguatian/hello-yange latest dfadd4a86525  3 minutes ago   865kB\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-6oj0vb9","Type":"NodeParagraph","Properties":{"id":"20230724021022-6oj0vb9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以看到镜像很小"}]},{"ID":"20230724021022-o1e6yra","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-o1e6yra","updated":"20230724021022"},"Children":[{"ID":"20230724021022-4ea8f9x","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-4ea8f9x","updated":"20230724021022"},"Children":[{"ID":"20230724021022-csx25du","Type":"NodeParagraph","Properties":{"id":"20230724021022-csx25du","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"利用新的镜像运行一个容器"}]}]}]},{"ID":"20230724021022-c17jo6m","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-c17jo6m","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@localhost hello_qf]# docker run --rm qf/hello-yange\nHello Yangge\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-5vdnmaw","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-5vdnmaw","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"关于 Alpine"}]},{"ID":"20230724021022-7g3zaev","Type":"NodeParagraph","Properties":{"id":"20230724021022-7g3zaev","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"官网："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//alpinelinux.org/","TextMarkTextContent":"https://alpinelinux.org/"}]},{"ID":"20230724021022-x3p0pdk","Type":"NodeParagraph","Properties":{"id":"20230724021022-x3p0pdk","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**WIKI **"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//wiki.alpinelinux.org/wiki/Main_Page","TextMarkTextContent":"https://wiki.alpinelinux.org/wiki/Main_Page"}]},{"ID":"20230724021022-v9bwst2","Type":"NodeParagraph","Properties":{"id":"20230724021022-v9bwst2","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Alpine Linux是一款独立的非商业性通用Linux发行版，专为那些了解安全性，简单性和资源效率的高级用户而设计。"}]},{"ID":"20230724021022-otcqbuz","Type":"NodeParagraph","Properties":{"id":"20230724021022-otcqbuz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"小"}]},{"ID":"20230724021022-aer4q2c","Type":"NodeParagraph","Properties":{"id":"20230724021022-aer4q2c","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Alpine Linux围绕musl libc和busybox构建。这使得它比传统的GNU / Linux发行版更小，更节省资源。一个容器需要不超过8 MB的空间，而对磁盘的最小安装需要大约130 MB的存储空间。您不仅可以获得完整的Linux环境，还可以从存储库中选择大量的软件包。"}]},{"ID":"20230724021022-6rrg2dg","Type":"NodeParagraph","Properties":{"id":"20230724021022-6rrg2dg","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"二进制软件包被缩减和拆分，使您可以更好地控制安装的内容，从而使您的环境尽可能地小巧高效。"}]},{"ID":"20230724021022-u4fbfpx","Type":"NodeParagraph","Properties":{"id":"20230724021022-u4fbfpx","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"简单"}]},{"ID":"20230724021022-sj8v1e4","Type":"NodeParagraph","Properties":{"id":"20230724021022-sj8v1e4","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Alpine Linux是一个非常简单的发行版，它会尽量避免使用。它使用自己的包管理器，称为apk，OpenRC init系统，脚本驱动的设置，就是这样！这为您提供了一个简单，清晰的Linux环境，没有任何噪音。然后，您可以添加项目所需的软件包，因此无论是构建家用PVR还是iSCSI存储控制器，薄型邮件服务器容器或坚如磐石的嵌入式交换机，其他都不会挡道。"}]},{"ID":"20230724021022-u4eufks","Type":"NodeParagraph","Properties":{"id":"20230724021022-u4eufks","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"安全"}]},{"ID":"20230724021022-btrdiiu","Type":"NodeParagraph","Properties":{"id":"20230724021022-btrdiiu","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Alpine Linux的设计考虑到了安全性。内核修补了一个非官方的grsecurity / PaX端口，并且所有的用户级二进制文件被编译为位置独立可执行文件（PIE）和堆栈粉碎保护。这些主动安全功能可防止利用整个类别的零日等漏洞。"}]},{"ID":"20230724021022-ze2ohlq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-ze2ohlq","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"LABEL 指令"}]},{"ID":"20230724021022-dwoxzix","Type":"NodeParagraph","Properties":{"id":"20230724021022-dwoxzix","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"LABEL 指令用于指定一个镜像的描述信息"}]},{"ID":"20230724021022-k4haqax","Type":"NodeParagraph","Properties":{"id":"20230724021022-k4haqax","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​指令将元数据添加到镜像中。"}]},{"ID":"20230724021022-11l6894","Type":"NodeParagraph","Properties":{"id":"20230724021022-11l6894","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​是一个键值对。"}]},{"ID":"20230724021022-ufnbe0s","Type":"NodeParagraph","Properties":{"id":"20230724021022-ufnbe0s","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"要在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​值中包含空格，请像在命令行解析中一样使用引号和续行符"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-7gmmjop","Type":"NodeParagraph","Properties":{"id":"20230724021022-7gmmjop","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"几个用法示例："}]},{"ID":"20230724021022-jjtchb4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-jjtchb4","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"LABEL maintainer=\"yangge@qf.com\" LABEL \"com.example.vendor\"=\"ACME Incorporated\" LABEL com.example.label-with-value=\"foo\" LABEL version=\"1.0\" LABEL description=\"This text illustrates \\ that label-values can span multiple lines.\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-n1ero51","Type":"NodeParagraph","Properties":{"id":"20230724021022-n1ero51","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"一个镜像可以有多个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​标签。您可以在一行中指定多个标签。并且目前的版本不再会影响到镜像的大小了。"}]},{"ID":"20230724021022-mj7vbwu","Type":"NodeParagraph","Properties":{"id":"20230724021022-mj7vbwu","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"但是仍然可以把他们写在一行或用反斜线进行续航"}]},{"ID":"20230724021022-i6foy66","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-i6foy66","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"LABEL multi.label1=\"value1\" multi.label2=\"value2\" other=\"value3\"\nLABEL multi.label1=\"value1\" \\\n      multi.label2=\"value2\" \\\n      other=\"value3\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-0qgs116","Type":"NodeParagraph","Properties":{"id":"20230724021022-0qgs116","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"有继承关系的镜像，标签也会有面向对象编程中继承的关系和特性"}]},{"ID":"20230724021022-xdbk64n","Type":"NodeParagraph","Properties":{"id":"20230724021022-xdbk64n","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**要查看镜像的 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​ 信息，请使用该"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker inspect"},{"Type":"NodeText","Data":"​命令。"}]},{"ID":"20230724021022-6y2qbdj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-6y2qbdj","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"ENV 指令"}]},{"ID":"20230724021022-6jhoebx","Type":"NodeParagraph","Properties":{"id":"20230724021022-6jhoebx","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用于设置环境变量"}]},{"ID":"20230724021022-n9q8j1w","Type":"NodeParagraph","Properties":{"id":"20230724021022-n9q8j1w","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式有两种："}]},{"ID":"20230724021022-g9dgds5","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-g9dgds5","updated":"20230724021022"},"Children":[{"ID":"20230724021022-rssslxn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-rssslxn","updated":"20230724021022"},"Children":[{"ID":"20230724021022-4qklzaf","Type":"NodeParagraph","Properties":{"id":"20230724021022-4qklzaf","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV \u0026lt;key\u0026gt; \u0026lt;value\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724021022-vn54xal","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-vn54xal","updated":"20230724021022"},"Children":[{"ID":"20230724021022-257j199","Type":"NodeParagraph","Properties":{"id":"20230724021022-257j199","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV \u0026lt;key1\u0026gt;=\u0026lt;value1\u0026gt; \u0026lt;key2\u0026gt;=\u0026lt;value2\u0026gt;..."},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20230724021022-8z7h9nz","Type":"NodeParagraph","Properties":{"id":"20230724021022-8z7h9nz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"示例："}]},{"ID":"20230724021022-918co4g","Type":"NodeParagraph","Properties":{"id":"20230724021022-918co4g","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"推荐的方式，易读"}]},{"ID":"20230724021022-tcp5htd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-tcp5htd","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ENV VERSION=1.0 DEBUG=on \\\n NAME=\"Happy Feet\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-0wjij33","Type":"NodeParagraph","Properties":{"id":"20230724021022-0wjij33","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不推荐都方式，不易读"}]},{"ID":"20230724021022-v6i4cea","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-v6i4cea","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ENV NODE_VERSION 7.2.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-d63yjkn","Type":"NodeParagraph","Properties":{"id":"20230724021022-d63yjkn","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"其他指令使用："}]},{"ID":"20230724021022-2305ngb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-2305ngb","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"RUN echo $NODE_VERSION\n...\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-bmq6j32","Type":"NodeParagraph","Properties":{"id":"20230724021022-bmq6j32","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**下列指令可以支持环境变量： **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ADD"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENV"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"EXPOSE"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"LABEL"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"USER"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"VOLUME"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"STOPSIGNAL"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ONBUILD"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-c84zqpq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-c84zqpq","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"RUN 指令"}]},{"ID":"20230724021022-auwzmb0","Type":"NodeParagraph","Properties":{"id":"20230724021022-auwzmb0","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 指令是在容器内执行 shell 命令，默认会是用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/bin/sh -c"},{"Type":"NodeText","Data":"​ 的方式执行。"}]},{"ID":"20230724021022-8r8rppk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-8r8rppk","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"执行命令的两种方式"}]},{"ID":"20230724021022-qxns7sl","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-qxns7sl","updated":"20230724021022"},"Children":[{"ID":"20230724021022-65kgp72","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-65kgp72","updated":"20230724021022"},"Children":[{"ID":"20230724021022-cumsgt1","Type":"NodeParagraph","Properties":{"id":"20230724021022-cumsgt1","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN \u0026lt;command\u0026gt;"},{"Type":"NodeText","Data":"​（"},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"形式，该命令在shell中运行）"}]}]},{"ID":"20230724021022-dker5ay","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-dker5ay","updated":"20230724021022"},"Children":[{"ID":"20230724021022-e3slesc","Type":"NodeParagraph","Properties":{"id":"20230724021022-e3slesc","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN [\u0026quot;executable\u0026quot;, \u0026quot;param1\u0026quot;, \u0026quot;param2\u0026quot;]"},{"Type":"NodeText","Data":"​（"},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"形式）"}]}]}]},{"ID":"20230724021022-3lyb8i7","Type":"NodeParagraph","Properties":{"id":"20230724021022-3lyb8i7","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"之前说过，Dockerfile 中每一个指令都会建立一层，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 也不例外。每一个 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 的行为，就和刚才我们手工建立镜像的过程一样：新建立一层，在其上执行这些命令，执行结束后，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"commit"},{"Type":"NodeText","Data":"​ 这一层的修改，构成新的镜像。"}]},{"ID":"20230724021022-q0m9yvt","Type":"NodeParagraph","Properties":{"id":"20230724021022-q0m9yvt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意："},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"Union FS 是有最大层数限制的，比如 AUFS，曾经是最大不得超过 42 层，现在是不得超过 127 层。"}]},{"ID":"20230724021022-dvvcbap","Type":"NodeParagraph","Properties":{"id":"20230724021022-dvvcbap","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**所以，在使用 **"},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":" 方式，尽量多的使用续行符"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\\"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-5bdyl86","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-5bdyl86","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"RUN /bin/bash -c 'source $HOME/.bashrc; \\\n echo $HOME'\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-wegxt5q","Type":"NodeParagraph","Properties":{"id":"20230724021022-wegxt5q","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"写 Dockerfile 的时候，要经常提醒自己，这并不是在写 Shell 脚本，而是在定义每一层该如何构建。"}]},{"ID":"20230724021022-o9b0h48","Type":"NodeParagraph","Properties":{"id":"20230724021022-o9b0h48","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**注意当使用 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"​ 方式时，需要明确指定 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​ 路径，否则变量可能不会生效"}]},{"ID":"20230724021022-divhge9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-divhge9","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM centos\nENV name=\"yangge\"\nRUN [\"/bin/echo\", \"$name\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-21w03o5","Type":"NodeBlockquote","Properties":{"id":"20230724021022-21w03o5","updated":"20230724021022"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20230724021022-rvygbk5","Type":"NodeParagraph","Properties":{"id":"20230724021022-rvygbk5","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**可以看到 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$name"},{"Type":"NodeText","Data":"​ 被作为普通的字符串输出了，因为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"$name"},{"Type":"NodeText","Data":"​ 是 shell 中的用法，而这里里并没有 使用到 shell"}]}]},{"ID":"20230724021022-n5wxc9r","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-n5wxc9r","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"下面是正确的做法"}]},{"ID":"20230724021022-cuwtv9b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-cuwtv9b","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM alpine\nENV name=\"yangge\"\nRUN [\"/bin/sh\", \"-c\", \"/bin/echo $name\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-oi8k92d","Type":"NodeBlockquote","Properties":{"id":"20230724021022-oi8k92d","updated":"20230724021022"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20230724021022-10k3gd7","Type":"NodeParagraph","Properties":{"id":"20230724021022-10k3gd7","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意:"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"em","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"的方式下，列表中的内容会被解析为JSON数组，这意味着您必须在单词周围使用双引号（“） 而非单引号（'）。"}]}]},{"ID":"20230724021022-4ivlupn","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-4ivlupn","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"CMD 指令"}]},{"ID":"20230724021022-gome1oa","Type":"NodeParagraph","Properties":{"id":"20230724021022-gome1oa","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 中只能有一条"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​指令。如果列出多个，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 则只有最后一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​会生效。"}]},{"ID":"20230724021022-3wubqdo","Type":"NodeParagraph","Properties":{"id":"20230724021022-3wubqdo","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD 主要目的是为运行容器时提供默认值"}]},{"ID":"20230724021022-dxmlfnl","Type":"NodeParagraph","Properties":{"id":"20230724021022-dxmlfnl","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 不是虚拟机，容器就是进程，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 指令就是用于指定默认的容器主进程的启动命令的。在启动(运行)一个容器时可以指定新的命令来替代镜像设置中的这个默认命令。"}]},{"ID":"20230724021022-gc0e9c5","Type":"NodeParagraph","Properties":{"id":"20230724021022-gc0e9c5","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以包含可执行文件，当然也可以省略。"}]},{"ID":"20230724021022-nwslion","Type":"NodeParagraph","Properties":{"id":"20230724021022-nwslion","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 指令的格式和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 相似，也是两种格式："}]},{"ID":"20230724021022-0rar4w4","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-0rar4w4","updated":"20230724021022"},"Children":[{"ID":"20230724021022-g6nmbwz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-g6nmbwz","updated":"20230724021022"},"Children":[{"ID":"20230724021022-lhzp97y","Type":"NodeParagraph","Properties":{"id":"20230724021022-lhzp97y","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​ 格式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD \u0026lt;命令\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724021022-mmpdn9t","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-mmpdn9t","updated":"20230724021022"},"Children":[{"ID":"20230724021022-vowenpd","Type":"NodeParagraph","Properties":{"id":"20230724021022-vowenpd","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"​ 格式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD [\u0026quot;可执行文件\u0026quot;, \u0026quot;参数1\u0026quot;, \u0026quot;参数2\u0026quot;...]"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724021022-ouphnaw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-ouphnaw","updated":"20230724021022"},"Children":[{"ID":"20230724021022-t50f8xd","Type":"NodeParagraph","Properties":{"id":"20230724021022-t50f8xd","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"参数列表格式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD [\u0026quot;参数1\u0026quot;, \u0026quot;参数2\u0026quot;...]"},{"Type":"NodeText","Data":"​。在指定了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 指令后，用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 指定具体的参数。"}]}]}]},{"ID":"20230724021022-ql628tt","Type":"NodeBlockquote","Properties":{"id":"20230724021022-ql628tt","updated":"20230724021022"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20230724021022-iv2pfas","Type":"NodeParagraph","Properties":{"id":"20230724021022-iv2pfas","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意"},{"Type":"NodeText","Data":"：不要混淆"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​实际上运行一个命令并提交结果; "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​在构建时不执行任何操作，但指定镜像的默认命令。"}]}]},{"ID":"20230724021022-j3iylys","Type":"NodeParagraph","Properties":{"id":"20230724021022-j3iylys","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Docker 不是虚拟机，容器内没有后台服务的概念。"}]},{"ID":"20230724021022-5itipm6","Type":"NodeParagraph","Properties":{"id":"20230724021022-5itipm6","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不要期望这样启动一个程序到后台:"}]},{"ID":"20230724021022-fw7htwx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-fw7htwx","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"CMD systemctl start nginx\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-3hyylyv","Type":"NodeParagraph","Properties":{"id":"20230724021022-3hyylyv","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**这行被 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Docker"},{"Type":"NodeText","Data":"​ 理解为："}]},{"ID":"20230724021022-iip6405","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-iip6405","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"CMD [\"sh\" \"-c\" \"systemctl start nginx\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-afd1kl0","Type":"NodeParagraph","Properties":{"id":"20230724021022-afd1kl0","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"对于容器而言，其启动程序就是容器的应用进程，容器就是为了主进程而存在的，主进程退出，容器就失去了存在的意义，从而退出，其它辅助进程不是它需要关心的东西。"}]},{"ID":"20230724021022-1ilrylc","Type":"NodeParagraph","Properties":{"id":"20230724021022-1ilrylc","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**就像上面的示例中，主进程是 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sh"},{"Type":"NodeText","Data":"​ , 那么当 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"service nginx start"},{"Type":"NodeText","Data":"​ 命令结束后，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sh"},{"Type":"NodeText","Data":"​ 也就结束了，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sh"},{"Type":"NodeText","Data":"​ 作为主进程退出了，自然就会使容器退出。"}]},{"ID":"20230724021022-4ey6hqo","Type":"NodeParagraph","Properties":{"id":"20230724021022-4ey6hqo","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**正确的做法是直接执行 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"nginx"},{"Type":"NodeText","Data":"​ 这个可执行文件，并且关闭后台守护的方式，使程序在前台运行。"}]},{"ID":"20230724021022-jpm92bs","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-jpm92bs","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"CMD [\"nginx\", \"-g\", \"daemon off;\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-nguic5v","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-nguic5v","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"ENTRYPOINT 指令"}]},{"ID":"20230724021022-n89i5yg","Type":"NodeParagraph","Properties":{"id":"20230724021022-n89i5yg","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 的目的和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 一样，都是在指定容器的启动程序及参数。"}]},{"ID":"20230724021022-vgxwy2e","Type":"NodeParagraph","Properties":{"id":"20230724021022-vgxwy2e","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 在运行时也可以被替代，不过比 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 要略显繁琐，需要通过 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker run"},{"Type":"NodeText","Data":"​ 的参数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--entrypoint"},{"Type":"NodeText","Data":"​ 来指定。"}]},{"ID":"20230724021022-5ljiso9","Type":"NodeParagraph","Properties":{"id":"20230724021022-5ljiso9","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 的格式和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 指令格式一样，也分为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"​ 格式和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​ 格式。"}]},{"ID":"20230724021022-6ddh2aw","Type":"NodeParagraph","Properties":{"id":"20230724021022-6ddh2aw","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**当指定了 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 后，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 的含义就发生了改变，不再是直接的运行其命令，而是将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 的内容作为参数传给 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 指令，也就是实际执行时，将变为："}]},{"ID":"20230724021022-uxp2nfl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-uxp2nfl","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"\u003cENTRYPOINT\u003e \"\u003cCMD\u003e\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-zq8ae91","Type":"NodeParagraph","Properties":{"id":"20230724021022-zq8ae91","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**有了 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 后，为什么还要有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 呢？"}]},{"ID":"20230724021022-xrzurto","Type":"NodeParagraph","Properties":{"id":"20230724021022-xrzurto","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**这种 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;ENTRYPOINT\u0026gt; \u0026quot;\u0026lt;CMD\u0026gt;\u0026quot;"},{"Type":"NodeText","Data":"​ 给我们带来了什么好处么？"}]},{"ID":"20230724021022-9k8i6qe","Type":"NodeParagraph","Properties":{"id":"20230724021022-9k8i6qe","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"让我们来看几个场景。"}]},{"ID":"20230724021022-t4v960r","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-t4v960r","updated":"20230724021022"},"Children":[{"ID":"20230724021022-0cek7yf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-0cek7yf","updated":"20230724021022"},"Children":[{"ID":"20230724021022-7nn04iu","Type":"NodeParagraph","Properties":{"id":"20230724021022-7nn04iu","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景一：让镜像变成像命令一样使用"}]}]}]},{"ID":"20230724021022-7ob1ihi","Type":"NodeParagraph","Properties":{"id":"20230724021022-7ob1ihi","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD 方式"}]},{"ID":"20230724021022-x8rkuak","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-x8rkuak","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM centos\nRUN yum update \\\n    \u0026\u0026 yum install -y curl\nCMD [ \"curl\", \"-s\", \"http://ip.cn\" ]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-shxgjz4","Type":"NodeParagraph","Properties":{"id":"20230724021022-shxgjz4","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"构建镜像后, 运行容器"}]},{"ID":"20230724021022-qldyhpw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-qldyhpw","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# docker run --rm centos-echo-ip-cmd\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-uocmelt","Type":"NodeParagraph","Properties":{"id":"20230724021022-uocmelt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"执行下面命令会报错"}]},{"ID":"20230724021022-65gnfm7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-65gnfm7","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# docker run --rm centos-echo-ip-cmd -i\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-n2qz4wx","Type":"NodeParagraph","Properties":{"id":"20230724021022-n2qz4wx","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"我们可以看到报错，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"executable file not found"},{"Type":"NodeText","Data":"​。之前我们说过，跟在镜像名后面的是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"command"},{"Type":"NodeText","Data":"​，运行时会替换 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 的默认值。因此这里的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-i"},{"Type":"NodeText","Data":"​ 并不是添加在原来的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"curl -s http://ip.cn"},{"Type":"NodeText","Data":"​ 后面。 而是替换了原来的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​，变成了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD [\u0026quot;-i\u0026quot;]"},{"Type":"NodeText","Data":"​，而 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-i"},{"Type":"NodeText","Data":"​ 根本不是命令，所以报了"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"可执行文件找不到"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-j4nq5qi","Type":"NodeParagraph","Properties":{"id":"20230724021022-j4nq5qi","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"所以应该使用 "},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":" 方式"}]},{"ID":"20230724021022-kosp0pa","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-kosp0pa","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM centos\nRUN yum install -y curl\nENTRYPOINT [\"curl\", \"-s\", \"http://ip.cn\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-lg30r39","Type":"NodeParagraph","Properties":{"id":"20230724021022-lg30r39","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"再次构建镜像后, 运行容器"}]},{"ID":"20230724021022-6sacb7o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-6sacb7o","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# docker run --rm centos-echo-ip-entrypoint\n# docker run --rm centos-echo-ip-entrypoint -i\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-uz62d2f","Type":"NodeParagraph","Properties":{"id":"20230724021022-uz62d2f","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**这样的话, 最终的指令就变成 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT [\u0026quot;curl\u0026quot;, \u0026quot;-s\u0026quot;, \u0026quot;http://ip.cn\u0026quot;, \u0026quot;-i\u0026quot;]"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-vxpm5fu","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-vxpm5fu","updated":"20230724021022"},"Children":[{"ID":"20230724021022-gcig4fg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-gcig4fg","updated":"20230724021022"},"Children":[{"ID":"20230724021022-co9qfgp","Type":"NodeParagraph","Properties":{"id":"20230724021022-co9qfgp","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景二：应用运行前的准备工作"}]}]}]},{"ID":"20230724021022-eykg855","Type":"NodeParagraph","Properties":{"id":"20230724021022-eykg855","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"启动容器就是启动主进程，但有些时候，启动主进程前，需要一些准备工作。"}]},{"ID":"20230724021022-o0m9jz2","Type":"NodeParagraph","Properties":{"id":"20230724021022-o0m9jz2","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**官方镜像 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"redis"},{"Type":"NodeText","Data":"​ 中的示例："}]},{"ID":"20230724021022-t8ogib5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-t8ogib5","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM alpine:3.4\n...\nRUN addgroup -S redis \u0026\u0026 adduser -S -G redis redis\n...\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nEXPOSE 6379\nCMD [ \"redis-server\" ]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-u2kyflj","Type":"NodeParagraph","Properties":{"id":"20230724021022-u2kyflj","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**可以看到其中为 redis 服务创建了 redis 用户，并在最后指定了 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"docker-entrypoint.sh"},{"Type":"NodeText","Data":"​ 脚本。"}]},{"ID":"20230724021022-vxkrfzp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-vxkrfzp","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"#!/bin/sh\n...\n# allow the container to be started with `--user`\nif [ \"$1\" = 'redis-server' -a \"$(id -u)\" = '0' ]; then\n    chown -R redis .\n    exec gosu redis \"$0\" \"$@\"\nfi\n\nexec \"$@\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-oh6ah49","Type":"NodeParagraph","Properties":{"id":"20230724021022-oh6ah49","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**该脚本的内容就是根据 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 的内容来判断，如果是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"redis-server"},{"Type":"NodeText","Data":"​ 的话，则切换到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"redis"},{"Type":"NodeText","Data":"​ 用户身份启动服务器，否则依旧使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"root"},{"Type":"NodeText","Data":"​ 身份执行。比如："}]},{"ID":"20230724021022-bgkpmpp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-bgkpmpp","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ docker run -it redis id\nuid=0(root) gid=0(root) groups=0(root)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-wmkcntm","Type":"NodeParagraph","Properties":{"id":"20230724021022-wmkcntm","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**还有 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 指令不会被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 指令覆盖，而 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 指令会被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 指令覆盖"}]},{"ID":"20230724021022-cxgiaa5","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-cxgiaa5","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"WORKDIR 指令"}]},{"ID":"20230724021022-pdtorel","Type":"NodeParagraph","Properties":{"id":"20230724021022-pdtorel","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用于声明当前的工作目录，以后各层的当前目录就被改为指定的目录。"}]},{"ID":"20230724021022-6um9n7z","Type":"NodeParagraph","Properties":{"id":"20230724021022-6um9n7z","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**格式为 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR \u0026lt;工作目录路径\u0026gt;"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-4549tgt","Type":"NodeParagraph","Properties":{"id":"20230724021022-4549tgt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如该目录不存在，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​ 会帮你建立目录。"}]},{"ID":"20230724021022-f6nnnjz","Type":"NodeParagraph","Properties":{"id":"20230724021022-f6nnnjz","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**再次强调！不要以为编写 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfiel"},{"Type":"NodeText","Data":"​ 是在写 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​ 脚本。"}]},{"ID":"20230724021022-wzd92ay","Type":"NodeParagraph","Properties":{"id":"20230724021022-wzd92ay","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"下面是一个错误示例："}]},{"ID":"20230724021022-lntb1k3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-lntb1k3","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"RUN cd /app\nRUN echo \"hello\" \u003e world.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-lqnsrhz","Type":"NodeParagraph","Properties":{"id":"20230724021022-lqnsrhz","updated":"20230724021159"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果将这个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 进行构建镜像运行后，会发现找不到 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/app/world.txt"},{"Type":"NodeText","Data":"​ 文件，或者其内容不是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"hello"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-rckv19g","Type":"NodeParagraph","Properties":{"id":"20230724021022-rckv19g","updated":"20230724021157"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"原因其实很简单，这两行"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 命令的执行环境根本不同，是两个完全不同的容器。这就是对 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 构建分层存储的概念不了解所导致的错误。"}]},{"ID":"20230724021022-easslql","Type":"NodeParagraph","Properties":{"id":"20230724021022-easslql","updated":"20230724021155"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"之前说过每一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 都是启动一个容器、执行命令、然后提交存储层文件变更。"}]},{"ID":"20230724021022-u8f13et","Type":"NodeParagraph","Properties":{"id":"20230724021022-u8f13et","updated":"20230724021152"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"两行"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 分别构建了并启动了各自全新的容器。"}]},{"ID":"20230724021022-o2edgof","Type":"NodeParagraph","Properties":{"id":"20230724021022-o2edgof","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**因此如果需要改变以后各层的工作目录的位置，那么应该使用 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​ 指令。"}]},{"ID":"20230724021022-6lmxvqd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-6lmxvqd","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM alpine\nWORKDIR /a/b\nRUN touch a_b_f.txt\nWORKDIR /a\nRUN touch a_f.txt\n[root@localhost workdir]# docker run -it alpine:workdir /bin/sh\n/a # ls\na_f.txt  b\n/a # cd b\n/a/b # ls\na_b_f.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-d38njvn","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-d38njvn","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"COPY 指令"}]},{"ID":"20230724021022-3a4xmrf","Type":"NodeParagraph","Properties":{"id":"20230724021022-3a4xmrf","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式："}]},{"ID":"20230724021022-vaobwf9","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-vaobwf9","updated":"20230724021022"},"Children":[{"ID":"20230724021022-61gknnt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-61gknnt","updated":"20230724021022"},"Children":[{"ID":"20230724021022-6kjwvzh","Type":"NodeParagraph","Properties":{"id":"20230724021022-6kjwvzh","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY \u0026lt;源路径\u0026gt;... \u0026lt;目标路径\u0026gt;"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20230724021022-v1ezmb7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-v1ezmb7","updated":"20230724021022"},"Children":[{"ID":"20230724021022-l69zuki","Type":"NodeParagraph","Properties":{"id":"20230724021022-l69zuki","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY [\u0026quot;\u0026lt;源路径1\u0026gt;\u0026quot;,... \u0026quot;\u0026lt;目标路径\u0026gt;\u0026quot;]"},{"Type":"NodeText","Data":"​"}]}]}]},{"ID":"20230724021022-qry4lue","Type":"NodeParagraph","Properties":{"id":"20230724021022-qry4lue","updated":"20230724021150"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​ 指令一样，也有两种格式，一种类似于命令行，一种类似于函数调用。"}]},{"ID":"20230724021022-b92yl9f","Type":"NodeParagraph","Properties":{"id":"20230724021022-b92yl9f","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;目标路径\u0026gt;"},{"Type":"NodeText","Data":"​ 可以是容器内的绝对路径，也可以是相对于 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"WORKDIR"},{"Type":"NodeText","Data":"​ 指定的工作目录的相对路径。目标路径不需要事先创建，如果目录不存在会在复制文件前先被创建。"}]},{"ID":"20230724021022-e2b7f62","Type":"NodeParagraph","Properties":{"id":"20230724021022-e2b7f62","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 指令将会从构建的上下文目录中，把源路径的文件或目录复制到新的一层的镜像内的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;目标路径\u0026gt;"},{"Type":"NodeText","Data":"​ 位置。比如："}]},{"ID":"20230724021022-73hnd4u","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-73hnd4u","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"COPY qf.json /usr/src/app/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-78i4by9","Type":"NodeParagraph","Properties":{"id":"20230724021022-78i4by9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意下面是错误的"}]},{"ID":"20230724021022-r6hxgyi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-r6hxgyi","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"COPY qf.json /usr/src/app\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-6rmllkx","Type":"NodeParagraph","Properties":{"id":"20230724021022-6rmllkx","updated":"20230724021147"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这样会把"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"qf.json"},{"Type":"NodeText","Data":"​ 拷贝成为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/usr/src/"},{"Type":"NodeText","Data":"​ 目录下的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"app"},{"Type":"NodeText","Data":"​ 文件"}]},{"ID":"20230724021022-1fg0e9i","Type":"NodeParagraph","Properties":{"id":"20230724021022-1fg0e9i","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;源路径\u0026gt;"},{"Type":"NodeText","Data":"​ 可以是多个，支持通配符，如："}]},{"ID":"20230724021022-m3q4qb1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-m3q4qb1","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"COPY qf* /app/\nCOPY q?.txt /app/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-tzkr6oa","Type":"NodeParagraph","Properties":{"id":"20230724021022-tzkr6oa","updated":"20230724021144"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 指令，源文件的各种元数据都会保留。"}]},{"ID":"20230724021022-ymndofb","Type":"NodeParagraph","Properties":{"id":"20230724021022-ymndofb","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"比如读、写、执行权限、文件变更时间等。"}]},{"ID":"20230724021022-xl813iu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-xl813iu","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"ADD 指令"}]},{"ID":"20230724021022-fna6hby","Type":"NodeParagraph","Properties":{"id":"20230724021022-fna6hby","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ADD"},{"Type":"NodeText","Data":"​ 指令和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 的格式和性质基本一致。但是在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 基础上增加了一些功能。"}]},{"ID":"20230724021022-c9j8bxv","Type":"NodeParagraph","Properties":{"id":"20230724021022-c9j8bxv","updated":"20230724021141"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"支持自动解压缩，压缩格式支持："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gzip"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bzip2"},{"Type":"NodeText","Data":"​ 以及 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"xz"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-yatdgab","Type":"NodeParagraph","Properties":{"id":"20230724021022-yatdgab","updated":"20230724021139"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"官方推荐使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 进行文件的复制。"}]},{"ID":"20230724021022-ej9cwxz","Type":"NodeParagraph","Properties":{"id":"20230724021022-ej9cwxz","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ADD"},{"Type":"NodeText","Data":"​ 指定会使构建镜像时的缓存失效，导致构建镜像的速度很慢。"}]},{"ID":"20230724021022-7nssfvl","Type":"NodeParagraph","Properties":{"id":"20230724021022-7nssfvl","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ADD"},{"Type":"NodeText","Data":"​ 指令中选择的原则，所有的文件复制均使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 指令，仅在需要自动解压缩的场合使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ADD"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-fyhua3s","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-fyhua3s","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"ADD qf.tar.gz  /\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-19so9bb","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-19so9bb","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"USER 指令"}]},{"ID":"20230724021022-ik07h3c","Type":"NodeParagraph","Properties":{"id":"20230724021022-ik07h3c","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"USER"},{"Type":"NodeText","Data":"​ 则是改变执行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​ 以及 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 这类命令的身份。"}]},{"ID":"20230724021022-vys7003","Type":"NodeParagraph","Properties":{"id":"20230724021022-vys7003","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这个用户必须是事先在容器内存在(建立好)的，否则无法切换。"}]},{"ID":"20230724021022-der4kms","Type":"NodeParagraph","Properties":{"id":"20230724021022-der4kms","updated":"20230724021135"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果以"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"root"},{"Type":"NodeText","Data":"​ 执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程，不要使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"su"},{"Type":"NodeText","Data":"​ 或者 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"sudo"},{"Type":"NodeText","Data":"​，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错。建议使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gosu"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-vt9lvg0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-vt9lvg0","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 建立 redis 用户，并使用 gosu 换另一个用户执行命令\nRUN groupadd -r redis \u0026\u0026 useradd -r -g redis redis\n# 下载 gosu\nRUN wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64\" \\\n    \u0026\u0026 chmod +x /usr/local/bin/gosu \\\n    \u0026\u0026 gosu nobody true\n# 设置 CMD，并以另外的用户执行\nCMD [ \"exec\", \"gosu\", \"redis\", \"redis-server\" ]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-tzgor6b","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-tzgor6b","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"HEALTHCHECK 健康检查指令"}]},{"ID":"20230724021022-baidxwk","Type":"NodeParagraph","Properties":{"id":"20230724021022-baidxwk","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式："}]},{"ID":"20230724021022-sz2nm71","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-sz2nm71","updated":"20230724021022"},"Children":[{"ID":"20230724021022-a9tcio1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-a9tcio1","updated":"20230724021022"},"Children":[{"ID":"20230724021022-5ujq0jr","Type":"NodeParagraph","Properties":{"id":"20230724021022-5ujq0jr","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK [选项] CMD \u0026lt;命令\u0026gt;"},{"Type":"NodeText","Data":"​：设置检查容器健康状况的命令"}]}]},{"ID":"20230724021022-luf9iip","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-luf9iip","updated":"20230724021022"},"Children":[{"ID":"20230724021022-ts4gjgb","Type":"NodeParagraph","Properties":{"id":"20230724021022-ts4gjgb","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK NONE"},{"Type":"NodeText","Data":"​：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令"}]}]}]},{"ID":"20230724021022-lfj4n2l","Type":"NodeParagraph","Properties":{"id":"20230724021022-lfj4n2l","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 指令是告诉 Docker 应该如何进行判断容器的状态是否正常，这是 Docker 1.12 引入的新指令。"}]},{"ID":"20230724021022-4k3i42n","Type":"NodeParagraph","Properties":{"id":"20230724021022-4k3i42n","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"通过该指令指定一行命令，用这行命令来判断容器主进程的服务状态是否还正常，从而比较真实的反应容器实际状态。"}]},{"ID":"20230724021022-jfkh7yu","Type":"NodeParagraph","Properties":{"id":"20230724021022-jfkh7yu","updated":"20230724021129"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"当在一个镜像指定了"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 指令后，用其启动容器后的状态变化会是下面的演变过程："}]},{"ID":"20230724021022-9k98fey","Type":"NodeParagraph","Properties":{"id":"20230724021022-9k98fey","updated":"20230724021127"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"初始状态会为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"starting"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-7tp4nv4","Type":"NodeParagraph","Properties":{"id":"20230724021022-7tp4nv4","updated":"20230724021126"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 指令检查成功后变为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"healthy"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-xja8xly","Type":"NodeParagraph","Properties":{"id":"20230724021022-xja8xly","updated":"20230724021124"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果连续一定次数失败，则会变为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unhealthy"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-iggkxlj","Type":"NodeParagraph","Properties":{"id":"20230724021022-iggkxlj","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 支持下列选项："}]},{"ID":"20230724021022-g9xfl5l","Type":"NodeList","ListData":{},"Properties":{"id":"20230724021022-g9xfl5l","updated":"20230724021022"},"Children":[{"ID":"20230724021022-4fn01rq","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-4fn01rq","updated":"20230724021022"},"Children":[{"ID":"20230724021022-vyqmxtn","Type":"NodeParagraph","Properties":{"id":"20230724021022-vyqmxtn","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--interval=\u0026lt;间隔\u0026gt;"},{"Type":"NodeText","Data":"​：两次健康检查的间隔，默认为 30 秒；"}]}]},{"ID":"20230724021022-ax2omeu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-ax2omeu","updated":"20230724021022"},"Children":[{"ID":"20230724021022-l8vkh0o","Type":"NodeParagraph","Properties":{"id":"20230724021022-l8vkh0o","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--timeout=\u0026lt;时长\u0026gt;"},{"Type":"NodeText","Data":"​：健康检查命令运行超时时间，如果超过这个时间，本次健康检查就被视为失败，默认 30 秒；"}]}]},{"ID":"20230724021022-1xraxxi","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-1xraxxi","updated":"20230724021022"},"Children":[{"ID":"20230724021022-o8d8yga","Type":"NodeParagraph","Properties":{"id":"20230724021022-o8d8yga","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--retries=\u0026lt;次数\u0026gt;"},{"Type":"NodeText","Data":"​：当连续失败指定次数后，则将容器状态视为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"unhealthy"},{"Type":"NodeText","Data":"​，默认 3 次。"}]}]},{"ID":"20230724021022-aqml95w","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20230724021022-aqml95w","updated":"20230724021022"},"Children":[{"ID":"20230724021022-zgxi0qy","Type":"NodeParagraph","Properties":{"id":"20230724021022-zgxi0qy","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--start-period=\u0026lt;时长\u0026gt;"},{"Type":"NodeText","Data":"​: 容器的初始化实长，默认0秒，不计入健康检测时间内。"}]}]}]},{"ID":"20230724021022-fwuzouj","Type":"NodeParagraph","Properties":{"id":"20230724021022-fwuzouj","updated":"20230724021121"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"CMD"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ENTRYPOINT"},{"Type":"NodeText","Data":"​ 一样，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 在 Dockerfile 中只可以出现一次，如果写了多个，只有最后一个生效。"}]},{"ID":"20230724021022-9v4s6by","Type":"NodeParagraph","Properties":{"id":"20230724021022-9v4s6by","updated":"20230724021118"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"后面的命令同样支持"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"shell"},{"Type":"NodeText","Data":"​ 方式和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"exec"},{"Type":"NodeText","Data":"​ 方式。"}]},{"ID":"20230724021022-l413kss","Type":"NodeParagraph","Properties":{"id":"20230724021022-l413kss","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"命令的返回值决定了该次健康检查的成功与否："}]},{"ID":"20230724021022-xsgnqek","Type":"NodeParagraph","Properties":{"id":"20230724021022-xsgnqek","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"0"},{"Type":"NodeText","Data":"​：成功；"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"1"},{"Type":"NodeText","Data":"​：失败。"}]},{"ID":"20230724021022-qfte1xt","Type":"NodeParagraph","Properties":{"id":"20230724021022-qfte1xt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"示例："}]},{"ID":"20230724021022-77isjiq","Type":"NodeParagraph","Properties":{"id":"20230724021022-77isjiq","updated":"20230724021115"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"curl"},{"Type":"NodeText","Data":"​ 命令来判断 nginx 提供的 web 服务是否正常。"}]},{"ID":"20230724021022-v5q8z6w","Type":"NodeParagraph","Properties":{"id":"20230724021022-v5q8z6w","updated":"20230724021114"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"其"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HEALTHCHECK"},{"Type":"NodeText","Data":"​ 可以这么写："}]},{"ID":"20230724021022-ouzcff0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-ouzcff0","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM centos\nRUN rpm -ivh \\\nhttp://mirrors.aliyun.com/epel/epel-release-latest-7.noarch.rpm \u0026\u0026  yum install nginx \\\n                curl -y\nADD index.html /usr/share/nginx/html/index.html\nHEALTHCHECK --interval=5s --timeout=3s CMD curl -fs \\\n            http://localhost/ || exit 1\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\nEXPOSE 80\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-rak7h7y","Type":"NodeParagraph","Properties":{"id":"20230724021022-rak7h7y","updated":"20230724021111"},"Children":[{"Type":"NodeText","Data":"这里设置了每 5 秒检查一次（这里为了试验所以间隔非常短，实际应该相对较长），如果健康检查命令超过 3 秒没响应就视为失败，并且使用 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"curl -fs http://localhost/ || exit 1"},{"Type":"NodeText","Data":"​ 作为健康检查命令。"}]},{"ID":"20230724021022-2txjib2","Type":"NodeParagraph","Properties":{"id":"20230724021022-2txjib2","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"构建镜像后， 启动容器，并观察容器的状态变化"}]},{"ID":"20230724021022-gpwhpi9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-gpwhpi9","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# docker build -t ali_nginx .\n# docker run -d ali_nginx\n[root@localhost ~]# docker ps\nCONTAINER ID  IMAGE         COMMAND               CREATED     STATUS                            PORTS        NAMES\n09a8b90b0f67  ali_nginx   \"nginx -g 'daemon of…\"   4 seconds ago       Up 3 seconds (health: starting)   80/tcp      vigorous_jang\n[root@localhost ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                    PORTS               NAMES\n09a8b90b0f67        ali_nginx           \"nginx -g 'daemon of…\"   19 seconds ago      Up 18 seconds (healthy)   80/tcp              vigorous_jang\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-iffxgnt","Type":"NodeParagraph","Properties":{"id":"20230724021022-iffxgnt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"利用元数据查看容器的健康状态"}]},{"ID":"20230724021022-jm51pa3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-jm51pa3","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"docker inspect --format '{{json .State.Health}}' vigorous_jang | python -m json.tool\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-uz3fkkm","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-uz3fkkm","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"ONBILUD 指令"}]},{"ID":"20230724021022-804sloe","Type":"NodeParagraph","Properties":{"id":"20230724021022-804sloe","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ONBILUD"},{"Type":"NodeText","Data":"​ 指令用于当其他 Dockerfile 以自己为基础镜像时将会运行的命令。"}]},{"ID":"20230724021022-52yof6r","Type":"NodeParagraph","Properties":{"id":"20230724021022-52yof6r","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ONBUILD \u0026lt;其它指令\u0026gt;"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20230724021022-ppzoa0r","Type":"NodeParagraph","Properties":{"id":"20230724021022-ppzoa0r","updated":"20230724021103"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"其他指令可以是： 比如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RUN"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY"},{"Type":"NodeText","Data":"​ 等。"}]},{"ID":"20230724021022-1ctlobh","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-1ctlobh","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"基础应用场景"}]},{"ID":"20230724021022-ed30n4z","Type":"NodeParagraph","Properties":{"id":"20230724021022-ed30n4z","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"假如有两个项目 A 和 B"}]},{"ID":"20230724021022-rb4s12x","Type":"NodeParagraph","Properties":{"id":"20230724021022-rb4s12x","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"两个项目想分别有不同的文件"}]},{"ID":"20230724021022-cbwq0qh","Type":"NodeParagraph","Properties":{"id":"20230724021022-cbwq0qh","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"A 项目下的文件："}]},{"ID":"20230724021022-5fngqu7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-5fngqu7","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# tree A/\nA/\n├── a1.txt\n└── a.txt\n\n0 directories, 2 files\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-6epuzp9","Type":"NodeParagraph","Properties":{"id":"20230724021022-6epuzp9","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"B 项目下的文件"}]},{"ID":"20230724021022-qxre8ht","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-qxre8ht","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# tree B\nB\n├── b1.txt\n├── b2.txt\n└── b.txt\n\n0 directories, 3 files\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-j37fwso","Type":"NodeParagraph","Properties":{"id":"20230724021022-j37fwso","updated":"20230724021100"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"现在任意的空目录下创建一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-wb5fwdz","Type":"NodeParagraph","Properties":{"id":"20230724021022-wb5fwdz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"文件内容："}]},{"ID":"20230724021022-qssbzxh","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-qssbzxh","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# cat Dockerfile\nFROM alpine\nONBUILD COPY . /root/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-cab035y","Type":"NodeParagraph","Properties":{"id":"20230724021022-cab035y","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"接着用这个 Dockerfile 来构建一个所有项目都要使用的一个基础镜像"}]},{"ID":"20230724021022-f3hhhlb","Type":"NodeParagraph","Properties":{"id":"20230724021022-f3hhhlb","updated":"20230724021057"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"镜像名字："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"alpine-base"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-p31xiud","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-p31xiud","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# docker build -t alpine-base .\nSending build context to Docker daemon  6.144kB\nStep 1/2 : FROM alpine\n ---\u003e 3fd9065eaf02\nStep 2/2 : ONBUILD COPY . /root/\n ---\u003e Running in 4d6fad2809be\nRemoving intermediate container 4d6fad2809be\n ---\u003e 804bfc0b47be\nSuccessfully built 804bfc0b47be\nSuccessfully tagged alpine-base:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-9y7sqbi","Type":"NodeParagraph","Properties":{"id":"20230724021022-9y7sqbi","updated":"20230724021054"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"当使用这个镜像去运行容器的时候。查看"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/root"},{"Type":"NodeText","Data":"​ 目录下，可发现并没有任何东西，"}]},{"ID":"20230724021022-k92hs6z","Type":"NodeParagraph","Properties":{"id":"20230724021022-k92hs6z","updated":"20230724021051"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"说明"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"COPY . /root/"},{"Type":"NodeText","Data":"​ 并没有此次构建镜像的过程中去执行。"}]},{"ID":"20230724021022-8iafx7v","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-8iafx7v","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# docker run --rm alpine-base:latest ls /root/\n[root@docker onbulid]#\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-cu9t3oo","Type":"NodeParagraph","Properties":{"id":"20230724021022-cu9t3oo","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"现在我们在使用刚才构建的镜像为项目 A 的基础镜像，来构建 A 项目的镜像"}]},{"ID":"20230724021022-kp5v9gz","Type":"NodeParagraph","Properties":{"id":"20230724021022-kp5v9gz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"想看看目前 A 项目下的文件："}]},{"ID":"20230724021022-efxxqkk","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-efxxqkk","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# cd A\n[root@docker A]# ls\na1.txt  a.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-frc87h7","Type":"NodeParagraph","Properties":{"id":"20230724021022-frc87h7","updated":"20230724021049"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在项目的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"A"},{"Type":"NodeText","Data":"​ 目录下编写 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 文件内容如下："}]},{"ID":"20230724021022-yuk741b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-yuk741b","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker A]# cat Dockerfile\nFROM alpine-base:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-yyofsrc","Type":"NodeParagraph","Properties":{"id":"20230724021022-yyofsrc","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"是的只需要这一行即可"}]},{"ID":"20230724021022-04447ob","Type":"NodeParagraph","Properties":{"id":"20230724021022-04447ob","updated":"20230724021047"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"现在让我们来构建"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"A"},{"Type":"NodeText","Data":"​ 项目的镜像"}]},{"ID":"20230724021022-eebmcoq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-eebmcoq","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker A]# docker build -t alpine-a .\nSending build context to Docker daemon  3.072kB\nStep 1/1 : FROM alpine-base:latest\n# Executing 1 build trigger\n ---\u003e 5a003e1dc65f\nSuccessfully built 5a003e1dc65f\nSuccessfully tagged alpine-a:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-esnkoc1","Type":"NodeParagraph","Properties":{"id":"20230724021022-esnkoc1","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"接着运行以这个镜像"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"alpine-a:latest"},{"Type":"NodeText","Data":"​为基础镜像而运行的容器中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/root/"},{"Type":"NodeText","Data":"​ 目录下会有 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"A"},{"Type":"NodeText","Data":"​ 项目目录下的所有文件:"}]},{"ID":"20230724021022-wmqok70","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-wmqok70","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker A]# docker run --rm alpine-a:latest ls /root/\nDockerfile\na.txt\na1.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-12mc6zt","Type":"NodeParagraph","Properties":{"id":"20230724021022-12mc6zt","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"B"},{"Type":"NodeText","Data":"​ 项目的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 的内容："}]},{"ID":"20230724021022-l9kxyv1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-l9kxyv1","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker B]# ls\nb1.txt  b2.txt  b.txt\n[root@docker B]# cat Dockerfile\nFROM alpine-base:latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-5srx7y8","Type":"NodeParagraph","Properties":{"id":"20230724021022-5srx7y8","updated":"20230724021043"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"同样构建 B 项目的 镜像，运行容器后可以看到"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/root/"},{"Type":"NodeText","Data":"​ 目录下会有 B 项目目录下的所有文件"}]},{"ID":"20230724021022-30j3nvx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-30j3nvx","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker B]# docker build -t alpine-b .\nSending build context to Docker daemon  3.584kB\nStep 1/1 : FROM alpine-base:latest\n# Executing 1 build trigger\n ---\u003e e66b6ee561a9\nSuccessfully built e66b6ee561a9\nSuccessfully tagged alpine-b:latest\n[root@docker B]# docker run --rm alpine-b:latest ls /root/\nDockerfile\nb.txt\nb1.txt\nb2.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-fkcr2px","Type":"NodeParagraph","Properties":{"id":"20230724021022-fkcr2px","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以看出，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ONBUILD"},{"Type":"NodeText","Data":"​ 指令后面内容会在，其他镜像以此镜像为基础镜像构建的时候执行。"}]},{"ID":"20230724021022-uioi4wv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-uioi4wv","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"高级应用场景"}]},{"ID":"20230724021022-ymhtyv3","Type":"NodeParagraph","Properties":{"id":"20230724021022-ymhtyv3","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"python 项目都有自己的依赖包，通常会放在项目根目录下的一个文件，这个文件名叫："},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"requirements.txt"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-5tirhk7","Type":"NodeParagraph","Properties":{"id":"20230724021022-5tirhk7","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"此文件可以通过如下命令得到："}]},{"ID":"20230724021022-7g76580","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-7g76580","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"(django) [root@localhost ~]# pip3 freeze \u003e requirements.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-inq4sgj","Type":"NodeParagraph","Properties":{"id":"20230724021022-inq4sgj","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内容一般为："}]},{"ID":"20230724021022-krw3ogj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-krw3ogj","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"(django) [root@localhost ~]# head -3 requirement.txt\nDjango==1.11\nPyMySQL==0.8.1\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-bs3n4y0","Type":"NodeParagraph","Properties":{"id":"20230724021022-bs3n4y0","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"可以使用如下命令来安装这些项目的依赖模块。"}]},{"ID":"20230724021022-50f5izg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-50f5izg","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"pip3 install -r requirement.txt\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-r96f5gt","Type":"NodeParagraph","Properties":{"id":"20230724021022-r96f5gt","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"现在假设公司有多个 python3 的项目，每个项目都有自己不同的依赖模块。需要为每个项目制定一个 Dockerfile 或者镜像吗？"}]},{"ID":"20230724021022-sxx547r","Type":"NodeParagraph","Properties":{"id":"20230724021022-sxx547r","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"比如有两个项目： CMDB 和 SUPERMAN"}]},{"ID":"20230724021022-p3y0m7b","Type":"NodeParagraph","Properties":{"id":"20230724021022-p3y0m7b","updated":"20230724021036"},"Children":[{"Type":"NodeText","Data":"下面我们使用 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"ONBUILD"},{"Type":"NodeText","Data":"​ 指令来构建一个基础 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"python"},{"Type":"NodeText","Data":"​镜像，"}]},{"ID":"20230724021022-d7k848w","Type":"NodeParagraph","Properties":{"id":"20230724021022-d7k848w","updated":"20230724021031"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"之后两个项目可以不必修改原来的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 就可以部署自己的环境依赖包了。"}]},{"ID":"20230724021022-vupjsz7","Type":"NodeParagraph","Properties":{"id":"20230724021022-vupjsz7","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMDB 的 Dockerfile"}]},{"ID":"20230724021022-6ivvhaz","Type":"NodeParagraph","Properties":{"id":"20230724021022-6ivvhaz","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMDB"}]},{"ID":"20230724021022-p0uiev6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-p0uiev6","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# tree CMDB/\nCMDB/\n├── requirments.txt\n└── run.py\n[root@docker onbulid]# cat CMDB/requirmants.txt\ndjango==1.11\n[root@docker onbulid]# cat CMDB/run.py\nimport django\nprint(django.VERSION)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-h2t08et","Type":"NodeParagraph","Properties":{"id":"20230724021022-h2t08et","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"SUPERMAN"}]},{"ID":"20230724021022-4w59vle","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-4w59vle","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# tree SUPERMAN/\nSUPERMAN/\n├── requirments.txt\n└── run.py\n[root@docker onbulid]# cat SUPERMAN/requirmants.txt\ndjango==1.11\n[root@docker onbulid]# cat SUPERMAN/run.py\nimport django\nprint(django.VERSION)\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-867cg68","Type":"NodeParagraph","Properties":{"id":"20230724021022-867cg68","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用 ONBUILD 指令构建 Python 基础镜像"}]},{"ID":"20230724021022-i8ialrn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-i8ialrn","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@docker onbulid]# cat Dockerfile\nFROM python\nONBUILD COPY . /opt/\nONBUILD RUN pip3 install -r /opt/requirments.txt\nONBUILD CMD [\"python3\", \"/opt/run.py\"]\n[root@docker onbulid]# docker build -t python3-base .\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-ygn7bow","Type":"NodeParagraph","Properties":{"id":"20230724021022-ygn7bow","updated":"20230724021028"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"之后分别在各自的项目目录下创建自己的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230724021022-mdcqgvd","Type":"NodeParagraph","Properties":{"id":"20230724021022-mdcqgvd","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMDB 的 Dockerfile"}]},{"ID":"20230724021022-8a8zwbo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-8a8zwbo","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM python3-base\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-q40eu7g","Type":"NodeParagraph","Properties":{"id":"20230724021022-q40eu7g","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"SUPERMAN 的 Dockerfile"}]},{"ID":"20230724021022-g2d2np0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-g2d2np0","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM python3-base\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-knm6u08","Type":"NodeParagraph","Properties":{"id":"20230724021022-knm6u08","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这样就可以很简单的实现不同的项目只需要创建一个同样内容的镜像，而会得到自己的环境了。"}]},{"ID":"20230724021022-95ckrgh","Type":"NodeParagraph","Properties":{"id":"20230724021022-95ckrgh","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"另外下面的是在 shell 中的执行 python 的命令："}]},{"ID":"20230724021022-pln37cp","Type":"NodeThematicBreak","Properties":{"id":"20230724021022-pln37cp","updated":"20230724021022"}},{"ID":"20230724021022-om6hzcy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-om6hzcy","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM python\nONBUILD COPY ./requirement.txt /\nONBUILD RUN pip install -r /requirement.txt\nONBUILD CMD [\"python\", \"-c\" \"import django;print(django.VERSION)\"]\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-8ifgiaw","Type":"NodeParagraph","Properties":{"id":"20230724021022-8ifgiaw","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"把这个构建成所有项目的基础镜像，名字为： python-onbuild:v1.0"}]},{"ID":"20230724021022-8lm4sqm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-8lm4sqm","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# docker build -t python-onbuild:v1.0 .\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-g29pclb","Type":"NodeParagraph","Properties":{"id":"20230724021022-g29pclb","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"**其他 **"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"python"},{"Type":"NodeText","Data":"​ 项目再使用此镜像为基础镜像时，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Dockerfile"},{"Type":"NodeText","Data":"​ 中只需一行即可："}]},{"ID":"20230724021022-98p87sz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230724021022-98p87sz","updated":"20230724021022"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"FROM python-onbuild:v1.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230724021022-v7bvs08","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230724021022-v7bvs08","updated":"20230724021022"},"Children":[{"Type":"NodeText","Data":"更多参考官方 Docker Demo 和官网"}]},{"ID":"20230724021022-iwtg9ug","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-iwtg9ug","updated":"20230724021022"},"Children":[{"ID":"20230724021022-8dc1hcy","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-8dc1hcy","updated":"20230724021022"},"Children":[{"ID":"20230724021022-o7x7ikh","Type":"NodeParagraph","Properties":{"id":"20230724021022-o7x7ikh","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"doker demo"}]}]}]},{"ID":"20230724021022-hmowr70","Type":"NodeParagraph","Properties":{"id":"20230724021022-hmowr70","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//github.com/docker-library","TextMarkTextContent":"https://github.com/docker-library"}]},{"ID":"20230724021022-qjzo2c7","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724021022-qjzo2c7","updated":"20230724021022"},"Children":[{"ID":"20230724021022-gp7kwth","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230724021022-gp7kwth","updated":"20230724021022"},"Children":[{"ID":"20230724021022-ny79ol3","Type":"NodeParagraph","Properties":{"id":"20230724021022-ny79ol3","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"官网"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//docs.docker.com/engine/reference/builder/","TextMarkTextContent":"https://docs.docker.com/engine/reference/builder/"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://link.zhihu.com/?target=https%3A//docs.docker.com/develop/develop-images/dockerfile_best-practices/","TextMarkTextContent":"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/"}]}]}]},{"ID":"20230724021022-isjo6a0","Type":"NodeParagraph","Properties":{"id":"20230724021022-isjo6a0","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"发布于 2020-03-18 01:20"}]},{"ID":"20230724021022-fn2jdvg","Type":"NodeParagraph","Properties":{"id":"20230724021022-fn2jdvg","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.zhihu.com/topic/19597109","TextMarkTextContent":"命令行控制"}]},{"ID":"20230724021022-tlebmne","Type":"NodeParagraph","Properties":{"id":"20230724021022-tlebmne","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.zhihu.com/topic/20104978","TextMarkTextContent":"Docker Machine"}]},{"ID":"20230724021022-xm9qf8q","Type":"NodeParagraph","Properties":{"id":"20230724021022-xm9qf8q","updated":"20230724021022"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.zhihu.com/topic/19950993","TextMarkTextContent":"Docker"}]}]}