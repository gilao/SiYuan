{"ID":"20230724014743-pdx8gj2","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f384","id":"20230724014743-pdx8gj2","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230724014743-pdx8gj2\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230724014748-ti8nk1u\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230724014748-yis2fks\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230724014748-ti8nk1u\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","title":"8. 使用Dockerfile 创建镜像","updated":"20230724014911"},"Children":[{"ID":"20230724014748-ti8nk1u","Type":"NodeParagraph","Properties":{"id":"20230724014748-ti8nk1u","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dockerfile 是一个文本格式的配置文件，用户可以使用Docekerfile 来快速创建自定义的镜像"}]},{"ID":"20230724014748-yy5k9td","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724014748-yy5k9td","updated":"20230724014748"},"Children":[{"Type":"NodeText","Data":"1. 基本结构"}]},{"ID":"20230724014748-bkw68hn","Type":"NodeParagraph","Properties":{"id":"20230724014748-bkw68hn","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Dockerfile 分为 四部分 ： 基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令"}]},{"ID":"20230724014748-bjo66aj","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230724014748-bjo66aj","updated":"20230724014748"},"Children":[{"Type":"NodeText","Data":"2. 指令说明"}]},{"ID":"20230724014748-cipzk37","Type":"NodeParagraph","Properties":{"id":"20230724014748-cipzk37","updated":"20230724014816"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"1. FROM"}]},{"ID":"20230724014748-1js5e1m","Type":"NodeParagraph","Properties":{"id":"20230724014748-1js5e1m","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"指定所创建镜像的基础镜像，如果本地不存在，则默认会去Docker Hub下载指定镜像。"}]},{"ID":"20230724014748-s3sfk9k","Type":"NodeParagraph","Properties":{"id":"20230724014748-s3sfk9k","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式为FROM"},{"Type":"NodeText","Data":"\u003cimage\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，或FROM"},{"Type":"NodeText","Data":"\u003cimage\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"："},{"Type":"NodeText","Data":"\u003ctag\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"，或FROM"},{"Type":"NodeText","Data":"\u003cimage\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"@"},{"Type":"NodeText","Data":"\u003cdigest\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"。"}]},{"ID":"20230724014748-j00svyl","Type":"NodeParagraph","Properties":{"id":"20230724014748-j00svyl","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"任何Dockerfile中的第一条指令必须为FROM指令。并且，如果在同一个Dockerfile中创建多个镜像，可以使用多个FROM指令（每个镜像一次）。"}]},{"ID":"20230724014826-jij91bx","Type":"NodeParagraph","Properties":{"id":"20230724014826-jij91bx","updated":"20230724014834"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2. MAINTAINR"}]},{"ID":"20230724014748-yrdf4ht","Type":"NodeParagraph","Properties":{"id":"20230724014748-yrdf4ht","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"指定维护者信息，格式为MAINTAINER"},{"Type":"NodeText","Data":"\u003cname\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"。"}]},{"ID":"20230724014840-ggb4bpb","Type":"NodeParagraph","Properties":{"id":"20230724014840-ggb4bpb","updated":"20230724014845"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"3."},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"RUN"}]},{"ID":"20230724014748-xv6ysr3","Type":"NodeParagraph","Properties":{"id":"20230724014748-xv6ysr3","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行指定命令。"}]},{"ID":"20230724014748-6q8urry","Type":"NodeParagraph","Properties":{"id":"20230724014748-6q8urry","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式为RUN"},{"Type":"NodeText","Data":"\u003ccommand\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"或RUN[\u0026quot;executable\u0026quot;，\u0026quot;param1\u0026quot;，\u0026quot;param2\u0026quot;]。注意，后一个指令会被解析为Json数组，因此必须用双引号。"}]},{"ID":"20230724014748-fblljnz","Type":"NodeParagraph","Properties":{"id":"20230724014748-fblljnz","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"前者默认将在shell终端中运行命令，即/bin/sh-c；后者则使用exec执行，不会启动shell环境。"}]},{"ID":"20230724014748-mjftc3t","Type":"NodeParagraph","Properties":{"id":"20230724014748-mjftc3t","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"指定使用其他终端类型可以通过第二种方式实现，例如RUN[\u0026quot;/bin/bash\u0026quot;，\u0026quot;-c\u0026quot;，\u0026quot;echo hello\u0026quot;]。"}]},{"ID":"20230724014748-h5lmry3","Type":"NodeParagraph","Properties":{"id":"20230724014748-h5lmry3","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每条RUN指令将在当前镜像的基础上执行指定命令，并提交为新的镜像。当命令较长时可以使用\\来换行。例如："}]},{"ID":"20230724014748-nf5zjug","Type":"NodeParagraph","Properties":{"id":"20230724014748-nf5zjug","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"RUN apt-get update \\ \u0026amp;\u0026amp; apt-get install -y libsnappy-dev zlib1g-dev libbz2-dev \\ \u0026amp;\u0026amp; rm -rf /var/cache/apt"}]},{"ID":"20230724014748-7f1tezq","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724014748-7f1tezq","updated":"20230724014902"},"Children":[{"ID":"20230724014902-vwgirl6","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20230724014902-vwgirl6","updated":"20230724014902"},"Children":[{"ID":"20230724014902-96zrse1","Type":"NodeParagraph","Properties":{"id":"20230724014902-96zrse1","updated":"20230724014902"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD"}]}]}]},{"ID":"20230724014748-5tuuad5","Type":"NodeParagraph","Properties":{"id":"20230724014748-5tuuad5","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CMD指令用来指定启动容器时默认执行的命令。它支持三种格式："}]},{"ID":"20230724014748-8t4c9a3","Type":"NodeParagraph","Properties":{"id":"20230724014748-8t4c9a3","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"·CMD[\u0026quot;executable\u0026quot;，\u0026quot;param1\u0026quot;，\u0026quot;param2\u0026quot;]使用exec执行，是推荐使用的方式；"}]},{"ID":"20230724014748-hn2r5kt","Type":"NodeParagraph","Properties":{"id":"20230724014748-hn2r5kt","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"·CMD command param1 param2在/bin/sh中执行，提供给需要交互的应用；"}]},{"ID":"20230724014748-7sg8xyq","Type":"NodeParagraph","Properties":{"id":"20230724014748-7sg8xyq","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"·CMD[\u0026quot;param1\u0026quot;，\u0026quot;param2\u0026quot;]提供给ENTRYPOINT的默认参数。"}]},{"ID":"20230724014748-mj2gc6z","Type":"NodeParagraph","Properties":{"id":"20230724014748-mj2gc6z","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"每个Dockerfile只能有一条CMD命令。如果指定了多条命令，只有最后一条会被执行。"}]},{"ID":"20230724014748-r0oz81n","Type":"NodeParagraph","Properties":{"id":"20230724014748-r0oz81n","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"如果用户启动容器时手动指定了运行的命令（作为run的参数），则会覆盖掉CMD指定的命令。"}]},{"ID":"20230724014748-rtecr9t","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724014748-rtecr9t","updated":"20230724014752"},"Children":[{"ID":"20230724014748-96zikvt","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20230724014748-96zikvt","updated":"20230724014752"},"Children":[{"ID":"20230724014748-mu81ayo","Type":"NodeParagraph","Properties":{"id":"20230724014748-mu81ayo","updated":"20230724014752"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"LABEL"}]}]}]},{"ID":"20230724014748-sui5rjs","Type":"NodeParagraph","Properties":{"id":"20230724014748-sui5rjs","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"LABEL 指令是用来指定生成镜像的元数据标签信息"}]},{"ID":"20230724014748-gpq2g6l","Type":"NodeParagraph","Properties":{"id":"20230724014748-gpq2g6l","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式为LABEL"},{"Type":"NodeText","Data":"\u003ckey\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"="},{"Type":"NodeText","Data":"\u003cvalue\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"\u0026lt;key\u0026gt;"},{"Type":"NodeText","Data":"="},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"\u0026lt;value\u0026gt;"},{"Type":"NodeText","Data":"\u003ckey\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"="},{"Type":"NodeText","Data":"\u003cvalue\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"..."}]},{"ID":"20230724014748-y9e1dkb","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230724014748-y9e1dkb","updated":"20230724014748"},"Children":[{"ID":"20230724014748-ko13gg3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20230724014748-ko13gg3","updated":"20230724014748"},"Children":[{"ID":"20230724014748-9girs5t","Type":"NodeParagraph","Properties":{"id":"20230724014748-9girs5t","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"EXPOSE"}]}]}]},{"ID":"20230724014748-rh26wmr","Type":"NodeParagraph","Properties":{"id":"20230724014748-rh26wmr","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"声明镜像内服务所监听的端口。"}]},{"ID":"20230724014748-sipshdx","Type":"NodeParagraph","Properties":{"id":"20230724014748-sipshdx","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"格式为EXPOSE"},{"Type":"NodeText","Data":"\u003cport\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"["},{"Type":"NodeText","Data":"\u003cport\u003e"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"...]。"}]},{"ID":"20230724014748-39svx9f","Type":"NodeParagraph","Properties":{"id":"20230724014748-39svx9f","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"例如："}]},{"ID":"20230724014748-qwho1hz","Type":"NodeParagraph","Properties":{"id":"20230724014748-qwho1hz","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"EXPOSE 22 80 8443"}]},{"ID":"20230724014748-yg5aqso","Type":"NodeParagraph","Properties":{"id":"20230724014748-yg5aqso","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意，该指令只是起到声明作用，并不会自动完成端口映射。"}]},{"ID":"20230724014748-yis2fks","Type":"NodeParagraph","Properties":{"id":"20230724014748-yis2fks","updated":"20230724014748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"在启动容器时需要使用-P，Docker主机会自动分配一个宿主机的临时端口转发到指定的端口；使用-p，则可以具体指定哪个宿主机的本地端口会映射过来。"}]}]}