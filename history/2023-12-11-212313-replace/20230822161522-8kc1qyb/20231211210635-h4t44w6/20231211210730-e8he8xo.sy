{"ID":"20231211210730-e8he8xo","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f6d5","id":"20231211210730-e8he8xo","tags":"公众号-凉凉的知识库,gRPC","title":"01-protobuf基础","updated":"20231211212243"},"Children":[{"ID":"20231211210730-bceykua","Type":"NodeParagraph","Properties":{"id":"20231211210730-bceykua","updated":"20231211210829"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gRPC"},{"Type":"NodeText","Data":"​是谷歌开源的一款"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"高性能"},{"Type":"NodeText","Data":"、支持多种开发语言的服务框架，对于一个rpc我们关注如下几方面："}]},{"ID":"20231211210836-jlfv4u8","Type":"NodeParagraph","Properties":{"id":"20231211210836-jlfv4u8","updated":"20231211210836"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"序列化协议"},{"Type":"NodeText","Data":"。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gRPC"},{"Type":"NodeText","Data":"​使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​，首先使用protobuf定义服务，然后使用这个文件来生成客户端和服务端的代码。因为pb是跨语言的，因此即使服务端和客户端语言并不一致也是可以互相序列化和反序列化的"}]},{"ID":"20231211210836-iervq70","Type":"NodeParagraph","Properties":{"id":"20231211210836-iervq70","updated":"20231211210836"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"网络传输层"},{"Type":"NodeText","Data":"。gRPC使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"http2.0"},{"Type":"NodeText","Data":"​协议，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"http2.0"},{"Type":"NodeText","Data":"​相比于"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"HTTP 1.x"},{"Type":"NodeText","Data":"​ ，大幅度的提升了 web 性能。"}]},{"ID":"20231211210845-ficn6zd","Type":"NodeParagraph","Properties":{"id":"20231211210845-ficn6zd","updated":"20231211210845"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"849515ad57df8eae86e60fb19708053c"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/849515ad57df8eae86e60fb19708053c-20231211210845-rdmzhv0.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211210852-3a8mnar","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231211210852-3a8mnar","updated":"20231211210859"},"Children":[{"Type":"NodeText","Data":"Protobuf IDL"}]},{"ID":"20231211210907-7gxlhzk","Type":"NodeParagraph","Properties":{"id":"20231211210907-7gxlhzk","updated":"20231211210907"},"Children":[{"Type":"NodeText","Data":"所谓序列化通俗来说就是把内存的一段数据转化成二进制并存储或者通过网络传输，而读取磁盘或另一端收到后可以在内存中重建这段数据"}]},{"ID":"20231211210907-apxlsus","Type":"NodeParagraph","Properties":{"id":"20231211210907-apxlsus","updated":"20231211210907"},"Children":[{"Type":"NodeText","Data":"1、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​协议是跨语言跨平台的序列化协议。"}]},{"ID":"20231211210907-sdu183t","Type":"NodeParagraph","Properties":{"id":"20231211210907-sdu183t","updated":"20231211210907"},"Children":[{"Type":"NodeText","Data":"2、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​本身并不是和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"gRPC"},{"Type":"NodeText","Data":"​绑定的。它也可以被用于非RPC场景，如存储等"}]},{"ID":"20231211210907-h1mwcmw","Type":"NodeParagraph","Properties":{"id":"20231211210907-h1mwcmw","updated":"20231211210907"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"json"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt; xml"},{"Type":"NodeText","Data":"​都是一种序列化的方式，只是他们不需要提前预定义idl，且具备可读性，当然他们传输的体积也因此较大，可以说是各有优劣"}]},{"ID":"20231211210907-k8ru7nq","Type":"NodeParagraph","Properties":{"id":"20231211210907-k8ru7nq","updated":"20231211210907"},"Children":[{"Type":"NodeText","Data":"所以先来介绍下"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​的idl怎么写。"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​最新版本为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"proto3"},{"Type":"NodeText","Data":"​，在这里你可以看到详细的文档说明：https://protobuf.dev/programming-guides/proto3/"}]},{"ID":"20231211211345-wj5cgm9","Type":"NodeParagraph","Properties":{"id":"20231211211345-wj5cgm9"}},{"ID":"20231211211346-f3lq4bt","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211211346-f3lq4bt","updated":"20231211211354"},"Children":[{"Type":"NodeText","Data":"定义消息类型"}]},{"ID":"20231211211354-t4nuqil","Type":"NodeParagraph","Properties":{"id":"20231211211354-t4nuqil","updated":"20231211211400"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​里最基本的类型就是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"message"},{"Type":"NodeText","Data":"​，每一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"message"},{"Type":"NodeText","Data":"​都会有一个或者多个字段("},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"field"},{"Type":"NodeText","Data":"​)，其中字段包含如下元素"}]},{"ID":"20231211211408-807azs5","Type":"NodeParagraph","Properties":{"id":"20231211211408-807azs5","updated":"20231211211408"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"69dc349d9655d4a407479d2da0f22428"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/69dc349d9655d4a407479d2da0f22428-20231211211408-bj9im8d.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211211430-trmbq1b","Type":"NodeList","ListData":{},"Properties":{"id":"20231211211430-trmbq1b","updated":"20231211211430"},"Children":[{"ID":"20231211211430-xeayej1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-xeayej1","updated":"20231211211430"},"Children":[{"ID":"20231211211430-5p2njfi","Type":"NodeParagraph","Properties":{"id":"20231211211430-5p2njfi","updated":"20231211211430"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"类型"},{"Type":"NodeText","Data":"：类型不仅可以是标量类型（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"int"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"string"},{"Type":"NodeText","Data":"​等），也可以是复合类型（"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"enum"},{"Type":"NodeText","Data":"​等），也可以是其他"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"message"},{"Type":"NodeText","Data":"​"}]}]},{"ID":"20231211211430-sgwku1q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-sgwku1q","updated":"20231211211430"},"Children":[{"ID":"20231211211430-3u97xce","Type":"NodeParagraph","Properties":{"id":"20231211211430-3u97xce","updated":"20231211211430"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"字段名"},{"Type":"NodeText","Data":"：字段名比较推荐的是使用下划线/分隔名称"}]}]},{"ID":"20231211211430-zhf3i1p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-zhf3i1p","updated":"20231211211430"},"Children":[{"ID":"20231211211430-nfkook7","Type":"NodeParagraph","Properties":{"id":"20231211211430-nfkook7","updated":"20231211211430"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"字段编号"},{"Type":"NodeText","Data":"：一个message内每一个字段编号都必须唯一的，在编码后其实传递的是这个编号而不是字段名"}]}]},{"ID":"20231211211430-qusvxru","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-qusvxru","updated":"20231211211430"},"Children":[{"ID":"20231211211430-vrt25y8","Type":"NodeParagraph","Properties":{"id":"20231211211430-vrt25y8","updated":"20231211211430"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"字段规则"},{"Type":"NodeText","Data":"：消息字段可以是以下字段之一"}]},{"ID":"20231211211430-l38u3qf","Type":"NodeList","ListData":{},"Properties":{"id":"20231211211430-l38u3qf","updated":"20231211211430"},"Children":[{"ID":"20231211211430-h69kgrd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-h69kgrd","updated":"20231211211430"},"Children":[{"ID":"20231211211430-u850axs","Type":"NodeParagraph","Properties":{"id":"20231211211430-u850axs","updated":"20231211211430"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"singular"},{"Type":"NodeText","Data":"​：格式正确的消息可以有零个或一个字段（但不能超过一个）。使用 proto3 语法时，如果未为给定字段指定其他字段规则，则这是默认字段规则"}]}]},{"ID":"20231211211430-9az3c9q","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-9az3c9q","updated":"20231211211430"},"Children":[{"ID":"20231211211430-f97pt0w","Type":"NodeParagraph","Properties":{"id":"20231211211430-f97pt0w","updated":"20231211211430"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"optional"},{"Type":"NodeText","Data":"​：与 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"singular"},{"Type":"NodeText","Data":"​ 相同，不过您可以检查该值是否明确设置"}]}]},{"ID":"20231211211430-5kuy4bp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-5kuy4bp","updated":"20231211211430"},"Children":[{"ID":"20231211211430-eo8b1xz","Type":"NodeParagraph","Properties":{"id":"20231211211430-eo8b1xz","updated":"20231211211430"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"repeated"},{"Type":"NodeText","Data":"​：在格式正确的消息中，此字段类型可以重复零次或多次。系统会保留重复值的顺序"}]}]},{"ID":"20231211211430-fu1x3kw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-fu1x3kw","updated":"20231211211430"},"Children":[{"ID":"20231211211430-4lvumpv","Type":"NodeParagraph","Properties":{"id":"20231211211430-4lvumpv","updated":"20231211211430"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"map"},{"Type":"NodeText","Data":"​：这是一个成对的键值对字段"}]}]}]}]},{"ID":"20231211211430-f18sjda","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211211430-f18sjda","updated":"20231211211430"},"Children":[{"ID":"20231211211430-26opn7v","Type":"NodeParagraph","Properties":{"id":"20231211211430-26opn7v","updated":"20231211211430"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"保留字段"},{"Type":"NodeText","Data":"：为了避免再次使用到已移除的字段可以设定保留字段。如果任何未来用户尝试使用这些字段标识符，协议缓冲区编译器就会报错"}]}]}]},{"ID":"20231211211523-egfldw5","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211211523-egfldw5","updated":"20231211211531"},"Children":[{"Type":"NodeText","Data":"标量值类"}]},{"ID":"20231211211531-22yyqxk","Type":"NodeParagraph","Properties":{"id":"20231211211531-22yyqxk","updated":"20231211211616"},"Children":[{"Type":"NodeText","Data":"标量类型会涉及到不同语言和编码方式，后续有机会深入讲"}]},{"ID":"20231211211624-i8rrr26","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20231211211624-i8rrr26","updated":"20231211211624"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","TableCellContentWidth":13,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":".proto Type"}]},{"Type":"NodeTableCell","Data":"th","TableCellContentWidth":9,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"Go Type"}]},{"Type":"NodeTableCell","Data":"th","TableCellContentWidth":7,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"Notes"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"double"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":9,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"float64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":4,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"float"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":9,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"float32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":4,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"int32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":86,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。对负数的编码效率低下 - 如果您的字段可能包含负值，请改用 sint32。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"int64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":80,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。对负数的编码效率低下 - 如果字段可能有负值，请改用 sint64。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"uint32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"uint32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":22,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"uint64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"uint64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":22,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"sint32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":91,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。有符号整数值。与常规 int32 相比，这些函数可以更高效地对负数进行编码。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"sint64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":91,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"使用可变长度的编码。有符号整数值。与常规 int64 相比，这些函数可以更高效地对负数进行编码。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":9,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"fixed32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"uint32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":60,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"始终为 4 个字节。如果值通常大于 2^28，则比 uint32 更高效。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":9,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"fixed64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"uint64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":60,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"始终为 8 个字节。如果值通常大于 2^56，则比 uint64 更高效。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":10,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"sfixed32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int32"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":19,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"始终为 4 个字节。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":10,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"sfixed64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"int64"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":19,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"始终为 8 个字节。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":6,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"bool"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":6,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"bool"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":4,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeBr","Data":"br"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"string"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"string"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":73,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"字符串必须始终包含 UTF-8 编码或 7 位 ASCII 文本，并且长度不得超过 232。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":7,"TableCellContentMaxWidth":13,"Children":[{"Type":"NodeText","Data":"bytes"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":8,"TableCellContentMaxWidth":9,"Children":[{"Type":"NodeText","Data":"[]byte"}]},{"Type":"NodeTableCell","Data":"td","TableCellContentWidth":32,"TableCellContentMaxWidth":91,"Children":[{"Type":"NodeText","Data":"可以包含任意长度的 2^32 字节。"}]}]}]},{"ID":"20231211211713-7fe2c8m","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211211713-7fe2c8m","updated":"20231211211713"},"Children":[{"Type":"NodeText","Data":"复合类型"}]},{"ID":"20231211211713-f7qk51b","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211211713-f7qk51b","updated":"20231211211713"},"Children":[{"Type":"NodeText","Data":"数组"}]},{"ID":"20231211211713-dp78aiy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211211713-dp78aiy","updated":"20231211211713"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"message SearchResponse {\n  repeated Result results = 1;\n}\n\nmessage Result {\n  string url = 1;\n  string title = 2;\n  repeated string snippets = 3;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211211713-fzs34cw","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211211713-fzs34cw","updated":"20231211211713"},"Children":[{"Type":"NodeText","Data":"枚举"}]},{"ID":"20231211211713-b89cwo4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211211713-b89cwo4","updated":"20231211211713"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"message SearchRequest {\n  string query = 1;\n  int32 page_number = 2;\n  int32 result_per_page = 3;\n  enum Corpus {\n    UNIVERSAL = 0;\n    WEB = 1;\n    IMAGES = 2;\n    LOCAL = 3;\n    NEWS = 4;\n    PRODUCTS = 5;\n    VIDEO = 6;\n  }\n  Corpus corpus = 4;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211211713-lg9rfdf","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211211713-lg9rfdf","updated":"20231211211713"},"Children":[{"Type":"NodeText","Data":"服务"}]},{"ID":"20231211211724-kotm369","Type":"NodeParagraph","Properties":{"id":"20231211211724-kotm369","updated":"20231211211729"},"Children":[{"Type":"NodeText","Data":"定义的method仅能有一个入参和出参数。如果需要传递多个参数需要定义成message"}]},{"ID":"20231211211732-34j1k9o","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211211732-34j1k9o","updated":"20231211211816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"service SearchService {\n  rpc Search(SearchRequest) returns (SearchResponse)\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211211818-0ss1t6t","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231211211818-0ss1t6t","updated":"20231211211831"},"Children":[{"Type":"NodeText","Data":"使用其他消息类型"}]},{"ID":"20231211211839-nzpmx5e","Type":"NodeParagraph","Properties":{"id":"20231211211839-nzpmx5e","updated":"20231211211844"},"Children":[{"Type":"NodeText","Data":"使用import引用另外一个文件的pb"}]},{"ID":"20231211211845-qxeirmf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211211845-qxeirmf","updated":"20231211211850"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Z28="},{"Type":"NodeCodeBlockCode","Data":"syntax = \"proto3\";\n\nimport \"google/protobuf/wrappers.proto\";\n\npackage ecommerce;\n\nmessage Order {\n  string id = 1;\n  repeated string items = 2;\n  string description = 3;\n  float price = 4;\n  google.protobuf.StringValue destination = 5;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211211919-s1w2jhu","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231211211919-s1w2jhu","updated":"20231211211935"},"Children":[{"Type":"NodeText","Data":"Protoc 使用"}]},{"ID":"20231211211935-sb5hkli","Type":"NodeParagraph","Properties":{"id":"20231211211935-sb5hkli","updated":"20231211212011"},"Children":[{"Type":"NodeText","Data":"protoc 就是 protobuf 的编译器，它把proto文件编译成不同的语言"}]},{"ID":"20231211212048-dzqdq31","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-dzqdq31","updated":"20231211212103"},"Children":[{"Type":"NodeText","Data":"📖 安装"}]},{"ID":"20231211212048-ickxn1v","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-ickxn1v","updated":"20231211212048"},"Children":[{"ID":"20231211212048-rskvmjv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-rskvmjv","updated":"20231211212048"},"Children":[{"ID":"20231211212048-j6powa6","Type":"NodeParagraph","Properties":{"id":"20231211212048-j6powa6","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"Linux, using "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"apt"},{"Type":"NodeText","Data":"​ or "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"apt-get"},{"Type":"NodeText","Data":"​, for example:"}]}]}]},{"ID":"20231211212048-htws08r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-htws08r","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ apt install -y protobuf-compiler\n$ protoc --version  # Ensure compiler version is 3+\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-fap4qac","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-fap4qac","updated":"20231211212048"},"Children":[{"ID":"20231211212048-zhpnwga","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-zhpnwga","updated":"20231211212048"},"Children":[{"ID":"20231211212048-8jtaxj1","Type":"NodeParagraph","Properties":{"id":"20231211212048-8jtaxj1","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"MacOS, using Homebrew[1]:"}]}]}]},{"ID":"20231211212048-r497vgu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-r497vgu","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ brew install protobuf\n$ protoc --version  # Ensure compiler version is 3+\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-9whhf87","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-9whhf87","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"📖 使用"}]},{"ID":"20231211212048-vemqaw1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-vemqaw1","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ protoc --help\nUsage: protoc [OPTION] PROTO_FILES\n\n  -IPATH, --proto_path=PATH   指定搜索路径\n  --plugin=EXECUTABLE:\n  \n  ....\n \n  --cpp_out=OUT_DIR           Generate C++ header and source.\n  --csharp_out=OUT_DIR        Generate C# source file.\n  --java_out=OUT_DIR          Generate Java source file.\n  --js_out=OUT_DIR            Generate JavaScript source.\n  --objc_out=OUT_DIR          Generate Objective C header and source.\n  --php_out=OUT_DIR           Generate PHP source file.\n  --python_out=OUT_DIR        Generate Python source file.\n  --ruby_out=OUT_DIR          Generate Ruby source file\n  \n   @\u003cfilename\u003e                proto文件的具体位置\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-uk6zail","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-uk6zail","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"1.搜索路径参数"}]},{"ID":"20231211212048-86dxd61","Type":"NodeParagraph","Properties":{"id":"20231211212048-86dxd61","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"第一个比较重要的参数就是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"搜索路径参数"},{"Type":"NodeText","Data":"​，即上述展示的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-IPATH, --proto_path=PATH"},{"Type":"NodeText","Data":"​。它表示的是我们要在哪个路径下搜索"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".proto"},{"Type":"NodeText","Data":"​文件，这个参数既可以用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"-I"},{"Type":"NodeText","Data":"​指定，也可以使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--proto_path="},{"Type":"NodeText","Data":"​指定。"}]},{"ID":"20231211212048-7jd9pse","Type":"NodeParagraph","Properties":{"id":"20231211212048-7jd9pse","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"如果不指定该参数，则默认在"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"当前路径"},{"Type":"NodeText","Data":"下进行搜索；另外，该参数也可以指定多次，这也意味着我们可以指定"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多个路径"},{"Type":"NodeText","Data":"进行搜索。"}]},{"ID":"20231211212048-tdm6co4","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-tdm6co4","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"2.语言插件参数"}]},{"ID":"20231211212048-tb598fd","Type":"NodeParagraph","Properties":{"id":"20231211212048-tb598fd","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"语言参数即上述的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--cpp_out="},{"Type":"NodeText","Data":"​，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--python_out="},{"Type":"NodeText","Data":"​等，protoc支持的语言长达13种，且都是比较常见的"}]},{"ID":"20231211212048-rjwsja0","Type":"NodeParagraph","Properties":{"id":"20231211212048-rjwsja0","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"运行help出现的语言参数，说明protoc本身已经内置该语言对应的编译插件，我们无需安装"}]},{"ID":"20231211212048-2ar4s2g","Type":"NodeTable","TableAligns":[2],"Properties":{"colgroup":"","id":"20231211212048-2ar4s2g","updated":"20231211212048"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","TableCellAlign":2,"TableCellContentWidth":10,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"Language"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":38,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"C++ (include C++ runtime and protoc)"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":6,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"Java"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":8,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"Python"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":13,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"Objective-C"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":4,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"C#"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":6,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"Ruby"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","TableCellAlign":2,"TableCellContentWidth":5,"TableCellContentMaxWidth":38,"Children":[{"Type":"NodeText","Data":"PHP"}]}]}]},{"ID":"20231211212048-d8uad5f","Type":"NodeParagraph","Properties":{"id":"20231211212048-d8uad5f","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"下面的语言是由google维护，通过protoc的插件机制来实现，所以仓库单独维护"}]},{"ID":"20231211212048-61lg6vc","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-61lg6vc","updated":"20231211212048"},"Children":[{"ID":"20231211212048-9sby9ra","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-9sby9ra","updated":"20231211212048"},"Children":[{"ID":"20231211212048-cx8inct","Type":"NodeParagraph","Properties":{"id":"20231211212048-cx8inct","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"Dart"}]}]},{"ID":"20231211212048-282zqy3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-282zqy3","updated":"20231211212048"},"Children":[{"ID":"20231211212048-hi406hn","Type":"NodeParagraph","Properties":{"id":"20231211212048-hi406hn","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"Go"}]}]}]},{"ID":"20231211212048-kbrz21t","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-kbrz21t","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"3.proto文件位置参数"}]},{"ID":"20231211212048-hew52ff","Type":"NodeParagraph","Properties":{"id":"20231211212048-hew52ff","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"proto文件位置参数即上述的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"@\u0026lt;filename\u0026gt;"},{"Type":"NodeText","Data":"​参数，指定了我们proto文件的具体位置，如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"proto1/greeter/greeter.proto"},{"Type":"NodeText","Data":"​。"}]},{"ID":"20231211212048-6ynda8z","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-6ynda8z","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"📖 语言插件"}]},{"ID":"20231211212048-u9v3igv","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-u9v3igv","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"✨ golang插件"}]},{"ID":"20231211212048-n6pcwh2","Type":"NodeParagraph","Properties":{"id":"20231211212048-n6pcwh2","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"非内置的语言支持就得自己单独安装语言插件，比如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--go_out="},{"Type":"NodeText","Data":"​对应的是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​，安装命令如下："}]},{"ID":"20231211212048-j8p2wq8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-j8p2wq8","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# 最新版\n$ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest\n\n# 指定版本\n$ go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.3.0\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-wmlsmuo","Type":"NodeParagraph","Properties":{"id":"20231211212048-wmlsmuo","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"可以使用下面的命令来生成代码"}]},{"ID":"20231211212048-hqy07pb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-hqy07pb","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ protoc --proto_path=src --go_out=out --go_opt=paths=source_relative foo.proto bar/baz.proto\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-2n7w6gl","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-2n7w6gl","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"注意"}]},{"ID":"20231211212048-cwmc08u","Type":"NodeParagraph","Properties":{"id":"20231211212048-cwmc08u","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​要求pb文件必须指定go包的路径，即"}]},{"ID":"20231211212048-g4f053h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-g4f053h","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"option go_package = \"liangwt/note/grpc/example/ecommerce\";\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-vn7gm96","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-vn7gm96","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"--go_out"}]},{"ID":"20231211212048-wj8tchv","Type":"NodeParagraph","Properties":{"id":"20231211212048-wj8tchv","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"指定go代码生成的基本路径"}]},{"ID":"20231211212048-gkgqvqv","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-gkgqvqv","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"--go_opt：设定插件参数"}]},{"ID":"20231211212048-2ubxpfx","Type":"NodeParagraph","Properties":{"id":"20231211212048-2ubxpfx","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​提供了 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--go_opt"},{"Type":"NodeText","Data":"​ 来为其指定参数，并可以设置多个"}]},{"ID":"20231211212048-sqrxdb3","Type":"NodeParagraph","Properties":{"id":"20231211212048-sqrxdb3","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"1、如果使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"paths=import"},{"Type":"NodeText","Data":"​ , 生成的文件会按"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"go_package"},{"Type":"NodeText","Data":"​路径来生成，当然是在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--go_out"},{"Type":"NodeText","Data":"​目录下，即"}]},{"ID":"20231211212048-fvj0q75","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-fvj0q75","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$go_out/$go_package/pb_filename.pb.go\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-dbb7yx2","Type":"NodeParagraph","Properties":{"id":"20231211212048-dbb7yx2","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"2、如果使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"paths=source_relative"},{"Type":"NodeText","Data":"​ ， 就在当前pb文件同路径下生成代码。注意pb的目录也被包含进去了。即"}]},{"ID":"20231211212048-bbymzcb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-bbymzcb","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$go_out/$pb_filedir/$pb_filename.pb.go\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-k249ibo","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-k249ibo","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"✨ grpc go插件"}]},{"ID":"20231211212048-nfb8t4u","Type":"NodeParagraph","Properties":{"id":"20231211212048-nfb8t4u","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"google.golang.org/protobuf"},{"Type":"NodeText","Data":"​中，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​纯粹用来生成pb序列化相关的文件，不再承载gRPC代码生成功能。"}]},{"ID":"20231211212048-jimws2d","Type":"NodeParagraph","Properties":{"id":"20231211212048-jimws2d","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"生成gRPC相关代码需要安装grpc-go相关的插件"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go-grpc"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-v8fwt3c","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-v8fwt3c","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":" $ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-2xft3sb","Type":"NodeParagraph","Properties":{"id":"20231211212048-2xft3sb","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"执行code gen命令"}]},{"ID":"20231211212048-jexzz51","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-jexzz51","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ protoc --go_out=. --go_opt=paths=source_relative \\\n    --go-grpc_out=. --go-grpc_opt=paths=source_relative \\\n    routeguide/route_guide.proto\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-5tdku86","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-5tdku86","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"--go-grpc_out"}]},{"ID":"20231211212048-eko0msk","Type":"NodeParagraph","Properties":{"id":"20231211212048-eko0msk","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"指定grpc go代码生成的基本路径"}]},{"ID":"20231211212048-d7pj9n0","Type":"NodeParagraph","Properties":{"id":"20231211212048-d7pj9n0","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"命令会产生如下文件"}]},{"ID":"20231211212048-q1whe34","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-q1whe34","updated":"20231211212048"},"Children":[{"ID":"20231211212048-nehobe9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-nehobe9","updated":"20231211212048"},"Children":[{"ID":"20231211212048-p7p5tcw","Type":"NodeParagraph","Properties":{"id":"20231211212048-p7p5tcw","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"route_guide.pb.go"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​的产出物，包含所有类型的序列化和反序列化代码"}]}]},{"ID":"20231211212048-g0a2pzt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-g0a2pzt","updated":"20231211212048"},"Children":[{"ID":"20231211212048-q52nse3","Type":"NodeParagraph","Properties":{"id":"20231211212048-q52nse3","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"route_guide_grpc.pb.go"},{"Type":"NodeText","Data":"​, "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go-grpc"},{"Type":"NodeText","Data":"​的产出物，包含"}]},{"ID":"20231211212048-gc77qjt","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-gc77qjt","updated":"20231211212048"},"Children":[{"ID":"20231211212048-8d2e9g6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-8d2e9g6","updated":"20231211212048"},"Children":[{"ID":"20231211212048-7iypfuv","Type":"NodeParagraph","Properties":{"id":"20231211212048-7iypfuv","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"定义在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RouteGuide"},{"Type":"NodeText","Data":"​ service中的用来给client调用的接口定义"}]}]},{"ID":"20231211212048-evn47o2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-evn47o2","updated":"20231211212048"},"Children":[{"ID":"20231211212048-c4i1rwx","Type":"NodeParagraph","Properties":{"id":"20231211212048-c4i1rwx","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"定义在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"RouteGuide"},{"Type":"NodeText","Data":"​ service中的用来给服务端实现的接口定义"}]}]}]}]}]},{"ID":"20231211212048-d15i45n","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-d15i45n","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"--go-grpc_opt"}]},{"ID":"20231211212048-am9se41","Type":"NodeParagraph","Properties":{"id":"20231211212048-am9se41","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go"},{"Type":"NodeText","Data":"​类似，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc-gen-go-grpc"},{"Type":"NodeText","Data":"​提供 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"--go-grpc_opt"},{"Type":"NodeText","Data":"​ 来指定参数，并可以设置多个"}]},{"ID":"20231211212048-tx0ml9j","Type":"NodeThematicBreak","Properties":{"id":"20231211212048-tx0ml9j","updated":"20231211212048"}},{"ID":"20231211212048-j5o2qnc","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20231211212048-j5o2qnc","updated":"20231211212243"},"Children":[{"Type":"NodeText","Data":"✨"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"github.com/golang/protobuf"},{"Type":"NodeText","Data":"​ vs "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"google.golang.org/protobuf"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-gyfkm3l","Type":"NodeParagraph","Properties":{"id":"20231211212048-gyfkm3l","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;github.com/golang/protobuf"},{"Type":"NodeText","Data":"​虽然已经废弃，但网上搜索时经常还能搜到，方便理解整理两者区别。"}]},{"ID":"20231211212048-z9e5d8w","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-z9e5d8w","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"代码差异"}]},{"ID":"20231211212048-zcgod2z","Type":"NodeParagraph","Properties":{"id":"20231211212048-zcgod2z","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"这两个库，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;google.golang.org/protobuf"},{"Type":"NodeText","Data":"​是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;github.com/golang/protobuf"},{"Type":"NodeText","Data":"​的升级版本，"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;v1.4.0"},{"Type":"NodeText","Data":"​之后"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;github.com/golang/protobuf"},{"Type":"NodeText","Data":"​仅是"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;google.golang.org/protobuf"},{"Type":"NodeText","Data":"​的包装"}]},{"ID":"20231211212048-0vkgk0y","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-0vkgk0y","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"功能差异"}]},{"ID":"20231211212048-0goh9t5","Type":"NodeParagraph","Properties":{"id":"20231211212048-0goh9t5","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;google.golang.org/protobuf"},{"Type":"NodeText","Data":"​，纯粹用来生成pb序列化相关的文件，不再承载gRPC代码生成功能。生成gRPC相关代码需要安装grpc-go相关的插件"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;protoc-gen-go-grpc"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-apmnzrd","Type":"NodeParagraph","Properties":{"id":"20231211212048-apmnzrd","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;github.com/golang/protobuf\u0026lt;span\u0026gt; "},{"Type":"NodeText","Data":"​，可以同时生成pb和gRPC相关代码的"}]},{"ID":"20231211212048-bjmconc","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20231211212048-bjmconc","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"用法差异"}]},{"ID":"20231211212048-9o56wyl","Type":"NodeParagraph","Properties":{"id":"20231211212048-9o56wyl","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;google.golang.org/protobuf"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-l1mttft","Type":"NodeHTMLBlock","Data":"\u003cpre data-tool=\"mdnice编辑器\"\u003e\u003cp\u003e\u003cspan\u003e\u003cspan\u003e$ protoc --go_out=. --go_opt=paths=source_relative \\\u003c/span\u003e\u003cbr/\u003e    --go-grpc_out=. --go-grpc_opt=paths=source_relative \\\u003cbr/\u003e    routeguide/route_guide.proto\u003c/span\u003e\u003cbr/\u003e\u003c/p\u003e\u003c/pre\u003e","Properties":{"id":"20231211212048-l1mttft","updated":"20231211212048"}},{"ID":"20231211212048-4aju0j6","Type":"NodeParagraph","Properties":{"id":"20231211212048-4aju0j6","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;github.com/golang/protobuf"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-5td0n6s","Type":"NodeHTMLBlock","Data":"\u003cpre data-tool=\"mdnice编辑器\"\u003e\u003cp\u003e\u003cspan\u003e\u003cspan\u003e$ protoc --go_out=plugins=grpc,paths=import:. \\\u003c/span\u003e\u003cbr/\u003e    routeguide/route_guide.proto\u003c/span\u003e\u003cbr/\u003e\u003c/p\u003e\u003c/pre\u003e","Properties":{"id":"20231211212048-5td0n6s","updated":"20231211212048"}},{"ID":"20231211212048-6qsqqtp","Type":"NodeParagraph","Properties":{"id":"20231211212048-6qsqqtp","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;--go_out"},{"Type":"NodeText","Data":"​的写法是，参数之间用逗号隔开，最后加上冒号来指定代码的生成位置，比如"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;--go_out=plugins=grpc,paths=import:."},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-a19mn85","Type":"NodeParagraph","Properties":{"id":"20231211212048-a19mn85","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;--go_out"},{"Type":"NodeText","Data":"​主要的两个参数为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;plugins"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;paths"},{"Type":"NodeText","Data":"​，分别表示生成Go代码所使用的插件，以及生成的Go代码的位置。"}]},{"ID":"20231211212048-x8oacqa","Type":"NodeParagraph","Properties":{"id":"20231211212048-x8oacqa","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;plugins"},{"Type":"NodeText","Data":"​参数有不带grpc和带grpc两种（应该还有其它的，目前知道的有这两种），两者的区别如下，带grpc的会多一些跟gRPC相关的代码，实现gRPC通信"}]},{"ID":"20231211212048-89wv5oe","Type":"NodeParagraph","Properties":{"id":"20231211212048-89wv5oe","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"paths参数有两个选项，分别是 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;import"},{"Type":"NodeText","Data":"​ 和 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;source_relative"},{"Type":"NodeText","Data":"​，默认为 import"}]},{"ID":"20231211212048-ayq31zy","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-ayq31zy","updated":"20231211212048"},"Children":[{"ID":"20231211212048-gvriuya","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-gvriuya","updated":"20231211212048"},"Children":[{"ID":"20231211212048-5l5s5p8","Type":"NodeParagraph","Properties":{"id":"20231211212048-5l5s5p8","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;import"},{"Type":"NodeText","Data":"​表示按照生成的Go代码的包的全路径去创建目录层级"}]}]},{"ID":"20231211212048-8tkz6bd","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-8tkz6bd","updated":"20231211212048"},"Children":[{"ID":"20231211212048-3pkk5tv","Type":"NodeParagraph","Properties":{"id":"20231211212048-3pkk5tv","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;span\u0026gt;source_relative"},{"Type":"NodeText","Data":"​ 表示按照 proto源文件的目录层级去创建Go代码的目录层级，如果目录已存在则不用创建。"}]}]}]},{"ID":"20231211212048-djrxh34","Type":"NodeParagraph","Properties":{"id":"20231211212048-djrxh34","updated":"20231211212048"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"总之，用"},{"Type":"NodeTextMark","TextMarkType":"strong code","TextMarkTextContent":"google.golang.org/protobuf"},{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"就对了！"}]},{"ID":"20231211212048-tjjazrv","Type":"NodeThematicBreak","Properties":{"id":"20231211212048-tjjazrv","updated":"20231211212048"}},{"ID":"20231211212048-u81r157","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20231211212048-u81r157","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"Buf 工具"}]},{"ID":"20231211212048-efsigfh","Type":"NodeParagraph","Properties":{"id":"20231211212048-efsigfh","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"可以看到使用protoc的时候，当使用的插件逐渐变多，插件参数逐渐变多时，命令行执行并不是很方便和直观。例如后面使用到了grpc-gateway+swagger插件时"}]},{"ID":"20231211212048-0bz1tfy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-0bz1tfy","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ protoc -I ./pb \\\n  --go_out ./ecommerce --go_opt paths=source_relative \\\n  --go-grpc_out ./ecommerce --go-grpc_opt paths=source_relative \\\n  --grpc-gateway_out ./ecommerce --grpc-gateway_opt paths=source_relative \\\n  --openapiv2_out ./doc --openapiv2_opt logtostderr=true \\\n  ./pb/ecommerce/v1/product.proto\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-ttsr1wu","Type":"NodeParagraph","Properties":{"id":"20231211212048-ttsr1wu","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"其次依赖某些外部的protobuf文件时，只能通过拷贝到本地的方式，也不够方便"}]},{"ID":"20231211212048-esuvhyh","Type":"NodeParagraph","Properties":{"id":"20231211212048-esuvhyh","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"因此诞生了✨ Buf 这个项目，它除了能解决上述问题，还有额外的功能"}]},{"ID":"20231211212048-7jyv6wd","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-7jyv6wd","updated":"20231211212048"},"Children":[{"ID":"20231211212048-os1ta4h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-os1ta4h","updated":"20231211212048"},"Children":[{"ID":"20231211212048-bj83trp","Type":"NodeParagraph","Properties":{"id":"20231211212048-bj83trp","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"不兼容破坏检查"}]}]},{"ID":"20231211212048-lhr3myu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-lhr3myu","updated":"20231211212048"},"Children":[{"ID":"20231211212048-n1yibcs","Type":"NodeParagraph","Properties":{"id":"20231211212048-n1yibcs","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"linter"}]}]},{"ID":"20231211212048-mvrv75h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-mvrv75h","updated":"20231211212048"},"Children":[{"ID":"20231211212048-usramq5","Type":"NodeParagraph","Properties":{"id":"20231211212048-usramq5","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"集中式的版本管理"}]}]}]},{"ID":"20231211212048-7kdqlr6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-7kdqlr6","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"初始化模块"}]},{"ID":"20231211212048-0v3cemt","Type":"NodeParagraph","Properties":{"id":"20231211212048-0v3cemt","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"在pb文件的根目录执行，为这个pb目录创建一个buf的模块。此后便可以使用buf的各种命令来管理这个buf模块了"}]},{"ID":"20231211212048-5044o1n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-5044o1n","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ buf mod init\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-ivymnpu","Type":"NodeParagraph","Properties":{"id":"20231211212048-ivymnpu","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"此时会在根目录多出一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf.yaml"},{"Type":"NodeText","Data":"​文件，内容为"}]},{"ID":"20231211212048-3cv6x9k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-3cv6x9k","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# buf.yaml\nversion: v1\nbreaking:\n  use:\n    - FILE\nlint:\n  use:\n    - DEFAULT\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-wllajds","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-wllajds","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"Lint pb文件"}]},{"ID":"20231211212048-te64olp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-te64olp","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"$ buf lint\necommerce/v1/product.proto:10:9:Service name \"ServiceOrderManagement\" should be suffixed with \"Service\".\necommerce/v1/product.proto:11:18:RPC request type \"getOrderReq\" should be named \"GetOrderRequest\" or \"ServiceOrderManagementGetOrderRequest\".\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-xteqrqm","Type":"NodeParagraph","Properties":{"id":"20231211212048-xteqrqm","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"调整lint规则"}]},{"ID":"20231211212048-5egocaa","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-5egocaa","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":" # buf.yaml\n version: v1\n breaking:\n   use:\n     - FILE\n lint:\n   use:\n     - DEFAULT\n+  except:\n+    - PACKAGE_VERSION_SUFFIX\n+    - FIELD_LOWER_SNAKE_CASE\n+    - SERVICE_SUFFIX\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-ga5qi1p","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-ga5qi1p","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"生成代码"}]},{"ID":"20231211212048-zmyxe0u","Type":"NodeParagraph","Properties":{"id":"20231211212048-zmyxe0u","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"插件：和使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc"},{"Type":"NodeText","Data":"​一样，该装的插件一样要装"}]},{"ID":"20231211212048-j99nysf","Type":"NodeParagraph","Properties":{"id":"20231211212048-j99nysf","updated":"20231211212048"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"插件模版"}]},{"ID":"20231211212048-spy3ol1","Type":"NodeParagraph","Properties":{"id":"20231211212048-spy3ol1","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"创建一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf.gen.yaml"},{"Type":"NodeText","Data":"​ ，它是buf生成代码的配置。上面的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protoc"},{"Type":"NodeText","Data":"​同等功能的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf.gen.yaml"},{"Type":"NodeText","Data":"​可以写成如下形式，相对protoc更加直观"}]},{"ID":"20231211212048-vay23h7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-vay23h7","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# buf.gen.yaml\nversion: v1\nplugins:\n  - plugin: go\n    out: ecommerce\n    opt:\n      - paths=source_relative\n  - plugin: go-grpc\n    out: ecommerce\n    opt:\n      - paths=source_relative\n  - name: grpc-gateway\n    out: ecommerce\n    opt:\n      - paths=source_relative\n      - generate_unbound_methods=true\n  - name: openapiv2\n    out: doc\n    opt:\n      - logtostderr=true\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-3zyhg1l","Type":"NodeParagraph","Properties":{"id":"20231211212048-3zyhg1l","updated":"20231211212048"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"生成代码"}]},{"ID":"20231211212048-8klwmub","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-8klwmub","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"buf generate pb\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-vk5nu04","Type":"NodeParagraph","Properties":{"id":"20231211212048-vk5nu04","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf generate"},{"Type":"NodeText","Data":"​ 命令将会"}]},{"ID":"20231211212048-1a28zg8","Type":"NodeList","ListData":{},"Properties":{"id":"20231211212048-1a28zg8","updated":"20231211212048"},"Children":[{"ID":"20231211212048-nsmopbn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-nsmopbn","updated":"20231211212048"},"Children":[{"ID":"20231211212048-0p0wsnh","Type":"NodeParagraph","Properties":{"id":"20231211212048-0p0wsnh","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"搜索每一个"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf.yaml"},{"Type":"NodeText","Data":"​配置里的所有"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​文件"}]}]},{"ID":"20231211212048-zzhfu6g","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-zzhfu6g","updated":"20231211212048"},"Children":[{"ID":"20231211212048-f1fiua7","Type":"NodeParagraph","Properties":{"id":"20231211212048-f1fiua7","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"复制所有"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​文件到内存"}]}]},{"ID":"20231211212048-ll0kps9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-ll0kps9","updated":"20231211212048"},"Children":[{"ID":"20231211212048-nz576tx","Type":"NodeParagraph","Properties":{"id":"20231211212048-nz576tx","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"编译所有"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"protobuf"},{"Type":"NodeText","Data":"​文件"}]}]},{"ID":"20231211212048-ccjrjbz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20231211212048-ccjrjbz","updated":"20231211212048"},"Children":[{"ID":"20231211212048-sl1wc5u","Type":"NodeParagraph","Properties":{"id":"20231211212048-sl1wc5u","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"执行模版文件里的每一个插件"}]}]}]},{"ID":"20231211212048-44qkc94","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20231211212048-44qkc94","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"添加依赖"}]},{"ID":"20231211212048-zhwxe3m","Type":"NodeParagraph","Properties":{"id":"20231211212048-zhwxe3m","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"在使用grpc-gateway时依赖了"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"google.api.http"},{"Type":"NodeText","Data":"​，在不使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf"},{"Type":"NodeText","Data":"​的场景，我们需要手动复制"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":".proto"},{"Type":"NodeText","Data":"​到本地。"}]},{"ID":"20231211212048-oszjdxd","Type":"NodeParagraph","Properties":{"id":"20231211212048-oszjdxd","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf"},{"Type":"NodeText","Data":"​为我们提供了 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Buf Schema Registry (BSR)"},{"Type":"NodeText","Data":"，除了可以使用其他人发布的模块，也可以把我们自己的模块发布到"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"BSR"},{"Type":"NodeText","Data":"​"}]},{"ID":"20231211212048-q7ckz2b","Type":"NodeParagraph","Properties":{"id":"20231211212048-q7ckz2b","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"在模块的文件里声明依赖项"}]},{"ID":"20231211212048-hkis0w4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-hkis0w4","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":" # buf.yaml\n version: v1\n breaking:\n   use:\n     - FILE\n lint:\n   use:\n     - DEFAULT\ndeps:\n  - buf.build/googleapis/googleapis\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-rghfm2p","Type":"NodeParagraph","Properties":{"id":"20231211212048-rghfm2p","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"然后执行"}]},{"ID":"20231211212048-r5oj8mq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-r5oj8mq","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"buf mod update\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-l2ppzx6","Type":"NodeParagraph","Properties":{"id":"20231211212048-l2ppzx6","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf mod update"},{"Type":"NodeText","Data":"​ 把你所有的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"deps"},{"Type":"NodeText","Data":"​ 更新到最新版。并且会生成 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf.lock"},{"Type":"NodeText","Data":"​ 来固定版本"}]},{"ID":"20231211212048-0fwl9rl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20231211212048-0fwl9rl","updated":"20231211212048"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"# Generated by buf. DO NOT EDIT.\nversion: v1\ndeps:\n  - remote: buf.build\n    owner: googleapis\n    repository: googleapis\n    commit: 75b4300737fb4efca0831636be94e517\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20231211212048-sl5ythr","Type":"NodeParagraph","Properties":{"id":"20231211212048-sl5ythr","updated":"20231211212048"},"Children":[{"Type":"NodeText","Data":"此时执行"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"buf generate pb"},{"Type":"NodeText","Data":"​ 即使本地没有依赖，也不会再报错缺少依赖了"}]}]}